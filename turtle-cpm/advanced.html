<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Advanced topics - turtle-cpm user guide</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">User Guide</li><li class="chapter-item expanded "><a href="installation.html"><strong aria-hidden="true">1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="usage.html"><strong aria-hidden="true">2.</strong> Usage</a></li><li class="chapter-item expanded "><a href="advanced.html" class="active"><strong aria-hidden="true">3.</strong> Advanced topics</a></li><li class="chapter-item expanded "><a href="news.html"><strong aria-hidden="true">4.</strong> Changelog</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">turtle-cpm user guide</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/vmiklos/turtle-cpm/edit/main/guide/src/advanced.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="advanced-topics"><a class="header" href="#advanced-topics">Advanced topics</a></h1>
<h2 id="distributed-usage"><a class="header" href="#distributed-usage">Distributed usage</a></h2>
<p>One big downside of mobile-based TOTP apps is that you can't login to machines if you loose your
phone, and the TOTP shared secrets on those devices are not backed up.  <code>cpm</code> supports distributed
storage of passwords in a way that's similar to single-master replication in DBMS terms.</p>
<p>One possible setup is to have a central machine where you edit your cpm database, e.g. your home
router which is usually available or your VPS in some hosting. Then you can replicate the <code>cpm</code>
database to your other devices by configuring a virtual <code>cpm</code> remote machine in your <code>.ssh/config</code>
on the other machines:</p>
<pre><code>Host cpm
        Hostname myserver.example.com
</code></pre>
<p>Finally pull the remote database to your local one, using:</p>
<pre><code class="language-sh">cpm sync
</code></pre>
<p>This allows searching in your passwords even when you're offline. Keep in mind that editing the
database on the slaves is not a good idea as the next sync will overwrite your local changes.</p>
<h2 id="toolkit-integration"><a class="header" href="#toolkit-integration">Toolkit integration</a></h2>
<p>In case you have scripts to generate your local configuration files containing passwords from
templates, <code>cpm</code> can be integrated into such a workflow, using the quiet mode of the search
subcommand. For example, if you have an app password at your mail provider, and you want to generate
your mutt configuration, you can query just the password from <code>cpm</code> using:</p>
<pre><code class="language-sh">cpm -q -m accounts.example.com -u $USER-mail-$HOSTNAME
</code></pre>
<h2 id="importing-the-old-cpm-xml-database"><a class="header" href="#importing-the-old-cpm-xml-database">Importing the old CPM XML database</a></h2>
<p>In case you used the old <code>cpm</code> tool, it used to store its data at <code>~/.cpmdb</code> as an XML file,
compressed and encrypted. If you want to import that into turtle-cpm's database, you can do so
using:</p>
<pre><code class="language-sh">cpm import
</code></pre>
<h2 id="inspecting-the-encrypted-database-manually"><a class="header" href="#inspecting-the-encrypted-database-manually">Inspecting the encrypted database manually</a></h2>
<p>In case you want to inspect the SQLite database of <code>cpm</code> manually, you need to decrypt it yourself,
using:</p>
<pre><code class="language-sh">gpg --decrypt -a -o decrypted.db ~/.local/state/cpm/passwords.db
</code></pre>
<p>After this, you can inspect the database using a GUI like:</p>
<pre><code class="language-sh">sqlitebrowser decrypted.db
</code></pre>
<p>Don't forget to delete the decrypted database after you're done with your investigation.</p>
<h2 id="reference-documentation"><a class="header" href="#reference-documentation">Reference documentation</a></h2>
<p>Apart from this guide, reference documentation is available in <code>cpm</code> itself. You can learn about the
possible subcommands using:</p>
<pre><code class="language-sh">cpm -h
</code></pre>
<p>You can also check all the available options for one given subcommand using e.g.:</p>
<pre><code class="language-sh">cpm create -h
</code></pre>
<p>An alternative to this is the manual pages under <code>man/</code>, which provide the same information.</p>
<h2 id="re-sharing-totp-shared-secrets"><a class="header" href="#re-sharing-totp-shared-secrets">Re-sharing TOTP shared secrets</a></h2>
<p>TOTP shared secrets are typically transfered as QR codes, though there is usually a fallback option
to get the shared secret string itself, which is what <code>cpm</code> can manage. However, the QR code also
contains other information about the shared secret, and there are tools like
<a href="https://stefansundin.github.io/2fa-qr/">2fa-qr</a> that allow obtaining the full <code>otpauth://</code> URL from the
QR code image. <code>cpm</code> supports storing these full URLs as well, they look something like this:</p>
<p>otpauth://totp/Myserver:myuser?secret=...&amp;digits=6&amp;algorithm=SHA1&amp;issuer=Myserver&amp;period=30</p>
<p>Where Myserver is some server-side app name and myuser is your user name.</p>
<p>The benefit of storing the full URL in the <code>cpm</code> database is that later you can re-share them as QR
codes using e.g.:</p>
<pre><code class="language-console">$ cpm -t totp --qrcode twitter
machine: twitter.com, service: http, user: myuser, password type: TOTP shared secret, password:
...
</code></pre>
<p>The following lines will be a QR code you can scan with a mobile app.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="usage.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="news.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="usage.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="news.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
