<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>turtle-cpm user guide</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">User Guide</li><li class="chapter-item expanded "><a href="installation.html"><strong aria-hidden="true">1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="usage.html"><strong aria-hidden="true">2.</strong> Usage</a></li><li class="chapter-item expanded "><a href="advanced.html"><strong aria-hidden="true">3.</strong> Advanced topics</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">turtle-cpm user guide</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>turtle-cpm is a command line tool to manage passwords, a replacement of the now gone <a href="https://www.harry-b.de/dokuwiki/doku.php?id=harry:cpm">cpm
project</a>.</p>
<p>The latest version is v3.0, released on 2022-07-27.  See the <a href="https://github.com/vmiklos/turtle-cpm/blob/main/NEWS.md">release
notes</a>.</p>
<p>Notable features:</p>
<ul>
<li>Simple database format: encrypted SQLite (via <code>gpg</code>), tracking machines, services, users and
passwords</li>
<li>Supports plain passwords and also Time-based one-time password (TOTP) shared secrets, calculating
the actual TOTP code via <code>oathtool</code></li>
<li>Can import the original cpm's XML database</li>
<li>A little bit better than trivial search: you can search for e.g. <code>ldap</code> or <code>mybank</code> without
telling if you are searching for a service type or machine name</li>
</ul>
<h2 id="the-turtle"><a class="header" href="#the-turtle">The turtle</a></h2>
<p>The turtle-cpm codebase is independent from the original cpm. It's turtle because this project is
not in C, so might be a little bit slower (though not significantly in practice).</p>
<h2 id="contributing"><a class="header" href="#contributing">Contributing</a></h2>
<p>turtle-cpm is free and open source. You can find the source code on
<a href="https://github.com/vmiklos/turtle-cpm">GitHub</a> and issues and feature requests can be posted on the
issue tracker. If you'd like to contribute, please consider opening a pull request.</p>
<h2 id="license"><a class="header" href="#license">License</a></h2>
<p>Use of this source code is governed by a BSD-style license that can be found in the LICENSE file.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<p>cpm has been used on Linux, but nothing was done intentionally to prevent it from working on e.g.
macOS or Windows.</p>
<h2 id="dependencies"><a class="header" href="#dependencies">Dependencies</a></h2>
<p>You need to install <a href="https://gnupg.org/">GPG</a> if you don't have it already and need to generate at
least a key using:</p>
<pre><code class="language-sh">gpg --gen-key
</code></pre>
<p>This will allow cpm to encrypt and decrypt your password database. Don't fear from specifying a
passphrase for your key: you'll only have to enter it once after login (thanks to
<a href="https://www.gnupg.org/documentation/manuals/gnupg/Invoking-GPG_002dAGENT.html">gpg-agent</a>), and
this way an attacker can't get access to your passwords, even if they steal both your private key &amp;
your cpm database.</p>
<p>Optionally, you can install <a href="https://www.nongnu.org/oath-toolkit/">oathtool</a> in case you're
interested in TOTP support.</p>
<p>Optionally, you can install <a href="http://sourceforge.net/projects/pwgen/">pwgen</a> in case you want to have
auto-generated passwords.</p>
<h2 id="build-from-source"><a class="header" href="#build-from-source">Build from source</a></h2>
<p>You can install cpm using:</p>
<pre><code class="language-sh">go install vmiklos.hu/go/turtle-cpm@latest
</code></pre>
<p>If you don't have the original cpm around, you can make a symlink to allow less typing:</p>
<pre><code class="language-sh">ln -s $(go env GOPATH)/bin/turtle-cpm ~/bin/cpm
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="usage"><a class="header" href="#usage">Usage</a></h1>
<p>cpm supports creating, reading, updating and deleting passwords. You'll just create and read them
most of the time, though.</p>
<h2 id="creating"><a class="header" href="#creating">Creating</a></h2>
<p>You can ask cpm to generate a password for you and remember it using:</p>
<pre><code class="language-sh">cpm create -m mymachine -u myuser
</code></pre>
<p>Or in case you already have non-HTTP service or a preferred password:</p>
<pre><code class="language-sh">cpm create -m mymachine -s myservice -u myuser -p mypassword
</code></pre>
<p>When the machine is not yours, it can be e.g. the domain of a website.</p>
<p>If you try to insert two passwords for the same machine/service/user combination, you will get an
error. You can update or delete a password, though (see below).</p>
<h2 id="reading"><a class="header" href="#reading">Reading</a></h2>
<p>You can search in your passwords by entering a search term. You can do this implicitly:</p>
<pre><code class="language-sh">cpm mymachine
</code></pre>
<p>In the less likely case when you have multiple passwords on a website, you can be much more explicit
and search using:</p>
<pre><code class="language-sh">cpm search -m mymachine -s myservice -u myuser
</code></pre>
<h2 id="totp-support"><a class="header" href="#totp-support">TOTP support</a></h2>
<p>TOTP is one from of Two-Factor Authentication (2FA), currently used by many popular websites
(Facebook, Twitter, etc). Once a website asks you to scan a QR code for
<a href="https://en.wikipedia.org/wiki/Time-based_one-time_password">TOTP</a> purposes, just ask for the TOTP
shared secret and then add it to cpm using:</p>
<pre><code class="language-sh">cpm create -m mymachine -u myuser -p &quot;MY TOTP SHARED SECRET&quot; -t totp
</code></pre>
<p>When searching, it's a good idea to first narrow down your search results to a single hit, e.g.
first confirm that:</p>
<pre><code class="language-sh">cpm twitter
</code></pre>
<p>just returns your password and your TOTP shared secret, and then you can generate the current TOTP
code using:</p>
<pre><code class="language-sh">cpm --totp twitter
</code></pre>
<h2 id="update-and-deletion"><a class="header" href="#update-and-deletion">Update and deletion</a></h2>
<p>Update is quite similar to creation. You can generate a new password using:</p>
<pre><code class="language-sh">cpm update -m mymachine -u myuser
</code></pre>
<p>If you want to specify a service or a new password explicitly, you can do that using:</p>
<pre><code class="language-sh">cpm update -m mymachine -s myservice -u myuser -p mynewpassword
</code></pre>
<p>Finally if you want to delete a password, you can do so by using:</p>
<pre><code class="language-sh">cpm delete -m mymachine -u myuser
</code></pre>
<p>Or if you want to specify the service explicitly:</p>
<pre><code class="language-sh">cpm delete -m mymachine -s myservice -u myuser
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="advanced-topics"><a class="header" href="#advanced-topics">Advanced topics</a></h1>
<h2 id="distributed-usage"><a class="header" href="#distributed-usage">Distributed usage</a></h2>
<p>One big downside of mobile-based TOTP apps is that you can't login to machines if you loose your
phone, and the TOTP shared secrets on those devices are not backed up.  <code>cpm</code> supports distributed
storage of passwords in a way that's similar to single-master replication in DBMS terms.</p>
<p>One possible setup is to have a central machine where you edit your cpm database, e.g. your home
router which is usually available or your VPS in some hosting. Then you can replicate the <code>cpm</code>
database to your other devices by configuring a virtual <code>cpm</code> remote machine in your <code>.ssh/config</code>
on the other machines:</p>
<pre><code>Host cpm
        Hostname myserver.example.com
</code></pre>
<p>Finally put <code>scripts/cpmsync.sh</code> somewhere in your <code>$PATH</code>, so you can copy from your master to your
slave using:</p>
<pre><code class="language-sh">cpmsync
</code></pre>
<p>This allows searching in your passwords even when you're offline. Keep in mind that editing the
database on the slaves is not a good idea as the next sync will overwrite your local changes.</p>
<h2 id="toolkit-integration"><a class="header" href="#toolkit-integration">Toolkit integration</a></h2>
<p>In case you have scripts to generate your local configuration files containing passwords from
templates, <code>cpm</code> can be integrated into such a workflow, using the quiet mode of the search
subcommand. For example, if you have an app password at your mail provider, and you want to generate
your mutt configuration, you can query just the password from <code>cpm</code> using:</p>
<pre><code class="language-sh">cpm -q -m accounts.example.com -u $USER-mail-$HOSTNAME
</code></pre>
<h2 id="importing-the-old-cpm-xml-database"><a class="header" href="#importing-the-old-cpm-xml-database">Importing the old CPM XML database</a></h2>
<p>In case you used the old <code>cpm</code> tool, it used to store its data at <code>~/.cpmdb</code> as an XML file,
compressed and encrypted. If you want to import that into turtle-cpm's database, you can do so
using:</p>
<pre><code class="language-sh">cpm import
</code></pre>
<h2 id="inspecting-the-encrypted-database-manually"><a class="header" href="#inspecting-the-encrypted-database-manually">Inspecting the encrypted database manually</a></h2>
<p>In case you want to inspect the SQLite database of <code>cpm</code> manually, you need to decrypt it yourself,
using:</p>
<pre><code class="language-sh">gpg --decrypt -a -o decrypted.db ~/.local/state/cpm/passwords.db
</code></pre>
<p>After this, you can inspect the database using a GUI like:</p>
<pre><code class="language-sh">sqlitebrowser decrypted.db
</code></pre>
<p>Don't forget to delete the decrypted database after you're done with your investigation.</p>
<h2 id="reference-documentation"><a class="header" href="#reference-documentation">Reference documentation</a></h2>
<p>Apart from this guide, reference documentation is available in <code>cpm</code> itself. You can learn about the
possible subcommands using:</p>
<pre><code class="language-sh">cpm -h
</code></pre>
<p>You can also check all the available options for one given subcommand using e.g.:</p>
<pre><code class="language-sh">cpm create -h
</code></pre>
<p>An alternative to this is the manual pages under <code>man/</code>, which provide the same information.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->

        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
