<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
    <channel>
        <title>What is Miklos hacking</title>
        <description></description>
        <link>https://vmiklos.hu/blog/</link>
        <item>
            <title>Mail merge Writer data source</title>
            <description>&lt;div class="paragraph"&gt;&lt;p&gt;If you ever used the
&lt;a href="https://help.libreoffice.org/Writer/Mail_Merge_Wizard"&gt;mail merge wizard&lt;/a&gt; with
data sources, then you know how it works: it typically needs some kind of data
source (e.g. a Calc spreadsheet), a Writer document containing the email or
letter (that contains fields), and then mail merge can generate the
personalized documents for you.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;In case you have an existing document where you already have such data in a
Writer table, you had to somehow transfer it to one of the formats for which
there was a data source driver, and then you could use it inside mail merge.
I&amp;#8217;ve now added a dedicated Writer driver in &lt;code&gt;connectivity/&lt;/code&gt;, so picking up
data directly from Writer tables is now possible.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;If you are interested how this looks like, here is a demo (click on the image
to see the video):&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;a class="image" href="https://youtu.be/thasVxlF5Fo"&gt;
&lt;img src="https://farm5.staticflickr.com/4298/36060010585_900a1c7f1c_o.png" alt="https://farm5.staticflickr.com/4298/36060010585_900a1c7f1c_o.png" /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;That&amp;#8217;s it for now&amp;#8201;&amp;#8212;&amp;#8201;as usual the commits are in master, so you can try this
right now with a 6.0 &lt;a href="http://dev-builds.libreoffice.org/daily/master/"&gt;daily
build&lt;/a&gt;. :-)&lt;/p&gt;&lt;/div&gt;
</description>
            <link>https://vmiklos.hu/blog/mail-merge-writer-data-source.html</link>
            <pubDate>Fri, 21 Jul 2017 09:46:11 +0200</pubDate>
            <guid isPermaLink="false">https://vmiklos.hu/blog/mail-merge-writer-data-source.html</guid>
        </item>
        <item>
            <title>Using LibreOffice with xmlsec from the system</title>
            <description>&lt;div class="paragraph"&gt;&lt;p&gt;LibreOffice uses a number of external libraries, and most of them can be
configured to use a bundled version or a system version. libxmlsec was an
exception previously (only the bundled version was usable), but LibreOffice
master (towards 6.0) doesn&amp;#8217;t have this limitation anymore.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Using a bundled version is a good choice in case:&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
you want to create self-contained binaries
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
you want to bisect a regression, where possibly the regression was
  introduced by upgrading one of the external libraries
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
the system (e.g. macOS, Windows) doesn&amp;#8217;t provide the relevant library
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Using a system version is a good thing in case:&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
you want to work with the system, not against it (if a Linux distro already
  provides libxmlsec, why ship a duplicated copy inside LibreOffice?)
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
being able to use a system version means our bundled version does not have
  custom patches which affect the functionality of the library
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
not having custom patches also means upstream benefit from our submitted
  patches, these patches are reviewed by competent maintainers and upgrading
  the external is easier, as there is no patchset to rebase.
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;With that in mind, let&amp;#8217;s have a look what blocked using system-xmlsec in the past:&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
LibreOffice inherited a large patchset from OpenOffice.org, commit
  694a2c53810dec6d8e069d74baf51e6cdda91faa (2012-11-30) had 16 patches, with
  this scary diffstat:
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre&gt;&lt;code&gt; 43 files changed, 5888 insertions(+), 1885 deletions(-)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
I even increased this when I added the
  &lt;a href="/blog/libreoffice-sha256-signatures.html"&gt;SHA256 patches&lt;/a&gt;, as back then
  I wasn&amp;#8217;t sure if it&amp;#8217;ll be ever possible to upgrade to a newer libxmlsec
  version.
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
Step by step I got rid of most of these patches, either by upstreaming them
  or realizing they are no longer necessary. Upstreaming wasn&amp;#8217;t always
  trivial, as for our purposes it was always easy to patch something, but for
  upstream non-compatible changes always have to be conditional. Today we have
  3 build-specific patches, 1 backport and 1 feature patch that is (at least)
  not necessary when signing / verifying documents with software-based
  certificates.
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
At the end
  &lt;a href="https://cgit.freedesktop.org/libreoffice/core/commit/?id=9752eccdd06f6695ec4f173ea93cada65063d1f0"&gt;two&lt;/a&gt;
  &lt;a href="https://cgit.freedesktop.org/libreoffice/core/commit/?id=ab50f0b08b22af1e60a0b6ce5e7e8e7d1f665216"&gt;more&lt;/a&gt;
  commits were necessary to support building against system-xmlsec, only adding
  minimal differences when using the system or the bundled xmlsec variants.
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;If you are a Linux distro packager then &lt;code&gt;--with-system-libs&lt;/code&gt; already implies
&lt;code&gt;--with-system-xmlsec&lt;/code&gt;, so you probably don&amp;#8217;t have to do anything. If you
build LO for static analysis (e.g. Coverity) then this should be also useful,
so not relevant issues in 3rd-party code don&amp;#8217;t have to be ignored manually.&lt;/p&gt;&lt;/div&gt;
</description>
            <link>https://vmiklos.hu/blog/system-xmlsec.html</link>
            <pubDate>Tue, 04 Jul 2017 21:33:18 +0200</pubDate>
            <guid isPermaLink="false">https://vmiklos.hu/blog/system-xmlsec.html</guid>
        </item>
        <item>
            <title>LibreOffice Perugia HackFest 2017</title>
            <description>&lt;div style="text-align: center; font-size: 0.6em;"&gt;
&lt;img src="https://farm5.staticflickr.com/4272/34874639921_ef2ce56d1c_z.jpg"/&gt;
&lt;p&gt;(via &lt;a href="https://twitter.com/ogervasi/status/868767747756503041"&gt;ogervasi&lt;/a&gt;)&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Last weekend I attended the LibreOffice
&lt;a href="https://wiki.documentfoundation.org/Hackfest/Perugia2017"&gt;Perugia&lt;/a&gt; HackFest
2017, with the primary goal of mentoring students (together with
&lt;a href="http://erack.org/blog/"&gt;Eike&lt;/a&gt; and Christian): provided they manage to
contribute at least one non-trivial easy hack, they get university credits for
their work.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;I worked with &lt;a href="https://gerrit.libreoffice.org/38160"&gt;Arianna&lt;/a&gt;,
&lt;a href="https://gerrit.libreoffice.org/38159"&gt;Claudio&lt;/a&gt;,
&lt;a href="https://gerrit.libreoffice.org/38161"&gt;Francesco&lt;/a&gt; and
&lt;a href="https://gerrit.libreoffice.org/38134"&gt;Gian&lt;/a&gt;, all of them managed to
achieve something by the end of the third day.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;When I was not helping others, I also fixed a few bugs:&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://bugs.documentfoundation.org/show_bug.cgi?id=107976"&gt;tdf#107976&lt;/a&gt; sw: let a view handle multiple transferables
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://bugs.documentfoundation.org/show_bug.cgi?id=107837"&gt;tdf#107837&lt;/a&gt; DOCX export: fix balanced multi-col section at doc end
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://bugs.documentfoundation.org/show_bug.cgi?id=107684"&gt;tdf#107684&lt;/a&gt; DOCX export: fix duplicated &amp;lt;w:outlineLvl&amp;gt; element for styles
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://bugs.documentfoundation.org/show_bug.cgi?id=106950"&gt;tdf#106950&lt;/a&gt; sw: support CharShadingValue property on paragraph styles
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Some photos I took during the event are &lt;a href="https://www.flickr.com/photos/vmiklos/albums/72157681387507534"&gt;available&lt;/a&gt;.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Thanks the organizers for the great event, also kudos to
&lt;a href="https://www.collaboraoffice.com/"&gt;Collabora&lt;/a&gt;, Red Hat and TDF for allowing
mentors to come! :-)&lt;/p&gt;&lt;/div&gt;
</description>
            <link>https://vmiklos.hu/blog/perugia2017.html</link>
            <pubDate>Wed, 31 May 2017 10:07:43 +0200</pubDate>
            <guid isPermaLink="false">https://vmiklos.hu/blog/perugia2017.html</guid>
        </item>
        <item>
            <title>xmlsec improvements in LibreOffice 5.4</title>
            <description>&lt;div class="paragraph"&gt;&lt;p&gt;This post summarizes the plumbing work around ODF/OOXML digital signatures
that I did on LibreOffice master after the 5.3 branch-off up to now. The big
thing is the
&lt;a href="https://gerrit.libreoffice.org/gitweb?p=core.git;a=commit;h=ad319fdfcaaa6092ea1ff76935e088c5122e0d2e"&gt;integration&lt;/a&gt;
of the libxmlsec 1.2.24 release. Among other things, this contains 2 larger
changes that I contributed upstream triggered by the needs of LibreOffice:&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
The &lt;a href="/blog/xmlsec-nss-ecdsa.html"&gt;ECDSA-SHA256 feature&lt;/a&gt; is something I
  already mentioned, but I did not bother to backport the SHA1 and the SHA256
  part, so those now arrived to LibreOffice as well.
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
xmlsec&amp;#8217;s &lt;code&gt;XMLSEC_KEYINFO_FLAGS_X509DATA_DONT_VERIFY_CERTS&lt;/code&gt; flag (while
  verifying signatures) was there, but its behavior was not clear (neither
  for &lt;a href="https://github.com/lsh123/xmlsec/pull/78"&gt;nss&lt;/a&gt; nor for
  &lt;a href="https://github.com/lsh123/xmlsec/pull/79"&gt;mscrypto&lt;/a&gt;). I&amp;#8217;ve changed it to be in
  sync what you have in other commands to avoid certificate validation (like
  &lt;code&gt;wget -k&lt;/code&gt; or &lt;code&gt;curl -k&lt;/code&gt;), which means as a next step there will be one less
  xmlsec patch in LibreOffice that prevents us from using xmlsec from the system
  on Linux. (Adding tests also detected that in the nss case not using that flag
  also didn&amp;#8217;t do verification by accident, this is now fixed as well.)
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;After the release I also noticed that creating signatures on Windows
&lt;a href="https://www.aleksey.com/pipermail/xmlsec/2017/010143.html"&gt;was broken&lt;/a&gt;, this is
now fixed on xmlsec master and also backported to LibreOffice.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;All this is available in LibreOffice master, towards 5.4.&lt;/p&gt;&lt;/div&gt;
</description>
            <link>https://vmiklos.hu/blog/xmlsec-lo54.html</link>
            <pubDate>Wed, 17 May 2017 09:09:59 +0200</pubDate>
            <guid isPermaLink="false">https://vmiklos.hu/blog/xmlsec-lo54.html</guid>
        </item>
        <item>
            <title>Improved rountrip of PDF images in LibreOffice</title>
            <description>&lt;div class="paragraph"&gt;&lt;p&gt;This is a follow-up to the &lt;a href="/blog/pdfium.html"&gt;previous post&lt;/a&gt; that
described how it is now possible to insert a PDF file as an image in
LibreOffice and export that back to PDF, while keeping the original PDF
contents. I&amp;#8217;ve recently improved this feature so the resulting file is smaller
and the vector image can be viewed in more viewers. First, thanks to
&lt;a href="http://www.pmg.be/"&gt;PMG&lt;/a&gt; who made this work possible.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Let&amp;#8217;s look at the previously mentioned &lt;em&gt;front page of a magazine&lt;/em&gt; sample when
it&amp;#8217;s viewed in okular. (A KDE pdf viewer, i.e. something that&amp;#8217;s not Adobe
Acrobat). The previously used &lt;em&gt;reference XObject&lt;/em&gt; PDF markup is not handled by
it, so the bitmap fallback was displayed:&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm4.staticflickr.com/3947/34031939205_5315a9afb4_o.png" alt="https://farm4.staticflickr.com/3947/34031939205_5315a9afb4_o.png" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Compare it with the new result:&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm3.staticflickr.com/2830/34031939425_24b9a126ee_o.png" alt="https://farm3.staticflickr.com/2830/34031939425_24b9a126ee_o.png" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Notice the sharp text in the first line.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Also the size of this sample is smaller now, since we don&amp;#8217;t write a large
bitmap, and the not shown second page of the PDF image: 2 385 984 &amp;#8594; 1 605 558
bytes (about one third of the output is avoided).&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Both techniques have pros and cons, here is a summary:&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
The &lt;em&gt;reference XObject&lt;/em&gt; approach allows you to preserve the full PDF data of
  the image: if it was of multiple pages, even that. Also, the LibreOffice
  code for this is simple: we just preserve a byte array&amp;#8201;&amp;#8212;&amp;#8201;that can hardly go
  wrong. The problem is that no non-Acrobat PDF viewer implements this,
  including e.g. your printer most probably.
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
The new approach uses the tokenizer I originally wrote for
  &lt;a href="/blog/pdf-sign.html"&gt;PDF signature verification&lt;/a&gt; purposes&amp;#8201;&amp;#8212;&amp;#8201;it extracts
  the page stream of the first page from the original file and uses it as a
  form XObject in the export result&amp;#8201;&amp;#8212;&amp;#8201;this is the same as how e.g. &lt;code&gt;pdfcrop&lt;/code&gt;
  works.  This markup is handled by almost all PDF viewers and also the
  resulting size is smaller, since the data of other pages is dropped and there
  is no fallback bitmap. The problem may be that this is a much more complex
  scenario, so it may go wrong (as usual, bugreports
  &lt;a href="https://bugs.documentfoundation.org/enter_bug.cgi?product=LibreOffice"&gt;are
  welcome&lt;/a&gt;).
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Nevertheless, the new approach seems like a much better default, so
LibreOffice no longer writes the &lt;em&gt;reference XObject&lt;/em&gt; approach unless you
explicitly request it in the PDF export dialog.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Some perhaps interesting details:&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
PDF page streams may be provided by multiple objects, but form XObjects must
  have a single stream, so it we handle the case when different parts of the
  page stream are compressed in different ways.
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
LibreOffice writes PDF-1.4 by default, in case you insert a PDF image that
  uses PDF-1.5+, we use pdfium to downgrade that markup to 1.4, and only
  then insert it.
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
Copying the page stream of the image is not enough, we also recursively copy
  all referenced objects from the source PDF, while rewriting all contained
  references, since the objects IDs in the old and new files differ. We also
  take care of proper scoping of named references in the resource dictionary, so
  you can use this feature recursively (insert a document as a PDF image, even
  if that document itself contains PDF images already). :-)
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;All this is available in LibreOffice master, towards 5.4.&lt;/p&gt;&lt;/div&gt;
</description>
            <link>https://vmiklos.hu/blog/pdf-image-rountrip.html</link>
            <pubDate>Tue, 18 Apr 2017 09:13:23 +0200</pubDate>
            <guid isPermaLink="false">https://vmiklos.hu/blog/pdf-image-rountrip.html</guid>
        </item>
        <item>
            <title>LibreOffice now uses pdfium to render inserted PDF images</title>
            <description>&lt;div class="paragraph"&gt;&lt;p&gt;pdfium is the rendering library used in Chromium&amp;#8217;s pdf viewer. It&amp;#8217;s based on
the foxit pdf renderer and its rendering quality is much better compared to
the pre-existing "convert PDF to ODG, then to an image" code when it comes to
just viewing a PDF file.  First, thanks to &lt;a href="http://www.pmg.be/"&gt;PMG&lt;/a&gt; who made
this work possible.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Let&amp;#8217;s look at a few samples that compare the old pdfimport rendering result
and the new pdfium-based one. One important feature is that embedded fonts are
handled. This is how this inserted PDF looked like previously:&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm4.staticflickr.com/3727/33163219940_3a2a3278a0_o.png" alt="https://farm4.staticflickr.com/3727/33163219940_3a2a3278a0_o.png" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Compare it with the new result:&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm3.staticflickr.com/2927/33547029855_92c1a5150d_o.png" alt="https://farm3.staticflickr.com/2927/33547029855_92c1a5150d_o.png" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Now let&amp;#8217;s see the front page of a magazine, you can see 4 unexpected artifacts:&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm4.staticflickr.com/3948/33563793222_8a6b8e8a6b_z.jpg" alt="https://farm4.staticflickr.com/3948/33563793222_8a6b8e8a6b_z.jpg" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;New result:&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm3.staticflickr.com/2809/33547029645_de7cbcd800_z.jpg" alt="https://farm3.staticflickr.com/2809/33547029645_de7cbcd800_z.jpg" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Finally a problem with pdfium was that LibreOffice got bitmaps from it, so in case you re-exported to PDF, the quality of these PDF images were worse than in the original PDF file. The PDF specification has a &lt;em&gt;reference XObject&lt;/em&gt; feature that helps in this case: it allows the PDF export to still write the bitmap to the exported PDF, but in case the reader supports this feature, the vector-based original file will be shown, not the bitmap.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Here is a simple hand-crafted star in a PDF file, as it looked initially:&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm3.staticflickr.com/2915/33163219680_30f63b4a82_z.jpg" alt="https://farm3.staticflickr.com/2915/33163219680_30f63b4a82_z.jpg" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;This is how it looks after LibreOffice&amp;#8217;s PDF export learned to emit reference XObjects:&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm4.staticflickr.com/3933/33547029485_4f487bb26c_z.jpg" alt="https://farm4.staticflickr.com/3933/33547029485_4f487bb26c_z.jpg" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;All this is available in LibreOffice master, towards 5.4.&lt;/p&gt;&lt;/div&gt;
</description>
            <link>https://vmiklos.hu/blog/pdfium.html</link>
            <pubDate>Mon, 20 Mar 2017 10:00:22 +0100</pubDate>
            <guid isPermaLink="false">https://vmiklos.hu/blog/pdfium.html</guid>
        </item>
        <item>
            <title>ECDSA support in xmlsec-nss, bundled by LibreOffice</title>
            <description>&lt;div class="paragraph"&gt;&lt;p&gt;Last month a
&lt;a href="https://bugs.documentfoundation.org/show_bug.cgi?id=105983"&gt;LibreOffice
bugreport&lt;/a&gt; was filed, as the ODF signature created with Hungarian citizen eID
cards is not something LibreOffice can verify. After a bit of research it
seemed that LibreOffice and NSS (what we use for crypto work on Linux/macOS)
is not a problem, but xmlsec&amp;#8217;s NSS backend does not recognize ECDSA keys (RSA
or DSA keys work fine).&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;The xmlsec improvements happened in these pull requests:&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://github.com/lsh123/xmlsec/pull/81"&gt;prepare the xmlsec ECDSA tests&lt;/a&gt;, so
  that they can test not only openssl, but NSS as well
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://github.com/lsh123/xmlsec/pull/83"&gt;add initial ECDSA support&lt;/a&gt; (SHA256
  hashing only)
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://github.com/lsh123/xmlsec/pull/88"&gt;SHA1 support&lt;/a&gt;
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://github.com/lsh123/xmlsec/pull/89"&gt;SHA512 support&lt;/a&gt;
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://github.com/lsh123/xmlsec/pull/91"&gt;fix read of uninitialized memory&lt;/a&gt;
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;After this the xmlsec code looked good enough. I had to request an update of
the bugdoc in the TDF bug twice, as the signature itself looked also incorrect
initially:&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
an attribute type in the signature that had no official abbreviation was
  described as "UNDEF" instead of the dotted decimal form
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://tools.ietf.org/html/rfc3279#section-2.2.3"&gt;RFC3279&lt;/a&gt; specifies that an
  ECDSA signature value in general should be ASN1-encoded in general, but
  &lt;a href="https://tools.ietf.org/html/rfc4050#section-3.3"&gt;RFC4050&lt;/a&gt; is specific to XML
  digital signatures and that one says it should &lt;strong&gt;not&lt;/strong&gt; be ASN1-encoded. The
  bugdoc was initially ASN1-encoded.
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Finally a warning still remains: while trying to parse the text of the
&lt;code&gt;&amp;lt;X509IssuerName&amp;gt;&lt;/code&gt; element, the dotted decimal form is still not parsed (see
this &lt;a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1342137"&gt;NSS bugreport&lt;/a&gt;). The
bug is confirmed on the mailing list, but no other progress have been made so
far.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Oh, and of course: Windows is still untouched, there a bigger problem remains:
we use CryptoAPI (not CNG) there, and that does not support ECDSA at all.
Hooray for open-source libs where you can add such support yourself. ;-)&lt;/p&gt;&lt;/div&gt;
</description>
            <link>https://vmiklos.hu/blog/xmlsec-nss-ecdsa.html</link>
            <pubDate>Mon, 13 Mar 2017 09:57:17 +0100</pubDate>
            <guid isPermaLink="false">https://vmiklos.hu/blog/xmlsec-nss-ecdsa.html</guid>
        </item>
        <item>
            <title>okular now supports online videos in PDF files</title>
            <description>&lt;div class="paragraph"&gt;&lt;p&gt;I rarely write about work did by others, but given that in the
&lt;a href="/blog/pdf-video-export.html"&gt;previous post&lt;/a&gt; I mentioned that linked videos
(when they are a http:// URL) are not working, I had a very positive
experience which is worth noting. :-)&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;I got a private mail nagging me to file a
&lt;a href="https://bugs.kde.org/show_bug.cgi?id=376574"&gt;bug&lt;/a&gt; and just 3 days later it got
fixed!&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Thanks to both Oliver for the nagging and to Albert for the actual fix.&lt;/p&gt;&lt;/div&gt;
</description>
            <link>https://vmiklos.hu/blog/okular-linked-video.html</link>
            <pubDate>Mon, 27 Feb 2017 09:53:06 +0100</pubDate>
            <guid isPermaLink="false">https://vmiklos.hu/blog/okular-linked-video.html</guid>
        </item>
        <item>
            <title>LibreOffice PDF export now supports videos</title>
            <description>&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm4.staticflickr.com/3924/32549564340_4d0990cfa4_o.png" alt="https://farm4.staticflickr.com/3924/32549564340_4d0990cfa4_o.png" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;PDF supports screen annotations, which means it&amp;#8217;s possible to play embedded
and linked videos on top of a static image. Given that LibreOffice also
supports videos, it made sense to add support for this in our PDF export
filter. First, thanks to &lt;a href="http://www.pmg.be/"&gt;PMG&lt;/a&gt; who made this work possible. This
is currently added for Writer and Impress.&lt;/p&gt;&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_linked_videos"&gt;Linked videos&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Linked videos are the situation when the video is not part of the document
itself, but it&amp;#8217;s located somewhere else, e.g. a http:// location. This is
helpful if you want to email around a PDF file, and want to avoid sending
large files when it has video content.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;&lt;a href="https://bugs.documentfoundation.org/show_bug.cgi?id=104841"&gt;tdf#104841&lt;/a&gt; is
about this situation, first I added support for
&lt;a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=9d6a749bc664f1876c938afb9eba4adc9f6ee09a"&gt;linked
videos in Impress&lt;/a&gt;, then
&lt;a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=81aef113056270ce65f9dee5fe31b6f60617973c"&gt;also&lt;/a&gt;
&lt;a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=0e71075bb7379af318482bb3abbb630c58db9ec9"&gt;in
Writer&lt;/a&gt;.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;The result can be played using Adobe Acrobat Reader&amp;#8201;&amp;#8212;&amp;#8201;for some reason okular
on Linux is a bit confused about http:// URLs, wants to convert them to
relative ones, and then fails as of today.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_embedded_videos"&gt;Embedded videos&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm3.staticflickr.com/2666/32115175413_ec6f64243a_z.jpg" alt="https://farm3.staticflickr.com/2666/32115175413_ec6f64243a_z.jpg" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;&lt;a href="https://bugs.documentfoundation.org/show_bug.cgi?id=105093"&gt;tdf#105093&lt;/a&gt; is the
embedded video case, this is handy in case you want to create an entirely
self-contained PDF, where even the video content is inside the PDF file as an
embedded file.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;After
&lt;a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=4ad249af88d15f2c8a09f0721a59d82718fcc201"&gt;Impress
support&lt;/a&gt; (and a trick around
&lt;a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=64d80d22851a38eb3f320f4e2b2bdf875da4d8b4"&gt;Draw
vs Impress shapes&lt;/a&gt;) the
&lt;a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=46153bdcf2f89e88607dfb0dd0003108796424e9"&gt;Writer
part&lt;/a&gt; wasn&amp;#8217;t too complicated.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Regarding the situation around various video containers and codecs, the above
code is quite agnostic. :-) On the LibreOffice side all we require is to be
able to extract a key frame from the video to provide a preview image, so e.g.
on Linux the support depends on what gstreamer plugins you have installed. The
video content is written to the PDF file as-is, so again if it will work in
the PDF reader is up to the reader&amp;#8217;s codec support. On Linux e.g. okular uses
vlc for video playback, so the range of supported formats is quite wide.  The
same is true on Windows, what I personally tested is LibreOffice&amp;#8217;s VLC backend
and the embedded QuickTime player in Acrobat Reader.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;All of this is available on LibreOffice master towards 5.4.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
            <link>https://vmiklos.hu/blog/pdf-video-export.html</link>
            <pubDate>Thu, 16 Feb 2017 09:38:45 +0100</pubDate>
            <guid isPermaLink="false">https://vmiklos.hu/blog/pdf-video-export.html</guid>
        </item>
        <item>
            <title>Impress bugfixes, in time for FOSDEM 2017</title>
            <description>&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm1.staticflickr.com/334/32605456735_ac88121be8_o.png" alt="https://farm1.staticflickr.com/334/32605456735_ac88121be8_o.png" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;&lt;a href="https://fosdem.org/2017/"&gt;FOSDEM 2017&lt;/a&gt; is here this weekend, and as Michael
Stahl pointed out, this (together with the LibreOffice annual conference) are
two time periods each year when lots of Impress bugfixes are made, as people
start &lt;a href="https://en.wikipedia.org/wiki/Eating_your_own_dog_food"&gt;dogfooding&lt;/a&gt;. ;-)
So below you can read about a pair of Impress bugs I fixed recently.&lt;/p&gt;&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_changing_font_size_now_takes_table_selection_into_account"&gt;Changing font size now takes table selection into account&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;&lt;a href="https://bugs.documentfoundation.org/show_bug.cgi?id=105502"&gt;tdf#105502&lt;/a&gt; is a
situation where you have an Impress table shape, and you select part of the
cells, then you click on the sidebar to change the font size. Previously this
affected all cells of the table shape, now only the selected cells are
updated.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_background_fill_for_shapes"&gt;Background fill for shapes&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm1.staticflickr.com/277/31761747774_4b1e6b8d38_o.png" alt="https://farm1.staticflickr.com/277/31761747774_4b1e6b8d38_o.png" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;&lt;a href="https://bugs.documentfoundation.org/show_bug.cgi?id=105150"&gt;tdf#105150&lt;/a&gt; is a
PPT(X) filter bug where a shape was previously imported as transparent, but it
actually has to have the same fill type as the slide background. In case of
PPTX this was already handled in general, but not in case the slide had no
explicit background. The result was that in case the shape was used to cover
other shapes, they were visible, leading to e.g. this unexpected red rectangle
on the screenshot.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;The same bug was present in the PPT import, though there existing support was
even more limited: just the "background colored objects" were collected, but
nothing was done to them. Now the above use-case should be as good for PPT as
it is for PPTX.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
            <link>https://vmiklos.hu/blog/fosdem-2017.html</link>
            <pubDate>Tue, 31 Jan 2017 09:17:26 +0100</pubDate>
            <guid isPermaLink="false">https://vmiklos.hu/blog/fosdem-2017.html</guid>
        </item>
    </channel>
</rss>
