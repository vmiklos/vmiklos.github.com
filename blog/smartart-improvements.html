<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.5.3" />
<meta name="description" content="SmartArt improvements in LibreOffice - Miklos' blog" />
<meta name="keywords" content="vmiklos, libereoffice, swig, git, python, hacking, bitlbee" />
<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/index.rss" />
<link rel="stylesheet" href="/blog/xhtml11.css" type="text/css" />
<link rel="stylesheet" href="/blog/xhtml11-quirks.css" type="text/css" />
<link rel="stylesheet" href="/blog/layout.css" type="text/css" />
<title>SmartArt improvements in LibreOffice</title>
<!-- google analytics start -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-24726997-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- google analytics end -->
</head>
<body>
<div id="layout-banner-box">
<div id="layout-banner">
  <div id="layout-title">vmiklos.hu</div>
  <div id="layout-description">shameless self-promoting website</div>
</div>
</div>
<div id="layout-menu-box">
<div id="layout-menu">
  <div>&#187;<a href="/">Root</a></div>
  <div>&#187;<a href="/blog/">Rejourn root</a></div>
  <div>&#187;<a href="http://planet.documentfoundation.org/">LibreOffice Community Blogs</a></div>
  <div>
    Search:<br/>
    <form action="http://www.google.com/cse" id="cse-search-box" target="_blank">
    <input type="hidden" name="cx" value="007336731492173318056:bik8fqvatno"/><input type="hidden" name="ie" value="UTF-8"/><input type="text" name="q" size="15"/><br/>
    <input type="submit" name="sa" value="&#187;"/></form>
  </div>
</div>

</div>
<div id="layout-content-box">
<div id="layout-content">
<div id="header">
	<h1>SmartArt improvements in LibreOffice</h1>
</div>
<div id="preamble">
<div class="sectionbody">

<!-- Single entry -->
<div class="verseblock">
<div class="verseblock-content">Posted <span class="timeago" title="2018-11-05T16:35:25Z">Monday, 05 November 2018</span> by Miklos<br />
    Tags:
    <a href="tags/en.html">en</a>
    <a href="tags/libreoffice.html">libreoffice</a>
<div class="nav-previous"><a href="/blog/libocon2018-lightning.html" rel="prev"><span class="meta-nav">&larr;</span> Text layout performance in LibreOffice conference lightning talk</a></div>
</div>
</div>

<!-- Body -->
<div class="paragraph"><p>I recently dived into the SmartArt support of LibreOffice, which is the
component responsible for displaying complex diagrams from PPTX, especially in
case only document model and the layout constraints are given, not a
pre-rendered result.</p></div>
<div class="paragraph"><p>First, thanks to our partner <a href="https://www.suse.com/">SUSE</a> for working with
<a href="https://www.collaboraoffice.com/">Collabora</a> to make this possible.</p></div>
<div class="sect1">
<h2 id="_the_problem">The problem</h2>
<div class="sectionbody">
<div class="paragraph"><p>There are several ones. :-) If you are just interested in high quality viewing
of PPTX files, then your problem started with PowerPoint 2007 not writing a
pre-rendered drawingML markup of the diagram to the files, only PowerPoint
2010 started behaving like this. Additionally, if a diagram is not edited,
then re-saving with PowerPoint 2010 doesn&#8217;t seem to generate the drawingML
markup, either. This means that data + constraints cases are quite frequent
even today.</p></div>
<div class="paragraph"><p>Also, one day Impress should be able to actually edit these SmartArts as well,
so having the knowledge how to lay out SmartArt (even if it&#8217;s import-time-only
at the moment) is a good thing.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_results_so_far">Results so far</h2>
<div class="sectionbody">
<div class="paragraph"><p>I always write cppunit tests when I work on filter code (in this case OOXML), so
far all fixes were visible in just two test files:
<a href="https://cgit.freedesktop.org/libreoffice/core/tree/sd/qa/unit/data/pptx/smartart-vertial-box-list.pptx">smartart-vertial-box-list.pptx</a>
and
<a href="https://cgit.freedesktop.org/libreoffice/core/tree/sd/qa/unit/data/pptx/vertical-bracket-list.pptx">vertical-bracket-list.pptx</a>.</p></div>
<div class="paragraph"><p>Here is how the baseline, the current and the reference rendering of these test documents look like:</p></div>
<div style="text-align: center">
<img src="https://farm2.staticflickr.com/1924/45683201352_52e22af9dc_z.jpg"/>
<p>smartart-vertial-box-list.pptx, baseline</p>
</div>
<div style="text-align: center">
<img src="https://farm5.staticflickr.com/4912/45683200942_8005cd433d_z.jpg"/>
<p>smartart-vertial-box-list.pptx, current</p>
</div>
<div style="text-align: center">
<img src="https://farm2.staticflickr.com/1976/45683201252_edd6eddea4_z.jpg"/>
<p>smartart-vertial-box-list.pptx, reference</p>
</div>
<div style="text-align: center">
<img src="https://farm2.staticflickr.com/1951/45683201002_4c93cc831c_z.jpg"/>
<p>vertical-bracket-list.pptx, baseline</p>
</div>
<div style="text-align: center">
<img src="https://farm5.staticflickr.com/4876/45008491984_61f25e21ca_z.jpg"/>
<p>vertical-bracket-list.pptx, current</p>
</div>
<div style="text-align: center">
<img src="https://farm2.staticflickr.com/1911/45683201082_3022aa8fe5_z.jpg"/>
<p>vertical-bracket-list.pptx, reference</p>
</div>
<div class="paragraph"><p>In terms of code commits, the fixes are split into several ones:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=e49c42d17f50c8b0cac9db08dedc375dd5aa8a98">oox
  smartart, vertical bracket list: fix node counter condition</a>
</p>
</li>
<li>
<p>
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=397b64afc62a5632a6648598558a4d2c3ca0d283">oox
  smartart, linear layout: take horizontal position from constraints</a>
</p>
</li>
<li>
<p>
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=b083b0808121d19f398a9f6ead195ae7e14ed047">oox
  smartart, linear layout: take width from constraints</a>
</p>
</li>
<li>
<p>
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=923061d17d4b5b8bf0d4a8111b270c99a7c649a9">oox
  smartart: work towards accessing parent constraints</a>
</p>
</li>
<li>
<p>
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=b61d2784271bf8b042642c378f50e8b446682548">oox
  smartart: fix width of shapes with agl=lin, linDir=fromT</a>
</p>
</li>
<li>
<p>
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=a7e86beb00e9635ea4556ef4f8f8e24ff9965391">oox:
  ignore SmartArt "fallback" with empty shape list</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>Clearly the results are not perfect yet, but in both cases nothing was
visible, and now all text is readable, so we&#8217;re moving in the right direction!</p></div>
<div class="paragraph"><p>All this is available in master (towards LibreOffice 6.2), so you can grab a
<a href="http://dev-builds.libreoffice.org/daily/master/">daily build</a> and try it out
right now. :-)</p></div>
</div>
</div>


</div>
</div>
</div>
</div>
</body>
</html>
