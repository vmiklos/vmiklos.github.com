<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.5.3" />
<meta name="description" content="What is Miklos hacking - Tags: libreoffice - Miklos' blog" />
<meta name="keywords" content="vmiklos, libereoffice, swig, git, python, hacking, bitlbee" />
<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://vmiklos.hu/blog/index.rss" />
<link rel="stylesheet" href="/blog/xhtml11.css" type="text/css" />
<link rel="stylesheet" href="/blog/xhtml11-quirks.css" type="text/css" />
<link rel="stylesheet" href="/blog/layout.css" type="text/css" />
<title>What is Miklos hacking - Tags: libreoffice</title>
<!-- google analytics start -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-24726997-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- google analytics end -->
</head>
<body>
<div id="layout-banner-box">
<div id="layout-banner">
  <div id="layout-title">vmiklos.hu</div>
  <div id="layout-description">shameless self-promoting website</div>
</div>
</div>
<div id="layout-menu-box">
<div id="layout-menu">
  <div>&#187;<a href="/">Root</a></div>
  <div>&#187;<a href="/blog/">Rejourn root</a></div>
  <div>&#187;<a href="http://planet.documentfoundation.org/">LibreOffice Community Blogs</a></div>
  <div>
    Search:<br/>
    <form action="http://www.google.com/cse" id="cse-search-box" target="_blank">
    <input type="hidden" name="cx" value="007336731492173318056:bik8fqvatno"/><input type="hidden" name="ie" value="UTF-8"/><input type="text" name="q" size="15"/><br/>
    <input type="submit" name="sa" value="&#187;"/></form>
  </div>
</div>


</div>
<div id="layout-content-box">
<div id="layout-content">
<div id="header">
	<h1>What is Miklos hacking - Tags: libreoffice</h1>
</div>
<div id="preamble">
<div class="sectionbody">




<!-- Listing -->
<div class="ulist"><ul>
<li><p>Sunday, 31 January 2016<br /><a href="/blog/fosdem2016.html">Mail merge embedding in LibreOffice Writer FOSDEM talk</a>
(<a href="/blog/fosdem2016.html#disqus_thread">Comments</a>)
</p><p><div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://speakerd.s3.amazonaws.com/presentations/30e7f96db4a8430cbe7938245b545880/mm-fosdem-brussels-2k16.pdf">
<img src="https://lh3.googleusercontent.com/-tY-2qENlPkA/Vq3iZ4wlO9I/AAAAAAAAGbY/o7lbUDAUoHo/s800-Ic42/" alt="https://lh3.googleusercontent.com/-tY-2qENlPkA/Vq3iZ4wlO9I/AAAAAAAAGbY/o7lbUDAUoHo/s800-Ic42/" />
</a>
</div>
</div>
<div class="paragraph"><p>Yesterday I gave a
<a href="https://fosdem.org/2016/schedule/event/libreoffice_mail_merging/">Mail merge
embedding in LibreOffice Writer</a> talk at FOSDEM 2016, in the
<a href="https://fosdem.org/2016/schedule/track/open_document_editors/">Open document
editors developer room</a>. The room was well-crowded&#8201;&#8212;&#8201;seems this year LibreOffice
Online was a hot topic. ;-)</p></div>
<div class="paragraph"><p>We also had a
<a href="https://wiki.documentfoundation.org/Hackfest/FOSDEM2016">hackfest</a> with about
20 hackers attending, (again) kindly hosted by
<a href="http://www.betacowork.com/">Betacowork</a> on Thursday and Friday, before FOSDEM.</p></div>
<div class="paragraph"><p>There were a few topics I hacked on:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://gerrit.libreoffice.org/gitweb?p=core.git;a=commitdiff;h=552361aaad740e55fcfa7993b4111aba354f863f">.uno:Paste
  AnchorType param</a> for Writer
</p>
</li>
<li>
<p>
<a href="https://bugs.documentfoundation.org/show_bug.cgi?id=97371">tdf#97371</a> DOCX import regression fix about TextBoxes
</p>
</li>
<li>
<p>
<a href="https://bugs.documentfoundation.org/show_bug.cgi?id=96175">tdf#96175</a> RTF export feature about <em>company</em> doc property
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/gitweb?p=core.git;a=commitdiff;h=363aa5dbb2c223b6cc3a109bd654f39772e310fa">refactoring</a>
  around Writer&#8217;s new (in 5.1) hide-whitespace feature, as requested by Ashod
</p>
</li>
<li>
<p>
code coverage: <code>RtfExport::WriteRevTab()</code> was completely untested
  previously, now
  <a href="https://gerrit.libreoffice.org/gitweb?p=core.git;a=commitdiff;h=8ff66c71bb4da8d0e4454e250e480eada9fe226c">fixed</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>A full list of achievements is
<a href="https://wiki.documentfoundation.org/Hackfest/FOSDEM2016#Achievements">available</a>, if
you were at the hackfest and you did not contribute to that section, please
write a line about what did you hack on. :-)</p></div>
<div class="paragraph"><p>Quite some other slides are now available on
<a href="http://planet.documentfoundation.org/">Planet</a>, don&#8217;t miss them.</p></div>
</p><hr/></li>
<li><p>Tuesday, 12 January 2016<br /><a href="/blog/rtf-page-background-export.html">RTF page background export in LibreOffice Writer</a>
(<a href="/blog/rtf-page-background-export.html#disqus_thread">Comments</a>)
</p><p><div class="paragraph"><p>While I added support for page background colors in the RTF import
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=14e163b0caf97addf340aefc5760a9031ec98390">back
in 2013</a>, the export part was missing up to now.</p></div>
<div class="paragraph"><p>If you set a solid color fill for a page style, and you export it to RTF, here
is how the reference rendering output looks like:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://lh3.googleusercontent.com/-JI384fzDsng/VpEkSeMEgfI/AAAAAAAAGYY/GXhT1tzi4WQ/s900-Ic42/reference.png">
<img src="https://lh3.googleusercontent.com/-JI384fzDsng/VpEkSeMEgfI/AAAAAAAAGYY/GXhT1tzi4WQ/s900-Ic42/reference.png" alt="https://lh3.googleusercontent.com/-JI384fzDsng/VpEkSeMEgfI/AAAAAAAAGYY/GXhT1tzi4WQ/s900-Ic42/reference.png" />
</a>
</div>
</div>
<div class="paragraph"><p>However, in Libreoffice only the background of the paragraph reflected the
color set by the user:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://lh3.googleusercontent.com/-YZDNx5H0qYQ/VpEkSWxf2II/AAAAAAAAGYU/o4Q06VeBK-I/s900-Ic42/bad.png">
<img src="https://lh3.googleusercontent.com/-YZDNx5H0qYQ/VpEkSWxf2II/AAAAAAAAGYU/o4Q06VeBK-I/s900-Ic42/bad.png" alt="https://lh3.googleusercontent.com/-YZDNx5H0qYQ/VpEkSWxf2II/AAAAAAAAGYU/o4Q06VeBK-I/s900-Ic42/bad.png" />
</a>
</div>
</div>
<div class="paragraph"><p>After implementing this feature in the RTF export filter, it now looks much
closer to the reference:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://lh3.googleusercontent.com/--6VbXTzbA_k/VpEkSWJB7tI/AAAAAAAAGYc/D7KEn0lLvXw/s900-Ic42/good.png">
<img src="https://lh3.googleusercontent.com/--6VbXTzbA_k/VpEkSWJB7tI/AAAAAAAAGYc/D7KEn0lLvXw/s900-Ic42/good.png" alt="https://lh3.googleusercontent.com/--6VbXTzbA_k/VpEkSWJB7tI/AAAAAAAAGYc/D7KEn0lLvXw/s900-Ic42/good.png" />
</a>
</div>
</div>
<div class="paragraph"><p>At the moment only solid fill is implemented, so other advanced fill types
like graphics or gradients are still missing.</p></div>
</p><hr/></li>
<li><p>Friday, 11 December 2015<br /><a href="/blog/rtf-rich-comment-export.html">Rich RTF comment export in LibreOffice Writer</a>
(<a href="/blog/rtf-rich-comment-export.html#disqus_thread">Comments</a>)
</p><p><div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://lh3.googleusercontent.com/-cPX4gcKiTxI/VmnrtwdnTXI/AAAAAAAAGTE/cYj_XZONoRg/s0-Ic42/">
<img src="https://lh3.googleusercontent.com/-cPX4gcKiTxI/VmnrtwdnTXI/AAAAAAAAGTE/cYj_XZONoRg/s400-Ic42/" alt="https://lh3.googleusercontent.com/-cPX4gcKiTxI/VmnrtwdnTXI/AAAAAAAAGTE/cYj_XZONoRg/s400-Ic42/" />
</a>
</div>
</div>
<div class="paragraph"><p>As it has been reported in
<a href="https://bugs.documentfoundation.org/show_bug.cgi?id=94377">tdf#94377</a>, the
state of Writer comment contents in the RTF export filter wasn&#8217;t great.</p></div>
<div class="paragraph"><p>With two recent changes, however, the situation is now much better:</p></div>
<div class="ulist"><ul>
<li>
<p>
I&#8217;ve added support for multiple paragraphs
</p>
</li>
<li>
<p>
I&#8217;ve added support for both paragraph and text portion formatting
</p>
</li>
</ul></div>
<div class="paragraph"><p>It wasn&#8217;t necessary to implement this from scratch, because comment contents
uses the same editeng store as the shape text, and there formatting was already
handled. A benefit of this code sharing is that shape text also handles
multiple paragraphs without a problem now. :-)</p></div>
<div class="paragraph"><p>The commits are backported to <code>libreoffice-5-1</code>, so users will see them
already in the upcoming 5.1.0 release.</p></div>
</p><hr/></li>
<li><p>Thursday, 26 November 2015<br /><a href="/blog/sanitizing-member-variable-names.html">Sanitizing member variable names in LibreOffice Writer</a>
(<a href="/blog/sanitizing-member-variable-names.html#disqus_thread">Comments</a>)
</p><p><div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://lh3.googleusercontent.com/-Qk6Y55f7HaY/VlYtR13vYeI/AAAAAAAAGRA/hK-7EJMFhwk/s0-Ic42/">
<img src="https://lh3.googleusercontent.com/-Qk6Y55f7HaY/VlYtR13vYeI/AAAAAAAAGRA/hK-7EJMFhwk/s400-Ic42/" alt="https://lh3.googleusercontent.com/-Qk6Y55f7HaY/VlYtR13vYeI/AAAAAAAAGRA/hK-7EJMFhwk/s400-Ic42/" />
</a>
</div>
</div>
<div class="paragraph"><p>Robinson just
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?h=libreoffice-5-1&amp;id=fa7c921feb2f6e14f7eca717dd3cfbca0bd35c03">branched
off</a> libreoffice-5-1 from master in LibreOffice&#8217;s core.git repository, so time
to talk about what happened behind the scenes in the 5.0 &#8594; 5.1 development
cycle from my side.</p></div>
<div class="paragraph"><p>One stylistic detail that annoyed me for a while was the inconsistency around
naming class member variables. In new code it&#8217;s common to give them an <code>m_</code>
(or at least an <code>m</code>) prefix, but in older code that wasn&#8217;t that common, and
various custom hacks were invented to differentiate between pointers which
point to the same memory address, but one being a parameter of a member
function, and the other being a member variable.</p></div>
<div class="paragraph"><p>Probably the worst scenario is when one was an abbreviation of the other, like
pTable and pTbl or pCursor and pCrsr. I took this as an opportunity to play
with Clang&#8217;s <a href="http://clang.llvm.org/docs/LibTooling.html">LibTooling</a>, and I
wrote two tools <a href="http://vmiklos.hu/blog/cambridge.html">back during the
Cambridge hackfest</a> to automate the process of finding and fixing missing
prefixes.</p></div>
<div class="paragraph"><p>To scope the renaming, I changed all classes in the <code>sw</code> module having more
than 20 unprefixed members to follow the above convention, hopefully this
nicely improves code readability, together with the
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=49c2b9808df8a6b197dec666dfc0cda6321a4306">mass-rename
of pointless abbreviations</a>, also done before the branch-off, so affecting
both libreoffice-5-1 and master. :-)</p></div>
</p><hr/></li>
<li><p>Wednesday, 04 November 2015<br /><a href="/blog/calc-png-export.html">PNG export in LibreOffice Calc</a>
(<a href="/blog/calc-png-export.html#disqus_thread">Comments</a>)
</p><p><div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://lh3.googleusercontent.com/-8n61EJB3Xco/VjkUn1JvuqI/AAAAAAAAGOE/0-DCtcNV2RY/s0-Ic42/">
<img src="https://lh3.googleusercontent.com/-8n61EJB3Xco/VjkUn1JvuqI/AAAAAAAAGOE/0-DCtcNV2RY/s400-Ic42/" alt="https://lh3.googleusercontent.com/-8n61EJB3Xco/VjkUn1JvuqI/AAAAAAAAGOE/0-DCtcNV2RY/s400-Ic42/" />
</a>
</div>
</div>
<div class="paragraph"><p>Both LibreOffice Writer and Impress has the ability to export the document as
PNG, which is one way to create thumbnails for documents&#8201;&#8212;&#8201;i.e. being able to
preview them before the real loading of the document happens. It turns out
Calc did not have this feature, and given that <code>ScModelObj</code> also supports the
<code>css::view::XRenderable</code> interface (just like Writer), I hoped that it won&#8217;t
be too complex to add one.</p></div>
<div class="paragraph"><p>You can refer to
<a href="http://fridrich.blogspot.com/2013/08/extending-swiss-army-knife-overview.html">Fridrich&#8217;s
overview blog post</a> for the complete list of steps on how to add a new filter
to LibreOffice, here the following steps
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=03bb5d52fecd6c613c6cc36508eb44e5e1c3456a">were
needed</a>:</p></div>
<div class="ulist"><ul>
<li>
<p>
improve <code>DocumentToGraphicRenderer</code>, so that it can handle that Calc does
  not implement the <code>text::XTextViewCursorSupplier</code> interface (Writer uses
  this one to expose the cursor is on what page)
</p>
</li>
<li>
<p>
register <code>png_Portable_Network_Graphic</code> as filter type for Calc
</p>
</li>
<li>
<p>
create a new <code>calc_png_Export</code> filter fragment
</p>
</li>
<li>
<p>
register a Calc graphic filters configuration type and filter group in
  <code>Configuration_filter</code> and <code>CustomTarget_registry</code>
</p>
</li>
<li>
<p>
testcase
</p>
</li>
</ul></div>
<div class="paragraph"><p>If you can&#8217;t wait till LibreOffice 5.1 is released to try out this new
feature, you can get a <a href="http://dev-builds.libreoffice.org/daily/master/">daily
build</a>. :-)</p></div>
</p><hr/></li>
<li><p>Tuesday, 20 October 2015<br /><a href="/blog/flat-odf-android.html">Flat ODF support in LibreOffice's Android port</a>
(<a href="/blog/flat-odf-android.html#disqus_thread">Comments</a>)
</p><p><div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://lh3.googleusercontent.com/-M9NDl_ptc9U/ViPqlxkmJwI/AAAAAAAAGLk/t92PSwTHAk0/s0-Ic42/">
<img src="https://lh3.googleusercontent.com/-M9NDl_ptc9U/ViPqlxkmJwI/AAAAAAAAGLk/t92PSwTHAk0/s400-Ic42/" alt="https://lh3.googleusercontent.com/-M9NDl_ptc9U/ViPqlxkmJwI/AAAAAAAAGLk/t92PSwTHAk0/s400-Ic42/" />
</a>
</div>
</div>
<div class="paragraph"><p>While LibreOffice&#8217;s Android port has as good support for ODF as the desktop
version, flat ODF was lagging behind. There were two reasons for this:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://gerrit.libreoffice.org/gitweb?p=core.git;a=commit;h=9aa6ec9bfaa3c76c291ab8ec9a1b87fb89b817e6">flat-ODF-related
  services were simply missing</a> from the .apk, for historical reasons: when
  the .apk limit was 50MB, it sounded like a good idea to leave these out if it
  allowed packaging e.g. editing-related services.
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/gitweb?p=core.git;a=commit;h=1956b50e3b4c63a913151fd21d21c42cd288173d">flat
  ODS was blacklisted explicitly</a>, from the times when Calc tiled rendering
  was missing, and when .ods was included again the document browser, .fods was
  forgotten.
</p>
</li>
</ul></div>
<div class="paragraph"><p>With these two fixes my favorite test documents (of which the ODF version
worked already previously) in flat ODF version also load properly in all
Writer, Calc and Impress&#8201;&#8212;&#8201;as can be seen on the above montage of
screenshots.</p></div>
</p><hr/></li>
<li><p>Friday, 09 October 2015<br /><a href="/blog/presenter-console.html">Restarting timer of the presenter console</a>
(<a href="/blog/presenter-console.html#disqus_thread">Comments</a>)
</p><p><div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://lh3.googleusercontent.com/-gedKN4759cE/VhZqBSpZL7I/AAAAAAAAGJs/Hlez6jX85ww/s0-Ic42/">
<img src="https://lh3.googleusercontent.com/-gedKN4759cE/VhZqBSpZL7I/AAAAAAAAGJs/Hlez6jX85ww/s400-Ic42/" alt="https://lh3.googleusercontent.com/-gedKN4759cE/VhZqBSpZL7I/AAAAAAAAGJs/Hlez6jX85ww/s400-Ic42/" />
</a>
</div>
</div>
<div class="paragraph"><p>This use-case came up during this year&#8217;s LibreOffice conference. I started the
Impress slideshow a few minutes in advance, so the audience could check if they
are at the correct room, seeing the title side. Right after starting the
slideshow, the presentation timer also started to count. I had to stop and
start the presentation, so I had an idea how much time my talk took so far. The
side effect of this workaround was that the audience saw an ugly short flash
while the presentation was not running at the moment I started talking.</p></div>
<div class="paragraph"><p>Because hacking the presenter console requires you to have two monitors, it&#8217;s
not something I looked into during the conference&#8217;s hackfest, but now here it
is: I
<a href="https://gerrit.libreoffice.org/gitweb?p=core.git;a=commit;h=b1a6a99b9a78689c6d3649ce066fad66912188e2">added</a>
a button to just restart the timer, then it&#8217;s not needed to stop/start the
presentation manually.</p></div>
<div class="paragraph"><p>The icon is just a placeholder for now, the real design is
<a href="http://listarchives.libreoffice.org/global/design/msg07351.html">in progress</a>.</p></div>
</p><hr/></li>
<li><p>Friday, 25 September 2015<br /><a href="/blog/libreoffices-android-port.html">LibreOffice's Android port</a>
(<a href="/blog/libreoffices-android-port.html#disqus_thread">Comments</a>)
</p><p><div style="text-align: center; font-size: 0.6em;">
<img src="https://lh3.googleusercontent.com/-Q_NX5YCu1Wk/VgT4uHIJI5I/AAAAAAAAGHo/AgTiFrgfDcA/s400-Ic42/"/>
<p>(via <a href="https://plus.google.com/115321503505930643274/posts/gsXjsZpW5DR">Andras Timar</a>)</p>
</div>
<div class="paragraph"><p>I had the pleasure to share where we are wrt. the Android port of LibreOffice
yesterday. Abstract on the
<a href="http://conference.libreoffice.org/2015/the-program/talks/development/#LibreOffice%27s%20Android%20port">conference
website</a>, slides at the
<a href="https://speakerdeck.com/vmiklos/libreoffices-android-port">usual place</a>, video
record "soon" as usual. :-)</p></div>
</p><hr/></li>
<li><p>Wednesday, 16 September 2015<br /><a href="/blog/base-form.html">Fixing Base form image backgrounds</a>
(<a href="/blog/base-form.html#disqus_thread">Comments</a>)
</p><p><div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://lh3.googleusercontent.com/-G5jug0myAVY/Vfh1U_i-QTI/AAAAAAAAGFQ/eZ-GKJqxqMU/s0-Ic42/">
<img src="https://lh3.googleusercontent.com/-G5jug0myAVY/Vfh1U_i-QTI/AAAAAAAAGFQ/eZ-GKJqxqMU/s640-Ic42/" alt="https://lh3.googleusercontent.com/-G5jug0myAVY/Vfh1U_i-QTI/AAAAAAAAGFQ/eZ-GKJqxqMU/s640-Ic42/" />
</a>
</div>
</div>
<div class="paragraph"><p>In this post I want to go further, and after
<a href="http://vmiklos.hu/blog/calc-header.html">touching Calc</a>, here is my first story
about Base. Of course I lie, it seems that Base forms are kind of read-only
Writer documents, at least that&#8217;s how I could fix the bug I&#8217;m describing here.
:-) The topic is still the same, rounding rough edges after the fill
attributes rework, this time a stretched background of a Base form. (Which was
not stretched at all, it was simply centered both horizontally and vertically
on the page.)</p></div>
<div class="paragraph"><p>I&#8217;m not entirely sure how the document from
<a href="https://bugs.documentfoundation.org/show_bug.cgi?id=92586">tdf#92586</a> is
created, but the interesting part from styles.xml is:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;style:page-layout-properties</span></span> ... <span style="color: #009900">style:repeat</span><span style="color: #990000">=</span><span style="color: #FF0000">"no-repeat"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
     <span style="font-weight: bold"><span style="color: #0000FF">&lt;style:background-image</span></span> ... <span style="color: #009900">style:repeat</span><span style="color: #990000">=</span><span style="color: #FF0000">"stretch"</span><span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/style:page-layout-properties&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>So the schema allows specifying the way how the bitmap is repeated at two
places, and in the past the later attribute won, and with the rework this got
lost.</p></div>
<div class="paragraph"><p>An additional problem that
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=6621da38b3cd217314c2d2295fd1e71be7e1875e">the
commit</a> had to solve is that the attribute on the page-layout-properties XML
element is mapped to our
<a href="http://api.libreoffice.org/docs/idl/ref/servicecom_1_1sun_1_1star_1_1drawing_1_1FillProperties.html#acd89f2a230dfdf0be3f6c840c2630871">FillBitmapMode</a>
API, while the attribute with the same name on the background-image XML
element is mapped to the
<a href="http://api.libreoffice.org/docs/idl/ref/servicecom_1_1sun_1_1star_1_1style_1_1PageProperties.html#a229455fd0417732944f850139fdf96d5">BackGraphicLocation</a>
API, which is specific to Writer. As a result, now there is a compatibility
map from the old enumeration to the new one, that&#8217;s how the bug document is
now rendered the same again, as in the past.</p></div>
<div class="paragraph"><p>The fix is already backported to the <code>libreoffice-5-0</code> branch.</p></div>
</p><hr/></li>
<li><p>Wednesday, 02 September 2015<br /><a href="/blog/calc-header.html">Fixing Calc header image backgrounds</a>
(<a href="/blog/calc-header.html#disqus_thread">Comments</a>)
</p><p><div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://lh3.googleusercontent.com/-u9SiImjl99k/VecKvEnT6lI/AAAAAAAAGDs/sNUH3OIlk4Y/s0-Ic42/">
<img src="https://lh3.googleusercontent.com/-u9SiImjl99k/VecKvEnT6lI/AAAAAAAAGDs/sNUH3OIlk4Y/s640-Ic42/" alt="https://lh3.googleusercontent.com/-u9SiImjl99k/VecKvEnT6lI/AAAAAAAAGDs/sNUH3OIlk4Y/s640-Ic42/" />
</a>
</div>
</div>
<div class="paragraph"><p>I think this is my first Calc bugfix. :-) The problem I wanted to fix is that
while LibreOffice 4.4 learned advanced
<a href="https://gerrit.libreoffice.org/gitweb?p=core.git&amp;a=search&amp;h=HEAD&amp;st=commit&amp;s=fillattributes">fill
attributes</a> (gradients, hatches, etc) for page headers / footers in Writer,
this broke the saving of simple graphic header backgrounds in Calc. Seeing
that no-one stepped up to fix this, I tried to do this myself&#8201;&#8212;&#8201;and luckily
the problem was in the ODF export filter, which is much more familiar to me,
compared to Calc core.</p></div>
<div class="paragraph"><p>Part of that larger feature was changes to the ODF filter, and
<a href="https://bugs.documentfoundation.org/show_bug.cgi?id=89245">the bug</a> was exactly
about touching shared ODF filter code to please Writer without testing other
LibreOffice applications.</p></div>
<div class="paragraph"><p>The actual problem was
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=3b40329f9a64b93b1e1230b1bff74ed8cda8cd70">overlapping
constants</a>: as in multiple constants had the same numeric value. Such issues
are sometimes hard to track down, in this case it wasn&#8217;t <em>that</em> hard: the
context filter that tried to make sure we don&#8217;t write duplicated XML
attributes removed the background property when it tried to guard header
repeat offsets.</p></div>
<div class="paragraph"><p>Given that this affected the LibreOffice 4.4 and 5.0 series, both branches got
a backport of the commit, and so the next release from those lines will have
the fix.</p></div>
</p><hr/></li>
</ul></div>
<a href="/blog/archive.html">more &raquo;</a>
<script type="text/javascript">
var disqus_shortname = 'vmiklos';
(function () {
 var s = document.createElement('script'); s.async = true;
 s.src = 'http://disqus.com/forums/vmiklos/count.js';
 (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>

</div>
</div>
</div>
</div>
</body>
</html>
