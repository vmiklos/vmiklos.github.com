<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.5.3" />
<meta name="description" content="What is Miklos hacking - Tags: en - Miklos' blog" />
<meta name="keywords" content="vmiklos, libereoffice, swig, git, python, hacking, bitlbee" />
<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://vmiklos.hu/blog/index.rss" />
<link rel="stylesheet" href="/blog/xhtml11.css" type="text/css" />
<link rel="stylesheet" href="/blog/xhtml11-quirks.css" type="text/css" />
<link rel="stylesheet" href="/blog/layout.css" type="text/css" />
<title>What is Miklos hacking - Tags: en</title>
<!-- google analytics start -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-24726997-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- google analytics end -->
</head>
<body>
<div id="layout-banner-box">
<div id="layout-banner">
  <div id="layout-title">vmiklos.hu</div>
  <div id="layout-description">shameless self-promoting website</div>
</div>
</div>
<div id="layout-menu-box">
<div id="layout-menu">
  <div>&#187;<a href="/">Root</a></div>
  <div>&#187;<a href="/blog/">Rejourn root</a></div>
  <div>&#187;<a href="http://planet.documentfoundation.org/">LibreOffice Community Blogs</a></div>
  <div>
    Search:<br/>
    <form action="http://www.google.com/cse" id="cse-search-box" target="_blank">
    <input type="hidden" name="cx" value="007336731492173318056:bik8fqvatno"/><input type="hidden" name="ie" value="UTF-8"/><input type="text" name="q" size="15"/><br/>
    <input type="submit" name="sa" value="&#187;"/></form>
  </div>
</div>


</div>
<div id="layout-content-box">
<div id="layout-content">
<div id="header">
	<h1>What is Miklos hacking - Tags: en</h1>
</div>
<div id="preamble">
<div class="sectionbody">




<!-- Listing -->
<div class="ulist"><ul>
<li><p>Thursday, 31 March 2016<br /><a href="/blog/ooxml-signature-import.html">OOXML signature import in LibreOffice</a>
(<a href="/blog/ooxml-signature-import.html#disqus_thread">Comments</a>)
</p><p><div style="text-align: center; font-size: 0.6em;">
<img src="https://lh3.googleusercontent.com/-8fwMz2Ie0ys/Vvpxvf94SrI/AAAAAAAAGlQ/vVaTBn_vEvY7Y3Fn2rcLYPERx3raDX_UwCCo/s400-Ic42/"/>
<p>(via <a href="http://www.ascertia.com/">ascertia</a>)</p>
</div>
<div class="paragraph"><p>After adding <a href="http://vmiklos.hu/blog/libreoffice-sha256-signatures.html">support
for SHA-256 hashes in LibreOffice</a>, I turned towards implementing OOXML
signature import (as in: verification, not signing) in LibreOffice. First,
thanks to the Dutch Ministry of Defense who made this work possible (as part
of a project implementing trusted signing and communication in LibreOffice), I
collected a list of building blocks needed for this to work:</p></div>
<div class="ulist"><ul>
<li>
<p>
support for the Relationships Transform Algorithm (described in ISO/IEC
  29500-2:2012) in xmlsec
</p>
</li>
<li>
<p>
an actual XML parser for the OOXML signature in <code>xmlsecurity/</code>
</p>
</li>
<li>
<p>
a new filter flag, so that our code no longer assumes "is ODF" means
  "supports digital signing" and
</p>
</li>
<li>
<p>
some refactoring in <code>xmlsecurity/</code>, so that our digital signature code doesn&#8217;t
  assume that multiple signatures are always written to a single file
</p>
</li>
</ul></div>
<div class="paragraph"><p>The xmlsec bits are now
<a href="https://github.com/lsh123/xmlsec/commit/7069e2b0ab49679008abedd6d223fb95538b0684.patch">upstream</a>,
it seems to me that new algorithm is needed, so that MSO can avoid signing a
number of streams (files in ZIP containers), while still being able to verify
that all normal streams are signed. Given that MSO by default doesn&#8217;t sign all
streams (so that e.g. the metadata of the document can be modified without
invalidating signatures), this is in use even for a hello-world document. This
implies that a typical OOXML signature will never gain the best "signed"
category in LO, as we&#8217;ll always warn that even though the signature is valid,
not all streams are signed. This is a bit of a rant, but better not hide the
reality: a default ODF signature covers more than a default OOXML signature.</p></div>
<div class="paragraph"><p>The
<a href="https://cgit.freedesktop.org/libreoffice/core/tree/xmlsecurity/source/helper/ooxmlsecparser.cxx">OOXML
signature parser</a> had to extract all information from the signature markup
that&#8217;s interesting for LibreOffice, like the certificate, the signature date
or the signature description. I considered extending the ODF signature parser
instead of implementing a new one for OOXML, since both markups are based on
the same W3C signing spec, but they are different enough that the added
complexity doesn&#8217;t outweigh the benefit of code sharing here.</p></div>
<div class="paragraph"><p>The next step was to add a new <code>SUPPORTSSIGNING</code> filter flag in <code>filter/</code>, and
mark the DOCX, XLSX and PPTX file filters as such, and then of course find
places mostly in <code>sfx2/</code> and <code>xmlsecurity/</code> that assume only ODF files can be
signed, and modifying those checks to also handle this new flag.</p></div>
<div class="paragraph"><p>Finally, a difference between ODF and OOXML signatures is that ODF puts all of
them in a single stream, and all the signing and verifying code works with
that stream. However, in case of OOXML, all signatures are in separate
streams, so if we want to work with a single object as kind of a signature
context, we need a storage (a sub-directory inside the ZIP container), and
work with that.</p></div>
<div class="paragraph"><p>Putting all of these together, we now have unit tests that take test documents
having "good" and "bad" signatures, and the verification result in LO will
match with the one of MSO. As usual, you can try this right now with a 5.2
<a href="http://dev-builds.libreoffice.org/daily/master/">daily build</a>. :-)</p></div>
</p><hr/></li>
<li><p>Wednesday, 23 March 2016<br /><a href="/blog/libreoffice-sha256-signatures.html">SHA-256 hashes for ODF signatures in LibreOffice</a>
(<a href="/blog/libreoffice-sha256-signatures.html#disqus_thread">Comments</a>)
</p><p><div class="paragraph"><p>As it happened with MD5 hashes in the past, the world is currently moving from
SHA1 hashes to SHA-256 hashes these days. This affects LibreOffice&#8217;s ODF
signing feature as well, where we previously wrote and read SHA-1 hashes, but
not SHA-256 ones. First, thanks to the Dutch Ministry of Defense who made this
work possible (as part of a project implementing trusted signing and
communication in LibreOffice), I could start work on
<a href="https://bugs.documentfoundation.org/show_bug.cgi?id=76142">tdf#76142</a> which
attached a reproducer document as well, helping the implementation of this
feature.</p></div>
<div class="paragraph"><p>If you&#8217;re not into the digital signature details, SHA-256 is relevant in two
aspects here:</p></div>
<div class="ulist"><ul>
<li>
<p>
it can be a signature method, denoted by the
  <code>http://www.w3.org/2001/04/xmldsig-more#rsa-sha256</code> URI, and
</p>
</li>
<li>
<p>
it can be a digest method, denoted by the
  <code>http://www.w3.org/2001/04/xmlenc#sha256</code> URI
</p>
</li>
</ul></div>
<div class="paragraph"><p>Hashing is interesting in the context of digital signatures because typically
not the whole document is signed, just a hash of it, and crypto frameworks
like nss or mscrypto typically tie these two together, so you just say you
sign with rsa-sha256, which in more detail means hashing with SHA-256 and then
signing using rsa.</p></div>
<div class="paragraph"><p>A valid signed document using SHA-256 hashing looked like this before:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://lh3.googleusercontent.com/-c6JR6vywSuY/Vuw4CdYpj8I/AAAAAAAAGjE/hUOW-Ul073QM4SqMN2GM8K0mjGUdGSk5wCCo/s0-Ic42/">
<img src="https://lh3.googleusercontent.com/-c6JR6vywSuY/Vuw4CdYpj8I/AAAAAAAAGjE/hUOW-Ul073QM4SqMN2GM8K0mjGUdGSk5wCCo/s400-Ic42/" alt="https://lh3.googleusercontent.com/-c6JR6vywSuY/Vuw4CdYpj8I/AAAAAAAAGjE/hUOW-Ul073QM4SqMN2GM8K0mjGUdGSk5wCCo/s400-Ic42/" />
</a>
</div>
</div>
<div class="paragraph"><p>I.e. we failed to validate the signature, and presented a dialog that suggested the signature is not valid. After my changes, it looks like this:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://lh3.googleusercontent.com/-QLHuSvGkFJQ/Vuw4CQD60ZI/AAAAAAAAGjI/GcmqED9Vqmc7KEw1BpDVNg_uxyrJp693gCCo/s0-Ic42/">
<img src="https://lh3.googleusercontent.com/-QLHuSvGkFJQ/Vuw4CQD60ZI/AAAAAAAAGjI/GcmqED9Vqmc7KEw1BpDVNg_uxyrJp693gCCo/s400-Ic42/" alt="https://lh3.googleusercontent.com/-QLHuSvGkFJQ/Vuw4CQD60ZI/AAAAAAAAGjI/GcmqED9Vqmc7KEw1BpDVNg_uxyrJp693gCCo/s400-Ic42/" />
</a>
</div>
</div>
<div class="paragraph"><p>I.e. no error on loading, and the status bar icon tells the user that
everything is fine, except that we can&#8217;t validate the certificate used for
signing.</p></div>
<div class="paragraph"><p>As for when should LibreOffice start <strong>writing</strong> (not reading) SHA-256 hashes
when creating signatures, it&#8217;s an open question. Probably best to wait till
most users already have a version that can read those hashes. Then we would
still keep support for reading SHA-1 hashes, but we would use SHA-256 when
creating new signatures.</p></div>
<div class="paragraph"><p>Another detail is that the hard work of signing in LibreOffice is done by
using <a href="https://www.aleksey.com/xmlsec/">libxmlsec</a>. We bundled a heavily patched
version from 2009, and it wasn&#8217;t clear how much work it is to port our patches
to a newer upstream version, so I&#8217;ve initially backported the SHA-256 patches
to our older version (for the nss and mscrypto backends of libxmlsec, as that
covers what LibreOffice uses on Linux, Windows and OS X). At the end I managed
to update our bundled libxmlsec to a newer (even if not the newest yet)
version, so latest master got rid of those custom backports.  As usual, you
can try this right now with a 5.2
<a href="http://dev-builds.libreoffice.org/daily/master/">daily build</a>. :-)</p></div>
</p><hr/></li>
<li><p>Wednesday, 16 March 2016<br /><a href="/blog/libreoffice-signature-descriptions.html">Signature descriptions in LibreOffice</a>
(<a href="/blog/libreoffice-signature-descriptions.html#disqus_thread">Comments</a>)
</p><p><div class="paragraph"><p>LibreOffice&#8217;s user interface prohibited creating multiple signatures by the
same author on a document, because there was no semantic meaning of signing
the same document multiple times. I&#8217;ve recently extended the user interface to
be able to provide a signature description: this way it makes sense to allow
multiple signatures from the same author, because now each signature can have
a different meaning. First, thanks to the Dutch Ministry of Defense who
made this work possible.</p></div>
<div class="paragraph"><p>When the user selects File &#8594; Digital Signatures, the dialog lists existing
signatures together with their description (if they have any):</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://lh3.googleusercontent.com/-DqvpQOrLq6c/VuGAEfC56AI/AAAAAAAAGhg/CnFGm5z5Uoo/s0-Ic42/">
<img src="https://lh3.googleusercontent.com/-DqvpQOrLq6c/VuGAEfC56AI/AAAAAAAAGhg/CnFGm5z5Uoo/s600-Ic42/" alt="https://lh3.googleusercontent.com/-DqvpQOrLq6c/VuGAEfC56AI/AAAAAAAAGhg/CnFGm5z5Uoo/s600-Ic42/" />
</a>
</div>
</div>
<div class="paragraph"><p>When the user clicks on the Sign Document button, the dialog for certificate
selection now also asks for an optional description:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://lh3.googleusercontent.com/-OoA7rDynpzo/VuGAFuHpskI/AAAAAAAAGhg/aEqUEOVtcEo/s0-Ic42/">
<img src="https://lh3.googleusercontent.com/-OoA7rDynpzo/VuGAFuHpskI/AAAAAAAAGhg/aEqUEOVtcEo/s600-Ic42/" alt="https://lh3.googleusercontent.com/-OoA7rDynpzo/VuGAFuHpskI/AAAAAAAAGhg/aEqUEOVtcEo/s600-Ic42/" />
</a>
</div>
</div>
<div class="paragraph"><p>Changing the value of the description invalidates the signature. For this
feature to work, I have extended LibreOffice&#8217;s ODF signature markup to store
not only a <code>&lt;dc:date&gt;</code> element as signature metadata, but also the
<code>&lt;dc:description&gt;</code>. Given that the metadata of an ODF signature is not part of
the ODF specification, it is allowed to extend the metadata with custom child
elements, so it was not necessary to submit an ODF enhancement proposal for
this file format change at this stage.  As usual the commits are in master, so
you can try this right now with a 5.2
<a href="http://dev-builds.libreoffice.org/daily/master/">daily build</a>. :-)</p></div>
</p><hr/></li>
<li><p>Thursday, 25 February 2016<br /><a href="/blog/sw-linked-graphic-import.html">Import of DOCX and RTF linked graphic into LibreOffice Writer</a>
(<a href="/blog/sw-linked-graphic-import.html#disqus_thread">Comments</a>)
</p><p><div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://lh3.googleusercontent.com/-ov8ANPdqriE/Vs3em0UknHI/AAAAAAAAGc8/7mHejdWPLlg/s900-Ic42/">
<img src="https://lh3.googleusercontent.com/-ov8ANPdqriE/Vs3em0UknHI/AAAAAAAAGc8/7mHejdWPLlg/s900-Ic42/" alt="https://lh3.googleusercontent.com/-ov8ANPdqriE/Vs3em0UknHI/AAAAAAAAGc8/7mHejdWPLlg/s900-Ic42/" />
</a>
</div>
</div>
<div class="paragraph"><p>As it has been
<a href="https://bugs.documentfoundation.org/show_bug.cgi?id=59699">reported</a>, the RTF
<code>includepicture</code> field was ignored on import. As writerfilter has quite some
shared code for DOCX and RTF import, I also looked at the state of linked
graphics in the DOCX import, and that wasn&#8217;t better, either.</p></div>
<div class="paragraph"><p>Although, the root causes were different. ;-) Regarding DOCX, a linked and a
non-linked graphic has quite similar drawingML markup: the only difference is
if the graphic has a relationship alias (embedded case) or a (possibly
relative) external URL. Relative external URLs were broken, as the
writerfilter &#8594; oox call (to import the graphic) did not forward the base URL,
so oox had no chance to properly resolve a relative URL.</p></div>
<div class="paragraph"><p>Regarding RTF, a linked graphic is represented as an <code>includepicture</code> field, and
now the RTF tokenizer resolves that to a real graphic. As you can see on the
above screenshot series (new Writer behavior, old Writer, and reference), we
now behave the same way as the reference (or the Writer DOC import).</p></div>
<div class="paragraph"><p>A related interesting fact I noticed is that <code>includepicture</code> fields in OOXML
are valid, but it seems Word never writes them: either their expanded field
result is outdated (e.g. it&#8217;s some text), or if the user updates the field,
then their implementation instantly replaces the field with a drawingML markup
that links the graphic.</p></div>
</p><hr/></li>
<li><p>Sunday, 31 January 2016<br /><a href="/blog/fosdem2016.html">Mail merge embedding in LibreOffice Writer FOSDEM talk</a>
(<a href="/blog/fosdem2016.html#disqus_thread">Comments</a>)
</p><p><div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://speakerd.s3.amazonaws.com/presentations/30e7f96db4a8430cbe7938245b545880/mm-fosdem-brussels-2k16.pdf">
<img src="https://lh3.googleusercontent.com/-tY-2qENlPkA/Vq3iZ4wlO9I/AAAAAAAAGbY/o7lbUDAUoHo/s800-Ic42/" alt="https://lh3.googleusercontent.com/-tY-2qENlPkA/Vq3iZ4wlO9I/AAAAAAAAGbY/o7lbUDAUoHo/s800-Ic42/" />
</a>
</div>
</div>
<div class="paragraph"><p>Yesterday I gave a
<a href="https://fosdem.org/2016/schedule/event/libreoffice_mail_merging/">Mail merge
embedding in LibreOffice Writer</a> talk at FOSDEM 2016, in the
<a href="https://fosdem.org/2016/schedule/track/open_document_editors/">Open document
editors developer room</a>. The room was well-crowded&#8201;&#8212;&#8201;seems this year LibreOffice
Online was a hot topic. ;-)</p></div>
<div class="paragraph"><p>We also had a
<a href="https://wiki.documentfoundation.org/Hackfest/FOSDEM2016">hackfest</a> with about
20 hackers attending, (again) kindly hosted by
<a href="http://www.betacowork.com/">Betacowork</a> on Thursday and Friday, before FOSDEM.</p></div>
<div class="paragraph"><p>There were a few topics I hacked on:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://gerrit.libreoffice.org/gitweb?p=core.git;a=commitdiff;h=552361aaad740e55fcfa7993b4111aba354f863f">.uno:Paste
  AnchorType param</a> for Writer
</p>
</li>
<li>
<p>
<a href="https://bugs.documentfoundation.org/show_bug.cgi?id=97371">tdf#97371</a> DOCX import regression fix about TextBoxes
</p>
</li>
<li>
<p>
<a href="https://bugs.documentfoundation.org/show_bug.cgi?id=96175">tdf#96175</a> RTF export feature about <em>company</em> doc property
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/gitweb?p=core.git;a=commitdiff;h=363aa5dbb2c223b6cc3a109bd654f39772e310fa">refactoring</a>
  around Writer&#8217;s new (in 5.1) hide-whitespace feature, as requested by Ashod
</p>
</li>
<li>
<p>
code coverage: <code>RtfExport::WriteRevTab()</code> was completely untested
  previously, now
  <a href="https://gerrit.libreoffice.org/gitweb?p=core.git;a=commitdiff;h=8ff66c71bb4da8d0e4454e250e480eada9fe226c">fixed</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>A full list of achievements is
<a href="https://wiki.documentfoundation.org/Hackfest/FOSDEM2016#Achievements">available</a>, if
you were at the hackfest and you did not contribute to that section, please
write a line about what did you hack on. :-)</p></div>
<div class="paragraph"><p>Quite some other slides are now available on
<a href="http://planet.documentfoundation.org/">Planet</a>, don&#8217;t miss them.</p></div>
</p><hr/></li>
<li><p>Tuesday, 12 January 2016<br /><a href="/blog/rtf-page-background-export.html">RTF page background export in LibreOffice Writer</a>
(<a href="/blog/rtf-page-background-export.html#disqus_thread">Comments</a>)
</p><p><div class="paragraph"><p>While I added support for page background colors in the RTF import
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=14e163b0caf97addf340aefc5760a9031ec98390">back
in 2013</a>, the export part was missing up to now.</p></div>
<div class="paragraph"><p>If you set a solid color fill for a page style, and you export it to RTF, here
is how the reference rendering output looks like:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://lh3.googleusercontent.com/-JI384fzDsng/VpEkSeMEgfI/AAAAAAAAGYY/GXhT1tzi4WQ/s900-Ic42/reference.png">
<img src="https://lh3.googleusercontent.com/-JI384fzDsng/VpEkSeMEgfI/AAAAAAAAGYY/GXhT1tzi4WQ/s900-Ic42/reference.png" alt="https://lh3.googleusercontent.com/-JI384fzDsng/VpEkSeMEgfI/AAAAAAAAGYY/GXhT1tzi4WQ/s900-Ic42/reference.png" />
</a>
</div>
</div>
<div class="paragraph"><p>However, in Libreoffice only the background of the paragraph reflected the
color set by the user:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://lh3.googleusercontent.com/-YZDNx5H0qYQ/VpEkSWxf2II/AAAAAAAAGYU/o4Q06VeBK-I/s900-Ic42/bad.png">
<img src="https://lh3.googleusercontent.com/-YZDNx5H0qYQ/VpEkSWxf2II/AAAAAAAAGYU/o4Q06VeBK-I/s900-Ic42/bad.png" alt="https://lh3.googleusercontent.com/-YZDNx5H0qYQ/VpEkSWxf2II/AAAAAAAAGYU/o4Q06VeBK-I/s900-Ic42/bad.png" />
</a>
</div>
</div>
<div class="paragraph"><p>After implementing this feature in the RTF export filter, it now looks much
closer to the reference:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://lh3.googleusercontent.com/--6VbXTzbA_k/VpEkSWJB7tI/AAAAAAAAGYc/D7KEn0lLvXw/s900-Ic42/good.png">
<img src="https://lh3.googleusercontent.com/--6VbXTzbA_k/VpEkSWJB7tI/AAAAAAAAGYc/D7KEn0lLvXw/s900-Ic42/good.png" alt="https://lh3.googleusercontent.com/--6VbXTzbA_k/VpEkSWJB7tI/AAAAAAAAGYc/D7KEn0lLvXw/s900-Ic42/good.png" />
</a>
</div>
</div>
<div class="paragraph"><p>At the moment only solid fill is implemented, so other advanced fill types
like graphics or gradients are still missing.</p></div>
</p><hr/></li>
<li><p>Friday, 11 December 2015<br /><a href="/blog/rtf-rich-comment-export.html">Rich RTF comment export in LibreOffice Writer</a>
(<a href="/blog/rtf-rich-comment-export.html#disqus_thread">Comments</a>)
</p><p><div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://lh3.googleusercontent.com/-cPX4gcKiTxI/VmnrtwdnTXI/AAAAAAAAGTE/cYj_XZONoRg/s0-Ic42/">
<img src="https://lh3.googleusercontent.com/-cPX4gcKiTxI/VmnrtwdnTXI/AAAAAAAAGTE/cYj_XZONoRg/s400-Ic42/" alt="https://lh3.googleusercontent.com/-cPX4gcKiTxI/VmnrtwdnTXI/AAAAAAAAGTE/cYj_XZONoRg/s400-Ic42/" />
</a>
</div>
</div>
<div class="paragraph"><p>As it has been reported in
<a href="https://bugs.documentfoundation.org/show_bug.cgi?id=94377">tdf#94377</a>, the
state of Writer comment contents in the RTF export filter wasn&#8217;t great.</p></div>
<div class="paragraph"><p>With two recent changes, however, the situation is now much better:</p></div>
<div class="ulist"><ul>
<li>
<p>
I&#8217;ve added support for multiple paragraphs
</p>
</li>
<li>
<p>
I&#8217;ve added support for both paragraph and text portion formatting
</p>
</li>
</ul></div>
<div class="paragraph"><p>It wasn&#8217;t necessary to implement this from scratch, because comment contents
uses the same editeng store as the shape text, and there formatting was already
handled. A benefit of this code sharing is that shape text also handles
multiple paragraphs without a problem now. :-)</p></div>
<div class="paragraph"><p>The commits are backported to <code>libreoffice-5-1</code>, so users will see them
already in the upcoming 5.1.0 release.</p></div>
</p><hr/></li>
<li><p>Thursday, 26 November 2015<br /><a href="/blog/sanitizing-member-variable-names.html">Sanitizing member variable names in LibreOffice Writer</a>
(<a href="/blog/sanitizing-member-variable-names.html#disqus_thread">Comments</a>)
</p><p><div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://lh3.googleusercontent.com/-Qk6Y55f7HaY/VlYtR13vYeI/AAAAAAAAGRA/hK-7EJMFhwk/s0-Ic42/">
<img src="https://lh3.googleusercontent.com/-Qk6Y55f7HaY/VlYtR13vYeI/AAAAAAAAGRA/hK-7EJMFhwk/s400-Ic42/" alt="https://lh3.googleusercontent.com/-Qk6Y55f7HaY/VlYtR13vYeI/AAAAAAAAGRA/hK-7EJMFhwk/s400-Ic42/" />
</a>
</div>
</div>
<div class="paragraph"><p>Robinson just
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?h=libreoffice-5-1&amp;id=fa7c921feb2f6e14f7eca717dd3cfbca0bd35c03">branched
off</a> libreoffice-5-1 from master in LibreOffice&#8217;s core.git repository, so time
to talk about what happened behind the scenes in the 5.0 &#8594; 5.1 development
cycle from my side.</p></div>
<div class="paragraph"><p>One stylistic detail that annoyed me for a while was the inconsistency around
naming class member variables. In new code it&#8217;s common to give them an <code>m_</code>
(or at least an <code>m</code>) prefix, but in older code that wasn&#8217;t that common, and
various custom hacks were invented to differentiate between pointers which
point to the same memory address, but one being a parameter of a member
function, and the other being a member variable.</p></div>
<div class="paragraph"><p>Probably the worst scenario is when one was an abbreviation of the other, like
pTable and pTbl or pCursor and pCrsr. I took this as an opportunity to play
with Clang&#8217;s <a href="http://clang.llvm.org/docs/LibTooling.html">LibTooling</a>, and I
wrote two tools <a href="http://vmiklos.hu/blog/cambridge.html">back during the
Cambridge hackfest</a> to automate the process of finding and fixing missing
prefixes.</p></div>
<div class="paragraph"><p>To scope the renaming, I changed all classes in the <code>sw</code> module having more
than 20 unprefixed members to follow the above convention, hopefully this
nicely improves code readability, together with the
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=49c2b9808df8a6b197dec666dfc0cda6321a4306">mass-rename
of pointless abbreviations</a>, also done before the branch-off, so affecting
both libreoffice-5-1 and master. :-)</p></div>
</p><hr/></li>
<li><p>Wednesday, 04 November 2015<br /><a href="/blog/calc-png-export.html">PNG export in LibreOffice Calc</a>
(<a href="/blog/calc-png-export.html#disqus_thread">Comments</a>)
</p><p><div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://lh3.googleusercontent.com/-8n61EJB3Xco/VjkUn1JvuqI/AAAAAAAAGOE/0-DCtcNV2RY/s0-Ic42/">
<img src="https://lh3.googleusercontent.com/-8n61EJB3Xco/VjkUn1JvuqI/AAAAAAAAGOE/0-DCtcNV2RY/s400-Ic42/" alt="https://lh3.googleusercontent.com/-8n61EJB3Xco/VjkUn1JvuqI/AAAAAAAAGOE/0-DCtcNV2RY/s400-Ic42/" />
</a>
</div>
</div>
<div class="paragraph"><p>Both LibreOffice Writer and Impress has the ability to export the document as
PNG, which is one way to create thumbnails for documents&#8201;&#8212;&#8201;i.e. being able to
preview them before the real loading of the document happens. It turns out
Calc did not have this feature, and given that <code>ScModelObj</code> also supports the
<code>css::view::XRenderable</code> interface (just like Writer), I hoped that it won&#8217;t
be too complex to add one.</p></div>
<div class="paragraph"><p>You can refer to
<a href="http://fridrich.blogspot.com/2013/08/extending-swiss-army-knife-overview.html">Fridrich&#8217;s
overview blog post</a> for the complete list of steps on how to add a new filter
to LibreOffice, here the following steps
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=03bb5d52fecd6c613c6cc36508eb44e5e1c3456a">were
needed</a>:</p></div>
<div class="ulist"><ul>
<li>
<p>
improve <code>DocumentToGraphicRenderer</code>, so that it can handle that Calc does
  not implement the <code>text::XTextViewCursorSupplier</code> interface (Writer uses
  this one to expose the cursor is on what page)
</p>
</li>
<li>
<p>
register <code>png_Portable_Network_Graphic</code> as filter type for Calc
</p>
</li>
<li>
<p>
create a new <code>calc_png_Export</code> filter fragment
</p>
</li>
<li>
<p>
register a Calc graphic filters configuration type and filter group in
  <code>Configuration_filter</code> and <code>CustomTarget_registry</code>
</p>
</li>
<li>
<p>
testcase
</p>
</li>
</ul></div>
<div class="paragraph"><p>If you can&#8217;t wait till LibreOffice 5.1 is released to try out this new
feature, you can get a <a href="http://dev-builds.libreoffice.org/daily/master/">daily
build</a>. :-)</p></div>
</p><hr/></li>
<li><p>Tuesday, 20 October 2015<br /><a href="/blog/flat-odf-android.html">Flat ODF support in LibreOffice's Android port</a>
(<a href="/blog/flat-odf-android.html#disqus_thread">Comments</a>)
</p><p><div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://lh3.googleusercontent.com/-M9NDl_ptc9U/ViPqlxkmJwI/AAAAAAAAGLk/t92PSwTHAk0/s0-Ic42/">
<img src="https://lh3.googleusercontent.com/-M9NDl_ptc9U/ViPqlxkmJwI/AAAAAAAAGLk/t92PSwTHAk0/s400-Ic42/" alt="https://lh3.googleusercontent.com/-M9NDl_ptc9U/ViPqlxkmJwI/AAAAAAAAGLk/t92PSwTHAk0/s400-Ic42/" />
</a>
</div>
</div>
<div class="paragraph"><p>While LibreOffice&#8217;s Android port has as good support for ODF as the desktop
version, flat ODF was lagging behind. There were two reasons for this:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://gerrit.libreoffice.org/gitweb?p=core.git;a=commit;h=9aa6ec9bfaa3c76c291ab8ec9a1b87fb89b817e6">flat-ODF-related
  services were simply missing</a> from the .apk, for historical reasons: when
  the .apk limit was 50MB, it sounded like a good idea to leave these out if it
  allowed packaging e.g. editing-related services.
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/gitweb?p=core.git;a=commit;h=1956b50e3b4c63a913151fd21d21c42cd288173d">flat
  ODS was blacklisted explicitly</a>, from the times when Calc tiled rendering
  was missing, and when .ods was included again the document browser, .fods was
  forgotten.
</p>
</li>
</ul></div>
<div class="paragraph"><p>With these two fixes my favorite test documents (of which the ODF version
worked already previously) in flat ODF version also load properly in all
Writer, Calc and Impress&#8201;&#8212;&#8201;as can be seen on the above montage of
screenshots.</p></div>
</p><hr/></li>
</ul></div>
<a href="/blog/archive.html">more &raquo;</a>
<script type="text/javascript">
var disqus_shortname = 'vmiklos';
(function () {
 var s = document.createElement('script'); s.async = true;
 s.src = 'http://disqus.com/forums/vmiklos/count.js';
 (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>

</div>
</div>
</div>
</div>
</body>
</html>
