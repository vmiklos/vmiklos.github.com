<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.5.3" />
<meta name="description" content="What is Miklos hacking - Tags: bitlbee - Miklos' blog" />
<meta name="keywords" content="vmiklos, libereoffice, swig, git, python, hacking, bitlbee" />
<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://vmiklos.hu/blog/index.rss" />
<link rel="stylesheet" href="/blog/xhtml11.css" type="text/css" />
<link rel="stylesheet" href="/blog/xhtml11-quirks.css" type="text/css" />
<link rel="stylesheet" href="/blog/layout.css" type="text/css" />
<title>What is Miklos hacking - Tags: bitlbee</title>
<!-- google analytics start -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-24726997-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- google analytics end -->
</head>
<body>
<div id="layout-banner-box">
<div id="layout-banner">
  <div id="layout-title">vmiklos.hu</div>
  <div id="layout-description">shameless self-promoting website</div>
</div>
</div>
<div id="layout-menu-box">
<div id="layout-menu">
  <div>&#187;<a href="/">Root</a></div>
  <div>&#187;<a href="/blog/">Rejourn root</a></div>
</div>


</div>
<div id="layout-content-box">
<div id="layout-content">
<div id="header">
	<h1>What is Miklos hacking - Tags: bitlbee</h1>
</div>
<div id="preamble">
<div class="sectionbody">




<!-- Listing -->
<div class="ulist"><ul>
<li><p>Sunday, 27 January 2013<br /><a href="/blog/lcov.html">lcov</a>
(<a href="/blog/lcov.html#disqus_thread">Comments</a>)
</p><p><div class="paragraph"><p>There are multiple strategies how to add testcases for code that sort of works,
but has no or too few tests. One approach (that works quite well in
LibreOffice, for example) is to just add tests for new code, and there the test
is "good", if it passes, but it fails if you revert the corresponding real
change.</p></div>
<div class="paragraph"><p>An other approach to avoid duplicated tests is to use a tool like <tt>lcov</tt>, that
can perform line or function coverage analysis for you, so a test is "good" if
it increases the coverage. I wanted to look into this later approach for
LibreOffice, but I decided it&#8217;s more fun to try this out for a smaller project
first. That&#8217;s when adding testcases for BitlBee&#8217;s Skype plugin came into my
mind.</p></div>
<div class="paragraph"><p>The problem there is that manual testing typically includes multiple online
Skype clients and an IRC client as well, and such tests are extremely
unreliable. So I thought: if I&#8217;m able to
<a href="http://en.wikipedia.org/wiki/Mock_object">mock</a> both the interactive IRC and
Skype clients, then it&#8217;ll be easy to test the C Skype plugin itself, even for
very special scenarios (like changing a groupchat topic in the middle of
inviting somebody to a groupchat or similar).</p></div>
<div class="paragraph"><p>So here is the result looks like:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt> skyped mock file   +--------+         +---------+   pyexpect mock file
------------------&gt; | skyped | &lt;-----&gt; | bitlbee | &lt;--------------------
                    +--------+   TCP   +---------+</tt></pre>
</div></div>
<div class="paragraph"><p>For skyped, the exact traffic is recorded and played back later; for BitlBee,
only the outgoing traffic is exact, for the incoming traffic <tt>pyexpect</tt> allows
just patterns (to allow tolerance for not interesting changes). Once the
framework was available, it was quite easy to add testcases: I already have
70%+ coverage, and I think approaching the 100% function coverage is realistic.
:-)</p></div>
<div class="paragraph"><p>What was also interesting is that it turned out the latest upstream lcov
release is
<a href="http://sourceforge.net/mailarchive/forum.php?thread_name=50F3ECB7.7070505%40linux.vnet.ibm.com&amp;forum_name=ltp-coverage">not
compatible</a> with gcc-4.7, but the necessary patches are
<a href="https://build.opensuse.org/request/show/148334">now</a>
<a href="https://build.opensuse.org/request/show/148408">integrated</a>, and the next
upstream release will work out of the box.</p></div>
<div class="paragraph"><p>The BitlBee mock files can be found
<a href="http://code.bitlbee.org/lh/bitlbee/files/head:/protocols/skype/t">here</a>. Given
that there are now instructions to do similar analysis for
<a href="http://wiki.documentfoundation.org/Development/Lcov">LibreOffice as well</a>, I
hope to look into increasing test coverage for the classes I maintain as well.</p></div>
</p><hr/></li>
<li><p>Sunday, 24 July 2011<br /><a href="/blog/bitlbee-skype-merge.html">bitlbee-skype is now merged</a>
(<a href="/blog/bitlbee-skype-merge.html#disqus_thread">Comments</a>)
</p><p><div class="imageblock" style="text-align:center;">
<div class="content">
<img src="http://bitlbee.org/style/logo.png" alt="http://bitlbee.org/style/logo.png" />
</div>
</div>
<div class="paragraph"><p>Back in April I had the idea to merge my <code>bitlbee-skype</code> plugin to the
main BitlBee project. The reason is simple: BitlBee does not really have
plugins (basically my Skype plugin was the only one) and because of
this, ABI compatibility was not guaranteed, so I usually had to rebuild
or even fix it after each BitlBee release (though Wilmer was helpful in
case I was in doubt). Today this is all past, the plugin is
<a href="http://bugs.bitlbee.org/bitlbee/changeset/devel%2C802">part of the main
BitlBee repo</a> I won&#8217;t make separate <code>bitlbee-skype</code> releases anymore. (Latest
version of the code is
<a href="http://code.bitlbee.org/lh/bitlbee/files/head:/protocols/skype/">here</a>, bzr info
<a href="http://code.bitlbee.org/bitlbee/">here</a>.)</p></div>
<div class="paragraph"><p>I&#8217;m quite happy this little piece of software did not get lost, but now
is in the hands of an active maintainer again. :) If you need help with
BitlBee, ask on #bitlbee, at irc.oftc.net.</p></div>
</p><hr/></li>
<li><p>Monday, 03 January 2011<br /><a href="/blog/bitlbee-skype-group.html">bitlbee-skype now supports groups</a>
(<a href="/blog/bitlbee-skype-group.html#disqus_thread">Comments</a>)
</p><p><div class="paragraph"><p>I released bitlbee-skype 0.9.0 today. The last feature that triggered
the relase born in git during the last two days: now it reads and writes
Skype group info. This means if you have a Skype group "work", then you
can just <tt>/j &amp;work</tt> to see work contacts only, and <tt>/invite</tt> also works
in that channel as expected.</p></div>
<div class="paragraph"><p>More in the <a href="http://wiki.bitlbee.org/UiFix">BitlBee wiki</a> and in the
<a href="http://vmiklos.hu/project/bitlbee-skype/NEWS">NEWS file</a>.</p></div>
</p><hr/></li>
<li><p>Wednesday, 08 December 2010<br /><a href="/blog/bitlbee-skype-0.8.4.html">BitlBee-Skype 0.8.4</a>
(<a href="/blog/bitlbee-skype-0.8.4.html#disqus_thread">Comments</a>)
</p><p><div class="paragraph"><p>I just released 0.8.4. The happy thing about it is that basically the
only fix I added to this release is to make it work when python is
python3k (so we need to use python2.7 to get python2 support), but the
rest is just merge from:</p></div>
<div class="ulist"><ul>
<li>
<p>
email
</p>
</li>
<li>
<p>
github
</p>
</li>
<li>
<p>
Debian
</p>
</li>
</ul></div>
<div class="paragraph"><p>Now the total number of contributors increased to 7. :)</p></div>
</p><hr/></li>
<li><p>Friday, 05 November 2010<br /><a href="/blog/bitlbee-3.0.html">BitlBee 3.0</a>
(<a href="/blog/bitlbee-3.0.html#disqus_thread">Comments</a>)
</p><p><div class="paragraph"><p>Even if I gave it a quick testing about two weeks ago, now I tried the
new Twitter / identi.ca support and I like it a lot. Now messages are
not coming from a single user by default, but a separate channel is
created, nicks are appearing there, and I can just highlight people to
reply to their last tweet or simply type to submit a new one.</p></div>
<div class="paragraph"><p>And of course my Skype module still works, as Wilmer fixed it up. :)</p></div>
</p><hr/></li>
</ul></div>
<a href="/blog/archive.html">more &raquo;</a>
<script type="text/javascript">
var disqus_shortname = 'vmiklos';
(function () {
 var s = document.createElement('script'); s.async = true;
 s.src = 'http://disqus.com/forums/vmiklos/count.js';
 (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>

</div>
</div>
</div>
</div>
</body>
</html>
