<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
    <channel>
        <title>What is Miklos hacking - Tags: git</title>
        <description></description>
        <link>http://vmiklos.hu/blog/</link>
        <item>
            <title>Using a git push tree</title>
            <description>&lt;div class="paragraph"&gt;&lt;p&gt;I just checked, I created my git &lt;em&gt;push tree&lt;/em&gt; more than a year ago, but
yesterday I was reminded that this technique isn&amp;#8217;t really documented anywhere,
so let me describe it.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Some background: for the LibreOffice codebase, we decided to do all
micro-features directly on the &lt;code&gt;master&lt;/code&gt; branch. This means that we typically
rebase our local &lt;code&gt;master&lt;/code&gt; branch against &lt;code&gt;origin/master&lt;/code&gt;, then push it. The
benefit of this is that code gets wider testing quickly and the commit history
is not polluted with meaningless merge commits.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;The problem: one drawback of the above situation is that after you pull, some
changes of other developers in the lower layers may trigger a full rebuild,
typically wasting about an hour of your life (or more, in case of slower
machines).&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Push tree is one hack to avoid this problem. Using a push tree, you have two
separate repositories locally, you update your main one less regularly, and
when you have a commit to push, you push it from the push tree to be able to
avoid pulling in your main tree.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Here is how to do it. To set this up:&lt;/p&gt;&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre&gt;&lt;code&gt;git clone --reference /path/to/master ssh://logerrit/core master-push&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Then to use it, instead of &lt;code&gt;git pull -r &amp;amp;&amp;amp; git push&lt;/code&gt; in your &lt;code&gt;master&lt;/code&gt; tree, do these:&lt;/p&gt;&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre&gt;&lt;code&gt;cd /path/to/master
git show -s &lt;b&gt;&amp;lt;1&amp;gt;&lt;/b&gt;
cd /path/to/master-push
git pull -r
git cherry-pick $sha1 &lt;b&gt;&amp;lt;2&amp;gt;&lt;/b&gt;
git push&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class="colist arabic"&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;
copy the sha1 hash from the output
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
replace $sha1 with the sha1 hash you got in the previous step
&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;(There is a trick here, given that master-push already references the original
tree, you can go ahead with cherry-pick directly, without fetching branches
from your &lt;code&gt;master&lt;/code&gt; tree.)&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;And that&amp;#8217;s it, you were able to push without waiting for a long rebuild!&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Note: of course this technique has some drawbacks as well, so use with care.
Keep in mind the followings:&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
If your local &lt;code&gt;master&lt;/code&gt; is not up-to-date enough, you&amp;#8217;ll get conflicts while
  cherry-picking. I usually update my &lt;code&gt;master&lt;/code&gt; tree once a day in the morning.
  If you have a slower machine, do it once a week in the night, or so.
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
Even if you don&amp;#8217;t get conflicts, there can be cases when the result of the
  cherry-pick in the push tree won&amp;#8217;t be what you want. Chances that this
  happens is pretty low if your &lt;code&gt;master&lt;/code&gt; tree is not super-old, see the previous
  note.
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
An other non-technical but social reason to still update your &lt;code&gt;master&lt;/code&gt; tree
  regularly is that if everyone uses an infrequently updated &lt;code&gt;master&lt;/code&gt; tree,
  then nobody will fix breakages caused by others on &lt;code&gt;origin/master&lt;/code&gt;. So updating
  your real tree infrequently is a bit unfair to other developers.
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Other than these, I can just recommend using a push tree, it helped me many
times not to loose focus in the middle of the day. (And as we all know, pushing
all your risky changes on Friday afternoon is also a bad idea. :-) )&lt;/p&gt;&lt;/div&gt;
</description>
            <link>http://vmiklos.hu/blog/push-tree.html</link>
            <pubDate>Wed, 14 Aug 2013 10:14:28 +0200</pubDate>
            <guid isPermaLink="false">http://vmiklos.hu/blog/push-tree.html</guid>
        </item>
        <item>
            <title>Merging git notes</title>
            <description>&lt;div class="paragraph"&gt;&lt;p&gt;The &lt;tt&gt;git notes&lt;/tt&gt; command is really about local annotation of commits&amp;#8201;&amp;#8212;&amp;#8201;nothing
to share. If you decide to still do so, for example the
&lt;a href="http://git-scm.com/2010/08/25/notes.html"&gt;git-scm.com&lt;/a&gt; HOWTO can show you how to
pull and push them. But what about merging?  There is no UI for that, but&amp;#8201;&amp;#8212;&amp;#8201;given that with git, everything is possible&amp;#8201;&amp;#8212;&amp;#8201;you can still do so manually.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;So the problem comes when Alice fetches notes, Bob does so, Alice pushes her
notes back, Bob annotates a different commit and when Bob wants to push, he
gets &lt;tt&gt;rejected, non-fast-forward&lt;/tt&gt;. Normally you would merge or rebase in this
situation, but given that &lt;tt&gt;git notes&lt;/tt&gt; by default updates the
&lt;tt&gt;refs/notes/commits&lt;/tt&gt; ref and you typically have a different branch checked out,
you can&amp;#8217;t use &lt;tt&gt;git merge&lt;/tt&gt; or &lt;tt&gt;git rebase&lt;/tt&gt; directly.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;What works is:&lt;/p&gt;&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre&gt;&lt;tt&gt;git checkout refs/notes/commits
git fetch origin refs/notes/commits
git merge FETCH_HEAD
git update-ref refs/notes/commits HEAD
git checkout master&lt;/tt&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class="colist arabic"&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;
Check out the notes, so if you have conflicts, you can resolve them.
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
Fetch remote notes to FETCH_HEAD.
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
Do the merge.
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
Necessary, as &lt;tt&gt;git merge&lt;/tt&gt; won&amp;#8217;t update the ref automatically, since we&amp;#8217;re not on a branch.
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
Or whereever you were before.
&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;And now you can push your notes, as detailed in the above referred blog post.
Yes, rebasing would be possible as well, that&amp;#8217;s left as an exercise for the
reader. ;-)&lt;/p&gt;&lt;/div&gt;
</description>
            <link>http://vmiklos.hu/blog/git-notes-merge.html</link>
            <pubDate>Thu, 07 Jun 2012 19:31:30 +0200</pubDate>
            <guid isPermaLink="false">http://vmiklos.hu/blog/git-notes-merge.html</guid>
        </item>
        <item>
            <title>JGit eloadas</title>
            <description>&lt;div class="paragraph"&gt;&lt;p&gt;Holnap lesz 5 hete, hogy eloadtam JGit / EGit / Gerrit temaban a BME-n,
&lt;a href="https://www.vik.bme.hu/kepzes/targyak/VIIIAV51"&gt;e targy&lt;/a&gt; kereteben. Az
elaodas eleje gyakorlatilag copy&amp;amp;paste a korabbi Git eloadasombol, de
mivel a targy kifejezetten Javaval foglalkozik, igy az elobb emlitett
harom temat is feloleli. A slide-ok megtalalhatoak a
&lt;a href="http://vmiklos.hu/odp/"&gt;szokasos helyen&lt;/a&gt;.&lt;/p&gt;&lt;/div&gt;
</description>
            <link>http://vmiklos.hu/blog/jgit-ea.html</link>
            <pubDate>Wed, 01 Dec 2010 19:36:12 +0100</pubDate>
            <guid isPermaLink="false">http://vmiklos.hu/blog/jgit-ea.html</guid>
        </item>
    </channel>
</rss>
