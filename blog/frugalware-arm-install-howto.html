<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.5.3" />
<meta name="description" content="Frugalware arm port install HOWTO - Miklos' blog" />
<meta name="keywords" content="vmiklos, libereoffice, swig, git, python, hacking, bitlbee" />
<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://vmiklos.hu/blog/index.rss" />
<link rel="stylesheet" href="/blog/xhtml11.css" type="text/css" />
<link rel="stylesheet" href="/blog/xhtml11-quirks.css" type="text/css" />
<link rel="stylesheet" href="/blog/layout.css" type="text/css" />
<title>Frugalware arm port install HOWTO</title>
<!-- google analytics start -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-24726997-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- google analytics end -->
</head>
<body>
<div id="layout-banner-box">
<div id="layout-banner">
  <div id="layout-title">vmiklos.hu</div>
  <div id="layout-description">shameless self-promoting website</div>
</div>
</div>
<div id="layout-menu-box">
<div id="layout-menu">
  <div>&#187;<a href="/">Root</a></div>
  <div>&#187;<a href="/blog/">Rejourn root</a></div>
</div>

</div>
<div id="layout-content-box">
<div id="layout-content">
<div id="header">
	<h1>Frugalware arm port install HOWTO</h1>
</div>
<div id="preamble">
<div class="sectionbody">

<!-- Single entry -->
<div class="verseblock">
<div class="verseblock-content">Posted <span class="timeago" title="2012-01-04T01:29:49Z">Wednesday, 04 January 2012</span> by Miklos<br />
    Tags:
    <a href="tags/en.html">en</a>
    <a href="tags/frugalware.html">frugalware</a>
</div>
</div>

<!-- Body -->
<div class="paragraph"><p>I recently got a <a href="http://en.wikipedia.org/wiki/GuruPlug">GuruPlug</a>. It has Debian
by default, and it&#8217;s apt config is set to <tt>stable</tt>, while in fact at the moment
what&#8217;s the factory default is considered as <tt>oldstable</tt> by upstream. So if you
blindly do a few <tt>apt-get install foo</tt>, soon you&#8217;ll have newer userspace than
kernel, and your device will no longer boot (based on true story - and yes,
this is not Debian&#8217;s fault). Moreover, I was interested in how to install
Frugalware on this device, so here is a quick howto.</p></div>
<div class="sect1">
<h2 id="_install_rootfs">Install rootfs</h2>
<div class="sectionbody">
<div class="paragraph"><p>First you need to bootstrap Frugalware from Debian. It&#8217;s a good idea to install
Frugalware on a USB stick, so you can switch back to Debian in case you messed
up something and start from scratch again.</p></div>
<div class="paragraph"><p>Partitioning is up to you, you&#8217;re recommended to have a small FAT (type: <tt>0x0b</tt>)
partition (32MB for example) at the beginning, we&#8217;ll use that later. The second
can be the rest, ext4 or so.</p></div>
<div class="paragraph"><p>Format and mount it (your device name may differ!):</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>mkfs.ext4 /dev/sda2
mkdir -p /mnt/sda2
mount /dev/sda2 /mnt/sda2</tt></pre>
</div></div>
<div class="paragraph"><p>Then install our pacman-g2 binary to the Debian system, so you can bootstrap:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>wget http://ftp.frugalware.org/pub/frugalware/frugalware-stable/frugalware-arm/pacman-g2-3.8.3-2mores2-arm.fpm
unxz pacman-g2-3.8.3-2mores2-arm.tar.xz
cd /
tar xf /path/to/pacman-g2-3.8.3-2mores2-arm.tar
rm .CHANGELOG .FILELIST .PKGINFO</tt></pre>
</div></div>
<div class="paragraph"><p>Installing the required packages is a single command, as described
<a href="http://frugalware.org/docs/install#_a_manual_bootstrap">here</a>:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>pacman-g2.static --noconfirm -Sy core base -r /mnt/sda2/</tt></pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_upgrade_the_bootloader">Upgrade the bootloader</h2>
<div class="sectionbody">
<div class="paragraph"><p>Once the rootfs is ready, you need a new bootloader that will be able to boot
our vanilla kernel.</p></div>
<div class="paragraph"><p>You need a <a href="http://www.globalscaletechnologies.com/p-28-guruplug-jtag.aspx">JTAG
Board</a>, so you can access the serial console. If you connect the USB cable to
you PC, you can use for example</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>screen /dev/ttyUSB0 115200</tt></pre>
</div></div>
<div class="paragraph"><p>to access the device.</p></div>
<div class="paragraph"><p>Given that we want to boot a vanilla kernel, we need a vanilla bootloader as
well. Before you mess with the bootloader, it&#8217;s a good idea to make a backup of
its config (there is a 3 second timeout during boot - if you press any key
there, you get the Marvell prompt). Here is my config:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>Marvell&gt;&gt; printenv
bootcmd=${x_bootcmd_ethernet}; ${x_bootcmd_usb}; ${x_bootcmd_kernel}; setenv bootargs ${x_bootargs} ${x_bootargs_root}; bootm 0x6400000;
bootdelay=3
baudrate=115200
x_bootcmd_ethernet=ping 192.168.2.1
x_bootcmd_usb=usb start
x_bootcmd_kernel=nand read.e 0x6400000 0x100000 0x400000
x_bootargs=console=ttyS0,115200
x_bootargs_root=ubi.mtd=2 root=ubi0:rootfs rootfstype=ubifs
ethact=egiga0
bootargs=console=ttyS0,115200 ubi.mtd=2 root=ubi0:rootfs rootfstype=ubifs
ipaddr=10.10.10.10
serverip=10.10.10.179
ethaddr=F0:AD:4E:00:CE:C3
stdin=serial
stdout=serial
stderr=serial</tt></pre>
</div></div>
<div class="paragraph"><p>The only semi-unique part is the MAC address of the network interface(s).</p></div>
<div class="paragraph"><p>If you want to update the bootloader, a possible way is to put the new binary
to a pendrive. Given that the default bootloader does not support ext*, we need
a fat filesystem. So format the first small partition we created already (the
device name may be different in your case!):</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>mkdosfs /dev/sda1</tt></pre>
</div></div>
<div class="paragraph"><p>Till Frugalware 1.6 is released, support for GuruPlug is available in
Frugalware -current only, so download the
<a href="http://ftp.frugalware.org/pub/frugalware/frugalware-current/frugalware-arm/u-boot-2011.12-2-arm.fpm">binary
package</a> from there, extract the u-boot.kwb file from the guruplug directory,
put it to the new partition. (A few other models are explained
<a href="http://www.cyrius.com/debian/kirkwood/sheevaplug/uboot-upgrade.html">here</a>).</p></div>
<div class="paragraph"><p>Before you reboot, copy also <tt>/boot/uImage</tt> to the fat partition, you may have
problems problems with reading the kernel from the ext4 partition with u-boot.</p></div>
<div class="paragraph"><p>Once copying the kernel is done, reboot and in the u-boot shell do:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>usb start
fatload usb 0:1 0x0800000 u-boot.kwb
nand erase 0x0 0x60000
nand write 0x0800000 0x0 0x60000
reset</tt></pre>
</div></div>
<div class="paragraph"><p>You can verify the updated bootloader with the <tt>version</tt> command:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>Marvell&gt;&gt; version

U-Boot 2011.12 (Jan 03 2012 - 16:55:38)
Marvell-GuruPlug
gcc (Frugalware Linux) 4.6.2
GNU ld (GNU Binutils) 2.22</tt></pre>
</div></div>
<div class="paragraph"><p>If Frugalware is mentioned, that&#8217;s a good sign. :)</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_boot_the_new_rootfs">Boot the new rootfs</h2>
<div class="sectionbody">
<div class="paragraph"><p>Now you can boot your new rootfs:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>usb start
fatload usb 0:1 0x00800000 /uImage
setenv bootargs console=ttyS0,115200 root=/dev/sda2 rootdelay=5
bootm 0x00800000</tt></pre>
</div></div>
<div class="paragraph"><p>If it booted fine, you may want to make this the default:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>setenv bootargs 'console=ttyS0,115200 root=/dev/sda2 rootdelay=5'
setenv bootcmd_usb 'usb start; fatload usb 0:1 0x00800000 /uImage'
setenv bootcmd 'run bootcmd_usb; bootm 0x00800000'
saveenv</tt></pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_finalize">Finalize</h2>
<div class="sectionbody">
<div class="paragraph"><p>The rest is up to you:</p></div>
<div class="ulist"><ul>
<li>
<p>
setting up a root password
</p>
</li>
<li>
<p>
setting up network by default using netconfig
</p>
</li>
</ul></div>
<div class="paragraph"><p>and so on&#8230; you know this already, nothing arm-specific.</p></div>
<div class="paragraph"><p>For the reference, here is the tested CPU and Frugalware version:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>$ cat /proc/cpuinfo
Processor       : Feroceon 88FR131 rev 1 (v5l)
BogoMIPS        : 1191.11
Features        : swp half thumb fastmult edsp
CPU implementer : 0x56
CPU architecture: 5TE
CPU variant     : 0x2
CPU part        : 0x131
CPU revision    : 1

Hardware        : Marvell GuruPlug Reference Board
Revision        : 0000
Serial          : 0000000000000000
$ cat /etc/frugalware-release
Frugalware 1.5 (Mores)</tt></pre>
</div></div>
</div>
</div>


<script src="https://apis.google.com/js/plusone.js"></script>
<g:plus action="share"></g:plus>

<!-- Disqus comments -->
<h1 id="comment-header">Comments</h1>
<div id="disqus_thread"></div>
<script type="text/javascript" src="http://vmiklos.disqus.com/embed.js">
	var disqus_developer = 1;
</script>
<noscript>
  <p><a href="http://disqus.com/?ref_noscript=vmiklos">View the discussion thread.</a></p>
</noscript>

</div>
</div>
</div>
</div>
</body>
</html>
