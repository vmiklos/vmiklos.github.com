<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
    <channel>
        <title>What is Miklos hacking - Tags: en</title>
        <description></description>
        <link>https://vmiklos.hu/blog/</link>
        <item>
            <title>EPUB3 export improvements in Libreoffice Writer, take two</title>
            <description>&lt;div class="paragraph"&gt;&lt;p&gt;I worked on improving the EPUB3 export filter in LibreOffice further recently.
First, thanks to &lt;a href="http://nouenoff.nl/"&gt;Nou&amp;amp;Off&lt;/a&gt; in cooperation with a customer
who made this work possible. Since the
&lt;a href="/blog/epub3-improvements.html"&gt;previous blog entry&lt;/a&gt; there have been a
number of improvements around a next set of topics.&lt;/p&gt;&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_cover_images"&gt;Cover images&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm5.staticflickr.com/4760/38920770224_b247fa89c4_o.png" alt="https://farm5.staticflickr.com/4760/38920770224_b247fa89c4_o.png" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;It is now possible to specify a cover image for the exported EPUB file. Given
that a cover image is not naturally part of the Writer document model, I introduced the
concept of a media directory for the EPUB export. The media directory is a
directory next to the source file, with the &amp;lt;file name without extension&amp;gt;
name. If that directory contains a file named cover.svg (or .gif, .jpg, .png),
the exporter will automatically use it. Otherwise you can customize this
default.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;The picture shows two EPUB files in &lt;a href="http://readium.org/"&gt;Readium&lt;/a&gt; with
different cover images.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_improved_metadata_support"&gt;Improved metadata support&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm5.staticflickr.com/4603/38920770174_142950782e_o.png" alt="https://farm5.staticflickr.com/4603/38920770174_142950782e_o.png" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;It&amp;#8217;s quite frequent that you are technically author of a document, but the
logical author of the book is somebody else. Same for the date of the book,
and so on. So the EPUB export dialog now has support for overwriting the
defaults coming from the Writer document model. For mass-conversion of
documents it&amp;#8217;s possible to place a &amp;lt;file name without extension&amp;gt;.xmp file in
the media directory and &lt;a href="http://www.adobe.com/devnet/xmp.html"&gt;XMP&lt;/a&gt; metadata
from that file will also overwrite metadata coming from the document model.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;The picture shows the extended EPUB export options dialog.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_footnotes_and_image_popups"&gt;Footnotes and image popups&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm5.staticflickr.com/4612/38920770144_e90e2a8e92_o.png" alt="https://farm5.staticflickr.com/4612/38920770144_e90e2a8e92_o.png" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;I&amp;#8217;ve added support for footnotes. As a special case of this, image popups on
images and text is now supported. This works by placing a relative link on a
text portion or on an image, and placing an image with the same name (e.g. in
high resolution) in the media directory. In this case the EPUB export will
bundle the image from the media directory inside the EPUB file and clicking on
the text or image will open the bundled image in a popup (or in some other
container, depending on how your reader interprets footnotes).&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;The picture shows such a popup in Microsoft Edge.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_fixed_layout"&gt;Fixed layout&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm5.staticflickr.com/4604/38920770104_108465bda1_o.png" alt="https://farm5.staticflickr.com/4604/38920770104_108465bda1_o.png" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;The EPUB3 fixed layout is quite similar to PDF, just it is built on top of
XHTML and SVG. Possible use-cases for this can be:&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
exporting a document where presenting the content as reflowable text would
  be misleading (e.g. comic books), but the publisher of the book only works
  with EPUB (reflowable or fixed layout, but no PDF)
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
printing (again, in case for some reason you want to avoid PDF)
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;These might be very specific situations, but luckily supporting them is not
too complex. I implemented an approach very similar to the PDF export, where
we export individual pages of the Writer document&amp;#8217;s layout as a metafile, and
then consume that&amp;#8201;&amp;#8212;&amp;#8201;this time with the SVG export. Building on top of the
existing Writer layout and SVG export means the hard work is really done by
these components, the EPUB fixed layout export just puts these together.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;The picture shows a Writer document with a table of contents containing page
numbers, a header and a footer in Readium.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;All this is available in master (towards LibreOffice 6.1), or you can grab a
&lt;a href="http://dev-builds.libreoffice.org/daily/master/"&gt;daily build&lt;/a&gt; and try it out
right now. :-)&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
            <link>https://vmiklos.hu/blog/epub3-improvements-2.html</link>
            <pubDate>Thu, 11 Jan 2018 12:25:02 +0100</pubDate>
            <guid isPermaLink="false">https://vmiklos.hu/blog/epub3-improvements-2.html</guid>
        </item>
        <item>
            <title>EPUB3 export improvements in Libreoffice Writer</title>
            <description>&lt;div class="paragraph"&gt;&lt;p&gt;I worked on improving the EPUB3 export filter in LibreOffice recently. First,
thanks to &lt;a href="http://nouenoff.nl/"&gt;Nou&amp;amp;Off&lt;/a&gt; in cooperation with a customer who made
this work possible. Since the &lt;a href="/blog/basic-epub3-export.html"&gt;previous blog
entry&lt;/a&gt; there have been a number of improvements around 4 topics.&lt;/p&gt;&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_improved_links"&gt;Improved links&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm5.staticflickr.com/4540/38847800651_d5271ced3a_o.png" alt="https://farm5.staticflickr.com/4540/38847800651_d5271ced3a_o.png" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;The character properties of link text is now handled correctly, in the above
example you can see that the text is red, and this comes from a character
style.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_improved_table_support"&gt;Improved table support&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Previously the support for tables was there just to not loose content, now all
kinds cell, row and table properties are handled correctly. A few samples&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
custom cell width:
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm5.staticflickr.com/4566/38847800611_38b8483d7f_o.png" alt="https://farm5.staticflickr.com/4566/38847800611_38b8483d7f_o.png" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
custom row height:
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm5.staticflickr.com/4580/38847800521_26285a9152_o.png" alt="https://farm5.staticflickr.com/4580/38847800521_26285a9152_o.png" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
row span:
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm5.staticflickr.com/4540/38847800461_359651bc3d_o.png" alt="https://farm5.staticflickr.com/4540/38847800461_359651bc3d_o.png" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;So the table support should be now decent, covering row and column spanning
and various cell border properties.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_improved_image_support"&gt;Improved image support&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Previously only the simplest as-character anchoring was supported. Now much
more cases are handled. Two examples:&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
image borders:
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm5.staticflickr.com/4541/24975193838_94818bd1ed_o.png" alt="https://farm5.staticflickr.com/4541/24975193838_94818bd1ed_o.png" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
image with a caption:
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm5.staticflickr.com/4568/24975193608_83239bf287_o.png" alt="https://farm5.staticflickr.com/4568/24975193608_83239bf287_o.png" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;This includes various wrap types (to the extent HTML5 allows representing ODF
wrap types).&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_font_embedding"&gt;Font embedding&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;If the user chooses to embed fonts (via File &amp;#8594; Properties &amp;#8594; Font &amp;#8594; Embed),
then the EPUB export now handles this. Here is a custom font that is typically
not available:&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm5.staticflickr.com/4561/38847800811_613d6fbbd2_o.png" alt="https://farm5.staticflickr.com/4561/38847800811_613d6fbbd2_o.png" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;(The screenshot is from the Calibre ebook reader.)&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;All this is available in master (towards LibreOffice 6.1), or you can grab a
&lt;a href="http://dev-builds.libreoffice.org/daily/master/"&gt;daily build&lt;/a&gt; and try it out
right now. :-)&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
            <link>https://vmiklos.hu/blog/epub3-improvements.html</link>
            <pubDate>Tue, 05 Dec 2017 11:11:56 +0100</pubDate>
            <guid isPermaLink="false">https://vmiklos.hu/blog/epub3-improvements.html</guid>
        </item>
        <item>
            <title>Basic EPUB3 export in Libreoffice</title>
            <description>&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm5.staticflickr.com/4577/37588898064_117dc4a933_o_d.png" alt="https://farm5.staticflickr.com/4577/37588898064_117dc4a933_o_d.png" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;I worked on a new EPUB3 export filter in LibreOffice recently. First, thanks
to &lt;a href="http://nouenoff.nl/"&gt;Nou&amp;amp;Off&lt;/a&gt; in cooperation with a customer who made this
work possible.  The current state is that basic features work nicely to the
extent that the filter is probably usable for most books (they typically
mostly have just text with minimal formatting), so this post aims to explain
the architecture, how the various pieces fit together.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;The above picture shows the building blocks. The idea is that nominally EPUB
is a complete export filter, but instead of doing all the work, we offload
various sub-tasks to other modules:&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
First we invoke the existing (flat) ODT export, so we can work with ODF
  instead of with the UNO API directly. This will be useful in the next step.
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
Then we feed the SAX events from the ODT export to a new librevenge text
  export. Given that the librevenge API is really close to ODF (and xmloff/
  has quite some code to map the UNO API to ODF), here it pays off to work with
  ODF and not with the UNO API directly.
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
The librevenge text export talks to a librevenge generator, which is
  David Tardon&amp;#8217;s excellent
  &lt;a href="https://sourceforge.net/projects/libepubgen/"&gt;libepubgen&lt;/a&gt; in this case.
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
Finally libepubgen calls back to LibreOffice, and our package code does the
  ZIP compression.
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;The setup is a bit complicated, but it has a number of advantages:&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
Instead of reinventing the wheel, LO and DLP now shares code, libepubgen is
  now a dependency of LibreOffice.
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
libepubgen doesn&amp;#8217;t bring its own ZIP writer code, it can nicely reuse our
  existing one.
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
This is a great opportunity to finally write an ODT&amp;#8594;librevenge bridge, so
  other DLP-based export libs can be added in the future (e.g.
  &lt;a href="https://sourceforge.net/projects/librvngabw/"&gt;librvngabw&lt;/a&gt;).
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
If we ever want to export to EPUB from Draw/Impress, libepubgen will help us
  there as well.
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;As a user, here is a list of features you can expect working:&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
plain text should work fine (formatting may be lost, but content should be
  fine)
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
table of contents, as long as you properly use headings or you separate
  chapters by page breaks
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
export options: EPUB3 vs EPUB2, split on headings vs page breaks
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
basic set of character and paragraph properties should work
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;During development I regularly used
&lt;a href="https://github.com/IDPF/epubcheck"&gt;epubcheck&lt;/a&gt;, so hopefully the export result
is usually valid.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;All this is available in master (towards LibreOffice 6.0), or you can grab a
&lt;a href="http://dev-builds.libreoffice.org/daily/master/"&gt;daily build&lt;/a&gt; and try it out
right now. :-)&lt;/p&gt;&lt;/div&gt;
</description>
            <link>https://vmiklos.hu/blog/basic-epub3-export.html</link>
            <pubDate>Fri, 10 Nov 2017 11:19:36 +0100</pubDate>
            <guid isPermaLink="false">https://vmiklos.hu/blog/basic-epub3-export.html</guid>
        </item>
        <item>
            <title>A year in LibreOffice’s PDF support LOCon talk</title>
            <description>&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;a class="image" href="https://speakerd.s3.amazonaws.com/presentations/71ba628d90704fa9aa06c985d0c5a344/pdf-locon-rome-2k17.pdf"&gt;
&lt;img src="https://farm5.staticflickr.com/4468/37421553870_e33fe6329d_z.jpg" alt="https://farm5.staticflickr.com/4468/37421553870_e33fe6329d_z.jpg" /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;&lt;a href="http://conference.libreoffice.org/2017/the-program-2/oct-13th-friday/"&gt;A year
in LibreOffice’s PDF support&lt;/a&gt; was a talk I gave today at LibreOffice
conference 2017. Given that this was one of the last talks at the whole
conference, thanks to the ones who still did not go home, but listened. :-)&lt;/p&gt;&lt;/div&gt;
</description>
            <link>https://vmiklos.hu/blog/pdf-locon-rome-2k17.html</link>
            <pubDate>Fri, 13 Oct 2017 23:53:47 +0200</pubDate>
            <guid isPermaLink="false">https://vmiklos.hu/blog/pdf-locon-rome-2k17.html</guid>
        </item>
        <item>
            <title>LibreOffice: Code Structure LOCon talk</title>
            <description>&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;a class="image" href="https://speakerd.s3.amazonaws.com/presentations/69a6d9f8e5a14a948b27796b4c73ae11/beginners-structure-locon-rome-2k17.pdf"&gt;
&lt;img src="https://farm5.staticflickr.com/4457/37000772213_017693764a_z.jpg" alt="https://farm5.staticflickr.com/4457/37000772213_017693764a_z.jpg" /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Today I gave a
&lt;a href="http://conference.libreoffice.org/2017/the-program-2/oct-11th-wednesday/"&gt;LibreOffice:
Code Structure&lt;/a&gt; talk at LibreOffice conference 2017. These are an updated
version of Michael Meeks'
&lt;a href="https://wiki.documentfoundation.org/Development/Code_Overview"&gt;original
slides&lt;/a&gt;, it&amp;#8217;s actually surprised me how many things changed since April 2016.
:-)&lt;/p&gt;&lt;/div&gt;
</description>
            <link>https://vmiklos.hu/blog/code-structure-locon-rome-2k17.html</link>
            <pubDate>Wed, 11 Oct 2017 17:26:42 +0200</pubDate>
            <guid isPermaLink="false">https://vmiklos.hu/blog/code-structure-locon-rome-2k17.html</guid>
        </item>
        <item>
            <title>pdfium path segment API for LibreOffice's test needs</title>
            <description>&lt;div class="paragraph"&gt;&lt;p&gt;I recently
&lt;a href="https://cgit.freedesktop.org/libreoffice/core/commit/?id=da705eff910f512623a689aaf28604270fb8f1c4"&gt;fixed&lt;/a&gt;
&lt;a href="https://bugs.documentfoundation.org/show_bug.cgi?id=108963"&gt;tdf#108963&lt;/a&gt;, which
is a PDF export bug&amp;#8201;&amp;#8212;&amp;#8201;in case of highlighted and rotated text in e.g.
Impress, the highlight rectangle in the PDF export was not rotated.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;This is how the export result looked like:&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm5.staticflickr.com/4341/37305427601_db1cfb697e_o.png" alt="https://farm5.staticflickr.com/4341/37305427601_db1cfb697e_o.png" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;And this is how it now looks like, after fixing:&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm5.staticflickr.com/4453/37258379126_b20fd39655_o.png" alt="https://farm5.staticflickr.com/4453/37258379126_b20fd39655_o.png" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;For a long time the PDF export filter had no tests at all; the current
approach I introduced is that we parse the PDF export result with pdfium,
which is an excellent PDF rendering library (I covered it in general in an
&lt;a href="https://vmiklos.hu/blog/pdfium.html"&gt;earlier post&lt;/a&gt;).&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;So given that pdfium knows how that rectangle looks like, we should be able to
query the details of it from a test as well, correct? It depends. Yes, it&amp;#8217;s
possible technically, but no, most of the pdfium functionality is actually not
exposed at its &lt;a href="https://pdfium.googlesource.com/pdfium/+/master/public/"&gt;public API&lt;/a&gt;.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;The current situation is that one could use &lt;code&gt;FPDF_LoadMemDocument()&lt;/code&gt;,
&lt;code&gt;FPDF_LoadPage()&lt;/code&gt; to get access to a PDF page, then &lt;code&gt;FPDFPage_CountObject()&lt;/code&gt; and
&lt;code&gt;FPDFPage_GetObject()&lt;/code&gt; to iterate over objects on a page. We can filter for the
relevant object by using &lt;code&gt;FPDFPageObj_GetType()&lt;/code&gt; and &lt;code&gt;FPDFPath_GetFillColor()&lt;/code&gt;,
that will give us the only path that has a yellow fill color.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;But getting more info about the geometry of the path isn&amp;#8217;t really possible. As
a workaround I went with &lt;code&gt;FPDFPageObj_GetBounds()&lt;/code&gt; for the test, but wouldn&amp;#8217;t it
be nicer to get the individual segments (the objects that are the children of
a path) and then get coordinates and other properties of a segment? This is
what the recent API I added to pdfium now does. It provides the followings:&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
&lt;code&gt;FPDFPath_CountSegments()&lt;/code&gt; gives you the number of segments of a path
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
&lt;code&gt;FPDFPath_GetPathSegment()&lt;/code&gt; gives you a given segment, via a new
  &lt;code&gt;FPDF_PATHSEGMENT&lt;/code&gt; opaque type
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
you can use &lt;code&gt;FPDFPathSegment_GetPoint()&lt;/code&gt; to get the coordinates,
  &lt;code&gt;FPDFPathSegment_GetType()&lt;/code&gt; to get the type (move to, line to, etc.) and
  &lt;code&gt;FPDFPathSegment_GetClose()&lt;/code&gt; to see if the segment closes the current subpath
  of the path (or not)
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;This means that after the next pdfium update in LibreOffice, PDF export tests
can nicely assert these properties of paths instead of dubious &lt;em&gt;bounding box
should be larger after rotation&lt;/em&gt; assertions.&lt;/p&gt;&lt;/div&gt;
</description>
            <link>https://vmiklos.hu/blog/pdfium-pathsegment.html</link>
            <pubDate>Mon, 25 Sep 2017 12:05:45 +0200</pubDate>
            <guid isPermaLink="false">https://vmiklos.hu/blog/pdfium-pathsegment.html</guid>
        </item>
        <item>
            <title>Split sections inside tables for LibreOffice Writer</title>
            <description>&lt;div class="paragraph"&gt;&lt;p&gt;Tables and sections in LibreOffice Writer are both containers, and in some
cases it makes sense to have sections inside tables or tables inside sections.
(For example you can mark a group of paragraphs as read-only by including them
in a read-only section.) Tables in sections, split over multiple pages was
already working, but now it&amp;#8217;s possible to have sections in tables split over
multiple pages as well.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;First, thanks &lt;a href="https://www.escriba.de/en/"&gt;Escriba&lt;/a&gt; who made this work possible.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;There were 3 parts of this work, you can read some details about them below.&lt;/p&gt;&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_split_of_multi_line_paragraphs"&gt;Split of multi-line paragraphs&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;The first goal was to handle the split of multi-line paragraphs inside
sections inside tables. Initially this looked like this:&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm5.staticflickr.com/4430/35957293074_cfeabe6a51_o.png" alt="https://farm5.staticflickr.com/4430/35957293074_cfeabe6a51_o.png" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;After commit
&lt;a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=f991b842addddeada6dc45c4054deeca5aa7f17b"&gt;tdf#108524
sw: attempt to split section frames inside table cells&lt;/a&gt; it looks like this:&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm5.staticflickr.com/4393/35957293014_ae8f210542_o.png" alt="https://farm5.staticflickr.com/4393/35957293014_ae8f210542_o.png" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_split_of_one_liner_paragraphs"&gt;Split of one-liner paragraphs&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Technically this is a situation different to the previous one, as split
paragraphs have a master (first) frame and one or more follow (non-first)
frames; and the previous stage only addressed the move of follow frames to
next pages. Initially such a document looked like this:&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm5.staticflickr.com/4360/35957292924_2af502ffc7_o.png" alt="https://farm5.staticflickr.com/4360/35957292924_2af502ffc7_o.png" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;After commit
&lt;a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=f8a76d218305a56d15b82b9dac4fafa558872780"&gt;tdf#108524
sw: split section frames inside table cells, non-split text frames&lt;/a&gt; it is laid
out as expected:&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm5.staticflickr.com/4399/35957292834_dc2ce35f85_o.png" alt="https://farm5.staticflickr.com/4399/35957292834_dc2ce35f85_o.png" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_merge_a_split_section"&gt;Merge a split section&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;The last piece was moving paragraphs back to previous pages when there is
again space for them. Initially we did not use the newly available space:&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm5.staticflickr.com/4432/35982835413_99a65febe2_o.png" alt="https://farm5.staticflickr.com/4432/35982835413_99a65febe2_o.png" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;After commit
&lt;a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=850bf99e7d1abcf2e0cce731b6715f87420d0ee6"&gt;tdf#108524
sw: handle sections inside tables in SwFrame::GetPrevSctLeaf()&lt;/a&gt; the paragraph
is moved back properly:&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm5.staticflickr.com/4408/35982835283_1c2002254b_o.png" alt="https://farm5.staticflickr.com/4408/35982835283_1c2002254b_o.png" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_one_more_thing_8230"&gt;One more thing&amp;#8230;&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Given that all code changes affect how sections in tables are handled in a
parent frame in general (which is a body frame in all the above pictures), the
same changes are also usable for other parent containers as well, e.g. linked
TextFrames. Here is how that looks like:&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://farm5.staticflickr.com/4342/35982835353_25d609548d_o.png" alt="https://farm5.staticflickr.com/4342/35982835353_25d609548d_o.png" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;That&amp;#8217;s it for now&amp;#8201;&amp;#8212;&amp;#8201;as usual the commits are in master, so you can try this
right now with a 6.0 &lt;a href="http://dev-builds.libreoffice.org/daily/master/"&gt;daily
build&lt;/a&gt;. :-)&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
            <link>https://vmiklos.hu/blog/sw-split-section-in-table.html</link>
            <pubDate>Fri, 25 Aug 2017 11:09:40 +0200</pubDate>
            <guid isPermaLink="false">https://vmiklos.hu/blog/sw-split-section-in-table.html</guid>
        </item>
        <item>
            <title>Mail merge Writer data source</title>
            <description>&lt;div class="paragraph"&gt;&lt;p&gt;If you ever used the
&lt;a href="https://help.libreoffice.org/Writer/Mail_Merge_Wizard"&gt;mail merge wizard&lt;/a&gt; with
data sources, then you know how it works: it typically needs some kind of data
source (e.g. a Calc spreadsheet), a Writer document containing the email or
letter (that contains fields), and then mail merge can generate the
personalized documents for you.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;In case you have an existing document where you already have such data in a
Writer table, you had to somehow transfer it to one of the formats for which
there was a data source driver, and then you could use it inside mail merge.
I&amp;#8217;ve now added a dedicated Writer driver in &lt;code&gt;connectivity/&lt;/code&gt;, so picking up
data directly from Writer tables is now possible.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;If you are interested how this looks like, here is a demo (click on the image
to see the video):&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;a class="image" href="https://youtu.be/thasVxlF5Fo"&gt;
&lt;img src="https://farm5.staticflickr.com/4298/36060010585_900a1c7f1c_o.png" alt="https://farm5.staticflickr.com/4298/36060010585_900a1c7f1c_o.png" /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;That&amp;#8217;s it for now&amp;#8201;&amp;#8212;&amp;#8201;as usual the commits are in master, so you can try this
right now with a 6.0 &lt;a href="http://dev-builds.libreoffice.org/daily/master/"&gt;daily
build&lt;/a&gt;. :-)&lt;/p&gt;&lt;/div&gt;
</description>
            <link>https://vmiklos.hu/blog/mail-merge-writer-data-source.html</link>
            <pubDate>Fri, 21 Jul 2017 09:46:11 +0200</pubDate>
            <guid isPermaLink="false">https://vmiklos.hu/blog/mail-merge-writer-data-source.html</guid>
        </item>
        <item>
            <title>Using LibreOffice with xmlsec from the system</title>
            <description>&lt;div class="paragraph"&gt;&lt;p&gt;LibreOffice uses a number of external libraries, and most of them can be
configured to use a bundled version or a system version. libxmlsec was an
exception previously (only the bundled version was usable), but LibreOffice
master (towards 6.0) doesn&amp;#8217;t have this limitation anymore.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Using a bundled version is a good choice in case:&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
you want to create self-contained binaries
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
you want to bisect a regression, where possibly the regression was
  introduced by upgrading one of the external libraries
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
the system (e.g. macOS, Windows) doesn&amp;#8217;t provide the relevant library
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Using a system version is a good thing in case:&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
you want to work with the system, not against it (if a Linux distro already
  provides libxmlsec, why ship a duplicated copy inside LibreOffice?)
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
being able to use a system version means our bundled version does not have
  custom patches which affect the functionality of the library
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
not having custom patches also means upstream benefit from our submitted
  patches, these patches are reviewed by competent maintainers and upgrading
  the external is easier, as there is no patchset to rebase.
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;With that in mind, let&amp;#8217;s have a look what blocked using system-xmlsec in the past:&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
LibreOffice inherited a large patchset from OpenOffice.org, commit
  694a2c53810dec6d8e069d74baf51e6cdda91faa (2012-11-30) had 16 patches, with
  this scary diffstat:
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre&gt;&lt;code&gt; 43 files changed, 5888 insertions(+), 1885 deletions(-)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
I even increased this when I added the
  &lt;a href="/blog/libreoffice-sha256-signatures.html"&gt;SHA256 patches&lt;/a&gt;, as back then
  I wasn&amp;#8217;t sure if it&amp;#8217;ll be ever possible to upgrade to a newer libxmlsec
  version.
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
Step by step I got rid of most of these patches, either by upstreaming them
  or realizing they are no longer necessary. Upstreaming wasn&amp;#8217;t always
  trivial, as for our purposes it was always easy to patch something, but for
  upstream non-compatible changes always have to be conditional. Today we have
  3 build-specific patches, 1 backport and 1 feature patch that is (at least)
  not necessary when signing / verifying documents with software-based
  certificates.
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
At the end
  &lt;a href="https://cgit.freedesktop.org/libreoffice/core/commit/?id=9752eccdd06f6695ec4f173ea93cada65063d1f0"&gt;two&lt;/a&gt;
  &lt;a href="https://cgit.freedesktop.org/libreoffice/core/commit/?id=ab50f0b08b22af1e60a0b6ce5e7e8e7d1f665216"&gt;more&lt;/a&gt;
  commits were necessary to support building against system-xmlsec, only adding
  minimal differences when using the system or the bundled xmlsec variants.
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;If you are a Linux distro packager then &lt;code&gt;--with-system-libs&lt;/code&gt; already implies
&lt;code&gt;--with-system-xmlsec&lt;/code&gt;, so you probably don&amp;#8217;t have to do anything. If you
build LO for static analysis (e.g. Coverity) then this should be also useful,
so not relevant issues in 3rd-party code don&amp;#8217;t have to be ignored manually.&lt;/p&gt;&lt;/div&gt;
</description>
            <link>https://vmiklos.hu/blog/system-xmlsec.html</link>
            <pubDate>Tue, 04 Jul 2017 21:33:18 +0200</pubDate>
            <guid isPermaLink="false">https://vmiklos.hu/blog/system-xmlsec.html</guid>
        </item>
        <item>
            <title>LibreOffice Perugia HackFest 2017</title>
            <description>&lt;div style="text-align: center; font-size: 0.6em;"&gt;
&lt;img src="https://farm5.staticflickr.com/4272/34874639921_ef2ce56d1c_z.jpg"/&gt;
&lt;p&gt;(via &lt;a href="https://twitter.com/ogervasi/status/868767747756503041"&gt;ogervasi&lt;/a&gt;)&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Last weekend I attended the LibreOffice
&lt;a href="https://wiki.documentfoundation.org/Hackfest/Perugia2017"&gt;Perugia&lt;/a&gt; HackFest
2017, with the primary goal of mentoring students (together with
&lt;a href="http://erack.org/blog/"&gt;Eike&lt;/a&gt; and Christian): provided they manage to
contribute at least one non-trivial easy hack, they get university credits for
their work.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;I worked with &lt;a href="https://gerrit.libreoffice.org/38160"&gt;Arianna&lt;/a&gt;,
&lt;a href="https://gerrit.libreoffice.org/38159"&gt;Claudio&lt;/a&gt;,
&lt;a href="https://gerrit.libreoffice.org/38161"&gt;Francesco&lt;/a&gt; and
&lt;a href="https://gerrit.libreoffice.org/38134"&gt;Gian&lt;/a&gt;, all of them managed to
achieve something by the end of the third day.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;When I was not helping others, I also fixed a few bugs:&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://bugs.documentfoundation.org/show_bug.cgi?id=107976"&gt;tdf#107976&lt;/a&gt; sw: let a view handle multiple transferables
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://bugs.documentfoundation.org/show_bug.cgi?id=107837"&gt;tdf#107837&lt;/a&gt; DOCX export: fix balanced multi-col section at doc end
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://bugs.documentfoundation.org/show_bug.cgi?id=107684"&gt;tdf#107684&lt;/a&gt; DOCX export: fix duplicated &amp;lt;w:outlineLvl&amp;gt; element for styles
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://bugs.documentfoundation.org/show_bug.cgi?id=106950"&gt;tdf#106950&lt;/a&gt; sw: support CharShadingValue property on paragraph styles
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Some photos I took during the event are &lt;a href="https://www.flickr.com/photos/vmiklos/albums/72157681387507534"&gt;available&lt;/a&gt;.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Thanks the organizers for the great event, also kudos to
&lt;a href="https://www.collaboraoffice.com/"&gt;Collabora&lt;/a&gt;, Red Hat and TDF for allowing
mentors to come! :-)&lt;/p&gt;&lt;/div&gt;
</description>
            <link>https://vmiklos.hu/blog/perugia2017.html</link>
            <pubDate>Wed, 31 May 2017 10:07:43 +0200</pubDate>
            <guid isPermaLink="false">https://vmiklos.hu/blog/perugia2017.html</guid>
        </item>
    </channel>
</rss>
