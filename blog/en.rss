<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
    <channel>
        <title>What is Miklos hacking - Tags: en</title>
        <description></description>
        <link>http://vmiklos.hu/blog/</link>
        <item>
            <title>Sanitizing member variable names in LibreOffice Writer</title>
            <description>&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;a class="image" href="https://lh3.googleusercontent.com/-Qk6Y55f7HaY/VlYtR13vYeI/AAAAAAAAGRA/hK-7EJMFhwk/s0-Ic42/"&gt;
&lt;img src="https://lh3.googleusercontent.com/-Qk6Y55f7HaY/VlYtR13vYeI/AAAAAAAAGRA/hK-7EJMFhwk/s400-Ic42/" alt="https://lh3.googleusercontent.com/-Qk6Y55f7HaY/VlYtR13vYeI/AAAAAAAAGRA/hK-7EJMFhwk/s400-Ic42/" /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Robinson just
&lt;a href="http://cgit.freedesktop.org/libreoffice/core/commit/?h=libreoffice-5-1&amp;amp;id=fa7c921feb2f6e14f7eca717dd3cfbca0bd35c03"&gt;branched
off&lt;/a&gt; libreoffice-5-1 from master in LibreOffice&amp;#8217;s core.git repository, so time
to talk about what happened behind the scenes in the 5.0 &amp;#8594; 5.1 development
cycle from my side.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;One stylistic detail that annoyed me for a while was the inconsistency around
naming class member variables. In new code it&amp;#8217;s common to give them an &lt;code&gt;m_&lt;/code&gt;
(or at least an &lt;code&gt;m&lt;/code&gt;) prefix, but in older code that wasn&amp;#8217;t that common, and
various custom hacks were invented to differentiate between pointers which
point to the same memory address, but one being a parameter of a member
function, and the other being a member variable.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Probably the worst scenario is when one was an abbreviation of the other, like
pTable and pTbl or pCursor and pCrsr. I took this as an opportunity to play
with Clang&amp;#8217;s &lt;a href="http://clang.llvm.org/docs/LibTooling.html"&gt;LibTooling&lt;/a&gt;, and I
wrote two tools &lt;a href="http://vmiklos.hu/blog/cambridge.html"&gt;back during the
Cambridge hackfest&lt;/a&gt; to automate the process of finding and fixing missing
prefixes.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;To scope the renaming, I changed all classes in the &lt;code&gt;sw&lt;/code&gt; module having more
than 20 unprefixed members to follow the above convention, hopefully this
nicely improves code readability, together with the
&lt;a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=49c2b9808df8a6b197dec666dfc0cda6321a4306"&gt;mass-rename
of pointless abbreviations&lt;/a&gt;, also done before the branch-off, so affecting
both libreoffice-5-1 and master. :-)&lt;/p&gt;&lt;/div&gt;
</description>
            <link>http://vmiklos.hu/blog/sanitizing-member-variable-names.html</link>
            <pubDate>Thu, 26 Nov 2015 08:50:47 +0100</pubDate>
            <guid isPermaLink="false">http://vmiklos.hu/blog/sanitizing-member-variable-names.html</guid>
        </item>
        <item>
            <title>PNG export in LibreOffice Calc</title>
            <description>&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;a class="image" href="https://lh3.googleusercontent.com/-8n61EJB3Xco/VjkUn1JvuqI/AAAAAAAAGOE/0-DCtcNV2RY/s0-Ic42/"&gt;
&lt;img src="https://lh3.googleusercontent.com/-8n61EJB3Xco/VjkUn1JvuqI/AAAAAAAAGOE/0-DCtcNV2RY/s400-Ic42/" alt="https://lh3.googleusercontent.com/-8n61EJB3Xco/VjkUn1JvuqI/AAAAAAAAGOE/0-DCtcNV2RY/s400-Ic42/" /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Both LibreOffice Writer and Impress has the ability to export the document as
PNG, which is one way to create thumbnails for documents&amp;#8201;&amp;#8212;&amp;#8201;i.e. being able to
preview them before the real loading of the document happens. It turns out
Calc did not have this feature, and given that &lt;code&gt;ScModelObj&lt;/code&gt; also supports the
&lt;code&gt;css::view::XRenderable&lt;/code&gt; interface (just like Writer), I hoped that it won&amp;#8217;t
be too complex to add one.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;You can refer to
&lt;a href="http://fridrich.blogspot.com/2013/08/extending-swiss-army-knife-overview.html"&gt;Fridrich&amp;#8217;s
overview blog post&lt;/a&gt; for the complete list of steps on how to add a new filter
to LibreOffice, here the following steps
&lt;a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=03bb5d52fecd6c613c6cc36508eb44e5e1c3456a"&gt;were
needed&lt;/a&gt;:&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
improve &lt;code&gt;DocumentToGraphicRenderer&lt;/code&gt;, so that it can handle that Calc does
  not implement the &lt;code&gt;text::XTextViewCursorSupplier&lt;/code&gt; interface (Writer uses
  this one to expose the cursor is on what page)
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
register &lt;code&gt;png_Portable_Network_Graphic&lt;/code&gt; as filter type for Calc
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
create a new &lt;code&gt;calc_png_Export&lt;/code&gt; filter fragment
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
register a Calc graphic filters configuration type and filter group in
  &lt;code&gt;Configuration_filter&lt;/code&gt; and &lt;code&gt;CustomTarget_registry&lt;/code&gt;
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
testcase
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;If you can&amp;#8217;t wait till LibreOffice 5.1 is released to try out this new
feature, you can get a &lt;a href="http://dev-builds.libreoffice.org/daily/master/"&gt;daily
build&lt;/a&gt;. :-)&lt;/p&gt;&lt;/div&gt;
</description>
            <link>http://vmiklos.hu/blog/calc-png-export.html</link>
            <pubDate>Wed, 04 Nov 2015 09:17:15 +0100</pubDate>
            <guid isPermaLink="false">http://vmiklos.hu/blog/calc-png-export.html</guid>
        </item>
        <item>
            <title>Flat ODF support in LibreOffice's Android port</title>
            <description>&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;a class="image" href="https://lh3.googleusercontent.com/-M9NDl_ptc9U/ViPqlxkmJwI/AAAAAAAAGLk/t92PSwTHAk0/s0-Ic42/"&gt;
&lt;img src="https://lh3.googleusercontent.com/-M9NDl_ptc9U/ViPqlxkmJwI/AAAAAAAAGLk/t92PSwTHAk0/s400-Ic42/" alt="https://lh3.googleusercontent.com/-M9NDl_ptc9U/ViPqlxkmJwI/AAAAAAAAGLk/t92PSwTHAk0/s400-Ic42/" /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;While LibreOffice&amp;#8217;s Android port has as good support for ODF as the desktop
version, flat ODF was lagging behind. There were two reasons for this:&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://gerrit.libreoffice.org/gitweb?p=core.git;a=commit;h=9aa6ec9bfaa3c76c291ab8ec9a1b87fb89b817e6"&gt;flat-ODF-related
  services were simply missing&lt;/a&gt; from the .apk, for historical reasons: when
  the .apk limit was 50MB, it sounded like a good idea to leave these out if it
  allowed packaging e.g. editing-related services.
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://gerrit.libreoffice.org/gitweb?p=core.git;a=commit;h=1956b50e3b4c63a913151fd21d21c42cd288173d"&gt;flat
  ODS was blacklisted explicitly&lt;/a&gt;, from the times when Calc tiled rendering
  was missing, and when .ods was included again the document browser, .fods was
  forgotten.
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;With these two fixes my favorite test documents (of which the ODF version
worked already previously) in flat ODF version also load properly in all
Writer, Calc and Impress&amp;#8201;&amp;#8212;&amp;#8201;as can be seen on the above montage of
screenshots.&lt;/p&gt;&lt;/div&gt;
</description>
            <link>http://vmiklos.hu/blog/flat-odf-android.html</link>
            <pubDate>Tue, 20 Oct 2015 09:25:31 +0200</pubDate>
            <guid isPermaLink="false">http://vmiklos.hu/blog/flat-odf-android.html</guid>
        </item>
        <item>
            <title>Restarting timer of the presenter console</title>
            <description>&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;a class="image" href="https://lh3.googleusercontent.com/-gedKN4759cE/VhZqBSpZL7I/AAAAAAAAGJs/Hlez6jX85ww/s0-Ic42/"&gt;
&lt;img src="https://lh3.googleusercontent.com/-gedKN4759cE/VhZqBSpZL7I/AAAAAAAAGJs/Hlez6jX85ww/s400-Ic42/" alt="https://lh3.googleusercontent.com/-gedKN4759cE/VhZqBSpZL7I/AAAAAAAAGJs/Hlez6jX85ww/s400-Ic42/" /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;This use-case came up during this year&amp;#8217;s LibreOffice conference. I started the
Impress slideshow a few minutes in advance, so the audience could check if they
are at the correct room, seeing the title side. Right after starting the
slideshow, the presentation timer also started to count. I had to stop and
start the presentation, so I had an idea how much time my talk took so far. The
side effect of this workaround was that the audience saw an ugly short flash
while the presentation was not running at the moment I started talking.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Because hacking the presenter console requires you to have two monitors, it&amp;#8217;s
not something I looked into during the conference&amp;#8217;s hackfest, but now here it
is: I
&lt;a href="https://gerrit.libreoffice.org/gitweb?p=core.git;a=commit;h=b1a6a99b9a78689c6d3649ce066fad66912188e2"&gt;added&lt;/a&gt;
a button to just restart the timer, then it&amp;#8217;s not needed to stop/start the
presentation manually.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;The icon is just a placeholder for now, the real design is
&lt;a href="http://listarchives.libreoffice.org/global/design/msg07351.html"&gt;in progress&lt;/a&gt;.&lt;/p&gt;&lt;/div&gt;
</description>
            <link>http://vmiklos.hu/blog/presenter-console.html</link>
            <pubDate>Fri, 09 Oct 2015 08:06:29 +0200</pubDate>
            <guid isPermaLink="false">http://vmiklos.hu/blog/presenter-console.html</guid>
        </item>
        <item>
            <title>LibreOffice's Android port</title>
            <description>&lt;div style="text-align: center; font-size: 0.6em;"&gt;
&lt;img src="https://lh3.googleusercontent.com/-Q_NX5YCu1Wk/VgT4uHIJI5I/AAAAAAAAGHo/AgTiFrgfDcA/s400-Ic42/"/&gt;
&lt;p&gt;(via &lt;a href="https://plus.google.com/115321503505930643274/posts/gsXjsZpW5DR"&gt;Andras Timar&lt;/a&gt;)&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;I had the pleasure to share where we are wrt. the Android port of LibreOffice
yesterday. Abstract on the
&lt;a href="http://conference.libreoffice.org/2015/the-program/talks/development/#LibreOffice%27s%20Android%20port"&gt;conference
website&lt;/a&gt;, slides at the
&lt;a href="https://speakerdeck.com/vmiklos/libreoffices-android-port"&gt;usual place&lt;/a&gt;, video
record "soon" as usual. :-)&lt;/p&gt;&lt;/div&gt;
</description>
            <link>http://vmiklos.hu/blog/libreoffices-android-port.html</link>
            <pubDate>Fri, 25 Sep 2015 09:39:08 +0200</pubDate>
            <guid isPermaLink="false">http://vmiklos.hu/blog/libreoffices-android-port.html</guid>
        </item>
        <item>
            <title>Fixing Base form image backgrounds</title>
            <description>&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;a class="image" href="https://lh3.googleusercontent.com/-G5jug0myAVY/Vfh1U_i-QTI/AAAAAAAAGFQ/eZ-GKJqxqMU/s0-Ic42/"&gt;
&lt;img src="https://lh3.googleusercontent.com/-G5jug0myAVY/Vfh1U_i-QTI/AAAAAAAAGFQ/eZ-GKJqxqMU/s640-Ic42/" alt="https://lh3.googleusercontent.com/-G5jug0myAVY/Vfh1U_i-QTI/AAAAAAAAGFQ/eZ-GKJqxqMU/s640-Ic42/" /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;In this post I want to go further, and after
&lt;a href="http://vmiklos.hu/blog/calc-header.html"&gt;touching Calc&lt;/a&gt;, here is my first story
about Base. Of course I lie, it seems that Base forms are kind of read-only
Writer documents, at least that&amp;#8217;s how I could fix the bug I&amp;#8217;m describing here.
:-) The topic is still the same, rounding rough edges after the fill
attributes rework, this time a stretched background of a Base form. (Which was
not stretched at all, it was simply centered both horizontally and vertically
on the page.)&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;I&amp;#8217;m not entirely sure how the document from
&lt;a href="https://bugs.documentfoundation.org/show_bug.cgi?id=92586"&gt;tdf#92586&lt;/a&gt; is
created, but the interesting part from styles.xml is:&lt;/p&gt;&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;&lt;!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite --&gt;
&lt;pre&gt;&lt;tt&gt;&lt;span style="font-weight: bold"&gt;&lt;span style="color: #0000FF"&gt;&amp;lt;style:page-layout-properties&lt;/span&gt;&lt;/span&gt; ... &lt;span style="color: #009900"&gt;style:repeat&lt;/span&gt;&lt;span style="color: #990000"&gt;=&lt;/span&gt;&lt;span style="color: #FF0000"&gt;"no-repeat"&lt;/span&gt;&lt;span style="font-weight: bold"&gt;&lt;span style="color: #0000FF"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
     &lt;span style="font-weight: bold"&gt;&lt;span style="color: #0000FF"&gt;&amp;lt;style:background-image&lt;/span&gt;&lt;/span&gt; ... &lt;span style="color: #009900"&gt;style:repeat&lt;/span&gt;&lt;span style="color: #990000"&gt;=&lt;/span&gt;&lt;span style="color: #FF0000"&gt;"stretch"&lt;/span&gt;&lt;span style="font-weight: bold"&gt;&lt;span style="color: #0000FF"&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span style="font-weight: bold"&gt;&lt;span style="color: #0000FF"&gt;&amp;lt;/style:page-layout-properties&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/tt&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;So the schema allows specifying the way how the bitmap is repeated at two
places, and in the past the later attribute won, and with the rework this got
lost.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;An additional problem that
&lt;a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=6621da38b3cd217314c2d2295fd1e71be7e1875e"&gt;the
commit&lt;/a&gt; had to solve is that the attribute on the page-layout-properties XML
element is mapped to our
&lt;a href="http://api.libreoffice.org/docs/idl/ref/servicecom_1_1sun_1_1star_1_1drawing_1_1FillProperties.html#acd89f2a230dfdf0be3f6c840c2630871"&gt;FillBitmapMode&lt;/a&gt;
API, while the attribute with the same name on the background-image XML
element is mapped to the
&lt;a href="http://api.libreoffice.org/docs/idl/ref/servicecom_1_1sun_1_1star_1_1style_1_1PageProperties.html#a229455fd0417732944f850139fdf96d5"&gt;BackGraphicLocation&lt;/a&gt;
API, which is specific to Writer. As a result, now there is a compatibility
map from the old enumeration to the new one, that&amp;#8217;s how the bug document is
now rendered the same again, as in the past.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;The fix is already backported to the &lt;code&gt;libreoffice-5-0&lt;/code&gt; branch.&lt;/p&gt;&lt;/div&gt;
</description>
            <link>http://vmiklos.hu/blog/base-form.html</link>
            <pubDate>Wed, 16 Sep 2015 09:10:29 +0200</pubDate>
            <guid isPermaLink="false">http://vmiklos.hu/blog/base-form.html</guid>
        </item>
        <item>
            <title>Fixing Calc header image backgrounds</title>
            <description>&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;a class="image" href="https://lh3.googleusercontent.com/-u9SiImjl99k/VecKvEnT6lI/AAAAAAAAGDs/sNUH3OIlk4Y/s0-Ic42/"&gt;
&lt;img src="https://lh3.googleusercontent.com/-u9SiImjl99k/VecKvEnT6lI/AAAAAAAAGDs/sNUH3OIlk4Y/s640-Ic42/" alt="https://lh3.googleusercontent.com/-u9SiImjl99k/VecKvEnT6lI/AAAAAAAAGDs/sNUH3OIlk4Y/s640-Ic42/" /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;I think this is my first Calc bugfix. :-) The problem I wanted to fix is that
while LibreOffice 4.4 learned advanced
&lt;a href="https://gerrit.libreoffice.org/gitweb?p=core.git&amp;amp;a=search&amp;amp;h=HEAD&amp;amp;st=commit&amp;amp;s=fillattributes"&gt;fill
attributes&lt;/a&gt; (gradients, hatches, etc) for page headers / footers in Writer,
this broke the saving of simple graphic header backgrounds in Calc. Seeing
that no-one stepped up to fix this, I tried to do this myself&amp;#8201;&amp;#8212;&amp;#8201;and luckily
the problem was in the ODF export filter, which is much more familiar to me,
compared to Calc core.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Part of that larger feature was changes to the ODF filter, and
&lt;a href="https://bugs.documentfoundation.org/show_bug.cgi?id=89245"&gt;the bug&lt;/a&gt; was exactly
about touching shared ODF filter code to please Writer without testing other
LibreOffice applications.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;The actual problem was
&lt;a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=3b40329f9a64b93b1e1230b1bff74ed8cda8cd70"&gt;overlapping
constants&lt;/a&gt;: as in multiple constants had the same numeric value. Such issues
are sometimes hard to track down, in this case it wasn&amp;#8217;t &lt;em&gt;that&lt;/em&gt; hard: the
context filter that tried to make sure we don&amp;#8217;t write duplicated XML
attributes removed the background property when it tried to guard header
repeat offsets.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Given that this affected the LibreOffice 4.4 and 5.0 series, both branches got
a backport of the commit, and so the next release from those lines will have
the fix.&lt;/p&gt;&lt;/div&gt;
</description>
            <link>http://vmiklos.hu/blog/calc-header.html</link>
            <pubDate>Wed, 02 Sep 2015 18:08:21 +0200</pubDate>
            <guid isPermaLink="false">http://vmiklos.hu/blog/calc-header.html</guid>
        </item>
        <item>
            <title>8884 VirtualDevices</title>
            <description>&lt;div style="text-align: center; font-size: 0.6em;"&gt;
&lt;img src="https://lh3.googleusercontent.com/-RAsPMFc8JVk/VdH9h_W4r_I/AAAAAAAAF6U/PDpQIbBtPKg/s475-Ic42/"/&gt;
&lt;p&gt;(via &lt;a href="http://www.teq.com/smart-pointers"&gt;teq&lt;/a&gt;)&lt;/p&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;If you are into C++ programming, you probably know that smart pointers are
not just literally strange things like the above ones. ;-) LibreOffice 5.0 got
&lt;a href="https://gerrit.libreoffice.org/gitweb?p=core.git;a=blob;f=vcl/README.lifecycle;h=6b5cbd6e8df4bcc77b28b0e296e50a96ca8899a0;hb=HEAD"&gt;VclPtr&lt;/a&gt;,
which is smart pointer specialized to VCL&amp;#8217;s needs.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Such refactorings are good things, except that there is no huge rework without
regressions. In &lt;a href="https://bugs.documentfoundation.org/show_bug.cgi?id=93284"&gt;this
case&lt;/a&gt; the WMF filter had 3 places where we were leaking VirtualDevices due to
a misconversion to the new VclPtr API. The problem was that the document had
135 images, WMF files to be exact. Now given that the leaks were during
parsing of WMF records (a WMF file consists of multiple WMF records), at the
end we leaked 8884 VirtualDevices. At first the problem was seen as
Windows-specific, as at least X on Linux has no problem with creating that
many VirtualDevices, but Windows' default resource limits are hit in this
case.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;A note about testing this bugfix effectively, so it never happens again. The
problem was that I wanted to create a minimal reproducer, but I also needed a
document with lots of WMF images, each complex enough to trigger the resource
limit. At the end I manually created a DOCX file that had the same image
copy&amp;amp;pasted multiple times: that way we really imported them multiple times
(normally we notice that they&amp;#8217;re the same, and only save the image to the file
once, and put multiple references to it), and because DOCX is also a ZIP
container, the test file can be still only 99KB instead of the original 17MB
RTF.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Thanks to the
&lt;a href="https://wiki.documentfoundation.org/QA/Bibisect/Windows#Versions"&gt;4.4 &amp;#8594; 5.0
Windows bibisect repo&lt;/a&gt;, it was immediately obvious that this is a VclPtr
problem, and then it was possible to identify the root cause, and finally see
that the bug title mentioning RTF was just container of the WMF images in this
case, the problem had nothing to with with RTF and the leak wasn&amp;#8217;t
Windows-specific, either.&lt;/p&gt;&lt;/div&gt;
</description>
            <link>http://vmiklos.hu/blog/virtualdevice-leak.html</link>
            <pubDate>Tue, 18 Aug 2015 09:09:44 +0200</pubDate>
            <guid isPermaLink="false">http://vmiklos.hu/blog/virtualdevice-leak.html</guid>
        </item>
        <item>
            <title>Mail merge embedding</title>
            <description>&lt;div class="paragraph"&gt;&lt;p&gt;If you ever used the
&lt;a href="https://help.libreoffice.org/Writer/Mail_Merge_Wizard"&gt;mail merge wizard&lt;/a&gt; with
a Calc data source, then you know how it worked in the past: you&amp;#8217;ve got 3
files: the .odt mail template, the .ods data source and a .odb data source
definition that defines how to access the .ods.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;The target of this &lt;a href="http://www.muenchen.de/"&gt;LHM-funded project&lt;/a&gt; was to get rid
of the .odb file and just embed it into the .odt mail template. Why?&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Here is the problem description from a user&amp;#8217;s point of view: "When a mail
merge document is being saved a separate database file is being automatically
created. It links the Writer file to the spreadsheet (ODS, XLS, XLSX etc.) as
data source. This additional 2kB ODB file confuses users, they might delete it
without knowing to break the connection to the data source." An additional
problem is that because the non-embedded data source definition is part of the
user profile, you can&amp;#8217;t just move the three files to an other machine, as .odb
registration will be missing there.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;If you are interested how this looks like, here is a demo (click on the image
to see the video):&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;a class="image" href="https://youtu.be/5iQFZBOz8rM"&gt;
&lt;img src="https://lh3.googleusercontent.com/-XDcWgOWKr2k/Vbc4blHURTI/AAAAAAAAF4E/VXFBglt-YmU/s800-Ic42/" alt="https://lh3.googleusercontent.com/-XDcWgOWKr2k/Vbc4blHURTI/AAAAAAAAF4E/VXFBglt-YmU/s800-Ic42/" /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;That&amp;#8217;s it for now&amp;#8201;&amp;#8212;&amp;#8201;as usual the commits are in master, so you can try this
right now with a 5.1 &lt;a href="http://dev-builds.libreoffice.org/daily/master/"&gt;daily
build&lt;/a&gt;. :-)&lt;/p&gt;&lt;/div&gt;
</description>
            <link>http://vmiklos.hu/blog/mail-merge-embedding.html</link>
            <pubDate>Tue, 28 Jul 2015 09:34:09 +0200</pubDate>
            <guid isPermaLink="false">http://vmiklos.hu/blog/mail-merge-embedding.html</guid>
        </item>
        <item>
            <title>ctags vs override/SAL_OVERRIDE</title>
            <description>&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://lh3.googleusercontent.com/-9Hd40EVT8aw/VZBhBTZQdTI/AAAAAAAAFyM/AfymfTqKDFw/s0/" alt="https://lh3.googleusercontent.com/-9Hd40EVT8aw/VZBhBTZQdTI/AAAAAAAAFyM/AfymfTqKDFw/s0/" /&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;If you use &lt;a href="http://ctags.sourceforge.net/"&gt;ctags&lt;/a&gt; to help your LibreOffice
development, there are already good descriptions for that&amp;#8201;&amp;#8212;&amp;#8201;e.g. for vim
there is one &lt;a href="https://wiki.documentfoundation.org/Development/Vim#ctags"&gt;on the
TDF wiki&lt;/a&gt;.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;What was problematic is that since C++11, &lt;code&gt;override&lt;/code&gt; is a valid keyword
after a member function declaration, and we have our &lt;code&gt;SAL_OVERRIDE&lt;/code&gt; macro that
I
&lt;a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=3891d323cdc3c03154f5682baaeaa4b2ef015a63"&gt;added&lt;/a&gt;
to be able to use it before all our supported compilers recognize it.
Unsupported parsers include ctags, so if a member function have SAL_OVERRIDE,
ctags only indexed the definition, not the declaration.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;I created patches to fix these problems in ctags, the
&lt;a href="https://sourceforge.net/p/ctags/bugs/367/"&gt;override one&lt;/a&gt; is probably
interesting for all C++ projects, the
&lt;a href="https://github.com/vmiklos/ctags-svn/commit/ef53a231db5b428585324f266072b884e17bae52"&gt;SAL_OVERRIDE
one&lt;/a&gt; is LibreOffice-specific.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;The hope is that the later will go away in the long run, so it won&amp;#8217;t really be
a problem that ctags do not recognize that macro out of the box. :-)&lt;/p&gt;&lt;/div&gt;
</description>
            <link>http://vmiklos.hu/blog/ctags-sal-override.html</link>
            <pubDate>Mon, 29 Jun 2015 09:29:56 +0200</pubDate>
            <guid isPermaLink="false">http://vmiklos.hu/blog/ctags-sal-override.html</guid>
        </item>
    </channel>
</rss>
