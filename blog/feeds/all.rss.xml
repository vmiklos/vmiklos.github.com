<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"><channel><title>What is Miklos hacking</title><link>https://vmiklos.hu/blog/</link><description></description><lastBuildDate>Fri, 11 Dec 2020 09:31:26 +0100</lastBuildDate><item><title>Better PDF signature verification in Draw</title><link>https://vmiklos.hu/blog/pdfium-sign-verify.html</link><description>&lt;div id="preamble"&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Draw now has much better support for detecting unsigned incremental updates between signatures at
the end of PDF documents. We now also make sure that incremental updates introduced for adding
signatures really just add annotations and don&amp;#8217;t change the actual content.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_motivation"&gt;Motivation&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;There has been a recent &lt;a href="https://pdf-insecurity.org/signature-shadow/evaluation_2020.html"&gt;evaluation&lt;/a&gt;
of PDF signature verification, which included Draw. While we got a checkmark on their Shadow Hide
test, their Shadow Replace test found conditional problems and their Shadow Hide-and-Replace test
was not happy, either.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;So time to look at what are those corner-cases and how the situation can be improved, so people keep
trusting that if Draw says a signature is valid, it&amp;#8217;s indeed valid.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_results_so_far"&gt;Results so far&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;There were 4 incremental improvements in this area:&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://gerrit.libreoffice.org/c/core/+/99361"&gt;detect unsigned incremental update between
  signatures&lt;/a&gt;
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://gerrit.libreoffice.org/c/core/+/101712"&gt;fix infobar vs signature dialog inconsistency&lt;/a&gt;
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://gerrit.libreoffice.org/c/core/+/101926"&gt;avoid saying OK when the signature is partial&lt;/a&gt;
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://gerrit.libreoffice.org/c/core/+/102057"&gt;pdf incremental updates that are non-commenting are
  invalid&lt;/a&gt;
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;These were enough so that talking to the authors of that evaluation now confirmed that these
problems are all gone.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_how_is_this_implemented"&gt;How is this implemented?&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;If you would like to know a bit more about how this works, continue reading&amp;#8230; :-)&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;PDF signature verification works by using a custom PDF tokenizer. You can read about that code in
the PDF tokenizer section of &lt;a href="https://vmiklos.hu/blog/pdf-sign.html"&gt;this post&lt;/a&gt;. The bottom line is that
we now have both PDFium and this custom tokenizer, somewhat duplicating the functionality.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;After talking to the PDFium developers (see the relevant
&lt;a href="https://groups.google.com/g/pdfium/c/Z0fC8Fg3yek/m/IE6yD066AAAJ"&gt;mailing list thread&lt;/a&gt;), there were
open regarding adding all the high level API to allow PDF signature verification based on PDFium,
and not via our own tokenizer. See
&lt;a href="https://pdfium.googlesource.com/pdfium/+/refs/heads/master/public/fpdf_signature.h"&gt;this
header file&lt;/a&gt; for the set of relevant APIs added. A combinations of those allowed to
&lt;a href="https://gerrit.libreoffice.org/c/core/+/105766"&gt;adapt&lt;/a&gt; the code on our side and use PDFium for
signature verification, not the own tokanizer.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_want_to_start_using_this"&gt;Want to start using this?&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;You can get a snapshot / demo of Collabora Office and try it out yourself right now:
&lt;a href="https://www.collaboraoffice.com/collabora-office-latest-snapshot/"&gt;try unstable snapshot&lt;/a&gt;.  Collabora
intends to continue supporting and contributing to LibreOffice, the code is merged so we expect all
of this work will be available in TDF&amp;#8217;s next release too (7.1).&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Miklos Vajna</dc:creator><pubDate>Fri, 11 Dec 2020 09:31:26 +0100</pubDate><guid isPermaLink="false">tag:vmiklos.hu,2020-12-11:/blog/pdfium-sign-verify.html</guid><category>libreoffice</category><category>en</category></item><item><title>Effecting code review and backporting for Collabora Online</title><link>https://vmiklos.hu/blog/cool-g-review-backport.html</link><description>&lt;div id="preamble"&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Collabora Online now has a &lt;code&gt;./g&lt;/code&gt;
&lt;a href="https://github.com/CollaboraOnline/online/blob/a4becf39abc3228fa899f71ff284d41c3c199627/g"&gt;script&lt;/a&gt;
that tries to bring some of the Gerrit-based review benefits to a workflow based on GitHub.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_motivation"&gt;Motivation&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Collabora Online is on GitHub, but &lt;a href="https://git.libreoffice.org/core"&gt;core.git&lt;/a&gt; is still on Gerrit, so it made sense to spend some time on a small shell script that gives you review and backport experience that is closer to Gerrit than the stock GitHub workflow.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_how_we_use_github"&gt;How we use GitHub&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Most Online committers push their code for review directly to &lt;code&gt;online.git&lt;/code&gt;, to private namespaced
branches, like &lt;code&gt;private/kendy/master&lt;/code&gt;, then a pull request can be created to get commits from that
branch into master after CI, review, etc. This workflow has the benefit that you don&amp;#8217;t have to deal
with the complexity of multiple repos.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Next to master, there are distro branches like &lt;code&gt;distro/collabora/co-6-4&lt;/code&gt;, we may or may not want to
backport the contents of a PR to that stable branch.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;It&amp;#8217;s important that Gerrit used to have a &lt;code&gt;git review&lt;/code&gt; command to just submit your changes for
review, without asking anything. That explains why the stock GitHub workflow where you need to name
the source branch of your PR feels unnecessary complexity. Creating the PR by visiting a webpage is
again something we want to avoid. Not to mention open questions like should you delete your source
branch after a PR is merged? Should you delete your source repo?&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;On the other hand, we&amp;#8217;re interested in GitHub&amp;#8217;s ability to have multiple commits in a PR: Gerrit
forces to have one commit per change. The GitHub way encourages developers to split changes into
more commits, now that the review and CI cost won&amp;#8217;t increase just due to such splits.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_submit_for_review"&gt;Submit for review&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;The happy path is when you have one or more local commits and you want to submit it for review. In
this case now you can do:&lt;/p&gt;&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre&gt;&lt;code&gt;./g review&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;And the script will figure out that you want to push your local branch to a remote branch like
&lt;code&gt;private/kendy/master&lt;/code&gt; and also create a pull request for you, printing its URL.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;In case that branch already exists then you need to specify a name:&lt;/p&gt;&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre&gt;&lt;code&gt;./g review myhack&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;So parallel reviews are possible, but only the first gets an inferred name. Both cases need no
clicking in a browser, thanks to &lt;a href="https://github.com/cli/cli"&gt;gh&lt;/a&gt;.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_submit_a_backport"&gt;Submit a backport&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;The easiest case is when you can assume that the master branch and the distro branch is so close to
each other that there won&amp;#8217;t be conflicts to be resolved. In that case, you can do:&lt;/p&gt;&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre&gt;&lt;code&gt;./g backport distro/collabora/co-6-4 790&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;to pick all commits from &lt;a href="https://github.com/collaboraonline/online/pull/790"&gt;PR 790&lt;/a&gt; (which is already
merged to master) to a distro branch.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Again, you can have multiple backports in progress, e.g. you can do:&lt;/p&gt;&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;
&lt;pre&gt;&lt;code&gt;./g backport distro/collabora/co-6-4 790 myhack&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;If the default name is already used. The backport syntax is a bit longer, so you can always just
type &lt;code&gt;./g backport&lt;/code&gt; and you&amp;#8217;ll get the usage.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;This second command is a bit more complicated, as &lt;code&gt;gh&lt;/code&gt; has no trivial way to expose what is the
commit range of a PR. But there is &lt;code&gt;gh api graphql&lt;/code&gt; which can do arbitrary
&lt;a href="https://docs.github.com/en/free-pro-team@latest/graphql"&gt;GraphQL&lt;/a&gt; queries, which provide this
information. At this stage it may make sense to just rewrite the whole &lt;code&gt;./g&lt;/code&gt; script in e.g. Python,
but till that happens, we parse the output of the query using &lt;a href="https://stedolan.github.io/jq/"&gt;jq&lt;/a&gt;.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Finally, if you do have conflicts or you want a local build test / manual test before submitting,
you can always check out the distro branch manually, cherry-pick there and use plain &lt;code&gt;./g review&lt;/code&gt; to
submit your backport for review.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_want_to_start_using_this"&gt;Want to start using this?&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;You can go to the &lt;a href="https://collaboraonline.github.io/"&gt;Collabora Online&lt;/a&gt; community website and see how
to build the code. Then you may want to solve an
&lt;a href="https://github.com/CollaboraOnline/online/issues?q=is%3Aissue+is%3Aopen+label%3A%22Easy+Hack%22"&gt;easy
hack&lt;/a&gt;, finally submit your commit for review either by using the above method or whichever way you
prefer contributing to GitHub projects.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Miklos Vajna</dc:creator><pubDate>Wed, 02 Dec 2020 10:23:39 +0100</pubDate><guid isPermaLink="false">tag:vmiklos.hu,2020-12-02:/blog/cool-g-review-backport.html</guid><category>collabora-online</category><category>en</category></item><item><title>Better handling of cached field results in Writer</title><link>https://vmiklos.hu/blog/sw-cached-fields.html</link><description>&lt;div id="preamble"&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Writer now has much better support for preserving the cached result of fields in documents. This is
especially beneficial for Word formats where the input document may have a field result which is not
only a cache, but re-calculating the formula would yield a different result, even in Word.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_motivation"&gt;Motivation&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;A Collabora Office customer gave us a DOCX document, which is essentially a calendar for planned IT
maintenance windows at some organization. These calendars are tables with fields in it. The document
is halfway through towards changing it to a newer year: the formulas are already changed to
calculate a newer year, but all the cached field results are still for the old year.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;The request was to keep showing these results and not throw them away during save, either. Their
primary workflow is to fill the calendar with manual entries, not to tweak the calendar layout
itself.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_results_so_far"&gt;Results so far&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;The calendar now looks like this:&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://lh3.googleusercontent.com/6o7pvix-dJ9QhCX65FUkWeQZ60B89sHqDpBvd7WVRLtAzBW1323odrQ13aV_CgEFvgh7Iee-ePq95oPOf1Q-jMxvX1MBsz9FhgKd9vymyrdMBIZbF459hNKE1dM4XLcwXkGYh8ksmok=w1920" alt="https://lh3.googleusercontent.com/6o7pvix-dJ9QhCX65FUkWeQZ60B89sHqDpBvd7WVRLtAzBW1323odrQ13aV_CgEFvgh7Iee-ePq95oPOf1Q-jMxvX1MBsz9FhgKd9vymyrdMBIZbF459hNKE1dM4XLcwXkGYh8ksmok=w1920" /&gt;
&lt;/div&gt;
&lt;div class="title"&gt;Figure 1. New render result in Writer&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Matching the reference rendering:&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://lh3.googleusercontent.com/GJd2zcnspXDb7Wa2p32TInf9C8MAgt92h3G6PYuUwUvpQi5f3AdRbl5yGq8FN7kUPMcZwuFpohTKmX33s8u-AxFSO9rZFgH4X-fwrg8jShtJoA1KyGws_-ymUvINmK-5xo2_hd7YmLI=w1920" alt="https://lh3.googleusercontent.com/GJd2zcnspXDb7Wa2p32TInf9C8MAgt92h3G6PYuUwUvpQi5f3AdRbl5yGq8FN7kUPMcZwuFpohTKmX33s8u-AxFSO9rZFgH4X-fwrg8jShtJoA1KyGws_-ymUvINmK-5xo2_hd7YmLI=w1920" /&gt;
&lt;/div&gt;
&lt;div class="title"&gt;Figure 2. Reference render result&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;While it looked like a broken calendar previously:&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://lh3.googleusercontent.com/bpOVqcZX2CcKouuADNyPx1PMyI3I6CyjIDIAnUbylsT-ZimxSkPcUaRbMDd8MzHlG3Uqw2d-TunD4m7U4DUlm_O_esJt6CAY-H7Z5tdQxZ6q_MYxgJphutr_-JRVYh8uLmspiiI532U=w1920" alt="https://lh3.googleusercontent.com/bpOVqcZX2CcKouuADNyPx1PMyI3I6CyjIDIAnUbylsT-ZimxSkPcUaRbMDd8MzHlG3Uqw2d-TunD4m7U4DUlm_O_esJt6CAY-H7Z5tdQxZ6q_MYxgJphutr_-JRVYh8uLmspiiI532U=w1920" /&gt;
&lt;/div&gt;
&lt;div class="title"&gt;Figure 3. Old render result in Writer&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;You can see that the day numbers were broken previously and now they line up properly.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_how_is_this_implemented"&gt;How is this implemented?&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;If you would like to know a bit more about how this works, continue reading&amp;#8230; :-)&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;As usual, the high-level problem was addressed by a series of small fixes:&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://gerrit.libreoffice.org/c/core/+/105596"&gt;DOCX import: don&amp;#8217;t throw away cached value of
  SwHiddenTextField&lt;/a&gt; fixes a caching problem which was working for DOC already
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://gerrit.libreoffice.org/c/core/+/105639"&gt;DOCX import: fix lost cached result inside an IF
  field&lt;/a&gt; fixes caching in the context of nested IF fields (Writer in general has limited support for nested fields)
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://gerrit.libreoffice.org/c/core/+/105783"&gt;DOCX import: lost cached result of fields: fix
  leading whitespace&lt;/a&gt; fixes whitespace handling while caching
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://gerrit.libreoffice.org/c/core/+/105798"&gt;DOCX export: handle conditional fields&lt;/a&gt; adds an
  initial implementation of conditional fields in the DOCX export, which was completely missing
  previously.
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;With these, it&amp;#8217;s now possible to edit these calendars, without breaking the fields which provide the
day numbers.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_want_to_start_using_this"&gt;Want to start using this?&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;You can get a snapshot / demo of Collabora Office and try it out yourself right now:
&lt;a href="https://www.collaboraoffice.com/collabora-office-latest-snapshot/"&gt;try unstable snapshot&lt;/a&gt;.  Collabora
intends to continue supporting and contributing to LibreOffice, the code is merged so we expect all
of this work will be available in TDF&amp;#8217;s next release too (7.1).&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Miklos Vajna</dc:creator><pubDate>Fri, 27 Nov 2020 09:08:54 +0100</pubDate><guid isPermaLink="false">tag:vmiklos.hu,2020-11-27:/blog/sw-cached-fields.html</guid><category>libreoffice</category><category>en</category></item><item><title>Detecting 0-byte files based on extension in Impress and elsewhere</title><link>https://vmiklos.hu/blog/sd-zero-byte-files.html</link><description>&lt;div id="preamble"&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Impress (and Writer and Calc) now has support for detecting 0-byte files on open/import based on
their extension. This builds on top of the
&lt;a href="https://vmiklos.hu/blog/sw-locale-independent-templates.html"&gt;previous language-independent template
improvements&lt;/a&gt;. This means that e.g. a 0-byte PPTX file will open as an empty Impress presentation,
not in Writer.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_motivation"&gt;Motivation&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;We regularly see customers wanting minimal templates, which are language independent and have no
content. Such files are handy if your workflow is to first name an empty document (create it) and
only then edit it (and not the other way around: first create the document, then save it by giving
it a name). This is easy for &lt;code&gt;.txt&lt;/code&gt; files: if it&amp;#8217;s zero bytes, it&amp;#8217;s empty. But then this approach is
also expected to work for other file formats as well, where our original approach was more
technical: if it&amp;#8217;s an empty file, that that can be only plain text, so we (almost) always opened it
in Writer, not matching the user expectations.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Instead of explaining the problem to people again and again (that a literally empty PPTX file is not
a PPTX template), there is value in just adapting the code instead to "do what I mean".&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_results_so_far"&gt;Results so far&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;An empty PPTX file is now handled like this:&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://lh3.googleusercontent.com/zk3b0f2Rx3t5vFVuKiimujSJWYwPNH05PCf5Indih3OwMDeBrOUH1X7N22PO46kIbxTVzI0V3IV-bE0sMycTHGj2eRqKT6K7eQkZ0Py9QVCPIhV0pdKdGPLGH08xpw72wFQ-3eGyX4k=w1920" alt="https://lh3.googleusercontent.com/zk3b0f2Rx3t5vFVuKiimujSJWYwPNH05PCf5Indih3OwMDeBrOUH1X7N22PO46kIbxTVzI0V3IV-bE0sMycTHGj2eRqKT6K7eQkZ0Py9QVCPIhV0pdKdGPLGH08xpw72wFQ-3eGyX4k=w1920" /&gt;
&lt;/div&gt;
&lt;div class="title"&gt;Figure 1. Empty PPTX file opening in Impress&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;You can see this is no longer opening in Writer as plain text but in Impress, which is clearly a
less surprising behavior.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Here is what happens if you open an empty DOTX (template):&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://lh3.googleusercontent.com/cVB_kK2wDyNIJjLt9v9UcNS4AagRCifwBofp70mHfNVzopvrN1cxcsVLhWfEArhab_PwSFkAvLlMUS1witevRcKeEn9UXYtw5o4VeGSztvnNUi6YMtR3t2DUIu1k2LLOUhnpckAnrwQ=w1920" alt="https://lh3.googleusercontent.com/cVB_kK2wDyNIJjLt9v9UcNS4AagRCifwBofp70mHfNVzopvrN1cxcsVLhWfEArhab_PwSFkAvLlMUS1witevRcKeEn9UXYtw5o4VeGSztvnNUi6YMtR3t2DUIu1k2LLOUhnpckAnrwQ=w1920" /&gt;
&lt;/div&gt;
&lt;div class="title"&gt;Figure 2. Empty DOTX file creates a new Writer document&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;You can see that it is even recognized that this is a template format, so a new document is created,
not the template itself is opened for editing.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_how_is_this_implemented"&gt;How is this implemented?&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;If you would like to know a bit more about how this works, continue reading&amp;#8230; :-)&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;You can see the code change in
&lt;a href="https://git.libreoffice.org/core/commit/ada07f303e7cd1e39c73abe0741aefe7d9d73a57"&gt;this commit&lt;/a&gt;.
First, we restrict this trick to file URLs, and also to empty files.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Second, we look at the extension of the file and try to match an import filter that usually handles
that extension. This helps, because then nominally the correct filter will be used for the import,
so save will not ask for a filename (as it happens for new documents), but it will know what target
filename and export filter to use.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Finally we need to avoid actually invoking the import filter, because no file content is not
something an import filter has to handle if its filter detection would reject the file. (E.g. PPTX
is expected to be a valid ZIP file.) This is important, because we want to avoid touching each &amp;amp;
every file filter to not fail for empty file content&amp;#8201;&amp;#8212;&amp;#8201;instead we want to handle this centrally, at
a single place.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_want_to_start_using_this"&gt;Want to start using this?&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;You can get a snapshot / demo of Collabora Office and try it out yourself right now:
&lt;a href="https://www.collaboraoffice.com/collabora-office-latest-snapshot/"&gt;try unstable snapshot&lt;/a&gt;.  Collabora
intends to continue supporting and contributing to LibreOffice, the code is merged so we expect all
of this work will be available in TDF&amp;#8217;s next release too (7.1).&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Miklos Vajna</dc:creator><pubDate>Fri, 13 Nov 2020 08:50:19 +0100</pubDate><guid isPermaLink="false">tag:vmiklos.hu,2020-11-13:/blog/sd-zero-byte-files.html</guid><category>libreoffice</category><category>en</category></item><item><title>OOXML / PDF Digital Signing in Draw and elsewhere conference talk</title><link>https://vmiklos.hu/blog/libocon2020.html</link><description>&lt;div id="preamble"&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;a class="image" href="https://files.speakerdeck.com/presentations/eae85c2ac9d443708bda7ca26b3f5a6f/pdf-visible-sign-loconf-online-2k20.pdf"&gt;
&lt;img src="https://lh3.googleusercontent.com/4cDltVS1u4m8FWC9Bb54TWILfzrFEXKNUcKKE6cxTIzsDWbX4SXPNw6JM01eLVzyqSqsyWhukcXXWmlJthx9q8tdbqO1LfO8FQECzBcEK3ZQl1lCXdpoAFGKZn_H9sNy0QLgNpPox_w=w1920" alt="https://lh3.googleusercontent.com/4cDltVS1u4m8FWC9Bb54TWILfzrFEXKNUcKKE6cxTIzsDWbX4SXPNw6JM01eLVzyqSqsyWhukcXXWmlJthx9q8tdbqO1LfO8FQECzBcEK3ZQl1lCXdpoAFGKZn_H9sNy0QLgNpPox_w=w1920" /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Today I gave a &lt;a href="https://events.opensuse.org/conferences/oSLO/program/proposals/3187/"&gt;OOXML / PDF
Digital Signing in Draw and elsewhere&lt;/a&gt; talk at the LibreOffice Conference 2020. The (virtual) room
was well-crowded&amp;#8201;&amp;#8212;&amp;#8201;somehow people find digital signatures interesting. ;-)&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;It contains an overview of the ODF/OOXML/PDF signing feature set and also details the latest
improvements, like visible PDF signing.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;I expect quite some other slides from other Collaborans and the wider community will be available on
&lt;a href="http://planet.documentfoundation.org/"&gt;Planet&lt;/a&gt;, don&amp;#8217;t miss them.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;You can get a snapshot / demo of Collabora Office and try the presented features out yourself right
now: &lt;a href="https://www.collaboraoffice.com/collabora-office-latest-snapshot/"&gt;try unstable snapshot&lt;/a&gt;.
Collabora intends to continue supporting and contributing to LibreOffice, the code is merged so we
expect all of this work will be available in TDF&amp;#8217;s next release too (7.1).&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Miklos Vajna</dc:creator><pubDate>Fri, 16 Oct 2020 17:53:30 +0200</pubDate><guid isPermaLink="false">tag:vmiklos.hu,2020-10-16:/blog/libocon2020.html</guid><category>libreoffice</category><category>en</category></item><item><title>SmartArt improvements in Impress, part 6</title><link>https://vmiklos.hu/blog/smartart-improvements-6.html</link><description>&lt;div id="preamble"&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Impress now has support for an improved auto-fit-of-text layout across multiple shapes, also the
snake algorithm now handles width requests from constraints much better for SmartArt graphics from
PPTX files. This builds on top of the &lt;a href="https://vmiklos.hu/blog/smartart-improvements-5.html"&gt;previous
improvements&lt;/a&gt; around SmartArt support.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;First, thanks to our partner &lt;a href="https://www.suse.com/"&gt;SUSE&lt;/a&gt; for working with
&lt;a href="https://www.collaboraoffice.com/"&gt;Collabora&lt;/a&gt; to make this possible.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_motivation"&gt;Motivation&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;SmartArt allows declaring your content and requirements for a graphic, then the layout will take
care of arranging that in a suitable way. It is allowed to ask for an automatic font size, which is
small enough so that all the content fits into the shape. At the same time, you can ask that the
font size is the same in multiple shapes. Impress lacked the ability to do the latter, leading to
different font sizes in different shapes, all automatic inside a single shape.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_results_so_far"&gt;Results so far&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Here is how the automatic text scaling across multiple shapes works in practice:&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://lh3.googleusercontent.com/5f-rH0nKGed-6GhBn3bAOMH6sVUeZUeqt2TsFydVSFlL_185Hj6BjNkchKn7DVKpAQmRsg6bGNwKyBIN9bR1sRYacqcKnLYOeqasGZB2IWRohN8mtgFG9aNN_k5ofC_ZqunSeHqIYTc=w640" alt="https://lh3.googleusercontent.com/5f-rH0nKGed-6GhBn3bAOMH6sVUeZUeqt2TsFydVSFlL_185Hj6BjNkchKn7DVKpAQmRsg6bGNwKyBIN9bR1sRYacqcKnLYOeqasGZB2IWRohN8mtgFG9aNN_k5ofC_ZqunSeHqIYTc=w640" /&gt;
&lt;/div&gt;
&lt;div class="title"&gt;Figure 1. Autofit synchronization, new output&lt;/div&gt;
&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://lh3.googleusercontent.com/lncpRp13-vUBJH5Kt4ccYHMULGQ8U1Qw8v5z7LmRSE9bv6yjukFMfuiJolCKbVOpjT-85zw_BQMj72dKJLVnMI242CQlIxR7tDUbhBuVaYDuGPRVnAqhCsGbDmGLmyu-7ueA39kNXIg=w640" alt="https://lh3.googleusercontent.com/lncpRp13-vUBJH5Kt4ccYHMULGQ8U1Qw8v5z7LmRSE9bv6yjukFMfuiJolCKbVOpjT-85zw_BQMj72dKJLVnMI242CQlIxR7tDUbhBuVaYDuGPRVnAqhCsGbDmGLmyu-7ueA39kNXIg=w640" /&gt;
&lt;/div&gt;
&lt;div class="title"&gt;Figure 2. Autofit synchronization, old output&lt;/div&gt;
&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://lh3.googleusercontent.com/Go9LGPftmbtFnQXgzxITJVLhEVJF1B13Ge3PGbyKPNEzCJ2zi2DfYBMak92v127PJGYyzjL8V9fTh8Fb_vZXpAdBrBRQizd2onXM8dBka38BkBEi2FE8UP3JCPecKN1m9u8fR591GMM=w640" alt="https://lh3.googleusercontent.com/Go9LGPftmbtFnQXgzxITJVLhEVJF1B13Ge3PGbyKPNEzCJ2zi2DfYBMak92v127PJGYyzjL8V9fTh8Fb_vZXpAdBrBRQizd2onXM8dBka38BkBEi2FE8UP3JCPecKN1m9u8fR591GMM=w640" /&gt;
&lt;/div&gt;
&lt;div class="title"&gt;Figure 3. Autofit synchronization, reference output&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;You can see how the old output used to have unexpected large text in shape A, but now has the same
text size as shape B. This is not applied unconditionally, shape C can request to have an
independent, fixed font size.&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://lh3.googleusercontent.com/7IBC-z9NfhP0mjutFPQLPN312AH5Jch6Gss-75kROjLksQ3MnSZnhTodrPDJBm3MmkcQ-rHKvzozgB1O8j8rDBJEkzCf9vgmgrSYa3kH7GqnDS0BgBnlSOWC0GQxVBCIMYX0-Blf_F8=w640" alt="https://lh3.googleusercontent.com/7IBC-z9NfhP0mjutFPQLPN312AH5Jch6Gss-75kROjLksQ3MnSZnhTodrPDJBm3MmkcQ-rHKvzozgB1O8j8rDBJEkzCf9vgmgrSYa3kH7GqnDS0BgBnlSOWC0GQxVBCIMYX0-Blf_F8=w640" /&gt;
&lt;/div&gt;
&lt;div class="title"&gt;Figure 4. Snake rows, new output&lt;/div&gt;
&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://lh3.googleusercontent.com/4y0pEF3utBcpXMcCsrvrkvnNCdKKyhVlwejiwsI6cMUrA1nV4u1VuE4l1Xhuw60jQYrkeQD54Y0JuB4NR571kwtluUGceclQPZPcYITEyqf0GF1Y7fr_GXNnSRCtnXO1jjtcO_nSLS0=w640" alt="https://lh3.googleusercontent.com/4y0pEF3utBcpXMcCsrvrkvnNCdKKyhVlwejiwsI6cMUrA1nV4u1VuE4l1Xhuw60jQYrkeQD54Y0JuB4NR571kwtluUGceclQPZPcYITEyqf0GF1Y7fr_GXNnSRCtnXO1jjtcO_nSLS0=w640" /&gt;
&lt;/div&gt;
&lt;div class="title"&gt;Figure 5. Snake rows, old output&lt;/div&gt;
&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://lh3.googleusercontent.com/JqIugvyKapfY6Hw0bs7OtWMJ2sj5mdFOv8ebJwZac_BgmuJXKyHxDUdzCj0xZl9zcksXDjdqthce1xrHJzZdGG_024CLbVBSoCmR-X_qFxdWupFwXBa281LId18qezAU80vuT69kGl0=w640" alt="https://lh3.googleusercontent.com/JqIugvyKapfY6Hw0bs7OtWMJ2sj5mdFOv8ebJwZac_BgmuJXKyHxDUdzCj0xZl9zcksXDjdqthce1xrHJzZdGG_024CLbVBSoCmR-X_qFxdWupFwXBa281LId18qezAU80vuT69kGl0=w640" /&gt;
&lt;/div&gt;
&lt;div class="title"&gt;Figure 6. Snake rows, reference output&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;You can see that the old output laid shapes all over the place, while the new output puts them to a
3 by 2 matrix. The reason this works is because now we parse width requests from constraints
correctly. This means we give spacings a smaller width, real shapes a larger width, so the content
fits in less rows and the layout looks like a grid, matching the reference rendering.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_how_is_this_implemented"&gt;How is this implemented?&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;If you would like to know a bit more about how this works, continue reading&amp;#8230; :-)&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;As for the autofit synchronization:&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://gerrit.libreoffice.org/c/core/+/102266"&gt;svx UNO API for shapes: expose what scaling factor
  is used for autofit scaling&lt;/a&gt; made it possible to know what is a good scaling factor for one shape
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://gerrit.libreoffice.org/c/core/+/102324"&gt;svx UNO API for shapes: allow setting a max factor
  for autofit text scale&lt;/a&gt; made it possible to set the scaling factor, overriding what it would
  calculate by itself. This is a trade-off: setting the scaling factor on the shape inside the
  document model has the benefit that the importer doesn&amp;#8217;t duplicate any text measuring code. The cost
  is that now there is an UNO property that you can set, but the value of that won&amp;#8217;t be retained if
  you save to ODF and load the document back. At least not currently
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://gerrit.libreoffice.org/c/core/+/102490"&gt;oox smartart: add support for syncing font heights
  of multiple shapes&lt;/a&gt; is the SmartArt code to use the above mentioned building blocks
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://gerrit.libreoffice.org/c/core/+/102689"&gt;oox smartart: handle &amp;lt;dgm:prSet &amp;#8230; custT="1"/&amp;gt;&lt;/a&gt;
  made it possible to not perform auto-scaling for certain shapes, if they request so
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Beyond that, for the snake rows:&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://gerrit.libreoffice.org/c/core/+/103411"&gt;oox smartart: snake algo: consider child&amp;#8217;s aspect
  ratio request for cols/rows&lt;/a&gt; started to improve the grid calculation, so less vertical space is
  needed
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://gerrit.libreoffice.org/c/core/+/103594"&gt;oox smartart: snake algo: start parsing relative
  width constraints&lt;/a&gt; allows differentiating between space items on a snake path (small width) and
  shape items, which typically have a larger width
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://gerrit.libreoffice.org/c/core/+/103629"&gt;oox smartart: snake algo: apply constraints on
  child shape widths&lt;/a&gt; uses the information collected in the previous step, so the sample document is
  requesting the expected 3 by 2 grid
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
&lt;a href="https://gerrit.libreoffice.org/c/core/+/103680"&gt;oox smartart: snake algo: make sure child shape
  height stays within parent&lt;/a&gt; finally makes sure that the content is not falling off the slide,
  which would make it impossible to read when projecting
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_want_to_start_using_this"&gt;Want to start using this?&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;You can get a snapshot / demo of Collabora Office and try it out yourself right now:
&lt;a href="https://www.collaboraoffice.com/collabora-office-latest-snapshot/"&gt;try unstable snapshot&lt;/a&gt;.  Collabora
intends to continue supporting and contributing to LibreOffice, the code is merged so we expect all
of this work will be available in TDF&amp;#8217;s next release too (7.1).&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Miklos Vajna</dc:creator><pubDate>Fri, 02 Oct 2020 14:21:37 +0200</pubDate><guid isPermaLink="false">tag:vmiklos.hu,2020-10-02:/blog/smartart-improvements-6.html</guid><category>libreoffice</category><category>en</category></item><item><title>Locale-independent Writer templates</title><link>https://vmiklos.hu/blog/sw-locale-independent-templates.html</link><description>&lt;div class="sect1"&gt;
&lt;h2 id="_the_problem"&gt;The problem&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Users create new documents in various ways. When they do so in Online or via Windows Explorer&amp;#8217;s
context menu (New &amp;#8594; &amp;#8230;) then actual templates are not involved in the process, technically. What
happens instead is that there is a plain empty Writer (or Calc, Impress) document that gets copied.
The reason for this is that by the time the document gets created, the WOPI-like protocol or Windows
Explorer doesn&amp;#8217;t have a running soffice process to create a document instance from a template: it&amp;#8217;ll
just copy a file.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;With that aside, users expect that when they create new documents, the language of their new
document matches the locale of Writer itself. This conflicts with the idea that languages in the
documents are explicit, so if a German users writes a piece of German text, the spellcheck passes
and the next user is English, then the text should remain German, not introducing new spellcheck
errors.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_result"&gt;Result&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://lh3.googleusercontent.com/OnDdNBGLsYhicnEbt_G6XW3Tmrn17XUT4XyBczgm0eETha9ZQ0y62t74QxeUFi3BfzfZrbBzZaMikglblqQBqTnWdYQzEQ72iBh3gZMHb9akFpQRVztOW7_0pK1Uyn9fvaNhLfugHfQ=w640" alt="https://lh3.googleusercontent.com/OnDdNBGLsYhicnEbt_G6XW3Tmrn17XUT4XyBczgm0eETha9ZQ0y62t74QxeUFi3BfzfZrbBzZaMikglblqQBqTnWdYQzEQ72iBh3gZMHb9akFpQRVztOW7_0pK1Uyn9fvaNhLfugHfQ=w640" /&gt;
&lt;/div&gt;
&lt;div class="title"&gt;Figure 1. Locale-indepentent Writer template&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;The solution to this problem is what &lt;a href="https://gerrit.libreoffice.org/c/core/+/100899"&gt;Mike&lt;/a&gt;
and &lt;a href="https://gerrit.libreoffice.org/c/core/+/101195"&gt;Ezinne&lt;/a&gt; implemented: make these
"templates" minimal, so they don&amp;#8217;t refer to any language. Then Calc or Impress will fill the
language from the locale of the soffice process and it&amp;#8217;ll be part of the document on the first save.
This solves the problem of multi-language templates while it does not break the spellcheck use-case.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Andras &lt;a href="https://gerrit.libreoffice.org/c/online/+/102239"&gt;copied&lt;/a&gt; the same templates to various Online
integrations to have the same problem solved in that use-case as well.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Writer was still problematic, though. &lt;a href="https://gerrit.libreoffice.org/c/core/+/102051"&gt;sw: default to
UI locale when language is missing&lt;/a&gt; now fixes this. You can see on the above screenshot that the
stock soffice.odt was opened with a Hungarian locale and the status bar shows that the document
language is Hungarian, not the confusing "multiple languages", as before.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_want_to_start_using_this"&gt;Want to start using this?&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;You can get a snapshot / demo of Collabora Office and try it out yourself right now:
&lt;a href="https://www.collaboraoffice.com/collabora-office-latest-snapshot/"&gt;try unstable snapshot&lt;/a&gt;.  Collabora
is a major contributor to LibreOffice and all of this work will be available in TDF&amp;#8217;s next release
too (7.1).&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Miklos Vajna</dc:creator><pubDate>Wed, 16 Sep 2020 10:46:16 +0200</pubDate><guid isPermaLink="false">tag:vmiklos.hu,2020-09-16:/blog/sw-locale-independent-templates.html</guid><category>libreoffice</category><category>en</category></item><item><title>SmartArt improvements in Impress, part 5</title><link>https://vmiklos.hu/blog/smartart-improvements-5.html</link><description>&lt;div id="preamble"&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Impress now has support for considering rules next to constraints when it comes to lay out
SmartArt graphics from PPTX files. This builds on top of the
&lt;a href="https://vmiklos.hu/blog/smartart-improvements-4.html"&gt;previous improvements&lt;/a&gt; around SmartArt support.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;First, thanks to our partner &lt;a href="https://www.suse.com/"&gt;SUSE&lt;/a&gt; for working with
&lt;a href="https://www.collaboraoffice.com/"&gt;Collabora&lt;/a&gt; to make this possible.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_motivation"&gt;Motivation&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;SmartArt allows declaring your content and requirements for a graphic, then the layout will take
care of arranging that in a suitable way. It is allowed to declare conflicting requirements, and
rules can specify how to resolve those conflicts. The below example document has shape widths
defined in a way that multiple child shapes wants to have a width of 100%, but simply scaling down
all child shapes does not give a correct result. Rules define what to scale down and what to leave
unchanged.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_results_so_far"&gt;Results so far&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Here is how this works in practice:&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://lh3.googleusercontent.com/_AL6ARVsbgdaovqKPxr0n0I1kSn2zX_5xGg5y_4M8whkT6K0-mXIsGXeYI2Uo6u2YQAVwfLtbfy8XeYHggaPWpIHV4yaA4CaaIFUK4LQLRbV-JIbhy9A-Xz5JEEbcXp3TRWK4CzVcl0=w640" alt="https://lh3.googleusercontent.com/_AL6ARVsbgdaovqKPxr0n0I1kSn2zX_5xGg5y_4M8whkT6K0-mXIsGXeYI2Uo6u2YQAVwfLtbfy8XeYHggaPWpIHV4yaA4CaaIFUK4LQLRbV-JIbhy9A-Xz5JEEbcXp3TRWK4CzVcl0=w640" /&gt;
&lt;/div&gt;
&lt;div class="title"&gt;Figure 1. Linear layout with multiple 100% width shapes, new output&lt;/div&gt;
&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://lh3.googleusercontent.com/UmK7-j0WxUHamDA-g3FepAOYYgbD5LJJhssleqv2jLnfXX-62fP82uA_5t__9HOQWIZfJUl6hoZVVQX5-LuIdOxz2M0HS90zcaoov_SbxQHuv4DN48be8dZkvySb_QtAbmNOTcMpJ5c=w640" alt="https://lh3.googleusercontent.com/UmK7-j0WxUHamDA-g3FepAOYYgbD5LJJhssleqv2jLnfXX-62fP82uA_5t__9HOQWIZfJUl6hoZVVQX5-LuIdOxz2M0HS90zcaoov_SbxQHuv4DN48be8dZkvySb_QtAbmNOTcMpJ5c=w640" /&gt;
&lt;/div&gt;
&lt;div class="title"&gt;Figure 2. Linear layout with multiple 100% width shapes, old output&lt;/div&gt;
&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://lh3.googleusercontent.com/i2ScJOwjQfQeeFrw-yu6EQt67nt5Xx7o325WnaOeprXH4jc_CPLuXt0Mwb2iiT9rBamjooEA271HY48P6v8ieuWMUcoSq5HTjMsJkJnUOcrCrF_7uutebYGfO2WOZzAJRh6k-ibbglc=w640" alt="https://lh3.googleusercontent.com/i2ScJOwjQfQeeFrw-yu6EQt67nt5Xx7o325WnaOeprXH4jc_CPLuXt0Mwb2iiT9rBamjooEA271HY48P6v8ieuWMUcoSq5HTjMsJkJnUOcrCrF_7uutebYGfO2WOZzAJRh6k-ibbglc=w640" /&gt;
&lt;/div&gt;
&lt;div class="title"&gt;Figure 3. Linear layout with multiple 100% width shapes, reference output&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_how_is_this_implemented"&gt;How is this implemented?&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;If you would like to know a bit more about how this works, continue reading&amp;#8230; :-)&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
The initial heavy-lifting is done in
  &lt;a href="https://git.libreoffice.org/core/commit/6ca5412bac9e3da5cd20f315fc853c7733f10858"&gt;this commit&lt;/a&gt;,
  which parses the rules from the XML input.
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
Then once we had rule info around, the linear algorithm was improved to scale down child shapes
  based on rules (and not just all of them, equally).
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
Then it was necessary to scale spacings (between child shapes) based on rules as well.
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
It was also needed to limit the height request of a shape, since they should not leave the canvas
  of the SmartArt.
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
Finally it was necessary to support the "top" child order. This can be declared using the
  following markup:
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;&lt;!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite --&gt;
&lt;pre&gt;&lt;tt&gt;&lt;span style="font-weight: bold"&gt;&lt;span style="color: #0000FF"&gt;&amp;lt;dgm:layoutNode&lt;/span&gt;&lt;/span&gt; ... &lt;span style="color: #009900"&gt;chOrder&lt;/span&gt;&lt;span style="color: #990000"&gt;=&lt;/span&gt;&lt;span style="color: #FF0000"&gt;"t"&lt;/span&gt;&lt;span style="font-weight: bold"&gt;&lt;span style="color: #0000FF"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/tt&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;This declares that an earlier shape in a linear layout is on top of a later shapes, not the
opposite. The default is that newer shapes are on top of older shapes. This is not a visible
problem usually, but once you start using negative widths in a linear layout, you can have
overlapping shapes. The above example has 3 text shapes, which are overlapping with the "background"
arrow shape. This is expressed by having 100% width for child shapes (OK to scale down), then a
-100% width for a dummy shape (not scaling) and finally a 100% width for the background arrow (not
scaling).&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;All in all, now the background arrow shape has a good position and size, and the text on the arrow
is readable.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_want_to_start_using_this"&gt;Want to start using this?&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;You can get a snapshot / demo of Collabora Office and try it out yourself right now:
&lt;a href="https://www.collaboraoffice.com/collabora-office-latest-snapshot/"&gt;try unstable snapshot&lt;/a&gt;.  Collabora
is a major contributor to LibreOffice and all of this work will be available in TDF&amp;#8217;s next release
too (7.1).&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Miklos Vajna</dc:creator><pubDate>Wed, 19 Aug 2020 09:24:04 +0200</pubDate><guid isPermaLink="false">tag:vmiklos.hu,2020-08-19:/blog/smartart-improvements-5.html</guid><category>libreoffice</category><category>en</category></item><item><title>Adding visible signatures to existing PDF files in Draw</title><link>https://vmiklos.hu/blog/sd-visible-pdf-sign.html</link><description>&lt;div id="preamble"&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Draw now has support for adding visible signatures to an existing PDF file. This is in contrast with
the &lt;a href="https://vmiklos.hu/blog/pdf-sign.html"&gt;old functionality&lt;/a&gt; which was limited to invisible signatures.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;First, thanks to the Dutch Ministry of Defense in cooperation with &lt;a href="http://nouenoff.nl/"&gt;Nou&amp;amp;Off&lt;/a&gt; who
made this work by &lt;a href="https://www.collaboraoffice.com/"&gt;Collabora&lt;/a&gt; possible.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_motivation"&gt;Motivation&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;The PDF format allows assigning a shape (a form xobject) to a digital signature in the PDF file, and
if you use e.g. Adobe Acrobat, then it fills this shape with some visible information about the
digital signature. Draw used to write a placeholder widget there (a 0x0-sized rectangle on the first
page, at position 0x0). This is valid, but it&amp;#8217;s not close to real-world signatures, where signing
has a visual effect as well.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_results_so_far"&gt;Results so far&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Here is how this works in practice:&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;a class="image" href="https://youtu.be/tPAOXr2UH0M"&gt;
&lt;img src="https://lh3.googleusercontent.com/IDjXX1VwAvlFi1ug9pUSYLwakUyPn2YiMachx7DdiG5Jershph28sFOCWgSuQ6WbfgGdpMcnngjipnetuCBXiOMUR-OqTPO4rlikLXFJtc1WEtQoczPmQDLIXTpPcQD__0WI0T87Cw=w640" alt="https://lh3.googleusercontent.com/IDjXX1VwAvlFi1ug9pUSYLwakUyPn2YiMachx7DdiG5Jershph28sFOCWgSuQ6WbfgGdpMcnngjipnetuCBXiOMUR-OqTPO4rlikLXFJtc1WEtQoczPmQDLIXTpPcQD__0WI0T87Cw=w640" /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;div class="title"&gt;Figure 1. Demo of adding a visible signature to an existing PDF file in Draw&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;You can see how the 2 added signatures are visible and Adobe Acrobat confirms they are valid, too.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_how_is_this_implemented"&gt;How is this implemented?&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;If you would like to know a bit more about how this works, continue reading&amp;#8230; :-)&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
Signature lines were already working in Writer and Calc, this effort brings them to Draw,
  improving consistency.
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
Signing existing PDFs were already possible, this allows adding a visible signature with the
  correct markup. This is important for automated processing of PDFs, maybe even helps
  accessibility. (I think DocuSign doesn&amp;#8217;t get this right currently.)
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
This uses the existing "export selected shape to PDF" code to produce that object, so it&amp;#8217;s not a
  bitmap, but a scalable format. (As I know, DocuSign doesn&amp;#8217;t do this, either.)
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
If you didn&amp;#8217;t get the signature rectangle right for the first time, you can still move and resize
  it before the actual signing happens (Acrobat doesn&amp;#8217;t support this currently, I believe.)
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
The generated object is locale-aware when it comes to the actual signature string and date format.
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
The feature works for multiple signatures and multiple pages as well.
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
The final step was
  &lt;a href="https://git.libreoffice.org/core/commit/9b7a890fd59744459692d7f66402c6bdd25acec4"&gt;this commit&lt;/a&gt;,
  with much more grounding before that one.
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
Note that the signing is a two step process: first you draw the signature rectangle and optionally
  finalize its position / size, and only then you use the &lt;em&gt;Finish Signing&lt;/em&gt; button on the infobar to
trigger the actual signing:
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;img src="https://lh3.googleusercontent.com/TMPrD20O0PvPLB7Uru_mmxfeQTaWhJwNQ80jgLj23TWLNqkm44Ww8F9Azce0sEN1TzmjmmVW7MvHZTwtR6Us2H7qpzOSC07CQ0p_myEsM1WRQOToAEus0vsgpTh1yeD65YemFQvv_A=w640" alt="https://lh3.googleusercontent.com/TMPrD20O0PvPLB7Uru_mmxfeQTaWhJwNQ80jgLj23TWLNqkm44Ww8F9Azce0sEN1TzmjmmVW7MvHZTwtR6Us2H7qpzOSC07CQ0p_myEsM1WRQOToAEus0vsgpTh1yeD65YemFQvv_A=w640" /&gt;
&lt;/div&gt;
&lt;div class="title"&gt;Figure 2. After drawing a signature rectangle, before finishing the signing.&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;If you use a HW-based certificate, this second step will ask for your certificate PIN.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_want_to_start_using_this"&gt;Want to start using this?&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;You can get a snapshot / demo of Collabora Office and try it out yourself right now:
&lt;a href="https://www.collaboraoffice.com/collabora-office-latest-snapshot/"&gt;try unstable snapshot&lt;/a&gt;.  Collabora
is a major contributor to LibreOffice and all of this work will be available in TDF&amp;#8217;s next release
too (7.1).&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Miklos Vajna</dc:creator><pubDate>Mon, 20 Jul 2020 09:07:46 +0200</pubDate><guid isPermaLink="false">tag:vmiklos.hu,2020-07-20:/blog/sd-visible-pdf-sign.html</guid><category>libreoffice</category><category>en</category></item><item><title>Page-content-bottom vertical relation in Writer</title><link>https://vmiklos.hu/blog/sw-page-content-bottom-anchor.html</link><description>&lt;div id="preamble"&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Writer now has support for anchoring shapes relative to the bottom of the page content frame.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;First, thanks to our partner &lt;a href="https://www.suse.com/"&gt;SUSE&lt;/a&gt; for working with
&lt;a href="https://www.collaboraoffice.com/"&gt;Collabora&lt;/a&gt; to make this possible.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_motivation"&gt;Motivation&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Users sometimes want to specify the vertical position of their shapes in text documents in a way
that is relative from the bottom of the page content area. Also, this improves consistency,
specifying a position that is relative from the top of the page content area is already possible.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Alternatively, it is possible to have the same calculated position when positioning from the top of
the page content area. The downside of this approach is that the position changes when the page
height changes. So if the user intention is to position a shape 2 cm above the bottom of the page
content area and the page height changes, the shape has to be manually re-positioned. This manual
re-positioning is not needed with the new page-content-bottom vertical relation.&lt;/p&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;For example, if a shape has a height of 10 cm and a 2 cm spacing is wanted between the bottom of the
shape and the bottom of the page content area, the position can be set to -12 cm, and then the 2 cm
spacing will be maintained, even after the page height changes.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_results_so_far"&gt;Results so far&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;Here is how this works in practice:&lt;/p&gt;&lt;/div&gt;
&lt;div class="imageblock" style="text-align:center;"&gt;
&lt;div class="content"&gt;
&lt;a class="image" href="https://youtu.be/X49IbS97axs"&gt;
&lt;img src="https://lh3.googleusercontent.com/3r0eHqOn48OkUPHLGlhWTjPwwkWYWouF3LtMtVTmRITJ9oGHuRW1-COvswp71G7-ySMvZ-fsP8-0R5ELVNmiaN2FCxtFLfnun4OFYmFvmZk-W1UBw4EhJ4P8RAgPHhQtdcmjiCe9Eg=w640" alt="https://lh3.googleusercontent.com/3r0eHqOn48OkUPHLGlhWTjPwwkWYWouF3LtMtVTmRITJ9oGHuRW1-COvswp71G7-ySMvZ-fsP8-0R5ELVNmiaN2FCxtFLfnun4OFYmFvmZk-W1UBw4EhJ4P8RAgPHhQtdcmjiCe9Eg=w640" /&gt;
&lt;/a&gt;
&lt;/div&gt;
&lt;div class="title"&gt;Figure 1. Demo of a stable vertical position (relative to the bottom of the page content frame), during a page height change&lt;/div&gt;
&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;You can see how the distance of the shape from the bottom is 2 cm, even if the page height changes.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_how_is_this_implemented"&gt;How is this implemented?&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;If you would like to know a bit more about how this works, continue reading&amp;#8230; :-)&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
the UNO API now supports a new &lt;code&gt;PAGE_PRINT_AREA_BOTTOM&lt;/code&gt; relative orientation
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
the have the expected layout, &lt;code&gt;SwToContentAnchoredObjectPosition::CalcPosition()&lt;/code&gt; now considers
  this from-bottom anchoring when handling the vertical relative orientation
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
the DOCX format already had a markup for this:
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;&lt;!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite --&gt;
&lt;pre&gt;&lt;tt&gt;&lt;span style="font-weight: bold"&gt;&lt;span style="color: #0000FF"&gt;&amp;lt;wp:positionV&lt;/span&gt;&lt;/span&gt; &lt;span style="color: #009900"&gt;relativeFrom&lt;/span&gt;&lt;span style="color: #990000"&gt;=&lt;/span&gt;&lt;span style="color: #FF0000"&gt;"bottomMargin"&lt;/span&gt;&lt;span style="font-weight: bold"&gt;&lt;span style="color: #0000FF"&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span style="font-weight: bold"&gt;&lt;span style="color: #0000FF"&gt;&amp;lt;wp:posOffset&amp;gt;&lt;/span&gt;&lt;/span&gt;...&lt;span style="font-weight: bold"&gt;&lt;span style="color: #0000FF"&gt;&amp;lt;/wp:posOffset&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span style="font-weight: bold"&gt;&lt;span style="color: #0000FF"&gt;&amp;lt;/wp:positionV&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/tt&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;now the import/export code maps this markup to the new feature.&lt;/p&gt;&lt;/div&gt;
&lt;div class="ulist"&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
The UI allows setting a new "Page text area bottom" frame position. It turns out that the UI is
  quite nice here, it tries to prevent you from setting positions which would be outside the limits
  of the current page. This logic in &lt;code&gt;SwFEShell::CalcBoundRect()&lt;/code&gt; now handles the new relative
  orientation.
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
The ODF filter now has a markup to represent the new vertical relation:
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;
&lt;div class="listingblock"&gt;
&lt;div class="content"&gt;&lt;!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite --&gt;
&lt;pre&gt;&lt;tt&gt;&lt;span style="font-weight: bold"&gt;&lt;span style="color: #0000FF"&gt;&amp;lt;style:graphic-properties&lt;/span&gt;&lt;/span&gt; ... &lt;span style="color: #009900"&gt;loext:vertical-rel&lt;/span&gt;&lt;span style="color: #990000"&gt;=&lt;/span&gt;&lt;span style="color: #FF0000"&gt;"page-content-bottom"&lt;/span&gt; ...&lt;span style="font-weight: bold"&gt;&lt;span style="color: #0000FF"&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/tt&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;There is a &lt;a href="https://issues.oasis-open.org/browse/OFFICE-4073"&gt;proposal&lt;/a&gt; to promote this from our
extension namespace to normal ODF (thanks to Regina for the help there!).&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="sect1"&gt;
&lt;h2 id="_want_to_start_using_this"&gt;Want to start using this?&lt;/h2&gt;
&lt;div class="sectionbody"&gt;
&lt;div class="paragraph"&gt;&lt;p&gt;You can get a snapshot / demo of Collabora Office and try it out yourself right now:
&lt;a href="https://www.collaboraoffice.com/collabora-office-latest-snapshot/"&gt;try unstable snapshot&lt;/a&gt;.  Collabora
is a major contributor to LibreOffice and all of this work will be available in TDF&amp;#8217;s next release
too (7.1).&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Miklos Vajna</dc:creator><pubDate>Wed, 10 Jun 2020 09:12:45 +0200</pubDate><guid isPermaLink="false">tag:vmiklos.hu,2020-06-10:/blog/sw-page-content-bottom-anchor.html</guid><category>libreoffice</category><category>en</category></item></channel></rss>