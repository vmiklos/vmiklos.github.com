<!DOCTYPE html>
<html lang="en">

<head>
  <!-- ## for client-side less
  <link rel="stylesheet/less" type="text/css" href="https://vmiklos.hu/blog/theme/css/style.less">
  <script src="http://cdnjs.cloudflare.com/ajax/libs/less.js/1.7.3/less.min.js" type="text/javascript"></script>
  -->
  <link rel="stylesheet" type="text/css" href="https://vmiklos.hu/blog/theme/css/style.css">
  <link rel="stylesheet" type="text/css" href="https://vmiklos.hu/blog/theme/css/pygments.css">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Miklos Vajna">
  <meta name="description" content="Posts and writings by Miklos Vajna">

  <link href="https://vmiklos.hu/blog/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="What is Miklos hacking RSS" />

<link href="https://vmiklos.hu/blog/feeds/frugalware.rss.xml" type="application/rss+xml" rel="alternate" title="What is Miklos hacking frugalware Category RSS" />

  <title>
    What is Miklos hacking
&ndash; Category: frugalware  </title>

<script type="text/javascript">
  var _paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//analytics.vmiklos.hu/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
</head>

<body>
  <aside>
    <div id="user_meta">
      <h2><a href="https://vmiklos.hu/blog">What is Miklos hacking</a></h2>
      <p></p>
      <ul>
        <li><a href="/" target="_blank">Root</a></li>
        <li><a href="https://planet.documentfoundation.org/" target="_blank">LibreOffice Blogs</a></li>
      </ul>
    </div>
  </aside>

  <main>
    <header>
      <p>
      <a href="https://vmiklos.hu/blog">Index</a> &brvbar; <a href="https://vmiklos.hu/blog/archives.html">Archives</a>
      &brvbar; <a href="https://vmiklos.hu/blog/feeds/all.rss.xml">RSS</a>
&gt; Category: frugalware
&brvbar; <a href="https://vmiklos.hu/blog/feeds/frugalware.rss.xml">RSS</a>
      </p>
    </header>

<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/frugalware-history.html">Frugalware history</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Sun 16 September 2012</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 8 minutes</p>
  </div>
  <div class="article_text">
    <div id="preamble">
<div class="sectionbody">
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://lh5.googleusercontent.com/-72B3Mo4hOQs/UeegcVH4YZI/AAAAAAAADNU/IwX2_lLQt5k/s128/logo-new-big.png" alt="https://lh5.googleusercontent.com/-72B3Mo4hOQs/UeegcVH4YZI/AAAAAAAADNU/IwX2_lLQt5k/s128/logo-new-big.png" />
</div>
</div>
<div class="paragraph"><p>Given that Frugalware was founded by me, and recently James recently took over
the project leadership, I think it makes sense to look back and summarize the
past 6 years.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_the_beginning">The beginning</h2>
<div class="sectionbody">
<div class="paragraph"><p>It all started with
<a href="http://frugalware.org/pipermail/frugalware-announce/2004-September/000001.html">this
announcement</a> about 6 years ago. It was a one-man show before, there was a
<a href="http://ftp.frugalware.org/pub/archive/frugalware-0.1/ChangeLog.txt">manually
written ChangeLog</a> but even then there were already quite a few packages, so
don&#8217;t ask me when I started hacking on this. Yes, normally there would be a
first commit in git, but remember this was before git existed, and I hated
centralized CVS so much that we didn&#8217;t use anything.</p></div>
<div class="paragraph"><p>Looking back, it was all quite lame. :-) I used a mail address called "mamajom"
(English translation could be "momonkey"), tied to an ISP, with a lengthy
signature at the end of every mail I sent and was using my IRC nick instead of
my real one everywhere&#8230; OTOH, I made some decisions I&#8217;m happy about even
today. The first four developers (Ádám Zlehovszky, Krisztián Vasas, Zsolt
Szalai and me) were all Hungarian and despite of this, I forced every code,
test and documentation to be in English, to possibly turn the project into an
international one in the future. And that proved to very, very useful.</p></div>
<div class="paragraph"><p>It was between 0.1 and 0.2 that we (Krisztián, Zsolt and me) showed up in a
Hungarian TV (<a href="http://ftp.frugalware.org/pub/other/videos/hu/">video record</a>)
explaining Frugalware. This is something never happened later for some reason.</p></div>
<div class="paragraph"><p>The way we found a free hosting at a university I never attended may be also
interesting. In the grammar school, our IT teacher found my Linux distribution
idea interesting enough to support, and his friend was a teacher at the Eötvös
Loránd University, which is at the same Budapest city where I live. So, with my
friend Botond Balázs (who later was my witness at our wedding) we bought an
ultra-slow old PC (some Pentium 1 with a single HDD) and we were extremely
happy, as the uni offered to host it for free. I remember it ran some Slackware
version, as Frugalware didn&#8217;t support i586&#8230; ;-)</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_early_days">Early days</h2>
<div class="sectionbody">
<div class="paragraph"><p>Then some more developers joined and we started to package all the usual free
software which is available in other distributions but I personally didn&#8217;t use.
Think of GNOME, Xfce, OpenOffice.org and so on.</p></div>
<div class="paragraph"><p>Of course we were still lame, the announcements still were not spellchecked by
someone native and knowledgeable enough, ending up in words like "splitted" or
"optimalization". However, we started to use an SCM (Darcs, which was horribly
slow, but at least not the centralized CVS crap). Another developer I should
mention was Bence Nagy, he came up with the idea of how we should avoid
duplication in FrugalBuilds, leading to the various package templates under
<code>source/include/</code> in the source tree.</p></div>
<div class="paragraph"><p>Then we went multiarch, Krisztián Hamar contributed the x86_64 port to the 0.3
release. At the same time, I invented <code>syncpkg</code>, which avoided having to build
the same package on multiple architectures manually.</p></div>
<div class="paragraph"><p>We also got Gábor Lőcsei (later we met IRL and completed several bike marathons
together, resulting in a great friendship) who helped users in general on IRC,
but more importantly, for some time he did quite some bug triaging, leading to
a much better bugzilla (actually it was running Flyspray at that time) state.</p></div>
<div class="paragraph"><p>The constant questions of László Csécsy (who nowadays mostly hacks
Drupal core and its modules) generated more and more improving documentation.
We first started with a LaTeX documentation, then later turned it to an
asciidoc one, in the hope of attracting more non-math contributors. ;-)</p></div>
<div class="paragraph"><p>Then we started to have some beautiful artwork, Viktor Gondor contributed some
really cool wallpapers.</p></div>
<div class="paragraph"><p>Finally, I think the last two Hungarian guys who spent a hell of a time on the
project was András Vöröskői (we still link his
<a href="http://frugalware.org/docs/getting-involved/en">getting started HOWTO</a> for new
contributors) and János Kovács. I remember for a long time I used the
home-hosted server of János when we didn&#8217;t have a fast dedicated i686 build
server and my desktop was still 32bit.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_going_international">Going international</h2>
<div class="sectionbody">
<div class="paragraph"><p>Then things started to happen fast. Developers outside Hungary showed up:
Gabriel Craciunescu from Germany and Michel Hermier from France worked a lot on
KDE, Gabriel also hacked a lot of the core OS, like kernel, glibc, etc.</p></div>
<div class="paragraph"><p>Priyank Gosalia from India started to work on GTK tools like a package manager
frontend. David Kimpe contributed a PPC port years before I got my iBook (which
I used as my primary box for a few years).</p></div>
<div class="paragraph"><p>And needless to say, we still made mistakes. We thought that the development of
the original Pacman package manager slowed down, its rewrite (providing a
separate library and a console frontend, instead of one monolithic binary)
seemed to never complete, and given that we were not Archlinux developers, we
never got access to its CVS. We started to use that library API in the
installer, testcases, GUI tools, while changing the API for them wasn&#8217;t an
issue, since officially it was still unreleased. All this frustration (and
underestimating the cost of maintaining a fork) resulted in our Pacman-G2
project. First it appeared to be shiny, but once Krisztián Hamar left
Frugalware, we constantly lacked manpower and today the consensus is that with
git, maintaining a patchset over pacman.git would be far better, just nobody
did the work of merging the two projects. Pacman-G2 is in maintenance mode
today, and it still well serves its purpose, but it didn&#8217;t see any new major
feature in years.</p></div>
<div class="paragraph"><p>We also saw a rewrite of the installer. The original one was written in bash,
then the second was written in C, using libdialog. And currently James works on
a third one, hopefully fixing lots of instability, resulting from the design
errors of the current one. ;-)</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_more_and_more_developers">More and more developers</h2>
<div class="sectionbody">
<div class="paragraph"><p>And then somehow more and more developers came. Gourdin Gaetan (bouleetbil) and
Sébastien Vincent (Baste) worked a lot on the GNOME support, James Buren took
over the base system from me. Paolo Cretaro (Melko) does KDE bumps nowadays and
Marius Cirsta (mcirsta) did heroic work of including OpenJDK 7 into Frugalware.</p></div>
<div class="paragraph"><p>Abdelmoumene Hamza (Slown) is a guy who volunteered to do a log of boring work.
When you can install a random Perl on Python module from a package, chances
that it was packaged by Slown are high. ;-)</p></div>
<div class="paragraph"><p>Regarding infrastructure, Benjamin Nolmans (Xarkam) stepped up, and finally
converted the data from our Flyspray instance to the more mainstream and
maintained Trac format. Regarding architectures Boris Albar (Elentir)
contributed an ARM port. Our press noise was generated by Russell Dickenson
(phayz) for a long time: he wrote newsletters regularly, and these days he
works as a documentation writer for Red Hat.</p></div>
<div class="paragraph"><p>For a long time, no more Hungarians joined the project. Then Bagdán Róbert
(kikadf) came, and even if he&#8217;s rarely present on IRC, he still contributes
from time to time, and these small, but valuable contributions are what keep
Frugalware alive. :-)</p></div>
<div class="paragraph"><p>Regarding other big upgrades, Daniel Exner (dex) was the guy who stepped up and
finally packaged KDE4 for Frugalware. All KDE4 users meeting him should buy a
beer for him. ;-) Anthony Jorion (pingax) joined in 2010, and since then he
does XFCE updates.</p></div>
<div class="paragraph"><p>Finally, I should not forget about Daniel Eledut (Devil505), who probably
helped me the most with my "the rest" task: he really helped out in various
areas, and he was a major Frugalware contributor for a long time.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_the_end_of_my_leadership">The end of my leadership</h2>
<div class="sectionbody">
<div class="paragraph"><p>Contributing to other projects is something I did regularly, since every time I
got a bugreport for a package, first I created a patch to fix the problem (in
case it could not be worked around in the buildscript), and then of course
tried to upstream it, knowing the maintenance cost of non-upstreamed patches.
Still, these were minor and my main project was Frugalware for years.</p></div>
<div class="paragraph"><p>The bigger contributions came when I started to complete Google Summer of Code
projects, first SWIG, then git, finally OpenOffice.org&#8201;&#8212;&#8201;which turned into
LibreOffice. The motivation is easy: these were still Free Software hacking,
but given that they are not bash hacking (like most packaging work for
Frugalware), more interesting problem had to be solved, GSoC also provided nice
payments, and needless to say: was useful to many people not using Frugalware.</p></div>
<div class="paragraph"><p>The idea of passing over my leadership to someone else first came when I
looked back, and I saw that I spend more time on LibreOffice than on
Frugalware, even after the paid GSoC ended (later resulting in joining SUSE to
work on LibreOffice fulltime). My focus somehow just shifted from hacking a
distribution to hacking something that is directly useful for average users as
well. It&#8217;s not worse or better, it&#8217;s just different, and after lots of years, I
wanted to do something different.</p></div>
<div class="paragraph"><p>To sum up, I did not reach my expectations as a project leader and I waited for
a candidate I could teach and finally who could become as good as I was in
earlier years, or hopefully even better. And then James came, who first took
over the base system, and we agreed that after 1.7, he&#8217;ll do releases. So it
was not unexpected, but still I was a bit surprised when I saw his
role-changing
<a href="http://git.frugalware.org/gitweb/gitweb.cgi?p=frugalware-current.git;a=commitdiff;h=979ada221b2f822f88f4468e6aefc2487fe87e48">commit</a>.
But needless to say, when thinking a bit more, it was completely logical, all I
really do these days is fixing things left and right regarding my arm port
needs, and maintaining the LibreOffice package.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_summary">Summary</h2>
<div class="sectionbody">
<div class="paragraph"><p>The idea of writing this post is not mine. However, when I thought about how
many individuals helped this project so far, I realized I really need to create
a summary, thanking their work. Reading the above, I hope that in the past
years my leadership to Frugalware were useful and I realize that these days I
have to step back, given a better leader appeared. I honestly wish the project
to see at least as many releases as we already have, now that fresh energy
leads it. :-)</p></div>
<div class="paragraph"><p>I tried to point out all our heroes during the last years, but it&#8217;s possible I
forgot someone. If you think you&#8217;re missing from this post, please leave a
comment. Thanks.</p></div>
</div>
</div>

  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/grub2.html">GRUB2 vs. RAID1, cfdisk and serial console</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Sun 29 July 2012</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 2 minutes</p>
  </div>
  <div class="article_text">
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>Since the Frugalware 1.7 release is near, and it uses GRUB2 by default, I
created a virtual machine, that is similar to the one we use under
<code>genesis.frugalware.org</code>, which hosts this blog as well.</p></div>
<div class="paragraph"><p>The relevant details:</p></div>
<div class="ulist"><ul>
<li>
<p>
it has two RAID1 arrays with ext3:
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content">
<pre><code>$ mount|grep /md
/dev/md126 on / type ext3 (rw,relatime,errors=continue,barrier=1,data=ordered)
/dev/md127 on /home/ftp/pub type ext3 (rw,relatime,errors=continue,barrier=1,data=ordered)</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
the partition tables are created by cfdisk:
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content">
<pre><code>   Device Boot      Start         End      Blocks   Id  System
/dev/sda1              63  1465144064   732572001   fd  Linux raid autodetect</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
the machine has a serial console configured:
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content">
<pre><code># cat /proc/cmdline
root=/dev/disk/by-uuid/7e41c95d-cd73-4043-b0ba-4797af6ddeff ro vga=normal nomodeset console=ttyS1,115200</code></pre>
</div></div>
<div class="paragraph"><p>Now the question is how does this config deal with the GRUB2 upgrade. First,
don&#8217;t miss the official <a href="http://frugalware.org/docs/upgrade">upgrade howto</a>, it
covers most cases. What I want to detail here is how did I avoid starting from
scratch and creating a proper partition table using fdisk.</p></div>
<div class="paragraph"><p>Here are the steps I needed:</p></div>
<div class="ulist"><ul>
<li>
<p>
Backup. Yes, I did screw up for the first time, so it&#8217;s really needed.
</p>
</li>
<li>
<p>
Resize parts of the / RAID1 (/dev/sda1 and /dev/sdb1) with gparted livecd (resizing ext3 from cmdline parted didn&#8217;t work for me).
</p>
</li>
<li>
<p>
mdadm re-creation as described in the upgrade howto, from fw install cd, so you&#8217;ll have the required 1.0 metadata.
</p>
</li>
<li>
<p>
Reinstall GRUB1 to sda and sdb, since the physical location of GRUB1&#8217;s stage* changed.
</p>
</li>
<li>
<p>
Boot back to 1.6, run <code>pacman-g2 -Syu</code>, and <code>grub-install</code>&#8201;&#8212;&#8201;again, see the upgrade howto for details.
</p>
</li>
<li>
<p>
Now given that serial console needs a custom GRUB config and kernel parameters, you need to modify GRUB2&#8217;s <code>/etc/default/grub</code>. Here is my diff:
</p>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>/etc/default# diff -u grub.orig grub
<span style="color: #FF6600">--- grub.orig   2012-07-19 01:57:20.000000000 +0200</span>
<span style="color: #009900">+++ grub        2012-07-29 14:45:50.000000000 +0200</span>
<span style="color: #0000FF">@@ -1,11 +1,12 @@</span>
 GRUB_DEFAULT=0
 GRUB_TIMEOUT=5
 GRUB_DISTRIBUTOR="Frugalware 1.6"
<span style="color: #FF6600">-GRUB_CMDLINE_LINUX_DEFAULT="quiet splash"</span>
<span style="color: #009900">+GRUB_CMDLINE_LINUX_DEFAULT="vga=normal nomodeset plymouth.enable=0 console=ttyS0,115200"</span>
 GRUB_CMDLINE_LINUX=""
 GRUB_PRELOAD_MODULES=""
<span style="color: #FF6600">-GRUB_TERMINAL_INPUT=console</span>
<span style="color: #FF6600">-GRUB_TERMINAL_OUTPUT=gfxterm</span>
<span style="color: #009900">+GRUB_TERMINAL_INPUT=serial</span>
<span style="color: #009900">+GRUB_SERIAL_COMMAND="serial --speed=115200 --port=0x3f8"</span>
<span style="color: #009900">+GRUB_TERMINAL_OUTPUT=serial</span>
 #GRUB_GFXPAYLOAD_LINUX=keep
 GRUB_GFXMODE=auto
 #GRUB_DISABLE_LINUX_UUID=true</tt></pre></div></div>
<div class="paragraph"><p>(Refer to <a href="https://vmiklos.hu/blog/amtterm.html">this post</a> if you don&#8217;t know the needed port number.)</p></div>
</li>
<li>
<p>
Finally run <code>grub-mkconfig</code> to create the real config from the just modified default settings.
</p>
</li>
<li>
<p>
Reboot, and GRUB2, the boot process and the login prompt should be accessible over the serial console again.
</p>
</li>
</ul></div>
</div>
</div>

  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/mtd-utils.html">mtd-utils</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Fri 06 January 2012</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 1 minutes</p>
  </div>
  <div class="article_text">
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>Quick node about this useful project I packaged two days ago. It has a
<a href="http://www.linux-mtd.infradead.org/faq/ubi.html">long FAQ</a> - I was interested in
how can one access the builtin nand storage on an arm board using it.</p></div>
<div class="paragraph"><p>First, check your dmesg, you should see something like:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Creating 3 MTD partitions on "orion_nand":
0x000000000000-0x000000100000 : "u-boot"
0x000000100000-0x000000500000 : "uImage"
0x000000500000-0x000020000000 : "root"</code></pre>
</div></div>
<div class="paragraph"><p>As the names say, the three items here are the bootloader, the kernel and the
root filesystem. To access and mount the last one, you need:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>ubiattach /dev/ubi_ctrl -m 2
mount /dev/ubi0_0 root
... hack hack hack ...
umount root
ubidetach /dev/ubi_ctrl -m 2</code></pre>
</div></div>
</div>
</div>

  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/frugalware-arm-install-howto.html">Frugalware arm port install HOWTO</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Wed 04 January 2012</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 4 minutes</p>
  </div>
  <div class="article_text">
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>I recently got a <a href="http://en.wikipedia.org/wiki/GuruPlug">GuruPlug</a>. It has Debian
by default, and it&#8217;s apt config is set to <code>stable</code>, while in fact at the moment
what&#8217;s the factory default is considered as <code>oldstable</code> by upstream. So if you
blindly do a few <code>apt-get install foo</code>, soon you&#8217;ll have newer userspace than
kernel, and your device will no longer boot (based on true story - and yes,
this is not Debian&#8217;s fault). Moreover, I was interested in how to install
Frugalware on this device, so here is a quick howto.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_install_rootfs">Install rootfs</h2>
<div class="sectionbody">
<div class="paragraph"><p>First you need to bootstrap Frugalware from Debian. It&#8217;s a good idea to install
Frugalware on a USB stick, so you can switch back to Debian in case you messed
up something and start from scratch again.</p></div>
<div class="paragraph"><p>Partitioning is up to you, you&#8217;re recommended to have a small FAT (type: <code>0x0b</code>)
partition (32MB for example) at the beginning, we&#8217;ll use that later. The second
can be the rest, ext4 or so.</p></div>
<div class="paragraph"><p>Format and mount it (your device name may differ!):</p></div>
<div class="listingblock">
<div class="content">
<pre><code>mkfs.ext4 /dev/sda2
mkdir -p /mnt/sda2
mount /dev/sda2 /mnt/sda2</code></pre>
</div></div>
<div class="paragraph"><p>Then install our pacman-g2 binary to the Debian system, so you can bootstrap:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>wget http://ftp.frugalware.org/pub/frugalware/frugalware-stable/frugalware-arm/pacman-g2-3.8.3-2mores2-arm.fpm
unxz pacman-g2-3.8.3-2mores2-arm.tar.xz
cd /
tar xf /path/to/pacman-g2-3.8.3-2mores2-arm.tar
rm .CHANGELOG .FILELIST .PKGINFO</code></pre>
</div></div>
<div class="paragraph"><p>Installing the required packages is a single command, as described
<a href="http://frugalware.org/docs/install#_a_manual_bootstrap">here</a>:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>pacman-g2.static --noconfirm -Sy core base -r /mnt/sda2/</code></pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_upgrade_the_bootloader">Upgrade the bootloader</h2>
<div class="sectionbody">
<div class="paragraph"><p>Once the rootfs is ready, you need a new bootloader that will be able to boot
our vanilla kernel.</p></div>
<div class="paragraph"><p>You need a <a href="http://www.globalscaletechnologies.com/p-28-guruplug-jtag.aspx">JTAG
Board</a>, so you can access the serial console. If you connect the USB cable to
you PC, you can use for example</p></div>
<div class="listingblock">
<div class="content">
<pre><code>screen /dev/ttyUSB0 115200</code></pre>
</div></div>
<div class="paragraph"><p>to access the device.</p></div>
<div class="paragraph"><p>Given that we want to boot a vanilla kernel, we need a vanilla bootloader as
well. Before you mess with the bootloader, it&#8217;s a good idea to make a backup of
its config (there is a 3 second timeout during boot - if you press any key
there, you get the Marvell prompt). Here is my config:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Marvell&gt;&gt; printenv
bootcmd=${x_bootcmd_ethernet}; ${x_bootcmd_usb}; ${x_bootcmd_kernel}; setenv bootargs ${x_bootargs} ${x_bootargs_root}; bootm 0x6400000;
bootdelay=3
baudrate=115200
x_bootcmd_ethernet=ping 192.168.2.1
x_bootcmd_usb=usb start
x_bootcmd_kernel=nand read.e 0x6400000 0x100000 0x400000
x_bootargs=console=ttyS0,115200
x_bootargs_root=ubi.mtd=2 root=ubi0:rootfs rootfstype=ubifs
ethact=egiga0
bootargs=console=ttyS0,115200 ubi.mtd=2 root=ubi0:rootfs rootfstype=ubifs
ipaddr=10.10.10.10
serverip=10.10.10.179
ethaddr=F0:AD:4E:00:CE:C3
stdin=serial
stdout=serial
stderr=serial</code></pre>
</div></div>
<div class="paragraph"><p>The only semi-unique part is the MAC address of the network interface(s).</p></div>
<div class="paragraph"><p>If you want to update the bootloader, a possible way is to put the new binary
to a pendrive. Given that the default bootloader does not support ext*, we need
a fat filesystem. So format the first small partition we created already (the
device name may be different in your case!):</p></div>
<div class="listingblock">
<div class="content">
<pre><code>mkdosfs /dev/sda1</code></pre>
</div></div>
<div class="paragraph"><p>Till Frugalware 1.6 is released, support for GuruPlug is available in
Frugalware -current only, so download the
<a href="http://ftp.frugalware.org/pub/frugalware/frugalware-current/frugalware-arm/u-boot-2011.12-2-arm.fpm">binary
package</a> from there, extract the u-boot.kwb file from the guruplug directory,
put it to the new partition. (A few other models are explained
<a href="http://www.cyrius.com/debian/kirkwood/sheevaplug/uboot-upgrade.html">here</a>).</p></div>
<div class="paragraph"><p>Before you reboot, copy also <code>/boot/uImage</code> to the fat partition, you may have
problems problems with reading the kernel from the ext4 partition with u-boot.</p></div>
<div class="paragraph"><p>Once copying the kernel is done, reboot and in the u-boot shell do:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>usb start
fatload usb 0:1 0x0800000 u-boot.kwb
nand erase 0x0 0x60000
nand write 0x0800000 0x0 0x60000
reset</code></pre>
</div></div>
<div class="paragraph"><p>You can verify the updated bootloader with the <code>version</code> command:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Marvell&gt;&gt; version

U-Boot 2011.12 (Jan 03 2012 - 16:55:38)
Marvell-GuruPlug
gcc (Frugalware Linux) 4.6.2
GNU ld (GNU Binutils) 2.22</code></pre>
</div></div>
<div class="paragraph"><p>If Frugalware is mentioned, that&#8217;s a good sign. :)</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_boot_the_new_rootfs">Boot the new rootfs</h2>
<div class="sectionbody">
<div class="paragraph"><p>Now you can boot your new rootfs:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>usb start
fatload usb 0:1 0x00800000 /uImage
setenv bootargs console=ttyS0,115200 root=/dev/sda2 rootdelay=5
bootm 0x00800000</code></pre>
</div></div>
<div class="paragraph"><p>If it booted fine, you may want to make this the default:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>setenv bootargs 'console=ttyS0,115200 root=/dev/sda2 rootdelay=5'
setenv bootcmd_usb 'usb start; fatload usb 0:1 0x00800000 /uImage'
setenv bootcmd 'run bootcmd_usb; bootm 0x00800000'
saveenv</code></pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_finalize">Finalize</h2>
<div class="sectionbody">
<div class="paragraph"><p>The rest is up to you:</p></div>
<div class="ulist"><ul>
<li>
<p>
setting up a root password
</p>
</li>
<li>
<p>
setting up network by default using netconfig
</p>
</li>
</ul></div>
<div class="paragraph"><p>and so on&#8230; you know this already, nothing arm-specific.</p></div>
<div class="paragraph"><p>For the reference, here is the tested CPU and Frugalware version:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ cat /proc/cpuinfo
Processor       : Feroceon 88FR131 rev 1 (v5l)
BogoMIPS        : 1191.11
Features        : swp half thumb fastmult edsp
CPU implementer : 0x56
CPU architecture: 5TE
CPU variant     : 0x2
CPU part        : 0x131
CPU revision    : 1

Hardware        : Marvell GuruPlug Reference Board
Revision        : 0000
Serial          : 0000000000000000
$ cat /etc/frugalware-release
Frugalware 1.5 (Mores)</code></pre>
</div></div>
</div>
</div>

  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/userspace-boot-speed.html">Userspace boot speed: less than a second</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Sat 24 September 2011</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 1 minutes</p>
  </div>
  <div class="article_text">
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>I did not care about boot speed for a long time, since servers usually
restarted only for kernel upgrades, laptops suspend to ram all the time,
and I have no desktop machine at home for years now.  Though one use
case started to motivate me recently: I use virtual machines a lot, and
waiting for them to boot up is boring.</p></div>
<div class="paragraph"><p>So I looked at the <code>systemd-analyze blame</code> output, and it turned out
that for a base-only install the only service that takes a lot of time
is <code>netconfig</code>. It&#8217;s because it was a <code>oneshot</code> service, so the whole
boot process waited for <code>dhcpcd</code> to get an IP. A much better solution is
to just start netconfig in the background and move on&#8201;&#8212;&#8201;and that&#8217;s
exactly frugalwareutils in git does now.</p></div>
<div class="paragraph"><p>Before:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ systemd-analyze
Startup finished in 2030ms (kernel) + 1166ms (initrd) + 6755ms (userspace) = 9953ms</code></pre>
</div></div>
<div class="paragraph"><p>After:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ systemd-analyze
Startup finished in 2039ms (kernel) + 1146ms (initrd) + 892ms (userspace) = 4079ms</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Again, this is for a virtual machine (where the host has some IO
cache) and for a base-only install.</td>
</tr></table>
</div>
</div>
</div>

  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/systemd-vs-lvm.html">systemd vs. LVM</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Tue 18 January 2011</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 1 minutes</p>
  </div>
  <div class="article_text">
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>Yesterday I
<a href="http://frugalware.org/pipermail/frugalware-git/2011-January/056115.html">enabled</a>
udev support in our LVM package, and that means LVM volumes under
systemd not work as expected. Thanks to Lennart for the quick
<a href="http://article.gmane.org/gmane.comp.sysutils.systemd.devel/1073">answer</a>.
:)</p></div>
</div>
</div>

  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/nationality-of-frugalware-developers.html">Nationality of currently active Frugalware developers</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Fri 14 January 2011</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 1 minutes</p>
  </div>
  <div class="article_text">
    <div id="preamble">
<div class="sectionbody">
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="/pic/nationality-of-frugalware-developers.t.png" alt="/pic/nationality-of-frugalware-developers.t.png" />
</div>
</div>
<div class="paragraph"><p>Just a FYI:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ ./chkacc --verbose
Accepting active developer 'vmiklos' [hu]
Accepting active developer 'iron' [hu]
Accepting active developer 'voroskoi' [hu]
Accepting active developer 'boobaa' [hu]
Accepting active developer 'crazy' [ro]
Accepting active developer 'priyank' [in]
Accepting active developer 'hermier' [fr]
Accepting active developer 'devil505' [fr]
Accepting active developer 'bouleetbil' [fr]
Accepting active developer 'ryuo' [us]
Accepting active developer 'gholafox' [fr]
Accepting active developer 'phayz' [au]
Accepting active developer 'elentir' [fr]
Accepting active developer 'cedynamix' [fr]
Accepting active developer 'jercel' [fr]
Accepting active developer 'exceed' [fr]
Accepting active developer 'dex' [de]
Accepting active developer 'kooda' [fr]
Accepting active developer 'centuri0' [fr]
Accepting active developer 'kikadf' [hu]
Accepting active developer 'pingax' [fr]</code></pre>
</div></div>
</div>
</div>

  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/systemd-3.html">Systemd: kernel, bluetooth, bitlbee</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Mon 27 December 2010</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 1 minutes</p>
  </div>
  <div class="article_text">
    <div id="preamble">
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
Finally I can run systemd on my desktop, and not in a virtual machine
  only, since there is
  <a href="http://thread.gmane.org/gmane.linux.kernel/1080727">a patch</a> for the
  sched/cgroup issue I had. It was not a systemd bug, but systemd
  triggered a kernel issue, which was hidden so far.
</p>
</li>
<li>
<p>
I just
  <a href="http://frugalware.org/pipermail/frugalware-git/2010-December/055098.html">updated
  our bluez package</a>, and bus activation works fine. This means bluetoothd
  is not started till somebody connects to it. Given that I sometimes do
  not log in to KDE to use kbluetooth, but just want to do something on
  the console, where having bluetoothd running is totally unnecessary, I
  consider this really nice.
</p>
</li>
<li>
<p>
It came up on <code>#bitlbee</code> that there is a
  <a href="https://bugzilla.redhat.com/show_bug.cgi?id=662289">Fedora bug</a> where
  they ask for systemd unit files for BitlBee. So I
  <a href="http://bugs.bitlbee.org/bitlbee/ticket/738">created a patch</a>, and the
  nice thing is that the second iteration now seems to be fine for
  Frugalware/Fedora/Debian, so we managed to build something cross-distro
  here. (I think I mentioned that&#8217;s the #1 feature I like in systemd.)
</p>
</li>
</ul></div>
</div>
</div>

  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/systemd-2.html">Systemd Podcast</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Mon 20 December 2010</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 2 minutes</p>
  </div>
  <div class="article_text">
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>I just found
<a href="http://media.libsyn.com/media/linuxoutlaws/linuxoutlaws160.ogg">this</a>
podcast, it&#8217;s a bit dated since it happened in August and things have
been improved a bit since then, but still I was happy to listen it. (The
interesting part starts at 1:10:50; 17 minutes.)</p></div>
<div class="paragraph"><p>I already had a short <a href="https://vmiklos.hu/blog/systemd.html">post</a> about systemd, and I
mentioned the killer feature for me is the compact distro-independent
service file (initscript for sysvinit) format it uses, since even if the
initscript format we use in Frugalware right now is mostly
bullshit-free, it&#8217;s still more bloated than the systemd service files.</p></div>
<div class="paragraph"><p>Now back to why I began writing this post. :) So there is
<a href="http://0pointer.de/blog/projects/systemd.html">the post</a> about systemd,
but it&#8217;s rather long, and it&#8217;s easy to miss the point. Since the
previous post, I think there are a few more killer features in systemd:</p></div>
<div class="ulist"><ul>
<li>
<p>
Every service is started in a separate control group (cgroup). Do you
  remember the situation when you wanted to know who the hell started a
  given particular process? This is typically a problem if the process is
  running as root. Now this is no longer a problem, systemd-cgls will show
  you if it was started by a user or a given service, etc. (Yes, I
  consider this a security feature.)
</p>
</li>
<li>
<p>
Upstart already had this "restart if it crashed" feature, but systemd
  does it better: if the daemon supports socket activation, then
  messages sent to the socket are buffered by the kernel, and no message
  will be lost during the restart.
</p>
</li>
<li>
<p>
systemd provides this on-demand feature, which is pretty much like
  inetd, so hopefully we can get rid of inetd, which was a constant
  problem previously. (We inherited a fork of the OpenBSD inetd from
  Slackware, and being a fork it did not improve since years, causing a
  constant problem.)
</p>
</li>
</ul></div>
<div class="paragraph"><p>Why writing this post today? Because this morning systemd
<a href="http://frugalware.org/packages/103609">appeared</a> in -current, so you can
even <a href="http://wiki.frugalware.org/index.php/Systemd#Installation">try it
out</a> without installing any unofficial package.</p></div>
</div>
</div>

  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/splashy-vs-systemd.html">Splashy vs. systemd</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Wed 15 December 2010</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 2 minutes</p>
  </div>
  <div class="article_text">
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>So we have this <a href="http://wiki.frugalware.org/index.php/Systemd">systemd wip
repo</a> and one of the remaining todo items was to fix up splashy to work
with systemd.</p></div>
<div class="paragraph"><p>First, why doesn&#8217;t it out of the box of systemd is a drop-in
replacement? Because splashy is not a simple init script, it hooks
itself to <code>rc.sysvinit</code>, so it was specific to sysvinit.</p></div>
<div class="paragraph"><p>Now given that plymouth was already ported to systemd, it served as a
good example. You may also ask: why don&#8217;t we just switch to plymouth?
Because:</p></div>
<div class="ulist"><ul>
<li>
<p>
we don&#8217;t want to introduce multiple changes at the same time
</p>
</li>
<li>
<p>
it
  <a href="http://fedoraproject.org/wiki/Releases/FeatureBetterStartup#User_Documentation">requires
  kms</a>, while Splashy did not require it - so as long as it&#8217;s not true
  that most video cards support kms (think of via or anything else which
  supports vesafb, but not kms), such a switch would be a regression
</p>
</li>
</ul></div>
<div class="paragraph"><p>Okay, enough anti-Plymouth rant. As you can see, right now the task is to fix Splashy.</p></div>
<div class="paragraph"><p>The steps I did were:</p></div>
<div class="ulist"><ul>
<li>
<p>
updated the Splashy theme to remove the progressbar: given that now we
  start services parallel and on-demand, it does not really make too
  much sense
</p>
</li>
<li>
<p>
introduced unit files: to start on boot, to stop before getty/xorg, to
  start before kexec/reboot/halt/poweroff
</p>
</li>
<li>
<p>
added the usual compatibility symlinks to avoid starting the old
  rc.splash (which would happen anyway)
</p>
</li>
<li>
<p>
added a simple wrapper that fires up splashy and once it&#8217;s ready it
  sends the Booting&#8230;/Rebooting&#8230;/etc text to it
</p>
</li>
</ul></div>
<div class="paragraph"><p>The last problem is a bit more complex: now that xorg startup wants to
stop splashy, a dependency has to be declared. xorg startup is handled
by <code>prefdm.service</code>, but in case it depends on <code>splashy-quit.service</code>,
what will happen if you don&#8217;t have or don&#8217;t want a splash?</p></div>
<div class="paragraph"><p>The solution for now is to declare an <code>After=</code> relation: that means xorg
startup will happen after the quit of splashy, if it happens at all.</p></div>
<div class="paragraph"><p>This way:</p></div>
<div class="ulist"><ul>
<li>
<p>
you can disable the splash, it won&#8217;t cause any dependency errors
</p>
</li>
<li>
<p>
if you don&#8217;t have <code>prefdm.service</code> enabled, you can even have splashy
  uninstalled
</p>
</li>
<li>
<p>
(this one is a bit ugly) you can disable the splash, but if you
  uninstall it and have <code>prefdm.service</code> enabled, you&#8217;ll get a
  dependency error, as systemd will have no idea what
  <code>splashy-quit.service</code> is.
</p>
</li>
</ul></div>
<div class="paragraph"><p>To test the above:</p></div>
<div class="ulist"><ul>
<li>
<p>
you need to enable the systemd wip repo (see the link above)
</p>
</li>
<li>
<p>
run <code>pacman-g2 -Sy systemd</code>
</p>
</li>
<li>
<p>
boot with <code>init=/bin/systemd</code>
</p>
</li>
</ul></div>
<div class="paragraph"><p>Stay tuned, we still have a few blocker issues before merging the
(disabled by default, as you need that kernel parameter) systemd support
to current.</p></div>
</div>
</div>

  </div>
</article>

<footer>
<div id="paginator">
<a href="https://vmiklos.hu/blog/category/frugalware2.html" class="button_accent">&larr; Older Posts</a>

</div>
</footer>

    <div id="ending_message">
      <p>&copy; Miklos Vajna. Built using <a href="http://getpelican.com" target="_blank">Pelican</a>. Theme by Giulio Fidente on <a href="https://github.com/gfidente/pelican-svbhack" target="_blank">github</a>. </p>
    </div>
  </main>
</body>
</html>