<!DOCTYPE html>
<html lang="en">

<head>
  <!-- ## for client-side less
  <link rel="stylesheet/less" type="text/css" href="https://vmiklos.hu/blog/theme/css/style.less">
  <script src="http://cdnjs.cloudflare.com/ajax/libs/less.js/1.7.3/less.min.js" type="text/javascript"></script>
  -->
  <link rel="stylesheet" type="text/css" href="https://vmiklos.hu/blog/theme/css/style.css">
  <link rel="stylesheet" type="text/css" href="https://vmiklos.hu/blog/theme/css/pygments.css">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Miklos Vajna">
  <meta name="description" content="Posts and writings by Miklos Vajna">

  <link href="https://vmiklos.hu/blog/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="What is Miklos hacking RSS" />

<link href="https://vmiklos.hu/blog/feeds/libreoffice.rss.xml" type="application/rss+xml" rel="alternate" title="What is Miklos hacking libreoffice Category RSS" />

  <title>
    What is Miklos hacking
&ndash; Category: libreoffice  </title>

<script type="text/javascript">
  var _paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//analytics.vmiklos.hu/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
</head>

<body>
  <aside>
    <div id="user_meta">
      <h2><a href="https://vmiklos.hu/blog">What is Miklos hacking</a></h2>
      <p></p>
      <ul>
        <li><a href="/" target="_blank">Root</a></li>
        <li><a href="https://planet.documentfoundation.org/" target="_blank">LibreOffice Blogs</a></li>
      </ul>
    </div>
  </aside>

  <main>
    <header>
      <p>
      <a href="https://vmiklos.hu/blog">Index</a> &brvbar; <a href="https://vmiklos.hu/blog/archives.html">Archives</a>
      &brvbar; <a href="https://vmiklos.hu/blog/feeds/all.rss.xml">RSS</a>
&gt; Category: libreoffice
&brvbar; <a href="https://vmiklos.hu/blog/feeds/libreoffice.rss.xml">RSS</a>
      </p>
    </header>

<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/sw-ranged-comment-delete-docx.html">Improving deleted commented text ranges in Writer's DOCX filter</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Wed 04 February 2026</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 2 minutes</p>
  </div>
  <div class="article_text">
    <p>If you have a commented text range, which gets deleted while track changes is on and you later save
and load this with Writer's DOCX filter, that works now correctly.</p>
<p>This work is primarily for <a href="https://www.collaboraonline.com/">Collabora Online</a>, but the feature is
available in desktop Writer as well.</p>
<h2 id="motivation">Motivation<a class="headerlink" href="#motivation" title="Permanent link">&para;</a></h2>
<p>It was already possible to comment on text ranges. Comments were also supported inside deletes when
track changes is enabled. These could be already exported to and imported from DOCX in Writer. But
you could not combine these.</p>
<p>With the increasing popularity of commenting text ranges (rather than just inserting a comment with
an anchor), not being able to combine these was annoying.</p>
<h2 id="results-so-far">Results so far<a class="headerlink" href="#results-so-far" title="Permanent link">&para;</a></h2>
<p>Here is how a commented text range inside a delete from DOCX now looks like, note the
semi-transparent comment hinting it's deleted:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-ranged-comment-delete-docx/cool-good.png"><figure><img src="https://share.vmiklos.hu/blog/sw-ranged-comment-delete-docx/cool-good.png"><figcaption>Commented text range, inside a tracked delete, in DOCX, Collabora Online</figcaption></figure></a></p>
<p>As a side effect, this also fixes the behavior in desktop Writer, which crosses out deleted
comments:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-ranged-comment-delete-docx/desktop-good.png"><figure><img src="https://share.vmiklos.hu/blog/sw-ranged-comment-delete-docx/desktop-good.png"><figcaption>Commented text range, inside a tracked delete, in DOCX, desktop</figcaption></figure></a></p>
<p>In the past, the "is this deleted" property was not visible in the render result:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-ranged-comment-delete-docx/cool-bad.png"><figure><img src="https://share.vmiklos.hu/blog/sw-ranged-comment-delete-docx/cool-bad.png"><figcaption>Commented text range, inside a tracked delete, in DOCX, Collabora Online, old bad state</figcaption></figure></a></p>
<p>And it was also bad in desktop Writer:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-ranged-comment-delete-docx/desktop-bad.png"><figure><img src="https://share.vmiklos.hu/blog/sw-ranged-comment-delete-docx/desktop-bad.png"><figcaption>Commented text range, inside a tracked delete, in DOCX, desktop, old bad state</figcaption></figure></a></p>
<p>This required changes to both DOCX import and export: a comment could be deleted or could have an
anchor which is a text range, but you couldn't have both.</p>
<h2 id="how-is-this-implemented">How is this implemented?<a class="headerlink" href="#how-is-this-implemented" title="Permanent link">&para;</a></h2>
<p>If you would like to know a bit more about how this works, continue reading... :-)</p>
<p>As usual, the high-level problem was addressed by a series of small changes. Core side:</p>
<ul>
<li><a href="https://git.libreoffice.org/core/commit/5d101c9919c7c0798df092bd31b828d0a144abba">cool#13988 DOCX import: fix missing delete flag on deleted comments with ranges</a></li>
<li><a href="https://git.libreoffice.org/core/commit/a72506da82d2e0334e23a8c3c1cd07282fdd7ca3">cool#13988 DOCX export: fix missing delete flag on deleted comments with ranges</a></li>
</ul>
<h2 id="want-to-start-using-this">Want to start using this?<a class="headerlink" href="#want-to-start-using-this" title="Permanent link">&para;</a></h2>
<p>You can get a development edition of Collabora Online 25.04 and try it out yourself right now: <a href="https://www.collaboraonline.com/code/">try
the development edition</a>.  Collabora intends to continue
supporting and contributing to LibreOffice, the code is merged so we expect all of this work will be
available in TDF's next release too (26.8).</p>
  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/sd-bullet-improvements.html">Bullet improvements in Impress</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Mon 05 January 2026</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 3 minutes</p>
  </div>
  <div class="article_text">
    <p>The bullet support in Impress got a couple of improvements recently, some of this is PPTX support
and others are general UI improvements.</p>
<p>This work is primarily for <a href="https://www.collaboraonline.com/">Collabora Online</a>, but the feature is
available in desktop Impress as well.</p>
<h2 id="motivation">Motivation<a class="headerlink" href="#motivation" title="Permanent link">&para;</a></h2>
<p>Probably the most simple presentations are just a couple of slides, each slide having a title shape
and an outliner shape, containing some bullets, perhaps with some additional images. Images are just
bitmaps, so let's focus on outliner shapes and their outliner / bullet styles.</p>
<p>What happens if you save these to PPTX and load it back? Can you toggle between a numbering and a
bullet? Can you return to an outliner style after you had direct formatting for your bullet?</p>
<h2 id="results-so-far">Results so far<a class="headerlink" href="#results-so-far" title="Permanent link">&para;</a></h2>
<p>The first case was about bullet editing of this document:</p>
<p><a href="https://share.vmiklos.hu/blog/sd-bullet-improvements/sd-bullet-improvements-1.png"><figure><img src="https://share.vmiklos.hu/blog/sd-bullet-improvements/sd-bullet-improvements-1.png"><figcaption>Outliner shape with 3 outliner styles</figcaption></figure></a></p>
<p>If you pressed enter at the end of 'First level', then pressed <code>&lt;tab&gt;</code> to promote the current
paragraph to the second level, nothing happened. The reason for this was that our PPTX export was
missing the list styles of shapes, except for the very first list style. And the same was missing on
the import side, too. With this, not only the rendering of the bullets are OK, but also adding new
paragraphs and using promoting / demoting to change levels work as expected.</p>
<p>The second case was about this document, where the second level had a numbering, not a bullet:</p>
<p><a href="https://share.vmiklos.hu/blog/sd-bullet-improvements/sd-bullet-improvements-2.png"><figure><img src="https://share.vmiklos.hu/blog/sd-bullet-improvements/sd-bullet-improvements-2.png"><figcaption>Outliner shape with a numbering on the second level</figcaption></figure></a></p>
<p>We only had UI to first toggle off a numbering to no numbering, then you could toggle on bullets.
Now it's possible to do this change in one step.</p>
<p>The last case was about styles. Imagine that you had a master page with an outline shape and some
reasonably looking configuration for the first and second levels as outline styles:</p>
<p><a href="https://share.vmiklos.hu/blog/sd-bullet-improvements/sd-bullet-improvements-3.png"><figure><img src="https://share.vmiklos.hu/blog/sd-bullet-improvements/sd-bullet-improvements-3.png"><figcaption>Outliner shape with two outline styles</figcaption></figure></a></p>
<p>Notice how the last paragraph has a slightly inconsistent formatting, due to direct formatting.
Let's fix this.</p>
<p>Go to the end of the last bullet, which is currently not connected to an outline style, toggle
bullets off and then toggle it on again. Now we clear direct formatting when we turn off the bullet,
so next time you turn bullets on, it'll be again connected to the outline style's bullet
configuration and the content will look better.</p>
<p>Note how this even improves consistency: Writer was behaving the same way already, when toggling
bullets off and then toggle on again resulted in getting rid of previously applied unwanted direct
formatting.</p>
<h2 id="how-is-this-implemented">How is this implemented?<a class="headerlink" href="#how-is-this-implemented" title="Permanent link">&para;</a></h2>
<p>If you would like to know a bit more about how this works, continue reading... :-)</p>
<p>As usual, the high-level problem was addressed by a series of small changes. Core side:</p>
<ul>
<li><a href="https://git.libreoffice.org/core/commit/6a8b96ddd47af2be3f06e299ee7058438083ba5b">PPTX export: fix missing non-first level list style for outline shapes</a></li>
<li><a href="https://git.libreoffice.org/core/commit/ccb9e9ef70c4fae3f69b63083cab838794a3d46d">sd doc model dump: allow invoking this from outside sd/ in a debugger</a></li>
<li><a href="https://git.libreoffice.org/core/commit/e96f2ef1a299c95d83c6a7945fcc92f8f1833112">sd doc model xml dump: show styles</a></li>
<li><a href="https://git.libreoffice.org/core/commit/cb108a10479e72b63d32cae020a4ac178e763d14">tdf#168559 PPTX imp: fix missing custom level list style for outline shapes</a></li>
<li><a href="https://git.libreoffice.org/core/commit/b2c5d52f733cca2656daa0a2cfdd85a1108635f4">tdf#168559 PPTX imp: fix missing list style for outline shapes on master pages</a></li>
<li><a href="https://git.libreoffice.org/core/commit/f60ee00edcc5b0fdee5227bb695448119cddb013">tdf#89365 sd UI: fix transitioning from a numbered list to a bulleted list</a></li>
<li><a href="https://git.libreoffice.org/core/commit/0856eee636f512ae2cffc141b7ab3b5065d8beda">tdf#169275 sd UI: clear direct format when turning off bullet/num</a></li>
<li><a href="https://git.libreoffice.org/core/commit/122ff49f6ee6b88386cd30a542a92b04c508e47a">sd: extract <code>FN_TRANSFORM_DOCUMENT_STRUCTURE</code> handling to a new function</a></li>
<li><a href="https://git.libreoffice.org/core/commit/1dc25f541784b5e50210af1d5ffb619ec55220f1">sd, FuBulletAndPosition: avoid magic number for bullet toggle</a></li>
<li><a href="https://git.libreoffice.org/core/commit/a26e176abcd40438d19e2a9012db1342bdcaba12">Related: tdf#89365 sd UI, from numbering to bullet: fix defaults</a></li>
</ul>
<h2 id="want-to-start-using-this">Want to start using this?<a class="headerlink" href="#want-to-start-using-this" title="Permanent link">&para;</a></h2>
<p>You can get a development edition of Collabora Online 25.04 and try it out yourself right now: <a href="https://www.collaboraonline.com/code/">try
the development edition</a>.  Collabora intends to continue
supporting and contributing to LibreOffice, the code is merged so we expect the core of this work
will be available in TDF's next release too (26.2).</p>
  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/sw-markdown-templating.html">Markdown import in Writer: the new template option</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Wed 03 December 2025</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 3 minutes</p>
  </div>
  <div class="article_text">
    <p>Writer recently got a new markdown import option to take styles from a template, leading to much
prettier output when converting markdown to PDF, DOCX or ODT.</p>
<p>This work is primarily for <a href="https://www.collaboraonline.com/">Collabora Online</a>, but the templating
feature is available in desktop Writer as well.</p>
<h2 id="motivation">Motivation<a class="headerlink" href="#motivation" title="Permanent link">&para;</a></h2>
<p>A <a href="https://vmiklos.hu/blog/sw-markdown-filter.html">previous post</a> mentioned recent improvements to the
markdown import/export in Writer.</p>
<p>But if you convert some markdown to e.g. PDF, all the headings just have the default look, wouldn't
it be nice to take your organization template and add colors and other formatting there,
automatically?</p>
<p>Also, wouldn't it be nice if you could paste as markdown in COOL or copy the current selection as
markdown? Which would enable all sorts of interesting use-cases, like using an external API to turn
the selection into a summary or translating it to a different language.</p>
<h2 id="results-so-far">Results so far<a class="headerlink" href="#results-so-far" title="Permanent link">&para;</a></h2>
<p>Here is a sample input markdown:</p>
<div class="highlight"><pre><span></span><code><span class="gh"># heading 1</span>

body text
</code></pre></div>

<p>Here is how it looks like if you template it using the core.git <code>sw/qa/filter/md/data/template.docx</code>
sample:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-markdown-templating/templated.png"><figure><img src="https://share.vmiklos.hu/blog/sw-markdown-templating/templated.png"><figcaption>PDF result: templated</figcaption></figure></a></p>
<p>curl invocation for this:</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-k<span class="w"> </span>-F<span class="w"> </span><span class="s2">&quot;data=@/path/to/test.md&quot;</span><span class="w"> </span>-F<span class="w"> </span><span class="s2">&quot;template=@/path/to/template.docx&quot;</span><span class="w"> </span>-F<span class="w"> </span><span class="s2">&quot;format=pdf&quot;</span><span class="w"> </span>-o<span class="w"> </span>out.pdf<span class="w"> </span>https://localhost:9980/cool/convert-to
</code></pre></div>

<p>Or example desktop command-line:</p>
<div class="highlight"><pre><span></span><code>soffice<span class="w"> </span>--infilter<span class="o">=</span><span class="s1">&#39;Markdown:{&quot;TemplateURL&quot;:{&quot;type&quot;:&quot;string&quot;,&quot;value&quot;:&quot;./template.ott&quot;}}&#39;</span><span class="w"> </span>test.md
</code></pre></div>

<p>While it would look like this by default:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-markdown-templating/default.png"><figure><img src="https://share.vmiklos.hu/blog/sw-markdown-templating/default.png"><figcaption>PDF result: default</figcaption></figure></a></p>
<p>The other part is the PostMessage API of COOL, if you want to copy and paste as markdown. What's
newly possible:</p>
<ul>
<li>Copy the current selection: set MessageId to <code>Action_Copy</code> and the value to <code>{"Mimetype": "text/markdown;charset=utf-8"}</code></li>
<li>Paste at the current cursor position: set MessageId to <code>Action_Paste</code> and the value to
  something like <code>{"Mimetype": "text/markdown;charset=utf-8", "Data": "foo _bar_ baz"}</code></li>
</ul>
<p>You can read more about the PostMessage API in the <a href="https://sdk.collaboraonline.com/docs/postmessage_api.html">COOL
SDK</a>.</p>
<h2 id="how-is-this-implemented">How is this implemented?<a class="headerlink" href="#how-is-this-implemented" title="Permanent link">&para;</a></h2>
<p>If you would like to know a bit more about how this works, continue reading... :-)</p>
<p>As usual, the high-level problem was addressed by a series of small changes. Core side:</p>
<ul>
<li><a href="https://git.libreoffice.org/core/commit/7462639341c043bf72560e0ddfff06e1e8879859">tdf#169316 sw markdown import: add a TemplateURL parameter</a></li>
<li><a href="https://git.libreoffice.org/core/commit/6d1312e160ee8c2c0f65b6e0a86333bf3c9c60ce">tdf#169316 sw markdown import, template: handle non-ODF formats as well</a></li>
<li><a href="https://git.libreoffice.org/core/commit/64cf69926b7cb6fc94efd792b173ac12aa93cb8f">cool#13468 sw markdown paste: add UNO command parameter to skip the detection</a></li>
<li><a href="https://git.libreoffice.org/core/commit/5ae32bee8dfe5b3264debc02276a3eeac7f51021">Related: tdf#169251 sw markdown export: fix crash on OLE with no graphic</a></li>
</ul>
<p>Online side:</p>
<ul>
<li><a href="https://github.com/collaboraonline/online/commit/5741a8fe91f9fe2969926cf70c8c51f1dd144ad5">cool#13419 convert-to template option: handle multiple streams in ConvertToPartHandler</a></li>
<li><a href="https://github.com/collaboraonline/online/commit/31109066f2ea2b935cd9d2bc06b5debc6206b41a">cool#13419 convert-to template option: pass it to doc broker</a></li>
<li><a href="https://github.com/collaboraonline/online/commit/3916a7f82fd6454409b86b9915d33f9f2491a348">cool#13419 convert-to template option: pass it to the kit process</a></li>
<li><a href="https://github.com/collaboraonline/online/commit/b993c314e1b50aea382a1dac7391a3949e65045b">cool#13419 convert-to template option: more strict param name, generalize filenames</a></li>
<li><a href="https://github.com/collaboraonline/online/commit/852479accd67880934393f14c4101ad72e9ba806">cool#13419 convert-to template option: add testcase</a></li>
<li><a href="https://github.com/collaboraonline/online/commit/81881d58fd537924091a5e2e41d033e91c98c8be">cool#13468 PostMessage API: allow copying the current text selection</a></li>
</ul>
<h2 id="want-to-start-using-this">Want to start using this?<a class="headerlink" href="#want-to-start-using-this" title="Permanent link">&para;</a></h2>
<p>You can get a development edition of Collabora Online 25.04 and try it out yourself right now: <a href="https://www.collaboraonline.com/code/">try
the development edition</a>.  Collabora intends to continue
supporting and contributing to LibreOffice, the code is merged so we expect the core of this work
will be available in TDF's next release too (26.2).</p>
  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/sw-interdependent-redline-improvements4.html">Interdependent tracked changes improvements in Writer, part 4: direct accept/reject</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Tue 04 November 2025</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 3 minutes</p>
  </div>
  <div class="article_text">
    <p>Writer has some support for interdependent (or hierarchical) tracked changes: e.g. the case when you
have a delete on top of an insert. See the <a href="https://vmiklos.hu/blog/sw-interdependent-redline-improvements3.html">third
post</a> for background.</p>
<p>This work is primarily for <a href="https://www.collaboraonline.com/">Collabora Online</a>, but the feature is
available in desktop Writer as well.</p>
<h2 id="motivation">Motivation<a class="headerlink" href="#motivation" title="Permanent link">&para;</a></h2>
<p>Interdependent changes mean that the UI shows one type of change on top of another change, e.g.
formatting on top of insert. Writer knows the priority of each type, so in case you have an insert
or delete change and on top of that you have a formatting, then the UI will look "through" the
formatting and work on the underlying insert or delete when you navigate with your cursor to a
position with multiple changes and you press Accept on the Review tab of the notebookbar.</p>
<p>Usually this is what you mean, but what if you want to work on the formatting at the top, directly?
You can now open the Manage Changes dialog using the Manage button on the Review tab of the
notebookbar and if you go to the formatting change row of the dialog, then pressing Accept there
will accept the formatting change, not the insert or delete change. This is possible, because the dialog
gives you a way to precisely select which tracked change you want to work with, even if a specific
cursor position has multiple tracked changes.</p>
<h2 id="results-so-far">Results so far<a class="headerlink" href="#results-so-far" title="Permanent link">&para;</a></h2>
<p>Here is a sample <code>ins-then-format.docx</code> document from the core.git testcases, the baseline has an
insertion, and part of that is covered by an additional formatting change on top:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-interdependent-redline-improvements4/baseline.png"><figure><img src="https://share.vmiklos.hu/blog/sw-interdependent-redline-improvements4/baseline.png"><figcaption>Interdependent tracked change: baseline</figcaption></figure></a></p>
<p>If you just go in the middle of the document and press Accept, that will work with the more
important insert change, so the result looks like this:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-interdependent-redline-improvements4/default-accept-result.png"><figure><img src="https://share.vmiklos.hu/blog/sw-interdependent-redline-improvements4/default-accept-result.png"><figcaption>Interdependent tracked change: default accept result</figcaption></figure></a></p>
<p>But now you can also open the Manage Changes dialog, to be more specific by directly selecting the
formatting change:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-interdependent-redline-improvements4/direct-accept.png"><figure><img src="https://share.vmiklos.hu/blog/sw-interdependent-redline-improvements4/direct-accept.png"><figcaption>Interdependent tracked change: direct accept via the dialog</figcaption></figure></a></p>
<p>And when you accept the formatting change directly, the result will be just the insert change:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-interdependent-redline-improvements4/direct-accept-result.png"><figure><img src="https://share.vmiklos.hu/blog/sw-interdependent-redline-improvements4/direct-accept-result.png"><figcaption>Interdependent tracked change: direct accept result</figcaption></figure></a></p>
<p>You can save and load the results in both DOCX and ODT, as usual.</p>
<h2 id="how-is-this-implemented">How is this implemented?<a class="headerlink" href="#how-is-this-implemented" title="Permanent link">&para;</a></h2>
<p>If you would like to know a bit more about how this works, continue reading... :-)</p>
<p>As usual, the high-level problem was addressed by a series of small changes. Core side:</p>
<ul>
<li><a href="https://git.libreoffice.org/core/commit/55640f9f0a4741f8e4b5b98096af822cee71da2c">tdf#166319 sw interdependent redlines: allow accept/reject for fmt on ins/del</a></li>
<li><a href="https://git.libreoffice.org/core/commit/d04ab0febcf660e87d19574adc08f9f2af75509f">tdf#166319 sw interdependent redlines: fix redo of accept for fmt on ins/del</a></li>
<li><a href="https://git.libreoffice.org/core/commit/1e3b8177aef8cc3a242cd9fd41d492f2fd89d21e">tdf#166319 sw interdependent redlines: fix redo of direct reject for format</a></li>
</ul>
<h2 id="want-to-start-using-this">Want to start using this?<a class="headerlink" href="#want-to-start-using-this" title="Permanent link">&para;</a></h2>
<p>You can get a development edition of Collabora Online 25.04 and try it out yourself right now: <a href="https://www.collaboraonline.com/code/">try
the development edition</a>.  Collabora intends to continue
supporting and contributing to LibreOffice, the code is merged so we expect all of this work will be
available in TDF's next release too (26.2).</p>
  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/sw-markdown-filter.html">Markdown import/export in Writer</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Tue 07 October 2025</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 3 minutes</p>
  </div>
  <div class="article_text">
    <p>Writer recently got a Markdown import &amp; export filter and there were a number of improvements to
that.</p>
<p>This work is primarily for <a href="https://www.collaboraonline.com/">Collabora Online</a>, but the feature is
available in desktop Writer as well.</p>
<h2 id="motivation">Motivation<a class="headerlink" href="#motivation" title="Permanent link">&para;</a></h2>
<p>Ujjawal Kumar contributed a markdown import to Writer, as part of Google Summer of Code (GSoC) this
summer. Mike Kaganski of Collabora also created a minimal markdown export in Writer. I looked at the
feature differences between the two, and filled in various gaps in the markdown export. I also added
a few general markdown import/export improvements relevant for normal Writer documents, like
embedded image support.</p>
<h2 id="results-so-far">Results so far<a class="headerlink" href="#results-so-far" title="Permanent link">&para;</a></h2>
<p>Here is a sample case of a document using inline code spans:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-markdown-filter/1-code-baseline.png"><figure><img src="https://share.vmiklos.hu/blog/sw-markdown-filter/1-code-baseline.png"><figcaption>Code span: baseline</figcaption></figure></a></p>
<p>Exporting this to markdown &amp; loading back to Writer, the code span was lost:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-markdown-filter/1-code-old.png"><figure><img src="https://share.vmiklos.hu/blog/sw-markdown-filter/1-code-old.png"><figcaption>Code span: old result</figcaption></figure></a></p>
<p>And now it's preserved:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-markdown-filter/1-code-new.png"><figure><img src="https://share.vmiklos.hu/blog/sw-markdown-filter/1-code-new.png"><figcaption>Code span: new result</figcaption></figure></a></p>
<p>This also works with code blocks.</p>
<p>Second, here is a document with lists:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-markdown-filter/2-list-baseline.png"><figure><img src="https://share.vmiklos.hu/blog/sw-markdown-filter/2-list-baseline.png"><figcaption>Lists: baseline</figcaption></figure></a></p>
<p>Exporting this to markdown &amp; loading back to Writer, the lists were lost:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-markdown-filter/2-list-old.png"><figure><img src="https://share.vmiklos.hu/blog/sw-markdown-filter/2-list-old.png"><figcaption>Lists: old result</figcaption></figure></a></p>
<p>And now they are preserved:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-markdown-filter/2-list-new.png"><figure><img src="https://share.vmiklos.hu/blog/sw-markdown-filter/2-list-new.png"><figcaption>Lists: new result</figcaption></figure></a></p>
<p>This also works with nested lists.</p>
<p>Third, here is a document with an image:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-markdown-filter/3-image-baseline.png"><figure><img src="https://share.vmiklos.hu/blog/sw-markdown-filter/3-image-baseline.png"><figcaption>Image: baseline</figcaption></figure></a></p>
<p>Exporting this to markdown &amp; loading back to Writer, the image was lost:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-markdown-filter/3-image-old.png"><figure><img src="https://share.vmiklos.hu/blog/sw-markdown-filter/3-image-old.png"><figcaption>Image: old result</figcaption></figure></a></p>
<p>And now it's preserved:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-markdown-filter/3-image-new.png"><figure><img src="https://share.vmiklos.hu/blog/sw-markdown-filter/3-image-new.png"><figcaption>Image: new result</figcaption></figure></a></p>
<p>This also works with embedded and anchored images.</p>
<p>Fourth, here is a document with a table:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-markdown-filter/4-table-baseline.png"><figure><img src="https://share.vmiklos.hu/blog/sw-markdown-filter/4-table-baseline.png"><figcaption>Table: baseline</figcaption></figure></a></p>
<p>Exporting this to markdown &amp; loading back to Writer, the table was lost:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-markdown-filter/4-table-old.png"><figure><img src="https://share.vmiklos.hu/blog/sw-markdown-filter/4-table-old.png"><figcaption>Table: old result</figcaption></figure></a></p>
<p>And now it's preserved:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-markdown-filter/4-table-new.png"><figure><img src="https://share.vmiklos.hu/blog/sw-markdown-filter/4-table-new.png"><figcaption>Table: new result</figcaption></figure></a></p>
<p>This also works with table alignments and nested tables (to the extent the markdown markup allows
that).</p>
<p>Fifth, here is a document with a quote block:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-markdown-filter/5-quote-baseline.png"><figure><img src="https://share.vmiklos.hu/blog/sw-markdown-filter/5-quote-baseline.png"><figcaption>Quote: baseline</figcaption></figure></a></p>
<p>Exporting this to markdown &amp; loading back to Writer, the quote's paragraph indentation was lost:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-markdown-filter/5-quote-old.png"><figure><img src="https://share.vmiklos.hu/blog/sw-markdown-filter/5-quote-old.png"><figcaption>Quote: old result</figcaption></figure></a></p>
<p>And now it's preserved:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-markdown-filter/5-quote-new.png"><figure><img src="https://share.vmiklos.hu/blog/sw-markdown-filter/5-quote-new.png"><figcaption>Quote: new result</figcaption></figure></a></p>
<h2 id="how-is-this-implemented">How is this implemented?<a class="headerlink" href="#how-is-this-implemented" title="Permanent link">&para;</a></h2>
<p>If you would like to know a bit more about how this works, continue reading... :-)</p>
<p>As usual, the high-level problem was addressed by a series of small changes. Core side:</p>
<ul>
<li><a href="https://git.libreoffice.org/core/commit/55393d9cc42b0402362022594b04ab4888257fb7">desktop lok, doc save: register .md for Markdown</a></li>
<li><a href="https://git.libreoffice.org/core/commit/959c448e9531a53e068e4cec3a56b0caf0e0d3d1">sw markdown export: handle code</a></li>
<li><a href="https://git.libreoffice.org/core/commit/bcef97f29a7126cb3469066de4bacafaae30f86a">tdf#168152 sw markdown export: handle lists</a></li>
<li><a href="https://git.libreoffice.org/core/commit/fefd59b58c7d87e034fbf1c45cefa6a87ed09976">tdf#168172 sw markdown export: handle images</a></li>
<li><a href="https://git.libreoffice.org/core/commit/f073d733568d3b635ac8b2c3a5081afd679b4915">tdf#167564 sw markdown export: handle tables</a></li>
<li><a href="https://git.libreoffice.org/core/commit/c94b0c7ace10f5913aa53b593aa0ccd544df3cc3">sw markdown export: handle block quote</a></li>
<li><a href="https://git.libreoffice.org/core/commit/85aa1402c670e8c85949c5aaf01f529a0a59c05b">tdf#168317 sw markdown export: handle code block</a></li>
<li><a href="https://git.libreoffice.org/core/commit/5d0022c28b149dcc1db22176e442d130ff8d0279">sw markdown export: handle table cell adjustment</a></li>
<li><a href="https://git.libreoffice.org/core/commit/b7bc0e5f3999950d6b5f0d2bdcda2c6cc2f04e61">tdf#168341 sw markdown filter: handle links on images</a></li>
<li><a href="https://git.libreoffice.org/core/commit/f63c14c9e45d795c6d5927103181c8d0ede8a34b">sw markdown export: handle line breaks</a></li>
<li><a href="https://git.libreoffice.org/core/commit/3a294f97a9b37cc8ff38f76200b5b58879a3a72f">tdf#168446 sw markdown export: improve image name/description/title handling</a></li>
<li><a href="https://git.libreoffice.org/core/commit/852d8b06bcecc5c68194fced94e4c7af02086c52">tdf#167564 sw markdown export: handle multi-para table cells</a></li>
<li><a href="https://git.libreoffice.org/core/commit/c830c9ab824c8086b2124fec44f834a1d0ae4fa5">tdf#167564 sw markdown export: handle nested table cells</a></li>
<li><a href="https://git.libreoffice.org/core/commit/7608d96302652eb48863da441e121e0c61350412">tdf#168617 sw markdown filter: map tasks to checkbox content controls and back</a></li>
<li><a href="https://git.libreoffice.org/core/commit/169e1f3b914ac590b3719b8129b4f0913d4da228">sw markdown filter: import images with 'data:' URLs</a></li>
<li><a href="https://git.libreoffice.org/core/commit/8d60fcdac9bc79c7b8956ed3cd9e9f518b28c119">sw markdown filter: export non-linked inline images</a></li>
<li><a href="https://git.libreoffice.org/core/commit/3c29e1277bda566b4455123a7a53c8f0fc6eda98">tdf#168662 sw markdown export: extract inline image export functions</a></li>
<li><a href="https://git.libreoffice.org/core/commit/e0601a598977265c5b05ba397bce04d9689fca4b">tdf#168662 sw markdown export: handle anchored images</a></li>
</ul>
<h2 id="want-to-start-using-this">Want to start using this?<a class="headerlink" href="#want-to-start-using-this" title="Permanent link">&para;</a></h2>
<p>You can get a development edition of Collabora Online 25.04 and try it out yourself right now: <a href="https://www.collaboraonline.com/code/">try
the development edition</a>.  Collabora intends to continue
supporting and contributing to LibreOffice, the code is merged so we expect all of this work will be
available in TDF's next release too (26.2).</p>
  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/sw-interdependent-redline-improvements3.html">Interdependent tracked changes improvements in Writer, part 3</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Tue 09 September 2025</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 3 minutes</p>
  </div>
  <div class="article_text">
    <p>Writer has some support for interdependent (or hierarchical) tracked changes: e.g. the case when you
have a delete on top of an insert. See the <a href="https://vmiklos.hu/blog/sw-interdependent-redline-improvements2.html">second
post</a> for background.</p>
<p>This work is primarily for <a href="https://www.collaboraonline.com/">Collabora Online</a>, but the feature is
available in desktop Writer as well.</p>
<h2 id="motivation">Motivation<a class="headerlink" href="#motivation" title="Permanent link">&para;</a></h2>
<p>With the already mentioned improvements in place, the area of format redlines with character style
or direct formatting changes were still lacking: Writer's original model here was just marking a
text range as "formatted" and then either accept the format redline as-is, or reject reverting back
to the paragraph style (default formatting), losing the old character style or old direct
formatting.</p>
<h2 id="results-so-far">Results so far<a class="headerlink" href="#results-so-far" title="Permanent link">&para;</a></h2>
<p>Here is a sample case of a document where the old character style is Strong (~bold) and the font
size is 24pt, while the new character style is Quote (~italic) and the font size is 36pt. The rest
of the document uses no specific character styles and has the font size of 12pt:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-interdependent-redline-improvements3/1-baseline.png"><figure><img src="https://share.vmiklos.hu/blog/sw-interdependent-redline-improvements3/1-baseline.png"><figcaption>Interdependent tracked change: improved format, after document load</figcaption></figure></a></p>
<p>Rejecting that format redline resulted in just the defaults, i.e. no character style and 12pt font
size:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-interdependent-redline-improvements3/2-edit-old.png"><figure><img src="https://share.vmiklos.hu/blog/sw-interdependent-redline-improvements3/2-edit-old.png"><figcaption>Interdependent tracked change: old reject, lost character style / direct format</figcaption></figure></a></p>
<p>But now we track the old character style &amp; direct format:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-interdependent-redline-improvements3/3-edit-new.png"><figure><img src="https://share.vmiklos.hu/blog/sw-interdependent-redline-improvements3/3-edit-new.png"><figcaption>Interdependent tracked change: new reject, handled character style / direct format</figcaption></figure></a></p>
<p>This required changes in the DOCX import, ODF import and ODF export, too.</p>
<h2 id="how-is-this-implemented">How is this implemented?<a class="headerlink" href="#how-is-this-implemented" title="Permanent link">&para;</a></h2>
<p>If you would like to know a bit more about how this works, continue reading... :-)</p>
<p>As usual, the high-level problem was addressed by a series of small changes. Core side:</p>
<ul>
<li><a href="https://git.libreoffice.org/core/commit/7aa34659e2b49bf02a95a17f51e78f3ab9683235">sw: document DocumentRedlineManager</a></li>
<li><a href="https://git.libreoffice.org/core/commit/da3da0635a30f9b61a913bd7553b5e1278bf260e">sw: document IDocumentRedlineAccess</a></li>
<li><a href="https://git.libreoffice.org/core/commit/b2919d5b5ee4e057c99219f5541efc388b2d19b7">sw doc model xml dump: show the item set of a format redline</a></li>
<li><a href="https://git.libreoffice.org/core/commit/d7bf3a17cb27da1a58163e9db657f0a8d8344901">tdf#166319 sw interdependent redlines: fix redo of accept of ins-then-fmt's fmt</a></li>
<li><a href="https://git.libreoffice.org/core/commit/f66d63da05dbe2f254ffaf428257684a38523f66">tdf#166319 sw interdependent redlines: handle deleting a self ins-then-fmt</a></li>
<li><a href="https://git.libreoffice.org/core/commit/1ba53f5ebbd57b7baf72240784d18954688a09b9">tdf#166319 sw interdependent redlines: fix redo of reject of del-then-fmt's fmt</a></li>
<li><a href="https://git.libreoffice.org/core/commit/e545ada3501780ee6552bbfa19954794e0440d46">tdf#167194 sw redline reinstate: fix handling of self-inserts</a></li>
<li><a href="https://git.libreoffice.org/core/commit/2db0a779944f9496371b3ba68f7494c635ad431d">tdf#167761 sw format redline: register the item set in the autostyle pool</a></li>
<li><a href="https://git.libreoffice.org/core/commit/b78bdc9eb15fedd22ece76aeb1b43df40caf3b82">tdf#167761 sw format redline: implement ODF export</a></li>
<li><a href="https://git.libreoffice.org/core/commit/0e21f3b36cbd12787021c3b8ef439aab9a09efdd">tdf#167761 sw format redline, char props: implement ODF import</a></li>
<li><a href="https://git.libreoffice.org/core/commit/a6d8608595fd1ecfdff35c2003a28589ea1214ad">tdf#167761 sw format redline, char style: implement DOCX import</a></li>
<li><a href="https://git.libreoffice.org/core/commit/0ba6dd9eb3f342345663b12527a29425675d2078">tdf#167761 sw format redline, char style: implement ODF import</a></li>
<li><a href="https://git.libreoffice.org/core/commit/43104ad996bc9b292b66d9e605632407cb59c4c6">tdf#167761 sw format redline, char style: fix missing encode in ODF filter</a></li>
<li><a href="https://git.libreoffice.org/core/commit/c625247680cd5737723154b9a73c45e786611b44">tdf#167761 sw format redline, char style+direct: add ODT export</a></li>
<li><a href="https://git.libreoffice.org/core/commit/bbebb3908ff9a9c384a475737ead537906517387">tdf#167761 sw format redline, char style+direct: add ODT import</a></li>
</ul>
<h2 id="want-to-start-using-this">Want to start using this?<a class="headerlink" href="#want-to-start-using-this" title="Permanent link">&para;</a></h2>
<p>You can get a development edition of Collabora Online 25.04 and try it out yourself right now: <a href="https://www.collaboraonline.com/code/">try
the development edition</a>.  Collabora intends to continue
supporting and contributing to LibreOffice, the code is merged so we expect all of this work will be
available in TDF's next release too (26.2).</p>
  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/sw-floattable12.html">Multi-page floating tables in Writer: keep together or not</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Fri 15 August 2025</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 3 minutes</p>
  </div>
  <div class="article_text">
    <p>This post is part of a series to describe how Writer now gets a feature to handle tables that are
both floating and span over multiple pages.</p>
<p>This work is primarily for <a href="https://www.collaboraoffice.com/">Collabora Online</a>, but is useful on
the desktop as well. See the <a href="https://vmiklos.hu/blog/sw-floattable11.html">11th post</a> for the previous part.</p>
<h2 id="motivation">Motivation<a class="headerlink" href="#motivation" title="Permanent link">&para;</a></h2>
<p>Previous posts described the hardest part of multi-page floating tables: making sure that text can
wrap around them and they can split across pages. In this part, we'll look at a conflicting
requirement. On one hand, headings want their text to not split across pages (and shapes anchored
into paragraphs are considered part of the paragraph, too). On the other hand, it should be OK to
have a floating table at the bottom of a page and the following heading to go to the next page.</p>
<p>It turns out, Writer gave "keep together" a priority, while Word gave "floating tables are OK to
split to a previous page" a priority.</p>
<p>Note that if you have a shape (e.g. a triangle) and not a floating table, then both Word and Writer
prevents the move of that shape to a previous page (if the shape is anchored in a heading); this
difference was there just for floating tables.</p>
<h2 id="results-so-far">Results so far<a class="headerlink" href="#results-so-far" title="Permanent link">&para;</a></h2>
<p>Here is how the <a href="https://bugs.documentfoundation.org/show_bug.cgi?id=167222">tdf#167222</a> bugdoc
looks like now in Writer:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-floattable12/new.png"><figure><img src="https://share.vmiklos.hu/blog/sw-floattable12/new.png"><figcaption>Floating table, followed by heading: new Writer render</figcaption></figure></a></p>
<p>And here is how it used to look like:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-floattable12/old.png"><figure><img src="https://share.vmiklos.hu/blog/sw-floattable12/old.png"><figcaption>Floating table, followed by heading: old Writer render</figcaption></figure></a></p>
<p>And here is the reference rendering:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-floattable12/ref.png"><figure><img src="https://share.vmiklos.hu/blog/sw-floattable12/ref.png"><figcaption>Floating table, followed by heading: reference render</figcaption></figure></a></p>
<p>This means that we leave layout for shapes unchanged in general: shapes anchored in headings are
still considered to be part of headings and don't split. But for floating tables, we now allow them
to split and use space at a previous page if they fit there.</p>
<h2 id="how-is-this-implemented">How is this implemented?<a class="headerlink" href="#how-is-this-implemented" title="Permanent link">&para;</a></h2>
<p>If you would like to know a bit more about how this works, continue reading... :-)</p>
<p>As usual, the high-level problem was addressed by a series of small changes:</p>
<ul>
<li><a href="https://git.libreoffice.org/core/commit/77f0dc4347b8802c56121ca1c5ef59209970214a">tdf#167222 sw floattable: allow split of fly and its keep-together anchor text</a></li>
<li><a href="https://git.libreoffice.org/core/commit/44c0872bf5f1b658b126d8d928c795e74c0e8ecd">Related: tdf#167222 sw floattable: fix split of fly and its 'keep' anchor text</a></li>
<li><a href="https://git.libreoffice.org/core/commit/e1522e2b1985f6ebdbf442bdbd55cbc5f2b85dd6">Related: tdf#167222 sw floattable: fix split of fly and its heading text w/ ftn</a></li>
<li><a href="https://git.libreoffice.org/core/commit/a5154c0de7679e2abc78b33b351025ea5e54a479">sw: fix assertion failure in SwFrameShell::Execute()</a></li>
<li><a href="https://git.libreoffice.org/core/commit/e03da71738c72bbaecb824b4ba356a0a9923a0ff">Related: tdf#167222 sw floattable: fix split of fly and heading text fit check</a></li>
</ul>
<h2 id="want-to-start-using-this">Want to start using this?<a class="headerlink" href="#want-to-start-using-this" title="Permanent link">&para;</a></h2>
<p>You can get a development edition of Collabora Online 25.04 and try it out yourself right now: <a href="https://www.collaboraonline.com/code/">try
the development edition</a>.  Collabora intends to continue
supporting and contributing to LibreOffice, the code is merged so we expect all of this work will be
available in TDF's next release too (26.2).</p>
  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/sw-interdependent-redline-improvements2.html">Interdependent tracked changes improvements in Writer, part 2</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Tue 08 July 2025</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 2 minutes</p>
  </div>
  <div class="article_text">
    <p>Writer has some support for interdependent (or hierarchical) tracked changes: e.g. the case when you
have a delete on top of an insert. See the <a href="https://vmiklos.hu/blog/sw-interdependent-redline-improvements.html">first
post</a> for background.</p>
<p>This work is primarily for <a href="https://www.collaboraonline.com/">Collabora Online</a>, but the feature is
available in desktop Writer as well.</p>
<h2 id="motivation">Motivation<a class="headerlink" href="#motivation" title="Permanent link">&para;</a></h2>
<p>With the already mentioned improvements in place, a few areas were still lacking: we didn't have UI
for all cases where the DOCX import was possible already; combining tracked changes (redlines) were
not complete (so you don't have to reject all parts of a logical redline one by one) and some of the
undo/redo code didn't work as expected.</p>
<h2 id="results-so-far">Results so far<a class="headerlink" href="#results-so-far" title="Permanent link">&para;</a></h2>
<p>Here is a sample case where the UI was missing to create something that was possible to import from
DOCX: a format redline on top of an insert redline.</p>
<p>If you had a document with an insert:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-interdependent-redline-improvements2/1-baseline.png"><figure><img src="https://share.vmiklos.hu/blog/sw-interdependent-redline-improvements2/1-baseline.png"><figcaption>Interdependent tracked change: just insert</figcaption></figure></a></p>
<p>And you selected BBB to mark those characters as bold, we just updated the existing insert redline
to be bold:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-interdependent-redline-improvements2/2-edit-old.png"><figure><img src="https://share.vmiklos.hu/blog/sw-interdependent-redline-improvements2/2-edit-old.png"><figcaption>Interdependent tracked change: old, format is not tracked separately</figcaption></figure></a></p>
<p>But now we track a format change on top of the insert separately:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-interdependent-redline-improvements2/3-edit-new.png"><figure><img src="https://share.vmiklos.hu/blog/sw-interdependent-redline-improvements2/3-edit-new.png"><figcaption>Interdependent tracked change: new, format is tracked separately</figcaption></figure></a></p>
<p>This is also visible if you open the track changes dialog, which explains that now you have part of
the insert redline covered by a format redline:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-interdependent-redline-improvements2/4-dialog.png"><figure><img src="https://share.vmiklos.hu/blog/sw-interdependent-redline-improvements2/4-dialog.png"><figcaption>Interdependent tracked change: UI dialog now showing multiple redlines </figcaption></figure></a></p>
<h2 id="how-is-this-implemented">How is this implemented?<a class="headerlink" href="#how-is-this-implemented" title="Permanent link">&para;</a></h2>
<p>If you would like to know a bit more about how this works, continue reading... :-)</p>
<p>As usual, the high-level problem was addressed by a series of small changes. Core side:</p>
<ul>
<li><a href="https://git.libreoffice.org/core/commit/cc2babfa0a960c7d52ea7997aea19dcf10c12d08">sw interdependent redlines: fix nPamEndtNI -&gt; nPamEndNI typo</a></li>
<li><a href="https://git.libreoffice.org/core/commit/82b24dd9748c6c0a2990e70bda0960ae26415390">tdf#166319 sw interdependent redlines: combine on reject of del-then-fmt's fmt</a></li>
<li><a href="https://git.libreoffice.org/core/commit/612ba7b2bc5d1d12c10287094263f6d31983a3d8">tdf#166319 sw interdependent redlines: fix undo of reject of ins-then-del's del</a></li>
<li><a href="https://git.libreoffice.org/core/commit/eef0dfed817e40cd83e8ba8e290f45c224257f97">tdf#166319 sw interdependent redlines: add UI to create format inside insert</a></li>
<li><a href="https://git.libreoffice.org/core/commit/0566e8e1776921ecb26f0ddd0546ec10afeed8e0">tdf#166319 sw interdependent redlines: undo of creating an ins-then-fmt redline</a></li>
<li><a href="https://git.libreoffice.org/core/commit/e06eb6b4a6176692d25c758121012473fe638043">tdf#166319 sw interdependent redlines: redo of creating an ins-then-fmt redline</a></li>
<li><a href="https://git.libreoffice.org/core/commit/5ed41ca44bee5122a9db4aa946f6e3ecd9432574">tdf#166319 sw interdependent redlines: fix redo of reject of del-then-fmt's del</a></li>
<li><a href="https://git.libreoffice.org/core/commit/76c2168a276f0996deeac08ce176525821fb056e">tdf#166319 sw interdependent redlines: fix bad accept undo action for reject</a></li>
</ul>
<h2 id="want-to-start-using-this">Want to start using this?<a class="headerlink" href="#want-to-start-using-this" title="Permanent link">&para;</a></h2>
<p>You can get a development edition of Collabora Online 25.04 and try it out yourself right now: <a href="https://www.collaboraonline.com/code/">try
the development edition</a>.  Collabora intends to continue
supporting and contributing to LibreOffice, the code is merged so we expect all of this work will be
available in TDF's next release too (25.8).</p>
  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/sw-interdependent-redline-improvements.html">Interdependent tracked changes improvements in Writer</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Mon 02 June 2025</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 4 minutes</p>
  </div>
  <div class="article_text">
    <p>Writer has some support for interdependent (or hierarchical) tracked changes: e.g. the case when you
have a delete on top of an insert. While there were some working cases, handling of many
combinations were missing. I started to make systematic improvements in this area in the recent
past, this post gives you an overview what's done so far.</p>
<p>This work is primarily for <a href="https://www.collaboraonline.com/">Collabora Online</a>, but the feature is
available in desktop Writer as well.</p>
<h2 id="motivation">Motivation<a class="headerlink" href="#motivation" title="Permanent link">&para;</a></h2>
<p>DOCX files in Word can often have overlapping tracked changes: Writer tries to split these up to
make sure there is only one tracked change under the cursor at the same time. Still, it's possible
that you have a tracked change with multiple types: e.g. a delete on top of an insert.</p>
<p>The focus in on 3 combinations which appear in DOCX files a lot: "insert, then delete", "insert,
then format" and "delete, then format".</p>
<p>This mostly affects the UI and import/export filters of ODT and DOCX.</p>
<h2 id="results-so-far">Results so far<a class="headerlink" href="#results-so-far" title="Permanent link">&para;</a></h2>
<p>Given an insert, then delete:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-interdependent-redline-improvements/ins-then-del.png"><figure><img src="https://share.vmiklos.hu/blog/sw-interdependent-redline-improvements/ins-then-del.png"><figcaption>Interdependent tracked change: insert, then delete</figcaption></figure></a></p>
<p>Most operations worked nicely here, but in case your cursor was in the middle of AAA and you did a
reject, followed by an undo, proper handling of that was missing, now implemented.</p>
<p>But then given an insert, then a format:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-interdependent-redline-improvements/ins-then-fmt.png"><figure><img src="https://share.vmiklos.hu/blog/sw-interdependent-redline-improvements/ins-then-fmt.png"><figcaption>Interdependent tracked change: insert, then format</figcaption></figure></a></p>
<p>Then a handling of more actions were missing:</p>
<ol>
<li>DOCX import is now implemented.</li>
<li>ODT import is now implemented.</li>
<li>Accepting when you're inside AAA is now implemented: the insert is accepted for BBB but the
   format stays unchanged.</li>
<li>Rejecting when you're inside AAA is now implemented: the insert is rejected and BBB is also
   removed, together with the format on top of it.</li>
<li>Accepting the BBB now correctly operates on the insert type, so the format type remains after
   accept.</li>
<li>If you accept BBB, now the surrounding AAA and CCC also get accepted as well, as expected.</li>
<li>Now if you reject BBB, then it gets removed from the document, since you rejected an insert.</li>
<li>When you reject BBB, the surrounding AAA and CCC also get rejected.</li>
</ol>
<p>The combined implementation of these should give you a smooth feeling in case you're used to how
Word works: if there is a format redline combined with an insert, then the operations act on the
insert type, and format is only accepted/rejected when there is no insert "under" the format.</p>
<p>Similarly: it's a bit of an implementation detail that Writer splits redlines on DOCX import: so if
you e.g. accept AAA then we combine that with BBB and CCC when it makes sense, so you need to click
a lot less.</p>
<p>Finally, given a delete, then a format:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-interdependent-redline-improvements/del-then-fmt.png"><figure><img src="https://share.vmiklos.hu/blog/sw-interdependent-redline-improvements/del-then-fmt.png"><figcaption>Interdependent tracked change: delete, then format</figcaption></figure></a></p>
<p>Then again handling of some actions were missing:</p>
<ol>
<li>DOCX import is now implemented.</li>
<li>ODT import is now implemented.</li>
<li>ODT export is now implemented.</li>
<li>Accepting AAA now correctly operates on the delete type of BBB.</li>
<li>Rejecting AAA now correctly operates on the delete type of BBB.</li>
<li>Accepting BBB now correctly works with the delete type.</li>
<li>Accepting BBB now correctly tries to also accept AAA and CCC, too.</li>
</ol>
<p>The current state is not yet complete, but it's a big improvement over what we had in the past,
which was mostly focusing on just "insert, then delete".</p>
<p>You may wonder what about some other cases: if you insert some content with change tracking, that
always creates a new tracked change, so "insert" is never on top of something else. Similarly,
format is always on top of something. Finally the same type is never on top of itself.</p>
<h2 id="how-is-this-implemented">How is this implemented?<a class="headerlink" href="#how-is-this-implemented" title="Permanent link">&para;</a></h2>
<p>If you would like to know a bit more about how this works, continue reading... :-)</p>
<p>As usual, the high-level problem was addressed by a series of small changes. Core side:</p>
<ul>
<li><a href="https://git.libreoffice.org/core/commit/096a40b27d07603880bbf120440ac169a87fe115">tdf#166319 sw interdependent redlines: fix undo of del on top of ins</a></li>
<li><a href="https://git.libreoffice.org/core/commit/ca7a6a57ad1e8d7aadffbbf3fe28d9aabed31286">tdf#166319 sw interdependent redlines: handle format on top of insert</a></li>
<li><a href="https://git.libreoffice.org/core/commit/8e85d559a68f980d99af4ded6a91b7f0458048b9">tdf#166319 sw interdependent redlines: handle accept of insert under format</a></li>
<li><a href="https://git.libreoffice.org/core/commit/3c039cb31239ba01e3d3b56c526bdb7ba6446032">tdf#166319 sw interdependent redlines: handle reject of insert under format</a></li>
<li><a href="https://git.libreoffice.org/core/commit/96faaaf83a1c8b897ce675d175b4d8756d0ea0df">tdf#166319 sw interdependent redlines: handle accept of delete under format</a></li>
<li><a href="https://git.libreoffice.org/core/commit/97066d4f5a89ad89d81a45c0b20ce404f9712fc7">tdf#166319 sw interdependent redlines: fix DOCX export of delete under format</a></li>
<li><a href="https://git.libreoffice.org/core/commit/d659f4b12a24e275e38ec5aa7406c32c9fa08c48">tdf#166319 sw interdependent redlines: handle reject of delete under format</a></li>
<li><a href="https://git.libreoffice.org/core/commit/ff110bb17b7e003bd205438af94badabeca007c6">tdf#166319 sw interdependent redlines: handle ODF import of insert under format</a></li>
<li><a href="https://git.libreoffice.org/core/commit/1a340196237ed075b337e6a0ac9f8a45132053bb">tdf#166319 sw interdependent redlines: handle ODF export of delete under format</a></li>
<li><a href="https://git.libreoffice.org/core/commit/08acfb815745e7f43ca43557feefcb68607d26c1">tdf#166319 sw interdependent redlines: handle ODF import of delete under format</a></li>
<li><a href="https://git.libreoffice.org/core/commit/8cabdef0b34210d026ea7a8229f321e272a49109">tdf#166319 sw interdependent redlines: handle accept of ins-then-fmt's fmt</a></li>
<li><a href="https://git.libreoffice.org/core/commit/2292bda37378d7f782abbda42c026affd3fa59e5">tdf#166319 sw interdependent redlines: combine on accept of ins-then-fmt's fmt</a></li>
<li><a href="https://git.libreoffice.org/core/commit/b6cba0119f8028b426f5eee55be9761971dbfdee">tdf#166319 sw interdependent redlines: handle reject of ins-then-fmt's fmt</a></li>
<li><a href="https://git.libreoffice.org/core/commit/15bd73a093f1f944d504cf555918ca9e60d75c03">tdf#166319 sw interdependent redlines: combine on reject of ins-then-fmt's fmt</a></li>
<li><a href="https://git.libreoffice.org/core/commit/5fedce78c8d79a3e86307523c3d74c7df98668f7">tdf#166319 sw interdependent redlines: handle accept of del-then-fmt's fmt</a></li>
<li><a href="https://git.libreoffice.org/core/commit/98f0b23a48246507ced6de5b54d327d95f1725f9">tdf#166319 sw interdependent redlines: combine on accept of del-then-fmt's fmt</a></li>
<li><a href="https://git.libreoffice.org/core/commit/569eb476bbdf83aab0f377da5cb7d2e8c77192b8">tdf#166319 sw interdependent redlines: handle reject of del-then-fmt's fmt</a></li>
</ul>
<h2 id="want-to-start-using-this">Want to start using this?<a class="headerlink" href="#want-to-start-using-this" title="Permanent link">&para;</a></h2>
<p>You can get a development edition of Collabora Online 25.04 and try it out yourself right now: <a href="https://www.collaboraonline.com/code/">try
the development edition</a>.  Collabora intends to continue
supporting and contributing to LibreOffice, the code is merged so we expect all of this work will be
available in TDF's next release too (25.8).</p>
  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/sw-redline-reinstate.html">Reinstate for tracked changes in Writer</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Thu 08 May 2025</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 3 minutes</p>
  </div>
  <div class="article_text">
    <p>Writer has the concept of rejecting tracked changes: if a proposed insertion or deletion is not
wanted, then one can reject it to push back on the proposal. So far such an action left no trace in
the document, which is sometimes not wanted. Calling reinstate on a change behaves like reject, but
with history: it reinstates the original state, with the rejected change preserved in the document.</p>
<p>This work is primarily for <a href="https://www.collaboraonline.com/">Collabora Online</a>, but the feature is
available in desktop Writer as well.</p>
<h2 id="motivation">Motivation<a class="headerlink" href="#motivation" title="Permanent link">&para;</a></h2>
<p>When Alice works on a document to insert e.g. new conditions for a contract, then perhaps Bob is not
happy with the proposal. But just rejecting the change "silently" would not be polite: the tracked
change then disappears, so possibly Alice thinks it was accepted and Bob didn't communicate the
pushback explicitly in the resulting document, either.</p>
<p>Reinstate is meant to improve this interaction: if an insert is reinstated, then an explicit delete
is created on top of the insert, so Alice can see that Bob was not happy with the proposal. Or in
case Alice proposed a delete, Bob can reinstate that by adding the same content again to the
document, without typing the text manually after the delete.</p>
<p>This is a UI feature: the resulting model still only contains inserts and deletes, so it works even with
DOCX files.</p>
<h2 id="results-so-far">Results so far<a class="headerlink" href="#results-so-far" title="Permanent link">&para;</a></h2>
<p>Given an insert:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-redline-reinstate/insert.png"><figure><img src="https://share.vmiklos.hu/blog/sw-redline-reinstate/insert.png"><figcaption>Reinstate: an insert</figcaption></figure></a></p>
<p>Now you can easily create a delete on top of the insert:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-redline-reinstate/insert-after.png"><figure><img src="https://share.vmiklos.hu/blog/sw-redline-reinstate/insert-after.png"><figcaption>Reinstate: a reinstated insert</figcaption></figure></a></p>
<p>And given a delete:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-redline-reinstate/delete.png"><figure><img src="https://share.vmiklos.hu/blog/sw-redline-reinstate/delete.png"><figcaption>Reinstate: a delete</figcaption></figure></a></p>
<p>Now you can easily create an insert right after the delete, preserving complex content:</p>
<p><a href="https://share.vmiklos.hu/blog/sw-redline-reinstate/delete-after.png"><figure><img src="https://share.vmiklos.hu/blog/sw-redline-reinstate/delete-after.png"><figcaption>Reinstate: a reinstated delete</figcaption></figure></a></p>
<p>As you can see, this creates the opposite of the original change as a new tracked change, so it will
in the end still reject the change, but without deleting the original change.</p>
<h2 id="how-is-this-implemented">How is this implemented?<a class="headerlink" href="#how-is-this-implemented" title="Permanent link">&para;</a></h2>
<p>If you would like to know a bit more about how this works, continue reading... :-)</p>
<p>As usual, the high-level problem was addressed by a series of small changes. Core side:</p>
<ul>
<li><a href="https://git.libreoffice.org/core/commit/7af8b3d3305fe8344cb9339269c5dc3f1cd44650">cool#11357 sw redline reinstate: implement this for a single insert</a></li>
<li><a href="https://git.libreoffice.org/core/commit/1df71464588d4cfcba708cf00ef7b6ac94574c8f">cool#11357 sw redline reinstate: handle inserts in selection</a></li>
<li><a href="https://git.libreoffice.org/core/commit/e312cf46fe840f04b729600db9efe89d5f58d6fe">cool#11357 sw redline reinstate: handle a single delete</a></li>
<li><a href="https://git.libreoffice.org/core/commit/db541619cb1ca83598ec479eb9f52e559a8fe72d">cool#11357 sw redline reinstate: handle a single rich delete</a></li>
<li><a href="https://git.libreoffice.org/core/commit/157c00922959adc8fd2e0203ed94dfd847479c54">cool#11357 sw redline reinstate: handle deletes in selection</a></li>
<li><a href="https://git.libreoffice.org/core/commit/447935fba57f1b0f88c0b56cccf5bf971fb1e819">cool#11357 sw redline reinstate: simplify ReinstateRedlinesInSelection()</a></li>
<li><a href="https://git.libreoffice.org/core/commit/9c2c98ac7668e4a3a2e3a70cc54b632de5f79621">cool#11357 sw redline reinstate: add command state</a></li>
<li><a href="https://git.libreoffice.org/core/commit/1926105b47df7b15dd34a8c1135f83b936bf9926">cool#11357 sw redline reinstate: add a reinstate-and-next command</a></li>
<li><a href="https://git.libreoffice.org/core/commit/4535698e0b16bf003e8a3705e28f7347f509eb12">cool#11357 sw redline reinstate: add a reinstate-all command</a></li>
<li><a href="https://git.libreoffice.org/core/commit/01311bb1e4c2404354cce8934d36991d91d527b2">cool#11357 sw redline reinstate: avoid unwanted multi- or table selection</a></li>
<li><a href="https://git.libreoffice.org/core/commit/fbf9465e2bc9f878723674d1eff13e0c69656057">cool#11357 sw redline reinstate: fix undo string for a single redline</a></li>
<li><a href="https://git.libreoffice.org/core/commit/7d702ebbfcda41ce2972e30b2a1e493c320df67c">cool#11357 sw redline reinstate: fix undo count &amp; string for multiple redlines</a></li>
<li><a href="https://git.libreoffice.org/core/commit/dcd3427149c33852428b4198c22f6f858125c294">cool#11357 sw redline reinstate: add to the context menu for text</a></li>
</ul>
<p>Online side:</p>
<ul>
<li><a href="https://github.com/collaboraonline/online/commit/3d7933974241fe5d015a9d80f2cc8bde1c1d352e">cool#11357 sw redline reinstate: add UI for this</a></li>
</ul>
<h2 id="want-to-start-using-this">Want to start using this?<a class="headerlink" href="#want-to-start-using-this" title="Permanent link">&para;</a></h2>
<p>You can get a development edition of Collabora Online 25.04 and try it out yourself right now: <a href="https://www.collaboraonline.com/code/">try
the development edition</a>.  Collabora intends to continue
supporting and contributing to LibreOffice, the code is merged so we expect all of this work will be
available in TDF's next release too (25.8).</p>
  </div>
</article>

<footer>
<div id="paginator">
<a href="https://vmiklos.hu/blog/category/libreoffice2.html" class="button_accent">&larr; Older Posts</a>

</div>
</footer>

    <div id="ending_message">
      <p>&copy; Miklos Vajna. Built using <a href="http://getpelican.com" target="_blank">Pelican</a>. Theme by Giulio Fidente on <a href="https://github.com/gfidente/pelican-svbhack" target="_blank">github</a>. </p>
    </div>
  </main>
</body>
</html>