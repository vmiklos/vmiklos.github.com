<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.5.3" />
<meta name="description" content="EPUB3 export improvements in Libreoffice Writer, take two - Miklos' blog" />
<meta name="keywords" content="vmiklos, libereoffice, swig, git, python, hacking, bitlbee" />
<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/index.rss" />
<link rel="stylesheet" href="/blog/xhtml11.css" type="text/css" />
<link rel="stylesheet" href="/blog/xhtml11-quirks.css" type="text/css" />
<link rel="stylesheet" href="/blog/layout.css" type="text/css" />
<title>EPUB3 export improvements in Libreoffice Writer, take two</title>
<!-- google analytics start -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-24726997-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- google analytics end -->
</head>
<body>
<div id="layout-banner-box">
<div id="layout-banner">
  <div id="layout-title">vmiklos.hu</div>
  <div id="layout-description">shameless self-promoting website</div>
</div>
</div>
<div id="layout-menu-box">
<div id="layout-menu">
  <div>&#187;<a href="/">Root</a></div>
  <div>&#187;<a href="/blog/">Rejourn root</a></div>
  <div>&#187;<a href="http://planet.documentfoundation.org/">LibreOffice Community Blogs</a></div>
  <div>
    Search:<br/>
    <form action="http://www.google.com/cse" id="cse-search-box" target="_blank">
    <input type="hidden" name="cx" value="007336731492173318056:bik8fqvatno"/><input type="hidden" name="ie" value="UTF-8"/><input type="text" name="q" size="15"/><br/>
    <input type="submit" name="sa" value="&#187;"/></form>
  </div>
</div>

</div>
<div id="layout-content-box">
<div id="layout-content">
<div id="header">
	<h1>EPUB3 export improvements in Libreoffice Writer, take two</h1>
</div>
<div id="preamble">
<div class="sectionbody">

<!-- Single entry -->
<div class="verseblock">
<div class="verseblock-content">Posted <span class="timeago" title="2018-01-11T12:25:02Z">Thursday, 11 January 2018</span> by Miklos<br />
    Tags:
    <a href="tags/en.html">en</a>
    <a href="tags/libreoffice.html">libreoffice</a>
<div class="nav-previous"><a href="/blog/epub3-improvements.html" rel="prev"><span class="meta-nav">&larr;</span> EPUB3 export improvements in Libreoffice Writer</a></div>
</div>
</div>

<!-- Body -->
<div class="paragraph"><p>I worked on improving the EPUB3 export filter in LibreOffice further recently.
First, thanks to the Dutch Ministry of Defense in cooperation with
<a href="http://nouenoff.nl/">Nou&amp;Off</a> who made this work possible. Since the
<a href="/blog/epub3-improvements.html">previous blog entry</a> there have been a
number of improvements around a next set of topics.</p></div>
<div class="sect1">
<h2 id="_cover_images">Cover images</h2>
<div class="sectionbody">
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://farm5.staticflickr.com/4760/38920770224_b247fa89c4_o.png" alt="https://farm5.staticflickr.com/4760/38920770224_b247fa89c4_o.png" />
</div>
</div>
<div class="paragraph"><p>It is now possible to specify a cover image for the exported EPUB file. Given
that a cover image is not naturally part of the Writer document model, I introduced the
concept of a media directory for the EPUB export. The media directory is a
directory next to the source file, with the &lt;file name without extension&gt;
name. If that directory contains a file named cover.svg (or .gif, .jpg, .png),
the exporter will automatically use it. Otherwise you can customize this
default.</p></div>
<div class="paragraph"><p>The picture shows two EPUB files in <a href="http://readium.org/">Readium</a> with
different cover images.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_improved_metadata_support">Improved metadata support</h2>
<div class="sectionbody">
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://farm5.staticflickr.com/4603/38920770174_142950782e_o.png" alt="https://farm5.staticflickr.com/4603/38920770174_142950782e_o.png" />
</div>
</div>
<div class="paragraph"><p>It&#8217;s quite frequent that you are technically author of a document, but the
logical author of the book is somebody else. Same for the date of the book,
and so on. So the EPUB export dialog now has support for overwriting the
defaults coming from the Writer document model. For mass-conversion of
documents it&#8217;s possible to place a &lt;file name without extension&gt;.xmp file in
the media directory and <a href="http://www.adobe.com/devnet/xmp.html">XMP</a> metadata
from that file will also overwrite metadata coming from the document model.</p></div>
<div class="paragraph"><p>The picture shows the extended EPUB export options dialog.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_footnotes_and_image_popups">Footnotes and image popups</h2>
<div class="sectionbody">
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://farm5.staticflickr.com/4612/38920770144_e90e2a8e92_o.png" alt="https://farm5.staticflickr.com/4612/38920770144_e90e2a8e92_o.png" />
</div>
</div>
<div class="paragraph"><p>I&#8217;ve added support for footnotes. As a special case of this, image popups on
images and text is now supported. This works by placing a relative link on a
text portion or on an image, and placing an image with the same name (e.g. in
high resolution) in the media directory. In this case the EPUB export will
bundle the image from the media directory inside the EPUB file and clicking on
the text or image will open the bundled image in a popup (or in some other
container, depending on how your reader interprets footnotes).</p></div>
<div class="paragraph"><p>The picture shows such a popup in Microsoft Edge.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_fixed_layout">Fixed layout</h2>
<div class="sectionbody">
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://farm5.staticflickr.com/4604/38920770104_108465bda1_o.png" alt="https://farm5.staticflickr.com/4604/38920770104_108465bda1_o.png" />
</div>
</div>
<div class="paragraph"><p>The EPUB3 fixed layout is quite similar to PDF, just it is built on top of
XHTML and SVG. Possible use-cases for this can be:</p></div>
<div class="ulist"><ul>
<li>
<p>
exporting a document where presenting the content as reflowable text would
  be misleading (e.g. comic books), but the publisher of the book only works
  with EPUB (reflowable or fixed layout, but no PDF)
</p>
</li>
<li>
<p>
printing (again, in case for some reason you want to avoid PDF)
</p>
</li>
</ul></div>
<div class="paragraph"><p>These might be very specific situations, but luckily supporting them is not
too complex. I implemented an approach very similar to the PDF export, where
we export individual pages of the Writer document&#8217;s layout as a metafile, and
then consume that&#8201;&#8212;&#8201;this time with the SVG export. Building on top of the
existing Writer layout and SVG export means the hard work is really done by
these components, the EPUB fixed layout export just puts these together.</p></div>
<div class="paragraph"><p>The picture shows a Writer document with a table of contents containing page
numbers, a header and a footer in Readium.</p></div>
<div class="paragraph"><p>All this is available in master (towards LibreOffice 6.1), or you can grab a
<a href="http://dev-builds.libreoffice.org/daily/master/">daily build</a> and try it out
right now. :-)</p></div>
</div>
</div>


<script src="https://apis.google.com/js/plusone.js"></script>
<g:plus action="share"></g:plus>

<!-- Disqus comments -->
<h1 id="comment-header">Comments</h1>
<div id="disqus_thread"></div>
<script type="text/javascript" src="//vmiklos.disqus.com/embed.js">
	var disqus_developer = 1;
</script>
<noscript>
  <p><a href="http://disqus.com/?ref_noscript=vmiklos">View the discussion thread.</a></p>
</noscript>

</div>
</div>
</div>
</div>
</body>
</html>
