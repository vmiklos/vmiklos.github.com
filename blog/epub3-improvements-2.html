<!DOCTYPE html>
<html lang="en">

<head>
  <!-- ## for client-side less
  <link rel="stylesheet/less" type="text/css" href="https://vmiklos.hu/blog/theme/css/style.less">
  <script src="http://cdnjs.cloudflare.com/ajax/libs/less.js/1.7.3/less.min.js" type="text/javascript"></script>
  -->
  <link rel="stylesheet" type="text/css" href="https://vmiklos.hu/blog/theme/css/style.css">
  <link rel="stylesheet" type="text/css" href="https://vmiklos.hu/blog/theme/css/pygments.css">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Miklos Vajna">
  <meta name="description" content="Posts and writings by Miklos Vajna">

  <link href="https://vmiklos.hu/blog/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="What is Miklos hacking RSS" />

<meta name="keywords" content="en">

  <title>
    What is Miklos hacking
&ndash; EPUB3 export improvements in Libreoffice Writer, take two  </title>

<script type="text/javascript">
  var _paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//analytics.vmiklos.hu/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
</head>

<body>
  <aside>
    <div id="user_meta">
      <h2><a href="https://vmiklos.hu/blog">What is Miklos hacking</a></h2>
      <p></p>
      <ul>
        <li><a href="/" target="_blank">Root</a></li>
        <li><a href="https://planet.documentfoundation.org/" target="_blank">LibreOffice Blogs</a></li>
      </ul>
    </div>
  </aside>

  <main>
    <header>
      <p>
      <a href="https://vmiklos.hu/blog">Index</a> &brvbar; <a href="https://vmiklos.hu/blog/archives.html">Archives</a>
      &brvbar; <a href="https://vmiklos.hu/blog/feeds/all.rss.xml">RSS</a>
      </p>
    </header>

<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/epub3-improvements-2.html">EPUB3 export improvements in Libreoffice Writer, take two</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Thu 11 January 2018</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 3 minutes</p>
  </div>
  <div class="article_text">
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>I worked on improving the EPUB3 export filter in LibreOffice further recently.
First, thanks to <a href="http://nouenoff.nl/">Nou&amp;Off</a> in cooperation with a customer
who made this work possible. Since the
<a href="https://vmiklos.hu/blog/epub3-improvements.html">previous blog entry</a> there have been a
number of improvements around a next set of topics.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_cover_images">Cover images</h2>
<div class="sectionbody">
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://farm5.staticflickr.com/4760/38920770224_b247fa89c4_o.png" alt="https://farm5.staticflickr.com/4760/38920770224_b247fa89c4_o.png" />
</div>
</div>
<div class="paragraph"><p>It is now possible to specify a cover image for the exported EPUB file. Given
that a cover image is not naturally part of the Writer document model, I introduced the
concept of a media directory for the EPUB export. The media directory is a
directory next to the source file, with the &lt;file name without extension&gt;
name. If that directory contains a file named cover.svg (or .gif, .jpg, .png),
the exporter will automatically use it. Otherwise you can customize this
default.</p></div>
<div class="paragraph"><p>The picture shows two EPUB files in <a href="http://readium.org/">Readium</a> with
different cover images.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_improved_metadata_support">Improved metadata support</h2>
<div class="sectionbody">
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://farm5.staticflickr.com/4603/38920770174_142950782e_o.png" alt="https://farm5.staticflickr.com/4603/38920770174_142950782e_o.png" />
</div>
</div>
<div class="paragraph"><p>It&#8217;s quite frequent that you are technically author of a document, but the
logical author of the book is somebody else. Same for the date of the book,
and so on. So the EPUB export dialog now has support for overwriting the
defaults coming from the Writer document model. For mass-conversion of
documents it&#8217;s possible to place a &lt;file name without extension&gt;.xmp file in
the media directory and <a href="http://www.adobe.com/devnet/xmp.html">XMP</a> metadata
from that file will also overwrite metadata coming from the document model.</p></div>
<div class="paragraph"><p>The picture shows the extended EPUB export options dialog.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_footnotes_and_image_popups">Footnotes and image popups</h2>
<div class="sectionbody">
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://farm5.staticflickr.com/4612/38920770144_e90e2a8e92_o.png" alt="https://farm5.staticflickr.com/4612/38920770144_e90e2a8e92_o.png" />
</div>
</div>
<div class="paragraph"><p>I&#8217;ve added support for footnotes. As a special case of this, image popups on
images and text is now supported. This works by placing a relative link on a
text portion or on an image, and placing an image with the same name (e.g. in
high resolution) in the media directory. In this case the EPUB export will
bundle the image from the media directory inside the EPUB file and clicking on
the text or image will open the bundled image in a popup (or in some other
container, depending on how your reader interprets footnotes).</p></div>
<div class="paragraph"><p>The picture shows such a popup in Microsoft Edge.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_fixed_layout">Fixed layout</h2>
<div class="sectionbody">
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://farm5.staticflickr.com/4604/38920770104_108465bda1_o.png" alt="https://farm5.staticflickr.com/4604/38920770104_108465bda1_o.png" />
</div>
</div>
<div class="paragraph"><p>The EPUB3 fixed layout is quite similar to PDF, just it is built on top of
XHTML and SVG. Possible use-cases for this can be:</p></div>
<div class="ulist"><ul>
<li>
<p>
exporting a document where presenting the content as reflowable text would
  be misleading (e.g. comic books), but the publisher of the book only works
  with EPUB (reflowable or fixed layout, but no PDF)
</p>
</li>
<li>
<p>
printing (again, in case for some reason you want to avoid PDF)
</p>
</li>
</ul></div>
<div class="paragraph"><p>These might be very specific situations, but luckily supporting them is not
too complex. I implemented an approach very similar to the PDF export, where
we export individual pages of the Writer document&#8217;s layout as a metafile, and
then consume that&#8201;&#8212;&#8201;this time with the SVG export. Building on top of the
existing Writer layout and SVG export means the hard work is really done by
these components, the EPUB fixed layout export just puts these together.</p></div>
<div class="paragraph"><p>The picture shows a Writer document with a table of contents containing page
numbers, a header and a footer in Readium.</p></div>
<div class="paragraph"><p>All this is available in master (towards LibreOffice 6.1), or you can grab a
<a href="http://dev-builds.libreoffice.org/daily/master/">daily build</a> and try it out
right now. :-)</p></div>
</div>
</div>

  </div>
  <div class="article_meta">
    <p>Category: <a href="https://vmiklos.hu/blog/category/libreoffice.html">libreoffice</a>
 &ndash; Tags:
      <a href="https://vmiklos.hu/blog/tag/en.html">en</a>    </p>
  </div>


</article>


    <div id="ending_message">
      <p>&copy; Miklos Vajna. Built using <a href="http://getpelican.com" target="_blank">Pelican</a>. Theme by Giulio Fidente on <a href="https://github.com/gfidente/pelican-svbhack" target="_blank">github</a>. </p>
    </div>
  </main>
</body>
</html>