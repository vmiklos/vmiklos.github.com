<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.5.3" />
<meta name="description" content="What is Miklos hacking - Miklos' blog" />
<meta name="keywords" content="vmiklos, libereoffice, swig, git, python, hacking, bitlbee" />
<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://vmiklos.hu/blog/index.rss" />
<link rel="stylesheet" href="/blog/xhtml11.css" type="text/css" />
<link rel="stylesheet" href="/blog/xhtml11-quirks.css" type="text/css" />
<link rel="stylesheet" href="/blog/layout.css" type="text/css" />
<title>What is Miklos hacking</title>
<!-- google analytics start -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-24726997-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- google analytics end -->
</head>
<body>
<div id="layout-banner-box">
<div id="layout-banner">
  <div id="layout-title">vmiklos.hu</div>
  <div id="layout-description">shameless self-promoting website</div>
</div>
</div>
<div id="layout-menu-box">
<div id="layout-menu">
  <div>&#187;<a href="/">Root</a></div>
  <div>&#187;<a href="/blog/">Rejourn root</a></div>
  <div>&#187;<a href="http://planet.documentfoundation.org/">LibreOffice Community Blogs</a></div>
  <div>
    Search:<br/>
    <form action="http://www.google.com/cse" id="cse-search-box" target="_blank">
    <input type="hidden" name="cx" value="007336731492173318056:bik8fqvatno"/><input type="hidden" name="ie" value="UTF-8"/><input type="text" name="q" size="15"/><br/>
    <input type="submit" name="sa" value="&#187;"/></form>
  </div>
</div>

<div id="alltags-menu">
	Tags:
	<div>&#187;<a href="/blog/tags/hu.html">hu</a> (1201)</div>
	<div>&#187;<a href="/blog/tags/en.html">en</a> (537)</div>
	<div>&#187;<a href="/blog/tags/hacking.html">hacking</a> (416)</div>
	<div>&#187;<a href="/blog/tags/film.html">film</a> (286)</div>
	<div>&#187;<a href="/blog/tags/libreoffice.html">libreoffice</a> (88)</div>
	<div>&#187;<a href="/blog/tags/geek.html">geek</a> (82)</div>
	<div>&#187;<a href="/blog/tags/bringa.html">bringa</a> (60)</div>
	<div>&#187;<a href="/blog/tags/konyv.html">konyv</a> (44)</div>
	<div>&#187;<a href="/blog/tags/misc.html">misc</a> (37)</div>
	<div>&#187;<a href="/blog/tags/zene.html">zene</a> (32)</div>
	<div>&#187;<a href="/blog/tags/munka.html">munka</a> (28)</div>
	<div>&#187;<a href="/blog/tags/fun.html">fun</a> (27)</div>
	<div>&#187;<a href="/blog/tags/frugalware.html">frugalware</a> (23)</div>
	<div>&#187;<a href="/blog/tags/sieles.html">sieles</a> (7)</div>
	<div>&#187;<a href="/blog/tags/bitlbee.html">bitlbee</a> (5)</div>
	<div>&#187;<a href="/blog/tags/gsoc2009.html">gsoc2009</a> (4)</div>
	<div>&#187;<a href="/blog/tags/git.html">git</a> (3)</div>
	<div>&#187;<a href="/blog/tags/szinhaz.html">szinhaz</a> (3)</div>
	<div>&#187;<a href="/blog/tags/gsoc2008.html">gsoc2008</a> (3)</div>
	<div>&#187;<a href="/blog/tags/opensuse.html">opensuse</a> (3)</div>
	<div>&#187;<a href="/blog/tags/gsoc2011.html">gsoc2011</a> (2)</div>
	<div>&#187;<a href="/blog/tags/go-oo.html">go-oo</a> (2)</div>
	<div>&#187;<a href="/blog/tags/kde.html">kde</a> (1)</div>
	<div>&#187;<a href="/blog/tags/libwpd.html">libwpd</a> (1)</div>
	<div>&#187;<a href="/blog/tags/karacsony.html">karacsony</a> (1)</div>
	<div>&#187;<a href="/blog/tags/upc.html">upc</a> (1)</div>
	<div>&#187;<a href="/blog/tags/google.html">google</a> (1)</div>
	<div>&#187;<a href="/blog/tags/fail.html">fail</a> (1)</div>
	<div>&#187;<a href="/blog/tags/openstack.html">openstack</a> (1)</div>
	<div>&#187;<a href="/blog/tags/mdadm.html">mdadm</a> (1)</div>
	<div>&#187;<a href="/blog/tags/w3c.html">w3c</a> (1)</div>
	<div>&#187;<a href="/blog/tags/java.html">java</a> (1)</div>
	<div>&#187;<a href="/blog/tags/greasemonkey.html">greasemonkey</a> (1)</div>
	<div>&#187;<a href="/blog/tags/auto.html">auto</a> (1)</div>
	<div>&#187;<a href="/blog/tags/otrs.html">otrs</a> (1)</div>
	<div>&#187;<a href="/blog/tags/gsoc2010.html">gsoc2010</a> (1)</div>
	<div>&#187;<a href="/blog/tags/bme.html">bme</a> (1)</div>
	<div>&#187;<a href="/blog/tags/python.html">python</a> (1)</div>
	<div>&#187;<a href="/blog/tags/howto.html">howto</a> (1)</div>
	<div>&#187;<a href="/blog/tags/openoffice.html">openoffice</a> (1)</div>
	<div>&#187;<a href="/blog/tags/networking.html">networking</a> (1)</div>
	<div>&#187;<a href="/blog/tags/gpsbabel.html">gpsbabel</a> (1)</div>
	<div>&#187;<a href="/blog/tags/supybot.html">supybot</a> (1)</div>
	<div>&#187;<a href="/blog/tags/lcov.html">lcov</a> (1)</div>
	<div>&#187;<a href="/blog/tags/nyaralas.html">nyaralas</a> (1)</div>
</div>

</div>
<div id="layout-content-box">
<div id="layout-content">
<div id="header">
	<h1>What is Miklos hacking</h1>
</div>
<div id="preamble">
<div class="sectionbody">




<!-- Listing -->
<div class="ulist"><ul>
<li><p>Wednesday, 04 November 2015<br /><a href="/blog/calc-png-export.html">PNG export in LibreOffice Calc</a>
(<a href="/blog/calc-png-export.html#disqus_thread">Comments</a>)
</p><p><div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://lh3.googleusercontent.com/-8n61EJB3Xco/VjkUn1JvuqI/AAAAAAAAGOE/0-DCtcNV2RY/s0-Ic42/">
<img src="https://lh3.googleusercontent.com/-8n61EJB3Xco/VjkUn1JvuqI/AAAAAAAAGOE/0-DCtcNV2RY/s400-Ic42/" alt="https://lh3.googleusercontent.com/-8n61EJB3Xco/VjkUn1JvuqI/AAAAAAAAGOE/0-DCtcNV2RY/s400-Ic42/" />
</a>
</div>
</div>
<div class="paragraph"><p>Both LibreOffice Writer and Impress has the ability to export the document as
PNG, which is one way to create thumbnails for documents&#8201;&#8212;&#8201;i.e. being able to
preview them before the real loading of the document happens. It turns out
Calc did not have this feature, and given that <code>ScModelObj</code> also supports the
<code>css::view::XRenderable</code> interface (just like Writer), I hoped that it won&#8217;t
be too complex to add one.</p></div>
<div class="paragraph"><p>You can refer to
<a href="http://fridrich.blogspot.com/2013/08/extending-swiss-army-knife-overview.html">Fridrich&#8217;s
overview blog post</a> for the complete list of steps on how to add a new filter
to LibreOffice, here the following steps
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=03bb5d52fecd6c613c6cc36508eb44e5e1c3456a">were
needed</a>:</p></div>
<div class="ulist"><ul>
<li>
<p>
improve <code>DocumentToGraphicRenderer</code>, so that it can handle that Calc does
  not implement the <code>text::XTextViewCursorSupplier</code> interface (Writer uses
  this one to expose the cursor is on what page)
</p>
</li>
<li>
<p>
register <code>png_Portable_Network_Graphic</code> as filter type for Calc
</p>
</li>
<li>
<p>
create a new <code>calc_png_Export</code> filter fragment
</p>
</li>
<li>
<p>
register a Calc graphic filters configuration type and filter group in
  <code>Configuration_filter</code> and <code>CustomTarget_registry</code>
</p>
</li>
<li>
<p>
testcase
</p>
</li>
</ul></div>
<div class="paragraph"><p>If you can&#8217;t wait till LibreOffice 5.1 is released to try out this new
feature, you can get a <a href="http://dev-builds.libreoffice.org/daily/master/">daily
build</a>. :-)</p></div>
</p><hr/></li>
<li><p>Tuesday, 20 October 2015<br /><a href="/blog/flat-odf-android.html">Flat ODF support in LibreOffice's Android port</a>
(<a href="/blog/flat-odf-android.html#disqus_thread">Comments</a>)
</p><p><div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://lh3.googleusercontent.com/-M9NDl_ptc9U/ViPqlxkmJwI/AAAAAAAAGLk/t92PSwTHAk0/s0-Ic42/">
<img src="https://lh3.googleusercontent.com/-M9NDl_ptc9U/ViPqlxkmJwI/AAAAAAAAGLk/t92PSwTHAk0/s400-Ic42/" alt="https://lh3.googleusercontent.com/-M9NDl_ptc9U/ViPqlxkmJwI/AAAAAAAAGLk/t92PSwTHAk0/s400-Ic42/" />
</a>
</div>
</div>
<div class="paragraph"><p>While LibreOffice&#8217;s Android port has as good support for ODF as the desktop
version, flat ODF was lagging behind. There were two reasons for this:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://gerrit.libreoffice.org/gitweb?p=core.git;a=commit;h=9aa6ec9bfaa3c76c291ab8ec9a1b87fb89b817e6">flat-ODF-related
  services were simply missing</a> from the .apk, for historical reasons: when
  the .apk limit was 50MB, it sounded like a good idea to leave these out if it
  allowed packaging e.g. editing-related services.
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/gitweb?p=core.git;a=commit;h=1956b50e3b4c63a913151fd21d21c42cd288173d">flat
  ODS was blacklisted explicitly</a>, from the times when Calc tiled rendering
  was missing, and when .ods was included again the document browser, .fods was
  forgotten.
</p>
</li>
</ul></div>
<div class="paragraph"><p>With these two fixes my favorite test documents (of which the ODF version
worked already previously) in flat ODF version also load properly in all
Writer, Calc and Impress&#8201;&#8212;&#8201;as can be seen on the above montage of
screenshots.</p></div>
</p><hr/></li>
<li><p>Friday, 09 October 2015<br /><a href="/blog/presenter-console.html">Restarting timer of the presenter console</a>
(<a href="/blog/presenter-console.html#disqus_thread">Comments</a>)
</p><p><div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://lh3.googleusercontent.com/-gedKN4759cE/VhZqBSpZL7I/AAAAAAAAGJs/Hlez6jX85ww/s0-Ic42/">
<img src="https://lh3.googleusercontent.com/-gedKN4759cE/VhZqBSpZL7I/AAAAAAAAGJs/Hlez6jX85ww/s400-Ic42/" alt="https://lh3.googleusercontent.com/-gedKN4759cE/VhZqBSpZL7I/AAAAAAAAGJs/Hlez6jX85ww/s400-Ic42/" />
</a>
</div>
</div>
<div class="paragraph"><p>This use-case came up during this year&#8217;s LibreOffice conference. I started the
Impress slideshow a few minutes in advance, so the audience could check if they
are at the correct room, seeing the title side. Right after starting the
slideshow, the presentation timer also started to count. I had to stop and
start the presentation, so I had an idea how much time my talk took so far. The
side effect of this workaround was that the audience saw an ugly short flash
while the presentation was not running at the moment I started talking.</p></div>
<div class="paragraph"><p>Because hacking the presenter console requires you to have two monitors, it&#8217;s
not something I looked into during the conference&#8217;s hackfest, but now here it
is: I
<a href="https://gerrit.libreoffice.org/gitweb?p=core.git;a=commit;h=b1a6a99b9a78689c6d3649ce066fad66912188e2">added</a>
a button to just restart the timer, then it&#8217;s not needed to stop/start the
presentation manually.</p></div>
<div class="paragraph"><p>The icon is just a placeholder for now, the real design is
<a href="http://listarchives.libreoffice.org/global/design/msg07351.html">in progress</a>.</p></div>
</p><hr/></li>
<li><p>Friday, 25 September 2015<br /><a href="/blog/libreoffices-android-port.html">LibreOffice's Android port</a>
(<a href="/blog/libreoffices-android-port.html#disqus_thread">Comments</a>)
</p><p><div style="text-align: center; font-size: 0.6em;">
<img src="https://lh3.googleusercontent.com/-Q_NX5YCu1Wk/VgT4uHIJI5I/AAAAAAAAGHo/AgTiFrgfDcA/s400-Ic42/"/>
<p>(via <a href="https://plus.google.com/115321503505930643274/posts/gsXjsZpW5DR">Andras Timar</a>)</p>
</div>
<div class="paragraph"><p>I had the pleasure to share where we are wrt. the Android port of LibreOffice
yesterday. Abstract on the
<a href="http://conference.libreoffice.org/2015/the-program/talks/development/#LibreOffice%27s%20Android%20port">conference
website</a>, slides at the
<a href="https://speakerdeck.com/vmiklos/libreoffices-android-port">usual place</a>, video
record "soon" as usual. :-)</p></div>
</p><hr/></li>
<li><p>Wednesday, 16 September 2015<br /><a href="/blog/base-form.html">Fixing Base form image backgrounds</a>
(<a href="/blog/base-form.html#disqus_thread">Comments</a>)
</p><p><div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://lh3.googleusercontent.com/-G5jug0myAVY/Vfh1U_i-QTI/AAAAAAAAGFQ/eZ-GKJqxqMU/s0-Ic42/">
<img src="https://lh3.googleusercontent.com/-G5jug0myAVY/Vfh1U_i-QTI/AAAAAAAAGFQ/eZ-GKJqxqMU/s640-Ic42/" alt="https://lh3.googleusercontent.com/-G5jug0myAVY/Vfh1U_i-QTI/AAAAAAAAGFQ/eZ-GKJqxqMU/s640-Ic42/" />
</a>
</div>
</div>
<div class="paragraph"><p>In this post I want to go further, and after
<a href="http://vmiklos.hu/blog/calc-header.html">touching Calc</a>, here is my first story
about Base. Of course I lie, it seems that Base forms are kind of read-only
Writer documents, at least that&#8217;s how I could fix the bug I&#8217;m describing here.
:-) The topic is still the same, rounding rough edges after the fill
attributes rework, this time a stretched background of a Base form. (Which was
not stretched at all, it was simply centered both horizontally and vertically
on the page.)</p></div>
<div class="paragraph"><p>I&#8217;m not entirely sure how the document from
<a href="https://bugs.documentfoundation.org/show_bug.cgi?id=92586">tdf#92586</a> is
created, but the interesting part from styles.xml is:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;style:page-layout-properties</span></span> ... <span style="color: #009900">style:repeat</span><span style="color: #990000">=</span><span style="color: #FF0000">"no-repeat"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
     <span style="font-weight: bold"><span style="color: #0000FF">&lt;style:background-image</span></span> ... <span style="color: #009900">style:repeat</span><span style="color: #990000">=</span><span style="color: #FF0000">"stretch"</span><span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/style:page-layout-properties&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>So the schema allows specifying the way how the bitmap is repeated at two
places, and in the past the later attribute won, and with the rework this got
lost.</p></div>
<div class="paragraph"><p>An additional problem that
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=6621da38b3cd217314c2d2295fd1e71be7e1875e">the
commit</a> had to solve is that the attribute on the page-layout-properties XML
element is mapped to our
<a href="http://api.libreoffice.org/docs/idl/ref/servicecom_1_1sun_1_1star_1_1drawing_1_1FillProperties.html#acd89f2a230dfdf0be3f6c840c2630871">FillBitmapMode</a>
API, while the attribute with the same name on the background-image XML
element is mapped to the
<a href="http://api.libreoffice.org/docs/idl/ref/servicecom_1_1sun_1_1star_1_1style_1_1PageProperties.html#a229455fd0417732944f850139fdf96d5">BackGraphicLocation</a>
API, which is specific to Writer. As a result, now there is a compatibility
map from the old enumeration to the new one, that&#8217;s how the bug document is
now rendered the same again, as in the past.</p></div>
<div class="paragraph"><p>The fix is already backported to the <code>libreoffice-5-0</code> branch.</p></div>
</p><hr/></li>
<li><p>Wednesday, 02 September 2015<br /><a href="/blog/calc-header.html">Fixing Calc header image backgrounds</a>
(<a href="/blog/calc-header.html#disqus_thread">Comments</a>)
</p><p><div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://lh3.googleusercontent.com/-u9SiImjl99k/VecKvEnT6lI/AAAAAAAAGDs/sNUH3OIlk4Y/s0-Ic42/">
<img src="https://lh3.googleusercontent.com/-u9SiImjl99k/VecKvEnT6lI/AAAAAAAAGDs/sNUH3OIlk4Y/s640-Ic42/" alt="https://lh3.googleusercontent.com/-u9SiImjl99k/VecKvEnT6lI/AAAAAAAAGDs/sNUH3OIlk4Y/s640-Ic42/" />
</a>
</div>
</div>
<div class="paragraph"><p>I think this is my first Calc bugfix. :-) The problem I wanted to fix is that
while LibreOffice 4.4 learned advanced
<a href="https://gerrit.libreoffice.org/gitweb?p=core.git&amp;a=search&amp;h=HEAD&amp;st=commit&amp;s=fillattributes">fill
attributes</a> (gradients, hatches, etc) for page headers / footers in Writer,
this broke the saving of simple graphic header backgrounds in Calc. Seeing
that no-one stepped up to fix this, I tried to do this myself&#8201;&#8212;&#8201;and luckily
the problem was in the ODF export filter, which is much more familiar to me,
compared to Calc core.</p></div>
<div class="paragraph"><p>Part of that larger feature was changes to the ODF filter, and
<a href="https://bugs.documentfoundation.org/show_bug.cgi?id=89245">the bug</a> was exactly
about touching shared ODF filter code to please Writer without testing other
LibreOffice applications.</p></div>
<div class="paragraph"><p>The actual problem was
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=3b40329f9a64b93b1e1230b1bff74ed8cda8cd70">overlapping
constants</a>: as in multiple constants had the same numeric value. Such issues
are sometimes hard to track down, in this case it wasn&#8217;t <em>that</em> hard: the
context filter that tried to make sure we don&#8217;t write duplicated XML
attributes removed the background property when it tried to guard header
repeat offsets.</p></div>
<div class="paragraph"><p>Given that this affected the LibreOffice 4.4 and 5.0 series, both branches got
a backport of the commit, and so the next release from those lines will have
the fix.</p></div>
</p><hr/></li>
<li><p>Tuesday, 18 August 2015<br /><a href="/blog/virtualdevice-leak.html">8884 VirtualDevices</a>
(<a href="/blog/virtualdevice-leak.html#disqus_thread">Comments</a>)
</p><p><div style="text-align: center; font-size: 0.6em;">
<img src="https://lh3.googleusercontent.com/-RAsPMFc8JVk/VdH9h_W4r_I/AAAAAAAAF6U/PDpQIbBtPKg/s475-Ic42/"/>
<p>(via <a href="http://www.teq.com/smart-pointers">teq</a>)</p>
</div>
<div class="paragraph"><p>If you are into C++ programming, you probably know that smart pointers are
not just literally strange things like the above ones. ;-) LibreOffice 5.0 got
<a href="https://gerrit.libreoffice.org/gitweb?p=core.git;a=blob;f=vcl/README.lifecycle;h=6b5cbd6e8df4bcc77b28b0e296e50a96ca8899a0;hb=HEAD">VclPtr</a>,
which is smart pointer specialized to VCL&#8217;s needs.</p></div>
<div class="paragraph"><p>Such refactorings are good things, except that there is no huge rework without
regressions. In <a href="https://bugs.documentfoundation.org/show_bug.cgi?id=93284">this
case</a> the WMF filter had 3 places where we were leaking VirtualDevices due to
a misconversion to the new VclPtr API. The problem was that the document had
135 images, WMF files to be exact. Now given that the leaks were during
parsing of WMF records (a WMF file consists of multiple WMF records), at the
end we leaked 8884 VirtualDevices. At first the problem was seen as
Windows-specific, as at least X on Linux has no problem with creating that
many VirtualDevices, but Windows' default resource limits are hit in this
case.</p></div>
<div class="paragraph"><p>A note about testing this bugfix effectively, so it never happens again. The
problem was that I wanted to create a minimal reproducer, but I also needed a
document with lots of WMF images, each complex enough to trigger the resource
limit. At the end I manually created a DOCX file that had the same image
copy&amp;pasted multiple times: that way we really imported them multiple times
(normally we notice that they&#8217;re the same, and only save the image to the file
once, and put multiple references to it), and because DOCX is also a ZIP
container, the test file can be still only 99KB instead of the original 17MB
RTF.</p></div>
<div class="paragraph"><p>Thanks to the
<a href="https://wiki.documentfoundation.org/QA/Bibisect/Windows#Versions">4.4 &#8594; 5.0
Windows bibisect repo</a>, it was immediately obvious that this is a VclPtr
problem, and then it was possible to identify the root cause, and finally see
that the bug title mentioning RTF was just container of the WMF images in this
case, the problem had nothing to with with RTF and the leak wasn&#8217;t
Windows-specific, either.</p></div>
</p><hr/></li>
<li><p>Tuesday, 28 July 2015<br /><a href="/blog/mail-merge-embedding.html">Mail merge embedding</a>
(<a href="/blog/mail-merge-embedding.html#disqus_thread">Comments</a>)
</p><p><div class="paragraph"><p>If you ever used the
<a href="https://help.libreoffice.org/Writer/Mail_Merge_Wizard">mail merge wizard</a> with
a Calc data source, then you know how it worked in the past: you&#8217;ve got 3
files: the .odt mail template, the .ods data source and a .odb data source
definition that defines how to access the .ods.</p></div>
<div class="paragraph"><p>The target of this <a href="http://www.muenchen.de/">LHM-funded project</a> was to get rid
of the .odb file and just embed it into the .odt mail template. Why?</p></div>
<div class="paragraph"><p>Here is the problem description from a user&#8217;s point of view: "When a mail
merge document is being saved a separate database file is being automatically
created. It links the Writer file to the spreadsheet (ODS, XLS, XLSX etc.) as
data source. This additional 2kB ODB file confuses users, they might delete it
without knowing to break the connection to the data source." An additional
problem is that because the non-embedded data source definition is part of the
user profile, you can&#8217;t just move the three files to an other machine, as .odb
registration will be missing there.</p></div>
<div class="paragraph"><p>If you are interested how this looks like, here is a demo (click on the image
to see the video):</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://youtu.be/5iQFZBOz8rM">
<img src="https://lh3.googleusercontent.com/-XDcWgOWKr2k/Vbc4blHURTI/AAAAAAAAF4E/VXFBglt-YmU/s800-Ic42/" alt="https://lh3.googleusercontent.com/-XDcWgOWKr2k/Vbc4blHURTI/AAAAAAAAF4E/VXFBglt-YmU/s800-Ic42/" />
</a>
</div>
</div>
<div class="paragraph"><p>That&#8217;s it for now&#8201;&#8212;&#8201;as usual the commits are in master, so you can try this
right now with a 5.1 <a href="http://dev-builds.libreoffice.org/daily/master/">daily
build</a>. :-)</p></div>
</p><hr/></li>
<li><p>Monday, 29 June 2015<br /><a href="/blog/ctags-sal-override.html">ctags vs override/SAL_OVERRIDE</a>
(<a href="/blog/ctags-sal-override.html#disqus_thread">Comments</a>)
</p><p><div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://lh3.googleusercontent.com/-9Hd40EVT8aw/VZBhBTZQdTI/AAAAAAAAFyM/AfymfTqKDFw/s0/" alt="https://lh3.googleusercontent.com/-9Hd40EVT8aw/VZBhBTZQdTI/AAAAAAAAFyM/AfymfTqKDFw/s0/" />
</div>
</div>
<div class="paragraph"><p>If you use <a href="http://ctags.sourceforge.net/">ctags</a> to help your LibreOffice
development, there are already good descriptions for that&#8201;&#8212;&#8201;e.g. for vim
there is one <a href="https://wiki.documentfoundation.org/Development/Vim#ctags">on the
TDF wiki</a>.</p></div>
<div class="paragraph"><p>What was problematic is that since C++11, <code>override</code> is a valid keyword
after a member function declaration, and we have our <code>SAL_OVERRIDE</code> macro that
I
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=3891d323cdc3c03154f5682baaeaa4b2ef015a63">added</a>
to be able to use it before all our supported compilers recognize it.
Unsupported parsers include ctags, so if a member function have SAL_OVERRIDE,
ctags only indexed the definition, not the declaration.</p></div>
<div class="paragraph"><p>I created patches to fix these problems in ctags, the
<a href="https://sourceforge.net/p/ctags/bugs/367/">override one</a> is probably
interesting for all C++ projects, the
<a href="https://github.com/vmiklos/ctags-svn/commit/ef53a231db5b428585324f266072b884e17bae52">SAL_OVERRIDE
one</a> is LibreOffice-specific.</p></div>
<div class="paragraph"><p>The hope is that the later will go away in the long run, so it won&#8217;t really be
a problem that ctags do not recognize that macro out of the box. :-)</p></div>
</p><hr/></li>
<li><p>Monday, 08 June 2015<br /><a href="/blog/resourcemodel.html">Cleanup of resourcemodel in LibreOffice</a>
(<a href="/blog/resourcemodel.html#disqus_thread">Comments</a>)
</p><p><div style="text-align: center; font-size: 0.6em;">
<img src="https://lh3.googleusercontent.com/-YxMHx754A4A/VXQbB0-TMBI/AAAAAAAAFos/Nx6SlKp1JF4/s400/"/>
<p>(via <a href="https://www.flickr.com/photos/jbparrott/9381120992/">jbparrott</a>)</p>
</div>
<div class="paragraph"><p>The <code>libreoffice-5-0</code> branch is created, and in each release cycle there is at
least one topic that was a long overdue cleanup. In this post, I&#8217;m describing
how and why the <code>writerfilter/inc/resourcemodel/</code> and
<code>writerfilter/source/resourcemodel/</code> directories disappeared&#8201;&#8212;&#8201;though
probably nobody will miss them. :-)</p></div>
<div class="paragraph"><p>The resourcemodel building block of writerfilter (that handles Writer&#8217;s DOCX
and RTF import in LibreOffice) was basically a bucket of old and unused
<a href="https://www.youtube.com/watch?v=MvgN5gCuLac">stuff</a>.  After the removal of the
unused <a href="http://vmiklos.hu/blog/doctok.html">.DOC tokenizer</a>, it turned out that
most of that code was just referring to itself or template code that was used
with a single type only (hello
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=45234fd21ad76b7732be4e5783cc7dd5dcf2daa2">TableManager</a>).
resourcemodel was about 6000 lines of code at the time LibreOffice was
started, and after some manual cleanup and moving the still needed small part
to dmapper (the shared part of the RTF / DOCX import), tools like
<a href="http://cgit.freedesktop.org/libreoffice/core/tree/compilerplugins/clang/unreffun.cxx">loplugin:unreffun</a>
and <a href="https://github.com/caolanm/callcatcher">callcatcher</a> helped to detect what
became truly unused&#8201;&#8212;&#8201;at the end resulting in the complete removal of these
directories.</p></div>
<div class="paragraph"><p>That means that after folding the
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=fcec34ffcc93f98be005b06c223e25c9c4e77cde">last
remaining header into dmapper</a>, the relevant
<a href="http://cgit.freedesktop.org/libreoffice/core/tree/writerfilter/README">documentation</a>
can hopefully now describe source contents easier, having just 4 directories:
the RTF and the DOCX tokenizer, the shared part and the UNO service
implementations. One less cryptic leftover nobody really knows what it is! ;-)</p></div>
</p><hr/></li>
</ul></div>
<a href="/blog/archive.html">more &raquo;</a>
<script type="text/javascript">
var disqus_shortname = 'vmiklos';
(function () {
 var s = document.createElement('script'); s.async = true;
 s.src = 'http://disqus.com/forums/vmiklos/count.js';
 (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>

</div>
</div>
</div>
</div>
</body>
</html>
