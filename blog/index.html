<!DOCTYPE html>
<html lang="en">

<head>
  <!-- ## for client-side less
  <link rel="stylesheet/less" type="text/css" href="https://vmiklos.hu/blog/theme/css/style.less">
  <script src="http://cdnjs.cloudflare.com/ajax/libs/less.js/1.7.3/less.min.js" type="text/javascript"></script>
  -->
  <link rel="stylesheet" type="text/css" href="https://vmiklos.hu/blog/theme/css/style.css">
  <link rel="stylesheet" type="text/css" href="https://vmiklos.hu/blog/theme/css/pygments.css">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Miklos Vajna">
  <meta name="description" content="Posts and writings by Miklos Vajna">

  <link href="https://vmiklos.hu/blog/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="What is Miklos hacking RSS" />


  <title>
    What is Miklos hacking
  </title>

<script type="text/javascript">
  var _paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//analytics.vmiklos.hu/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
</head>

<body>
  <aside>
    <div id="user_meta">
      <h2><a href="https://vmiklos.hu/blog">What is Miklos hacking</a></h2>
      <p></p>
      <ul>
        <li><a href="/" target="_blank">Root</a></li>
        <li><a href="https://planet.documentfoundation.org/" target="_blank">LibreOffice Blogs</a></li>
      </ul>
    </div>
  </aside>

  <main>
    <header>
      <p>
      <a href="https://vmiklos.hu/blog">Index</a> &brvbar; <a href="https://vmiklos.hu/blog/archives.html">Archives</a>
      &brvbar; <a href="https://vmiklos.hu/blog/feeds/all.rss.xml">RSS</a>
      </p>
    </header>

<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/sw-content-controls5.html">Content controls in Writer: titles and tags</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Thu 03 November 2022</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 3 minutes</p>
  </div>
  <div class="article_text">
    <p>Writer now supports titles and tags for content controls, which helps providing context for the
filled in text even if the placeholder text is replaced already.</p>
<p>This work is primarily for <a href="https://www.collaboraoffice.com/">Collabora Online</a>, see <a href="https://vmiklos.hu/blog/sw-content-controls4.html">the previous
post</a> for background.</p>
<h2 id="motivation">Motivation<a class="headerlink" href="#motivation" title="Permanent link">&para;</a></h2>
<p>
<figure><img src="https://share.vmiklos.hu/blog/sw-content-controls5/content-control-alias.png"><figcaption>Rendering of a title for a content control</figcaption>
</figure>
</p>
<p>Once several content controls are added to a document, it's easy to forget what was the exact
purpose of what content control. Think of a press release for example â€“ those regularly start with
a location and a date, but once this information is provided, one no longer knows which content
control was for which content.</p>
<p>Titles solve this problem for the user: similar to Writer's header/footer buttons, this button
appears when you enter the content control and reminds you what content is expected there, even if
the placeholder is already replaced.</p>
<p>Tags serve a similar purpose, but they are unique, machine-readable keys or identifiers, so once the
form is filled in, an external consumer can easily extract the information from the document, given
a specific tag.</p>
<h2 id="results-so-far">Results so far<a class="headerlink" href="#results-so-far" title="Permanent link">&para;</a></h2>
<p>Titles (also known as aliases) and tags are now not only preserved, but also we have a UI to create,
show, edit and delete them. This is available in the desktop rendering and also on the LOK API.</p>
<p>Somewhat related, in case a content control breaks into multiple lines or has formatting to break
into multiple text portions, we now only emit one PDF widget for it, taking the description of the
widget from the content control's title.</p>
<p>The last related improvement is that now we handle data binding for date content controls, which
means that you can specify a timestamp, a language and a date format, and we'll format that
timestamp and update the content control's string value at import time from DOCX.</p>
<h2 id="how-is-this-implemented">How is this implemented?<a class="headerlink" href="#how-is-this-implemented" title="Permanent link">&para;</a></h2>
<p>If you would like to know a bit more about how this works, continue reading... :-)</p>
<p>As usual, the high-level problem was addressed by a series of small changes:</p>
<!-- s/\([^ ]\+\) \(.*\)/- [\2](https:\/\/git.libreoffice.org\/core\/commit\/\1)/g -->

<ul>
<li><a href="https://git.libreoffice.org/core/commit/481a082469802ffce08cd8c110e715260015eb97">sw content controls: preserve alias</a></li>
<li><a href="https://git.libreoffice.org/core/commit/5262aab9d220675f616579720b4bb43ee03cccfb">sw content controls: preserve tag</a></li>
<li><a href="https://git.libreoffice.org/core/commit/a70f5f141c1e6013abb4c1b3219e017b2eea40a8">sw content controls: emit only one PDF widget for multiple text portions</a></li>
<li><a href="https://git.libreoffice.org/core/commit/b138d6c12aaeb0b87dce15ea52dd134cf1abf6ac">tdf#151190 sw content controls: make them read-write in protected sections</a></li>
<li><a href="https://git.libreoffice.org/core/commit/1a94cd8257ef4c462eaaa6d49bf4f26c9ac56a5e">sw content controls: add rendering for the alias</a></li>
<li><a href="https://git.libreoffice.org/core/commit/888a8c3ca70ed19309c15ff7b9f0968ece337cb5">sw content controls, alias and tag: add ODT filter</a></li>
<li><a href="https://git.libreoffice.org/core/commit/add110bad816fadeb96e7af0d4689389c04c263e">sw content controls, alias and tag: add UI</a></li>
<li><a href="https://git.libreoffice.org/core/commit/e368d26a7f24dc25f3d855511baabc128bc151e6">sw content controls, alias: add LOK API</a></li>
<li><a href="https://git.libreoffice.org/core/commit/122419be4f7bf576f7db5456b8b6b1f6f700487f">sw content controls, alias: add PDF export</a></li>
<li><a href="https://git.libreoffice.org/core/commit/58002ab85d992c7ac44d8bb4d135246b67aa5cc7">sw content controls: enable data binding for date</a></li>
</ul>
<h2 id="want-to-start-using-this">Want to start using this?<a class="headerlink" href="#want-to-start-using-this" title="Permanent link">&para;</a></h2>
<p>You can get a snapshot / demo of Collabora Office 22.05 and try it out yourself right now: <a href="https://www.collaboraoffice.com/collabora-office-latest-snapshot/">try
unstable snapshot</a>.  Collabora
intends to continue supporting and contributing to LibreOffice, the code is merged so we expect all
of this work will be available in TDF's next release too (7.5).</p>
  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/sw-content-controls4.html">Content controls in Writer: PDF export and combo box type</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Mon 03 October 2022</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 3 minutes</p>
  </div>
  <div class="article_text">
    <p>Writer now supports exporting content controls to PDF and a 7th content control type: it is possible
to differentiate between drop-downs and combo boxes.</p>
<p>This work is primarily for <a href="https://www.collaboraoffice.com/">Collabora Online</a>, see <a href="https://vmiklos.hu/blog/sw-content-controls3.html">the previous
post</a> for background.</p>
<h2 id="motivation">Motivation<a class="headerlink" href="#motivation" title="Permanent link">&para;</a></h2>
<p>
<figure><img src="https://share.vmiklos.hu/blog/sw-content-controls4/adobe-writer.png"><figcaption>PDF export of Writer content controls into PDF</figcaption>
</figure>
</p>
<p>Writer users can create fillable forms using content controls, but the PDF export only contained the
plain text representation of them. PDF can also have fillable widgets for form filling, so it's
logical to map content controls to PDF widgets.</p>
<p>A perfect mapping is not possible, since PDF widgets are always a single rectangle and Writer
content controls is a list of rectangles (text portions), but this doesn't cause a problem in most
cases. The size of the PDF rectangle is determined based on the placeholder's size from Writer.</p>
<p>Benefits includes not having to insert a control shape, manually positioned to look like it's in
line with the surrounding text. An other benefit is that this way the widget's style (font name,
size, etc) can be specified using Writer styles, not with shape properties. It's also interesting
that Word itself doesn't seem to support content controls in its PDF export at the time of writing.</p>
<h2 id="results-so-far">Results so far<a class="headerlink" href="#results-so-far" title="Permanent link">&para;</a></h2>
<p>PDF export now automatically turns Writer content controls into fillable widgets for the rich text,
plain text, checkbox, drop-down, combo box and date types.</p>
<p>Combo box itself is a new type: now combo box content can be either free-form or one of its list
items, while drop-down can only be one of its list items.</p>
<h2 id="how-is-this-implemented">How is this implemented?<a class="headerlink" href="#how-is-this-implemented" title="Permanent link">&para;</a></h2>
<p>If you would like to know a bit more about how this works, continue reading... :-)</p>
<p>As usual, the high-level problem was addressed by a series of small changes:</p>
<ul>
<li><a href="https://git.libreoffice.org/core/commit/82d90529dc2b3cb8359dec78852cbd910a66d275">sw content controls, rich text: add initial PDF export</a></li>
<li><a href="https://git.libreoffice.org/core/commit/9bad5be0ffdcdee92d40162b598ed2ab2815e5d5">sw content controls, checkbox: add PDF export</a></li>
<li><a href="https://git.libreoffice.org/core/commit/6b2433f3b66c1f118dabcd40924122deb2d4f204">sw content controls, dropdown: add PDF export</a></li>
<li><a href="https://git.libreoffice.org/core/commit/f7408cf0e472be91bdb7a4d2a4b8da3eb9a049a9">sw content controls, date: add PDF export</a></li>
<li><a href="https://git.libreoffice.org/core/commit/493b10997053882d06803156a98ae8924bf7660d">sw content controls: add PDF export of font properties</a></li>
<li><a href="https://git.libreoffice.org/core/commit/08bce8eeb2e18c7cea4108dbfc2519ada56e8b61">sw content controls: fix getString() and setString() on SwXContentControl</a></li>
<li><a href="https://git.libreoffice.org/core/commit/de90c192cb8f1f03a4028493d8bfe9a127a76b2a">sw content controls, plain text: enable DOCX filter with data binding</a></li>
<li><a href="https://git.libreoffice.org/core/commit/addfb3cce0f7ce8fbd0b169d467b6956ed95dbb5">sw content controls: add a11y description for PDF export</a></li>
<li><a href="https://git.libreoffice.org/core/commit/276f3a3ce52ca422bf5ebccfa2c926d3e87d5eab">sw content controls, combo box: add doc model &amp; UNO API</a></li>
<li><a href="https://git.libreoffice.org/core/commit/37656a47d8797d45d706a17ab8843dcb8db90bbc">sw content controls, combo box: make the dropdown case read-only</a></li>
<li><a href="https://git.libreoffice.org/core/commit/21d93d8d2ffd9c5d5cfe9064590b35e0727295c9">sw content controls, combo box: add ODT filter</a></li>
<li><a href="https://git.libreoffice.org/core/commit/01b1f57a90172a76faa1489b3b72250ee76169a6">sw content controls, combo box: add DOCX filter</a></li>
<li><a href="https://git.libreoffice.org/core/commit/49f1bf56ebfa3c96aa90835c1121eb827d713b9d">sw content controls, combo box: add insert UI</a></li>
<li><a href="https://git.libreoffice.org/core/commit/82b9ff35649cd67ca16296676d2ad1e4eff15493">sw content controls, combo box: add PDF export</a></li>
</ul>
<h2 id="want-to-start-using-this">Want to start using this?<a class="headerlink" href="#want-to-start-using-this" title="Permanent link">&para;</a></h2>
<p>You can get a snapshot / demo of Collabora Office 22.05 and try it out yourself right now: <a href="https://www.collaboraoffice.com/collabora-office-latest-snapshot/">try
unstable snapshot</a>.  Collabora
intends to continue supporting and contributing to LibreOffice, the code is merged so we expect all
of this work will be available in TDF's next release too (7.5).</p>
  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/sd-video-crop.html">Cropped video for media shapes in Impress</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Thu 01 September 2022</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 3 minutes</p>
  </div>
  <div class="article_text">
    <p>Impress now supports cropped videos in slide edit mode and during slideshow for documents imported
from PowerPoint.</p>
<p>First, thanks to our partner <a href="https://www.suse.com/">SUSE</a> for working with
<a href="https://www.collaboraoffice.com/">Collabora</a> to make this possible.</p>
<h2 id="motivation">Motivation<a class="headerlink" href="#motivation" title="Permanent link">&para;</a></h2>
<p>
<figure><img src="https://share.vmiklos.hu/blog/sd-video-crop/new.png"><figcaption>PowerPoint-style cropped video in Impress</figcaption>
</figure>
</p>
<p>PowerPoint handles videos by taking a preview bitmap from the video, and then it allows users to
apply various effects on that bitmap, like cropping. The complex aspect of this is that such filters
are also respected while playing the video as well.</p>
<p>Impress didn't store such properties on the media shape, which lead to distorted aspect ratio when
playing some cropped videos from PPTX files. This lead to this preview in Impress before the work:</p>
<p>
<figure><img src="https://share.vmiklos.hu/blog/sd-video-crop/bad.png"><figcaption>Video with lost cropping in Impress</figcaption>
</figure>
</p>
<h2 id="results-so-far">Results so far<a class="headerlink" href="#results-so-far" title="Permanent link">&para;</a></h2>
<p>The first problem was that the Impress preview was picked from the 3rd second of the video
(presumably to avoid a black preview in many videos that start with a short black fade-in), while
PowerPoint can store an explicit preview from the video (seems to be the first frame), so no matter
what effects you apply, the previews were just different as the source bitmap was different. This
could be fixed by looking for an explicitly provided bitmap for the video first, and only then
asking the various <code>avmedia/</code> backends to produce a preview.</p>
<p>Once the preview's initial bitmap was OK, it was necessary to take cropping into account. This was
first done for the preview bitmap, and then also for the gstreamer backend (the relevant one for
Linux, as a start) of <code>avmedia/</code>, which is responsible for the actual video playback. The gstreamer
bits were done by first creating a
<a href="https://gstreamer.freedesktop.org/documentation/videocrop/videocrop.html">videocrop</a> element and
then connecting that to the existing
<a href="https://gstreamer.freedesktop.org/documentation/playback/playbin.html#playbin:video-filter">playbin</a>.</p>
<p>With these sorted out, we get rendering which matches the reference:</p>
<p>
<figure><img src="https://share.vmiklos.hu/blog/sd-video-crop/ref.png"><figcaption>Cropped video in PowerPoint</figcaption>
</figure>
</p>
<p>The last step was to load/save the explicit preview and the crop from/to ODF as well, not only PPTX.
We use a markup like this to store the information:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;style:style</span> <span class="na">style:name=</span><span class="s">&quot;gr1&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;style:graphic-properties</span> <span class="na">fo:clip=</span><span class="s">&quot;rect(0cm, 1.356cm, 0cm, 1.356cm)&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/style:style&gt;</span>
</code></pre></div>

<p>And now that the <code>gr1</code> automatic style is defined, we can refer to it from a media shape:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;draw:frame</span> <span class="na">draw:name=</span><span class="s">&quot;test&quot;</span> <span class="na">draw:style-name=</span><span class="s">&quot;gr1&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;draw:plugin</span> <span class="na">xlink:href=</span><span class="s">&quot;...&quot;</span> <span class="na">xlink:type=</span><span class="s">&quot;simple&quot;</span> <span class="na">xlink:show=</span><span class="s">&quot;embed&quot;</span> <span class="na">xlink:actuate=</span><span class="s">&quot;onLoad&quot;</span> <span class="na">draw:mime-type=</span><span class="s">&quot;application/vnd.sun.star.media&quot;</span><span class="nt">&gt;</span>
    ...
  <span class="nt">&lt;/draw:plugin&gt;</span>
  <span class="nt">&lt;draw:image</span> <span class="na">xlink:href=</span><span class="s">&quot;Pictures/MediaPreview1.png&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/draw:frame&gt;</span>
</code></pre></div>

<p>The nice property of this markup is that automatic styles are already used for other shapes and
image previews are also used for e.g. table shapes, so this is just using existing markup in a new
context, but the ODF spec already allows this markup.</p>
<h2 id="how-is-this-implemented">How is this implemented?<a class="headerlink" href="#how-is-this-implemented" title="Permanent link">&para;</a></h2>
<p>If you would like to know a bit more about how this works, continue reading... :-)</p>
<p>As usual, the high-level problem was addressed by a series of small changes:</p>
<ul>
<li><a href="https://gerrit.libreoffice.org/c/core/+/138763">Related: tdf#149971 svx: support explicitly provided snapshots for media shapes</a></li>
<li><a href="https://gerrit.libreoffice.org/c/core/+/138808">Related: tdf#149971 avmedia: add doc model and render for crop of media objects</a></li>
<li><a href="https://gerrit.libreoffice.org/c/core/+/138867">tdf#149971 avmedia: implement video crop support in the gsteamer backend</a></li>
<li><a href="https://gerrit.libreoffice.org/c/core/+/138959">avmedia: implement video crop support in the ODP filter</a></li>
<li><a href="https://gerrit.libreoffice.org/c/core/+/138971">xmloff: extract ExportGraphicPreview() from XMLShapeExport::ImpExportTableShape()</a></li>
</ul>
<p>User interface to create such a crop, support for other video effects (e.g. black-and-white) and
other backends (Windows, macOS) could be done, but is future work currently.</p>
<h2 id="want-to-start-using-this">Want to start using this?<a class="headerlink" href="#want-to-start-using-this" title="Permanent link">&para;</a></h2>
<p>You can get a snapshot / demo of Collabora Office and try it out yourself right now: <a href="https://www.collaboraoffice.com/collabora-office-latest-snapshot/">try unstable
snapshot</a>.  Collabora intends to
continue supporting and contributing to LibreOffice, the code is merged so we expect all of this
work will be available in TDF's next release too (7.5).</p>
  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/sw-content-controls3.html">Content controls in Writer: the plain text type</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Mon 01 August 2022</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 2 minutes</p>
  </div>
  <div class="article_text">
    <p>Writer now supports a 6th content control type: it is possible to insert a plain text content
control.</p>
<p>This work is primarily for <a href="https://www.collaboraoffice.com/">Collabora
Online</a>, done as a
<a href="https://vmiklos.hu/blog/hackweek-2021.html">HackWeek</a> project, but the feature is
fully available in desktop Writer as well.</p>
<h2 id="motivation">Motivation<a class="headerlink" href="#motivation" title="Permanent link">&para;</a></h2>
<p>
<figure><img src="https://share.vmiklos.hu/blog/sw-content-controls3/sw-content-control-plain-text.png"><figcaption>Word-style plain text content control, user interface</figcaption>
</figure>
</p>
<p>Writer users can put a content control around a piece of rich text, see
<a href="https://vmiklos.hu/blog/sw-content-controls2.html">Content controls in Writer: dropdown, picture and date
types</a> for the first five types.</p>
<p>The next step in this journey is plain text: even if one of the big advantages of content controls
over input fields is that they allow rich formatting, sometimes you want to restrict this. For
example, if one has to fill in their name, then it makes no sense to mark the family name as bold
while leaving the given name as non-bold. This would just lead to inconsistent look.</p>
<h2 id="results-so-far">Results so far<a class="headerlink" href="#results-so-far" title="Permanent link">&para;</a></h2>
<p>There is now a new Form â†’ Content Controls â†’ Insert Plain Text Content Control
menu item to create a plain text content control. If you try to make a
selection that is a subset of the text inside the content control and you try
to format it, the whole text in the content control is formatted to maintain
the invariant that plain text has no formatting itself, just the formatting of
the whole content control.</p>
<p>As usual, you can delete this content control later. You can also load/save it
to ODT/DOCX and it's preserved.</p>
<h2 id="how-is-this-implemented">How is this implemented?<a class="headerlink" href="#how-is-this-implemented" title="Permanent link">&para;</a></h2>
<p>If you would like to know a bit more about how this works, continue reading... :-)</p>
<p>As usual, the high-level problem was addressed by a series of small changes:</p>
<ul>
<li><a href="https://gerrit.libreoffice.org/c/core/+/137263">sw content controls, plain text: add doc model &amp; UNO API</a></li>
<li><a href="https://gerrit.libreoffice.org/c/core/+/137280">sw content controls, plain text: apply formatting to the entire contents</a></li>
<li><a href="https://gerrit.libreoffice.org/c/core/+/137340">sw content controls, plain text: add ODT filter</a></li>
<li><a href="https://gerrit.libreoffice.org/c/core/+/137349">sw: fix heap-use-after-free in SwTextNode::InsertHint()</a></li>
<li><a href="https://gerrit.libreoffice.org/c/core/+/137398">sw content controls, plain text: add DOCX export</a></li>
<li><a href="https://gerrit.libreoffice.org/c/core/+/137399">sw content controls, plain text: add DOCX import</a></li>
<li><a href="https://gerrit.libreoffice.org/c/core/+/137447">sw content controls, plain text: add insert UI</a></li>
</ul>
<h2 id="want-to-start-using-this">Want to start using this?<a class="headerlink" href="#want-to-start-using-this" title="Permanent link">&para;</a></h2>
<p>You can get a snapshot / demo of Collabora Office 22.05 and try it out yourself right now: <a href="https://www.collaboraoffice.com/collabora-office-latest-snapshot/">try
unstable snapshot</a>.  Collabora
intends to continue supporting and contributing to LibreOffice, the code is merged so we expect all
of this work will be available in TDF's next release too (7.5).</p>
  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/sd-theme-shape-fill.html">Document themes in Impress: shape fill</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Mon 04 July 2022</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 4 minutes</p>
  </div>
  <div class="article_text">
    <p>Impress now has the next step of document theme support: it is possible to refer to the theme colors
from shape fill colors (including effects).</p>
<p>This work is primarily for <a href="https://www.collaboraoffice.com/">Collabora Online</a>, but the feature is
fully available in desktop Impress as well.</p>
<h2 id="motivation">Motivation<a class="headerlink" href="#motivation" title="Permanent link">&para;</a></h2>
<p>
<figure><img src="https://share.vmiklos.hu/blog/sd-theme-shape-fill/ui.png"><figcaption>PowerPoint-style themed shape fill, user interface</figcaption>
</figure>
</p>
<p>PowerPoint users can attach a set of colors (and fonts, etc.) to master pages, and then refer to
these in many areas, like shape text or shape fill. It was already possible to define theme colors
and refer to them from shape text (see <a href="https://vmiklos.hu/blog/sd-theme-shape-text.html">Start of document themes in Impress: shape
text</a> for details).</p>
<p>The next step in this journey is shape fill: if your shape is filled with some color, it can be a
theme color, as visible on the above screenshot. One interesting aspect of this is that the default
shape fill color can now depend on the master page, and it may not be the same for all slides (this
is what would happen with styles, when not using theming).</p>
<h2 id="results-so-far">Results so far<a class="headerlink" href="#results-so-far" title="Permanent link">&para;</a></h2>
<p>Here is a demo that shows how it works:</p>
<p>If one opens the <code>svx/qa/unit/data/theme.pptx</code> test file from core.git, it looks like this:</p>
<p>
<figure><img src="https://share.vmiklos.hu/blog/sd-theme-shape-fill/old.png"><figcaption>PowerPoint-style themed shape fill, after opening</figcaption>
</figure>
</p>
<p>The middle row has 3 rounded rectangles: the first is filled with the 'Accent 1' color, the second is
the same, but 60% lighter and finally the last one is the same, but 25% darker.</p>
<p>Here is how you can change what the 'Accent 1' color is:</p>
<ul>
<li>Click 'Master View' on the sidebar to go to the master of the current slide.</li>
<li>Right click -&gt; 'Slide Properties' opens the 'Slide Properties' dialog.</li>
<li>The 'Theme' page has an 'Accent 1' row, with a blue color.</li>
<li>Change that to an orange color: click on the 'Accent 1' drop-down, then select 'Theme colors',
  finally the 6th choice is orange in the first row -- this comes from the document's theme.</li>
<li>Click 'OK' to close the dialog, followed by 'Close Master View' on the sidebar.</li>
</ul>
<p>Here is how your shapes now look like:</p>
<p>
<figure><img src="https://share.vmiklos.hu/blog/sd-theme-shape-fill/new.png"><figcaption>PowerPoint-style themed shape fill, after changing the theme</figcaption>
</figure>
</p>
<p>What you can see here is that the color effect (darker, lighter, default) of the rounded rectangles'
fill color was preserved, but all the blue colors are replaced with orange.</p>
<p>As a cherry on the cake, now if you insert a new shape, that will also have an orange fill color by
default as well.</p>
<p>You can see how this is useful when designing templates: a designer can create something
good-looking, and all you have to do is to set the theme to the colors of your organization, and
you're done.</p>
<h2 id="how-is-this-implemented">How is this implemented?<a class="headerlink" href="#how-is-this-implemented" title="Permanent link">&para;</a></h2>
<p>If you would like to know a bit more about how this works, continue reading... :-)</p>
<p>As usual, the high-level problem was addressed by a series of small changes:</p>
<ul>
<li><a href="https://gerrit.libreoffice.org/c/core/+/128248">sd theme: fix applying new colors after theme change for group shapes</a></li>
<li><a href="https://gerrit.libreoffice.org/c/core/+/130050">sd theme: add doc model for shape fill color</a></li>
<li><a href="https://gerrit.libreoffice.org/c/core/+/130467">sd theme: add UNO API for shape fill color</a></li>
<li><a href="https://gerrit.libreoffice.org/c/core/+/130894">sd theme: add rendering for shape fill color</a></li>
<li><a href="https://gerrit.libreoffice.org/c/core/+/131268">sd theme: add PPTX import for shape fill color</a></li>
<li><a href="https://gerrit.libreoffice.org/c/core/+/131717">sd theme: add ODP import/export for shape fill color</a></li>
<li><a href="https://gerrit.libreoffice.org/c/core/+/131984">sd theme: add PPTX export for shape fill color</a></li>
<li><a href="https://gerrit.libreoffice.org/c/core/+/132327">sd theme: add UI (area dialog) for shape fill color</a></li>
<li><a href="https://gerrit.libreoffice.org/c/core/+/132646">sd theme: add UI (sidebar) for shape fill color</a></li>
<li><a href="https://gerrit.libreoffice.org/c/core/+/132933">sd theme: add UNO API for shape fill color effects</a></li>
<li><a href="https://gerrit.libreoffice.org/c/core/+/133297">sd theme: add rendering for shape fill color effects</a></li>
<li><a href="https://gerrit.libreoffice.org/c/core/+/133525">sd theme: add PPTX import for shape fill color effects</a></li>
<li><a href="https://gerrit.libreoffice.org/c/core/+/133843">sd theme: add ODP import/export for shape fill color effects</a></li>
<li><a href="https://gerrit.libreoffice.org/c/core/+/133908">tdf#148929 sd theme: limit PPTX import for shape fill effects to lum mod/off</a></li>
<li><a href="https://gerrit.libreoffice.org/c/core/+/134208">tdf#148961 sd theme: add PPTX export for shape fill color effects</a></li>
<li><a href="https://gerrit.libreoffice.org/c/core/+/134552">sd theme: add UI (area dialog) for shape fill color effects</a></li>
<li><a href="https://gerrit.libreoffice.org/c/core/+/134883">tdf#149205 sd theme: fix PPTX export loosing dk1 and lt1 colors</a></li>
<li><a href="https://gerrit.libreoffice.org/c/core/+/134952">sd theme: add UI (sidebar) for shape fill color effects</a></li>
<li><a href="https://gerrit.libreoffice.org/c/core/+/136138">sd theme: consider accent1 color when inserting shape with solid fill</a></li>
<li><a href="https://gerrit.libreoffice.org/c/core/+/136599">tdf#149748 sd theme: fix crash on selecting none from color bar</a></li>
</ul>
<h2 id="want-to-start-using-this">Want to start using this?<a class="headerlink" href="#want-to-start-using-this" title="Permanent link">&para;</a></h2>
<p>You can get a snapshot / demo of Collabora Office 22.05 and try it out yourself right now: <a href="https://www.collaboraoffice.com/collabora-office-latest-snapshot/">try
unstable snapshot</a>.  Collabora
intends to continue supporting and contributing to LibreOffice, the code is merged so we expect all
of this work will be available in TDF's next release too (7.4).</p>
  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/sw-content-controls2.html">Content controls in Writer: dropdown, picture and date types</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Wed 01 June 2022</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 5 minutes</p>
  </div>
  <div class="article_text">
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>Writer already had <a href="https://vmiklos.hu/blog/sw-content-controls.html">rich text and checkbox content
controls</a>: a new way to set properties on a piece of text, primarily for form filling purposes. This
feature now gained 3 additional types: dropdown, picture and date picker types. This improves
compatibility with the DOCX format: there are now 5 inline content control types we can now import.</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-content-controls2/feature.png" alt="https://share.vmiklos.hu/blog/sw-content-controls2/feature.png" />
</div>
<div class="title">Figure 1. Word-style inline content controls in Writer.</div>
</div>
<div class="paragraph"><p>First, thanks to <a href="https://dapsi.ngi.eu/">NGI DAPSI</a> who made this work by
<a href="https://www.collaboraoffice.com/">Collabora</a> possible.</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-content-controls/eu.png" alt="https://share.vmiklos.hu/blog/sw-content-controls/eu.png" />
</div>
<div class="title">Figure 2. This project has received funding from the European Unionâ€™s Horizon 2020 research and innovation programme under grant agreement No 871498</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_motivation">Motivation</h2>
<div class="sectionbody">
<div class="paragraph"><p>Word users expect to be able to import their document to Writer and experience a matching feature
set: form filling is not an exception. Word provides several content control kinds (inline, block,
row and cell content controls), this project focuses on inline ("run") content controls.</p></div>
<div class="paragraph"><p>In the scope of inline content controls, the above linked blog post already described the rich text
and checkbox types. In this post, we&#8217;ll focus on the new dropdown, picture and date content
controls.</p></div>
<div class="paragraph"><p>You might wonder why content controls are useful, since Writer already has form controls and
fieldmarks, which provide something similar. Here are some benefits:</p></div>
<div class="ulist"><ul>
<li>
<p>
Dropdown content controls have a list of dropdown items. Each item is a display-text and value
  pair, allowing to differentiate between a human-readable string and a machine-readable value.
  Fieldmarks only handled (machine-readable) values, resulting in document text different from Word.
</p>
</li>
<li>
<p>
Picture content controls allow the author of a form to pre-format the image before the filler of
  the form inserts the actual image. Writer already had placeholder fields for images in the past,
  but that was just text, allowing image format only after insertion of the actual image.
</p>
</li>
<li>
<p>
Date content controls were emulated with Writer fieldmarks in the past, which created trouble
  during export, since Word itself doesn&#8217;t have a date form-field.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_results">Results</h2>
<div class="sectionbody">
<div class="paragraph"><p>The feature consists of menu items to insert dropdown/picture/date content controls, and then you
can interact with the inserted content controls or with their properties:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-content-controls2/menu.png" alt="https://share.vmiklos.hu/blog/sw-content-controls2/menu.png" />
</div>
<div class="title">Figure 3. Menu items to insert drop-down, picture and date content controls.</div>
</div>
<div class="paragraph"><p>Drop-down content controls show a dropdown button when you&#8217;re inside the content control:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-content-controls2/dropdown.png" alt="https://share.vmiklos.hu/blog/sw-content-controls2/dropdown.png" />
</div>
<div class="title">Figure 4. A drop-down content control.</div>
</div>
<div class="paragraph"><p>This is similar to dropdown fields, just allows display-text and value pairs, not limited to just
values.</p></div>
<div class="paragraph"><p>Picture content controls contain a single as-character image, but you can interact with them: clicking on
the content control opens the file open dialog to provide a replacement for the placeholder:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-content-controls2/picture.png" alt="https://share.vmiklos.hu/blog/sw-content-controls2/picture.png" />
</div>
<div class="title">Figure 5. Picture controls.</div>
</div>
<div class="paragraph"><p>And these content controls can be saved to ODT and DOCX.</p></div>
<div class="paragraph"><p>There is also a content control properties dialog, which allows setting if the content controls are
in placeholder mode or not:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-content-controls2/properties.png" alt="https://share.vmiklos.hu/blog/sw-content-controls2/properties.png" />
</div>
<div class="title">Figure 6. Content control properties.</div>
</div>
<div class="paragraph"><p>It has additional widgets for dropdowns. There is UI to create, update or delete these list items:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-content-controls2/properties-inner.png" alt="https://share.vmiklos.hu/blog/sw-content-controls2/properties-inner.png" />
</div>
<div class="title">Figure 7. Content control properties inner UI for list items.</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_is_this_implemented">How is this implemented?</h2>
<div class="sectionbody">
<div class="paragraph"><p>If you would like to know a bit more about how this works, continue reading&#8230; :-)</p></div>
<div class="paragraph"><p>As usual, the high-level problem was addressed by a series of incremental commits:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/133742">https://gerrit.libreoffice.org/c/core/+/133742</a> sw content controls, drop-down: add doc model &amp; UNO API
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/133801">https://gerrit.libreoffice.org/c/core/+/133801</a> sw content controls: enable indicator on the RHS of the content control end
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/133874">https://gerrit.libreoffice.org/c/core/+/133874</a> sw content controls, drop-down: show list items on click
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/133915">https://gerrit.libreoffice.org/c/core/+/133915</a> sw content controls, drop-down: select list item on click
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/134034">https://gerrit.libreoffice.org/c/core/+/134034</a> sw content controls, drop-down: add ODT filter
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/134041">https://gerrit.libreoffice.org/c/core/+/134041</a> sw content controls: only try to insert placeholders if there is no selection
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/134104">https://gerrit.libreoffice.org/c/core/+/134104</a> sw content controls, drop-down: add DOCX export
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/134143">https://gerrit.libreoffice.org/c/core/+/134143</a> sw content controls, drop-down: add DOCX import
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/134151">https://gerrit.libreoffice.org/c/core/+/134151</a> sw content controls: introduce a word breaking dummy char at the end
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/134215">https://gerrit.libreoffice.org/c/core/+/134215</a> sw content controls, dropdown: add insert UI
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/134239">https://gerrit.libreoffice.org/c/core/+/134239</a> sw content controls: fixes for the ending dummy char
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/134256">https://gerrit.libreoffice.org/c/core/+/134256</a> sw content controls, dropdown: add LOK API
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/134278">https://gerrit.libreoffice.org/c/core/+/134278</a> sw content controls, dropdown: add an initial properties dialog
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/134379">https://gerrit.libreoffice.org/c/core/+/134379</a> sw content controls, dropdown: edit list items in the properties dialog
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/134405">https://gerrit.libreoffice.org/c/core/+/134405</a> sw content controls, dropdown: edit list items: add modify and delete
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/134457">https://gerrit.libreoffice.org/c/core/+/134457</a> sw content controls, picture: add doc model &amp; UNO API
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/134511">https://gerrit.libreoffice.org/c/core/+/134511</a> sw content controls, picture: replace placeholder image on click
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/134538">https://gerrit.libreoffice.org/c/core/+/134538</a> sw content controls, dropdown: disable NOP buttons in the property dialog
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/134595">https://gerrit.libreoffice.org/c/core/+/134595</a> sw content controls, picture: add ODT filter
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/134657">https://gerrit.libreoffice.org/c/core/+/134657</a> sw content controls, picture: add DOCX filter
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/134681">https://gerrit.libreoffice.org/c/core/+/134681</a> sw content controls, picture: add insert UI
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/134750">https://gerrit.libreoffice.org/c/core/+/134750</a> sw content controls, picture: add LOK API
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/134847">https://gerrit.libreoffice.org/c/core/+/134847</a> sw content controls, date: add doc model &amp; UNO API
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/134926">https://gerrit.libreoffice.org/c/core/+/134926</a> sw content controls, date: show a date picker on click
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/134977">https://gerrit.libreoffice.org/c/core/+/134977</a> sw content controls, date: add ODT filter
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/135022">https://gerrit.libreoffice.org/c/core/+/135022</a> sw content controls, picture: add LOK API testcase
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/135033">https://gerrit.libreoffice.org/c/core/+/135033</a> sw content controls, date: add DOCX export
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/135035">https://gerrit.libreoffice.org/c/core/+/135035</a> sw content controls, date: add current date handling
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/135039">https://gerrit.libreoffice.org/c/core/+/135039</a> sw content controls, date: preserve more properties
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/135109">https://gerrit.libreoffice.org/c/core/+/135109</a> sw content controls, date: add DOCX import
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/135153">https://gerrit.libreoffice.org/c/core/+/135153</a> sw content controls, date: add insert UI
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/135214">https://gerrit.libreoffice.org/c/core/+/135214</a> sw content controls, date: add LOK API
</p>
</li>
</ul></div>
<div class="paragraph"><p>To make this more interesting, Rashesh Padia of Collabora continued exposing this in Collabora
Online, see the PR at <a href="https://github.com/CollaboraOnline/online/pull/4803">https://github.com/CollaboraOnline/online/pull/4803</a>.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_want_to_start_using_this">Want to start using this?</h2>
<div class="sectionbody">
<div class="paragraph"><p>You can get a snapshot / demo of Collabora Office 22.05 and try it out yourself right now:
<a href="https://www.collaboraoffice.com/collabora-office-latest-snapshot/">try unstable snapshot</a>.  Collabora
intends to continue supporting and contributing to LibreOffice, the code is merged so we expect all
of this work will be available in TDF&#8217;s next release too (7.4).</p></div>
</div>
</div>

  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/sw-content-controls.html">Content controls in Writer</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Tue 03 May 2022</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 4 minutes</p>
  </div>
  <div class="article_text">
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>Writer now has the start of content controls: a new way to set properties on a piece of text,
primarily for form filling purposes. This feature improves compatibility with the DOCX format:
inline content control types "rich text" and "checkbox" are the first two types we can now import.</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-content-controls/feature.png" alt="https://share.vmiklos.hu/blog/sw-content-controls/feature.png" />
</div>
<div class="title">Figure 1. Word-style inline content controls in Writer.</div>
</div>
<div class="paragraph"><p>First, thanks to <a href="https://dapsi.ngi.eu/">NGI DAPSI</a> who made this work by
<a href="https://www.collaboraoffice.com/">Collabora</a> possible.</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-content-controls/eu.png" alt="https://share.vmiklos.hu/blog/sw-content-controls/eu.png" />
</div>
<div class="title">Figure 2. This project has received funding from the European Unionâ€™s Horizon 2020 research and innovation programme under grant agreement No 871498</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_motivation">Motivation</h2>
<div class="sectionbody">
<div class="paragraph"><p>Word users expect to be able to import their document to Writer and experience a matching feature
set: form filling is not an exception. Word provides several content control kinds (inline, block,
row and cell content controls), this project focuses on inline ("run") content controls.</p></div>
<div class="paragraph"><p>In the scope of inline content controls, the plan is to support rich text, checkbox, dropdown,
picture and date content controls. This blog post presents the already implemented rich text and
checkbox types.</p></div>
<div class="paragraph"><p>You might wonder why content controls are useful, since Writer already has form controls and
fieldmarks, which provide something similar. Here are some properties of content controls, which
make them incompatible with field-based fillable forms or form controls:</p></div>
<div class="ulist"><ul>
<li>
<p>
inline content controls can&#8217;t span over multiple paragraphs, while this is allowed for fieldmarks
  (bookmark-based fields)
</p>
</li>
<li>
<p>
content controls must be well-formed XML elements, this allows nesting (while Writer fields can&#8217;t
  be nested), but does not allow the start/end position to be a random place in the document (while
  this is allowed for fieldmarks, which have separate XML elements for start and end)
</p>
</li>
<li>
<p>
content controls just have a set of properties, while fieldmarks are supposed to have a field
  command and a result (with a separator between the two)
</p>
</li>
<li>
<p>
content controls can contain rich text (full set of character formatting), while Writer fields can
  only have one character formatting (e.g. half of the field can&#8217;t be bold)
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_results">Results</h2>
<div class="sectionbody">
<div class="paragraph"><p>The feature consists of menu items to insert rich text or checkbox content controls, and then you
can interact with the inserted content controls:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-content-controls/menu.png" alt="https://share.vmiklos.hu/blog/sw-content-controls/menu.png" />
</div>
<div class="title">Figure 3. Menu items to insert rich text and checkbox content controls.</div>
</div>
<div class="paragraph"><p>Rich text content controls simply show an indicator when you&#8217;re inside the content control:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-content-controls/rich-text.png" alt="https://share.vmiklos.hu/blog/sw-content-controls/rich-text.png" />
</div>
<div class="title">Figure 4. A rich text content control.</div>
</div>
<div class="paragraph"><p>This is similar to input fields, just allows rich text content, not limited to plain text.</p></div>
<div class="paragraph"><p>Checkbox content controls contain a single character, but you can interact with them: clicking on
the content control toggles the checked state of the checkbox:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-content-controls/checkbox.png" alt="https://share.vmiklos.hu/blog/sw-content-controls/checkbox.png" />
</div>
<div class="title">Figure 5. Checkbox content controls.</div>
</div>
<div class="paragraph"><p>And these content controls can be saved to ODT and DOCX.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_how_is_this_implemented">How is this implemented?</h2>
<div class="sectionbody">
<div class="paragraph"><p>If you would like to know a bit more about how this works, continue reading&#8230; :-)</p></div>
<div class="paragraph"><p>As usual, the high-level problem was addressed by a series of incremental commits:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/132291">https://gerrit.libreoffice.org/c/core/+/132291</a> sw content controls: add document model
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/132350">https://gerrit.libreoffice.org/c/core/+/132350</a> sw content controls: add UNO API to insert this
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/132404">https://gerrit.libreoffice.org/c/core/+/132404</a> sw content controls: add UNO API to insert this with custom props
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/132491">https://gerrit.libreoffice.org/c/core/+/132491</a> sw content controls: include this in the UNO API text portion enum
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/132556">https://gerrit.libreoffice.org/c/core/+/132556</a> sw content controls: add initial layout support
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/132618">https://gerrit.libreoffice.org/c/core/+/132618</a> sw content controls: add overlay to render a border around the text portions
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/132652">https://gerrit.libreoffice.org/c/core/+/132652</a> sw content controls: select the content on click when showing placeholder
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/132717">https://gerrit.libreoffice.org/c/core/+/132717</a> sw content controls: add ODT export
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/132804">https://gerrit.libreoffice.org/c/core/+/132804</a> sw content controls: add ODT import
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/132875">https://gerrit.libreoffice.org/c/core/+/132875</a> sw content controls: add initial DOCX export
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/132944">https://gerrit.libreoffice.org/c/core/+/132944</a> sw content controls, DOCX export: handle SDT end at para end
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/133195">https://gerrit.libreoffice.org/c/core/+/133195</a> sw content controls: add initial DOCX import
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/133241">https://gerrit.libreoffice.org/c/core/+/133241</a> sw content controls: add insert UI
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/133314">https://gerrit.libreoffice.org/c/core/+/133314</a> sw content controls: add LOK API
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/133363">https://gerrit.libreoffice.org/c/core/+/133363</a> sw content controls, checkbox: add document model &amp; UNO API
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/133424">https://gerrit.libreoffice.org/c/core/+/133424</a> sw content controls, checkbox: toggle the checkbox on click
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/133467">https://gerrit.libreoffice.org/c/core/+/133467</a> sw content controls, checkbox: add ODT filter
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/133532">https://gerrit.libreoffice.org/c/core/+/133532</a> sw content controls, checkbox: add DOCX export
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/133588">https://gerrit.libreoffice.org/c/core/+/133588</a> sw content controls, checkbox: add DOCX import
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/133685">https://gerrit.libreoffice.org/c/core/+/133685</a> sw content controls, checkbox: add insert UI
</p>
</li>
</ul></div>
<div class="paragraph"><p>To make this even more interesting, Rashesh Padia of Collabora started exposing this in Collabora
Online, see the PR at <a href="https://github.com/CollaboraOnline/online/pull/4703">https://github.com/CollaboraOnline/online/pull/4703</a>.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_want_to_start_using_this">Want to start using this?</h2>
<div class="sectionbody">
<div class="paragraph"><p>You can get a snapshot / demo of Collabora Office 2022 and try it out yourself right now:
<a href="https://www.collaboraoffice.com/collabora-office-latest-snapshot/">try unstable snapshot</a>.  Collabora
intends to continue supporting and contributing to LibreOffice, the code is merged so we expect all
of this work will be available in TDF&#8217;s next release too (7.4).</p></div>
</div>
</div>

  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/sw-clearing-breaks.html">Clearing breaks in Writer</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Mon 04 April 2022</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 4 minutes</p>
  </div>
  <div class="article_text">
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>Writer now supports what we call clearing breaks: a new property on line breaks which controls where
to put the next line in case the line break is at the end of a line which intersects with an
anchored object. This feature improves compatibility with the DOCX and HTML formats.</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-clearing-break/all-new.png" alt="https://share.vmiklos.hu/blog/sw-clearing-break/all-new.png" />
</div>
<div class="title">Figure 1. Word-style "all" clearing in Writer, new result.</div>
</div>
<div class="paragraph"><p>First, thanks to <a href="https://dapsi.ngi.eu/">NGI DAPSI</a> who made this work by
<a href="https://www.collaboraoffice.com/">Collabora</a> possible.</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-clearing-break/eu.png" alt="https://share.vmiklos.hu/blog/sw-clearing-break/eu.png" />
</div>
<div class="title">Figure 2. This project has received funding from the European Unionâ€™s Horizon 2020 research and innovation programme under grant agreement No 871498</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_motivation">Motivation</h2>
<div class="sectionbody">
<div class="paragraph"><p>Word users expect to be able to import their documents to Writer and experience high fidelity
rendering: this means Writer has to support clearing breaks, which instruct the layout to put the
next line after a line break not necessarily at the next available vertical position, but perhaps
the next line should "just down" to the next full line, or perhaps just do this partially. (Jump
down to the next line, so no anchored object causes an additional indentation on the left or right
side.)</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_results">Results</h2>
<div class="sectionbody">
<div class="paragraph"><p>The easiest case is the "none" clearing break, i.e. when it&#8217;s not actually clearing. This looks like this:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-clearing-break/none-new.png" alt="https://share.vmiklos.hu/blog/sw-clearing-break/none-new.png" />
</div>
<div class="title">Figure 3. Word-style not clearing break, new result.</div>
</div>
<div class="paragraph"><p>This is just a plain line break, and there are no changes here. It used to look like this in the past as well:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-clearing-break/none-old.png" alt="https://share.vmiklos.hu/blog/sw-clearing-break/none-old.png" />
</div>
<div class="title">Figure 4. Word-style not clearing break, old result.</div>
</div>
<div class="paragraph"><p>And both match the reference rendering:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-clearing-break/none-ref.png" alt="https://share.vmiklos.hu/blog/sw-clearing-break/none-ref.png" />
</div>
<div class="title">Figure 5. Word-style not clearing break, reference.</div>
</div>
<div class="paragraph"><p>Now, what&#8217;s more interesting is the "all" clearing break, when the next line is placed in a way that
it&#8217;s a full line. Figure 1 already shows how it now looks like in Writer. Here is how it used to
look like:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-clearing-break/all-old.png" alt="https://share.vmiklos.hu/blog/sw-clearing-break/all-old.png" />
</div>
<div class="title">Figure 6. Word-style "all" clearing break, old result.</div>
</div>
<div class="paragraph"><p>Finally you can compare that with the reference:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-clearing-break/all-ref.png" alt="https://share.vmiklos.hu/blog/sw-clearing-break/all-ref.png" />
</div>
<div class="title">Figure 7. Word-style "all" clearing break, reference.</div>
</div>
<div class="paragraph"><p>This is the most interesting case, and Word still provides UI to insert such breaks, so it
frequently appears in documents out there. But there are two other cases, still. The "left" clearing
break "jumps down", below anchored objects on the left. Here is how it looks now in Writer:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-clearing-break/left-new.png" alt="https://share.vmiklos.hu/blog/sw-clearing-break/left-new.png" />
</div>
<div class="title">Figure 8. Word-style "left" clearing break, new result</div>
</div>
<div class="paragraph"><p>And this is how it used to look like:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-clearing-break/left-old.png" alt="https://share.vmiklos.hu/blog/sw-clearing-break/left-old.png" />
</div>
<div class="title">Figure 9. Word-style "left" clearing break, old result</div>
</div>
<div class="paragraph"><p>Finally you can compare that with the reference:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-clearing-break/left-ref.png" alt="https://share.vmiklos.hu/blog/sw-clearing-break/left-ref.png" />
</div>
<div class="title">Figure 10. Word-style "left" clearing break, reference</div>
</div>
<div class="paragraph"><p>The last case is the mirror of this, when the "right" clearing break "jumps down", below anchored
objects on the right. Here is how it looks now in Writer:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-clearing-break/right-new.png" alt="https://share.vmiklos.hu/blog/sw-clearing-break/right-new.png" />
</div>
<div class="title">Figure 11. Word-style "right" clearing break, new result</div>
</div>
<div class="paragraph"><p>And this is how it used to look like:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-clearing-break/right-old.png" alt="https://share.vmiklos.hu/blog/sw-clearing-break/right-old.png" />
</div>
<div class="title">Figure 12. Word-style "right" clearing break, old result</div>
</div>
<div class="paragraph"><p>Finally you can compare that with the reference:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-clearing-break/right-ref.png" alt="https://share.vmiklos.hu/blog/sw-clearing-break/right-ref.png" />
</div>
<div class="title">Figure 13. Word-style "right" clearing break, reference</div>
</div>
<div class="paragraph"><p>Other than the layout, there is also user interface for this in both LibreOffice and Collabora Online:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-clearing-break/ui.png" alt="https://share.vmiklos.hu/blog/sw-clearing-break/ui.png" />
</div>
<div class="title">Figure 14. Insert break dialog in Collabora Online, with a new option for clearing breaks</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_is_this_implemented">How is this implemented?</h2>
<div class="sectionbody">
<div class="paragraph"><p>If you would like to know a bit more about how this works, continue reading&#8230; :-)</p></div>
<div class="paragraph"><p>As usual, the high-level problem was addressed by a series of incremental commits:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/130687">https://gerrit.libreoffice.org/c/core/+/130687</a> sw clearing breaks: add document model
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/130741">https://gerrit.libreoffice.org/c/core/+/130741</a> sw clearing breaks: add UNO API to insert this
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/130818">https://gerrit.libreoffice.org/c/core/+/130818</a> sw clearing breaks: add UNO API to insert this with custom clear / char props
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/130903">https://gerrit.libreoffice.org/c/core/+/130903</a> sw clearing breaks: include this in the UNO API text portion enum
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/130961">https://gerrit.libreoffice.org/c/core/+/130961</a> sw clearing breaks: initial layout support
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/131093">https://gerrit.libreoffice.org/c/core/+/131093</a> sw clearing breaks: fix rendering of the line break char itself
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/131167">https://gerrit.libreoffice.org/c/core/+/131167</a> sw clearing breaks: add DOCX import
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/131231">https://gerrit.libreoffice.org/c/core/+/131231</a> sw clearing breaks: add DOCX export
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/131297">https://gerrit.libreoffice.org/c/core/+/131297</a> sw clearing breaks: fix layout when the line is empty
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/131346">https://gerrit.libreoffice.org/c/core/+/131346</a> sw clearing breaks: add ODF export
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/131645">https://gerrit.libreoffice.org/c/core/+/131645</a> sw clearing breaks: add ODF import
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/131697">https://gerrit.libreoffice.org/c/core/+/131697</a> sw clearing breaks: add DOC import
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/131732">https://gerrit.libreoffice.org/c/core/+/131732</a> sw clearing breaks: add DOC export
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/131886">https://gerrit.libreoffice.org/c/core/+/131886</a> sw clearing breaks: add RTF filter
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/131924">https://gerrit.libreoffice.org/c/core/+/131924</a> sw clearing breaks: add HTML filter
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/131958">https://gerrit.libreoffice.org/c/core/+/131958</a> sw clearing breaks: add plain text export
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/132024">https://gerrit.libreoffice.org/c/core/+/132024</a> sw clearing breaks: add insert UI
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/132093">https://gerrit.libreoffice.org/c/core/+/132093</a> sw clearing breaks: add clearing indicator during rendering
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/132162">https://gerrit.libreoffice.org/c/core/+/132162</a> sw clearing breaks: add layout support for the left and right cases
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/132317">https://gerrit.libreoffice.org/c/core/+/132317</a> sw clearing breaks: link ODF proposal
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_want_to_start_using_this">Want to start using this?</h2>
<div class="sectionbody">
<div class="paragraph"><p>You can get a snapshot / demo of Collabora Office 2022 and try it out yourself right now:
<a href="https://www.collaboraoffice.com/collabora-office-latest-snapshot/">try unstable snapshot</a>.  Collabora
intends to continue supporting and contributing to LibreOffice, the code is merged so we expect all
of this work will be available in TDF&#8217;s next release too (7.4).</p></div>
</div>
</div>

  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/sw-page-table-para-border.html">Word-style border fixes in Writer: pages, tables and paragraphs</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Tue 08 March 2022</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 3 minutes</p>
  </div>
  <div class="article_text">
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>Writer now has a set of improvements to better render Word-style borders around pages, tables and
paragaphs. This required adjusting how we perform automatic mirroring and also to make sure that
clipping is done the Word way.</p></div>
<div class="paragraph"><p>First, thanks <a href="https://www.docmosis.com/">Docmosis</a> and <a href="https://www.tubitak.gov.tr/en">TUBITAK</a> who
made this work by <a href="https://www.collaboraoffice.com/">Collabora</a> possible.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_motivation">Motivation</h2>
<div class="sectionbody">
<div class="paragraph"><p>Word users expect to able to import their documents to Writer and experience high fidelity
rendering: this means Writer has to support the way page / table / paragraph borders are painted
according to the OOXML model as well. This is all done conditionally, so existing ODF documents are
left unchanged.</p></div>
<div class="paragraph"><p>This is a set of 5 bugfixes, requested by multiple of our customers.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_results">Results</h2>
<div class="sectionbody">
<div class="paragraph"><p>First let&#8217;s look at the new render result for page borders:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-page-table-para-border/page-border-new.png" alt="https://share.vmiklos.hu/blog/sw-page-table-para-border/page-border-new.png" />
</div>
<div class="title">Figure 1. Word-style page borders, new result</div>
</div>
<div class="paragraph"><p>And this is how it used to look like:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-page-table-para-border/page-border-old.png" alt="https://share.vmiklos.hu/blog/sw-page-table-para-border/page-border-old.png" />
</div>
<div class="title">Figure 2. Word-style page borders, old result</div>
</div>
<div class="paragraph"><p>Finally you can compare that with the reference:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-page-table-para-border/page-border-ref.png" alt="https://share.vmiklos.hu/blog/sw-page-table-para-border/page-border-ref.png" />
</div>
<div class="title">Figure 3. Word-style page borders, reference</div>
</div>
<div class="paragraph"><p>What you can see here is that the page has a double border: the outer line is thick and the inner
line is thin. The right and bottom border was incorrect as our result was the opposite of the
reference.</p></div>
<div class="paragraph"><p>Second, let&#8217;s look at the new render result for table borders:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-page-table-para-border/table-border-new.png" alt="https://share.vmiklos.hu/blog/sw-page-table-para-border/table-border-new.png" />
</div>
<div class="title">Figure 4. Word-style table borders, new result</div>
</div>
<div class="paragraph"><p>And this is how it used to look like:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-page-table-para-border/table-border-old.png" alt="https://share.vmiklos.hu/blog/sw-page-table-para-border/table-border-old.png" />
</div>
<div class="title">Figure 5. Word-style table borders, old result</div>
</div>
<div class="paragraph"><p>Finally you can compare that with the reference:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-page-table-para-border/table-border-ref.png" alt="https://share.vmiklos.hu/blog/sw-page-table-para-border/table-border-ref.png" />
</div>
<div class="title">Figure 6. Word-style table borders, reference</div>
</div>
<div class="paragraph"><p>You can notice a number of problems here:</p></div>
<div class="ulist"><ul>
<li>
<p>
the inner horizontal line at the top table was overrunning, it was even painted between the two
  lines of the outer double border
</p>
</li>
<li>
<p>
the middle table shows how the vertical thick and thin lines of the outer double border was
  reversed
</p>
</li>
<li>
<p>
the bottom table shows how the horizontal tick inner border was not consistent
</p>
</li>
</ul></div>
<div class="paragraph"><p>The new render result properly clips the inner border lines, so they don&#8217;t intersect outer borders,
and the border mirroring (similar to the page borders) is now correct for table borders as well.</p></div>
<div class="paragraph"><p>Third, let&#8217;s look at the new render result for paragraph borders:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-page-table-para-border/para-border-new.png" alt="https://share.vmiklos.hu/blog/sw-page-table-para-border/para-border-new.png" />
</div>
<div class="title">Figure 7. Word-style paragraph borders, new result</div>
</div>
<div class="paragraph"><p>And this is how it used to look like:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-page-table-para-border/para-border-old.png" alt="https://share.vmiklos.hu/blog/sw-page-table-para-border/para-border-old.png" />
</div>
<div class="title">Figure 8. Word-style paragraph borders, old result</div>
</div>
<div class="paragraph"><p>Finally you can compare that with the reference:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/sw-page-table-para-border/para-border-ref.png" alt="https://share.vmiklos.hu/blog/sw-page-table-para-border/para-border-ref.png" />
</div>
<div class="title">Figure 9. Word-style paragraph borders, reference</div>
</div>
<div class="paragraph"><p>What&#8217;s visible here is that some paragraph inside the table cell had borders defined, but due to how
the reference clips these borders, this border was not visible. That unexpected border is now also
omitted in Writer.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_how_is_this_implemented">How is this implemented?</h2>
<div class="sectionbody">
<div class="paragraph"><p>If you would like to know a bit more about how this works, continue reading&#8230; :-)</p></div>
<div class="paragraph"><p>As usual, the high-level problem was addressed by a series of bugfix changes.</p></div>
<div class="paragraph"><p>For the page border:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/129281">https://gerrit.libreoffice.org/c/core/+/129281</a> sw: fix swapped inner vs outer border for Word-style right/bottom page borders
</p>
</li>
</ul></div>
<div class="paragraph"><p>For the table border:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/128053">https://gerrit.libreoffice.org/c/core/+/128053</a> sw: fix too long inner borders intersecting with outer borders for Word cells
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/128289">https://gerrit.libreoffice.org/c/core/+/128289</a> sw: fix swapped inner vs outer border for Word-style left table borders
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/128383">https://gerrit.libreoffice.org/c/core/+/128383</a> sw: fix swapped inner vs outer border for Word-style bottom table borders
</p>
</li>
</ul></div>
<div class="paragraph"><p>For the paragraph border:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/128569">https://gerrit.libreoffice.org/c/core/+/128569</a> sw: fix unexpected paragraph border inside table cells
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_want_to_start_using_this">Want to start using this?</h2>
<div class="sectionbody">
<div class="paragraph"><p>You can get a snapshot / demo of Collabora Office and try it out yourself right now:
<a href="https://www.collaboraoffice.com/collabora-office-latest-snapshot/">try unstable snapshot</a>.  Collabora
intends to continue supporting and contributing to LibreOffice, the code is merged so we expect all
of this work will be available in TDF&#8217;s next release too (7.4).</p></div>
</div>
</div>

  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/pdf-convert-to.html">Improved PDF export options in the command-line and in Online</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Tue 08 February 2022</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 3 minutes</p>
  </div>
  <div class="article_text">
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>The LibreOffice Technology now has much better support for creating custom PDF exports of documents:
options available in the interactive PDF export options dialog are now also possible to set from the
command-line, and also when using the document conversion feature of
<a href="https://www.collaboraoffice.com/document-conversion/">Collabora Online</a>.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_motivation">Motivation</h2>
<div class="sectionbody">
<div class="paragraph"><p>I was working on a regression that only happens if you export the second and third pages of a
document to PDF. While investigating, I needed a quick way to trigger the problematic code-path, and
clicking through a dialog is not convenient.</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://share.vmiklos.hu/blog/pdf-convert-to/pdf-export-partial.png" alt="https://share.vmiklos.hu/blog/pdf-convert-to/pdf-export-partial.png" />
</div>
<div class="title">Figure 1. UI to specify a partial export to PDF</div>
</div>
<div class="paragraph"><p>The PDF export in LibreOffice has a lot of options, but those are only available from extension code
(using the UNO API) or from the UI dialog. The idea was to expose much of this to the <code>soffice
--convert-to</code> command as well, and if we&#8217;re at it, also to the <code>/cool/convert-to</code> endpoint of
Online.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_results_so_far">Results so far</h2>
<div class="sectionbody">
<div class="paragraph"><p>Here are a few examples to show the possibilities:</p></div>
<div class="ulist"><ul>
<li>
<p>
Skip the first page of a Draw document:
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content">
<pre><code>soffice --convert-to 'pdf:draw_pdf_Export:{"PageRange":{"type":"string","value":"2-"}}' test.odg</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
Add watermark:
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content">
<pre><code>soffice --convert-to 'pdf:draw_pdf_Export:{"TiledWatermark":{"type":"string","value":"draft"}}' test.odg</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
Encrypt the output:
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content">
<pre><code>soffice --convert-to 'pdf:draw_pdf_Export:{"EncryptFile":{"type":"boolean","value":"true"},"DocumentOpenPassword":{"type":"string","value":"secret"}}' test.odg</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
We default to PDF 1.6, perhaps you want to write PDF 1.5:
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content">
<pre><code>soffice --convert-to 'pdf:draw_pdf_Export:{"SelectPdfVersion":{"type":"long","value":"15"}}' test.odg</code></pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
Sign the PDF:
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content">
<pre><code>soffice --convert-to 'pdf:draw_pdf_Export:{"SignPDF":{"type":"boolean","value":"true"},"SignCertificateSubjectName":{"type":"string","value":"CN=..."}}' test.odg</code></pre>
</div></div>
<div class="paragraph"><p>And the best is that the same also works in Online, e.g.:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>curl -k -F "data=@3page.odg" -F "format=pdf" -F "options={\"PageRange\":{\"type\":\"string\",\"value\":\"2-\"}}" https://localhost:9980/cool/convert-to &gt; out.pdf</code></pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_how_is_this_implemented">How is this implemented?</h2>
<div class="sectionbody">
<div class="paragraph"><p>If you would like to know a bit more about how this works, continue reading&#8230; :-)</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/128643">https://gerrit.libreoffice.org/c/core/+/128643</a> <em>tdf#141340 PDF export: fix hyperlinks on the wrong
  page with page num range</em> was the use-case that initially motivated to add the feature.
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/128709">https://gerrit.libreoffice.org/c/core/+/128709</a> <em>comphelper: move JsonToPropertyValues() from
  desktop/</em> was grounding work to use the "convert JSON to a string-any map" functionality we
  already had in core.git, as part of the LOK API.
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/128849">https://gerrit.libreoffice.org/c/core/+/128849</a> <em>PDF export: allow setting filter data keys from
  the cmdline</em> is the actual improvement to the PDF exporter
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/128970">https://gerrit.libreoffice.org/c/core/+/128970</a> <em>desktop lok, export options: allow passing through
  a JSON string as-is</em> is a tweak to let the LOK API also use this
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/c/core/+/129387">https://gerrit.libreoffice.org/c/core/+/129387</a> <em>filter: allow PDF export to sign from the cmdline</em>
  added the PDF signing as a string option, since referring to a certificate object from the command-line
  was not possible
</p>
</li>
<li>
<p>
<a href="https://github.com/CollaboraOnline/online/pull/4069">https://github.com/CollaboraOnline/online/pull/4069</a> <em>wsd, convert-to: allow specifying filter
  options as JSON</em> implemented the Online side
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_want_to_start_using_this">Want to start using this?</h2>
<div class="sectionbody">
<div class="paragraph"><p>You can get a snapshot / demo of Collabora Office and try it out yourself right now:
<a href="https://www.collaboraoffice.com/collabora-office-latest-snapshot/">try unstable snapshot</a>.  Collabora
intends to continue supporting and contributing to LibreOffice, the code is merged so we expect all
of this work will be available in TDF&#8217;s next release too (7.4).</p></div>
<div class="paragraph"><p>For the Online side, see the <a href="https://www.collaboraoffice.com/code/">CODE</a> page, the feature is
present in the current release (2021).</p></div>
</div>
</div>

  </div>
</article>

<footer>
<div id="paginator">
<a href="https://vmiklos.hu/blog/index2.html" class="button_accent">&larr; Older Posts</a>

</div>
</footer>

    <div id="ending_message">
      <p>&copy; Miklos Vajna. Built using <a href="http://getpelican.com" target="_blank">Pelican</a>. Theme by Giulio Fidente on <a href="https://github.com/gfidente/pelican-svbhack" target="_blank">github</a>. </p>
    </div>
  </main>
</body>
</html>