<!DOCTYPE html>
<html lang="en">

<head>
  <!-- ## for client-side less
  <link rel="stylesheet/less" type="text/css" href="https://vmiklos.hu/blog/theme/css/style.less">
  <script src="http://cdnjs.cloudflare.com/ajax/libs/less.js/1.7.3/less.min.js" type="text/javascript"></script>
  -->
  <link rel="stylesheet" type="text/css" href="https://vmiklos.hu/blog/theme/css/style.css">
  <link rel="stylesheet" type="text/css" href="https://vmiklos.hu/blog/theme/css/pygments.css">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Miklos Vajna">
  <meta name="description" content="Posts and writings by Miklos Vajna">

  <link href="https://vmiklos.hu/blog/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="What is Miklos hacking RSS" />


  <title>
    What is Miklos hacking
&ndash; Tag: en  </title>

<script type="text/javascript">
  var _paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//analytics.vmiklos.hu/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
</head>

<body>
  <aside>
    <div id="user_meta">
      <h2><a href="https://vmiklos.hu/blog">What is Miklos hacking</a></h2>
      <p></p>
      <ul>
        <li><a href="/" target="_blank">Root</a></li>
        <li><a href="https://planet.documentfoundation.org/" target="_blank">LibreOffice Blogs</a></li>
      </ul>
    </div>
  </aside>

  <main>
    <header>
      <p>
      <a href="https://vmiklos.hu/blog">Index</a> &brvbar; <a href="https://vmiklos.hu/blog/archives.html">Archives</a>
      &brvbar; <a href="https://vmiklos.hu/blog/feeds/all.rss.xml">RSS</a>
&gt; Tag: en
      </p>
    </header>

<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/base-form.html">Fixing Base form image backgrounds</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Wed 16 September 2015</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 2 minutes</p>
  </div>
  <div class="article_text">
    <div id="preamble">
<div class="sectionbody">
<div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://lh3.googleusercontent.com/-G5jug0myAVY/Vfh1U_i-QTI/AAAAAAAAGFQ/eZ-GKJqxqMU/s0-Ic42/">
<img src="https://lh3.googleusercontent.com/-G5jug0myAVY/Vfh1U_i-QTI/AAAAAAAAGFQ/eZ-GKJqxqMU/s640-Ic42/" alt="https://lh3.googleusercontent.com/-G5jug0myAVY/Vfh1U_i-QTI/AAAAAAAAGFQ/eZ-GKJqxqMU/s640-Ic42/" />
</a>
</div>
</div>
<div class="paragraph"><p>In this post I want to go further, and after
<a href="https://vmiklos.hu/blog/calc-header.html">touching Calc</a>, here is my first story
about Base. Of course I lie, it seems that Base forms are kind of read-only
Writer documents, at least that&#8217;s how I could fix the bug I&#8217;m describing here.
:-) The topic is still the same, rounding rough edges after the fill
attributes rework, this time a stretched background of a Base form. (Which was
not stretched at all, it was simply centered both horizontally and vertically
on the page.)</p></div>
<div class="paragraph"><p>I&#8217;m not entirely sure how the document from
<a href="https://bugs.documentfoundation.org/show_bug.cgi?id=92586">tdf#92586</a> is
created, but the interesting part from styles.xml is:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;style:page-layout-properties</span></span> ... <span style="color: #009900">style:repeat</span><span style="color: #990000">=</span><span style="color: #FF0000">"no-repeat"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
     <span style="font-weight: bold"><span style="color: #0000FF">&lt;style:background-image</span></span> ... <span style="color: #009900">style:repeat</span><span style="color: #990000">=</span><span style="color: #FF0000">"stretch"</span><span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/style:page-layout-properties&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>So the schema allows specifying the way how the bitmap is repeated at two
places, and in the past the later attribute won, and with the rework this got
lost.</p></div>
<div class="paragraph"><p>An additional problem that
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=6621da38b3cd217314c2d2295fd1e71be7e1875e">the
commit</a> had to solve is that the attribute on the page-layout-properties XML
element is mapped to our
<a href="http://api.libreoffice.org/docs/idl/ref/servicecom_1_1sun_1_1star_1_1drawing_1_1FillProperties.html#acd89f2a230dfdf0be3f6c840c2630871">FillBitmapMode</a>
API, while the attribute with the same name on the background-image XML
element is mapped to the
<a href="http://api.libreoffice.org/docs/idl/ref/servicecom_1_1sun_1_1star_1_1style_1_1PageProperties.html#a229455fd0417732944f850139fdf96d5">BackGraphicLocation</a>
API, which is specific to Writer. As a result, now there is a compatibility
map from the old enumeration to the new one, that&#8217;s how the bug document is
now rendered the same again, as in the past.</p></div>
<div class="paragraph"><p>The fix is already backported to the <code>libreoffice-5-0</code> branch.</p></div>
</div>
</div>

  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/calc-header.html">Fixing Calc header image backgrounds</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Wed 02 September 2015</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 1 minutes</p>
  </div>
  <div class="article_text">
    <div id="preamble">
<div class="sectionbody">
<div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://lh3.googleusercontent.com/-u9SiImjl99k/VecKvEnT6lI/AAAAAAAAGDs/sNUH3OIlk4Y/s0-Ic42/">
<img src="https://lh3.googleusercontent.com/-u9SiImjl99k/VecKvEnT6lI/AAAAAAAAGDs/sNUH3OIlk4Y/s640-Ic42/" alt="https://lh3.googleusercontent.com/-u9SiImjl99k/VecKvEnT6lI/AAAAAAAAGDs/sNUH3OIlk4Y/s640-Ic42/" />
</a>
</div>
</div>
<div class="paragraph"><p>I think this is my first Calc bugfix. :-) The problem I wanted to fix is that
while LibreOffice 4.4 learned advanced
<a href="https://gerrit.libreoffice.org/gitweb?p=core.git&amp;a=search&amp;h=HEAD&amp;st=commit&amp;s=fillattributes">fill
attributes</a> (gradients, hatches, etc) for page headers / footers in Writer,
this broke the saving of simple graphic header backgrounds in Calc. Seeing
that no-one stepped up to fix this, I tried to do this myself&#8201;&#8212;&#8201;and luckily
the problem was in the ODF export filter, which is much more familiar to me,
compared to Calc core.</p></div>
<div class="paragraph"><p>Part of that larger feature was changes to the ODF filter, and
<a href="https://bugs.documentfoundation.org/show_bug.cgi?id=89245">the bug</a> was exactly
about touching shared ODF filter code to please Writer without testing other
LibreOffice applications.</p></div>
<div class="paragraph"><p>The actual problem was
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=3b40329f9a64b93b1e1230b1bff74ed8cda8cd70">overlapping
constants</a>: as in multiple constants had the same numeric value. Such issues
are sometimes hard to track down, in this case it wasn&#8217;t <em>that</em> hard: the
context filter that tried to make sure we don&#8217;t write duplicated XML
attributes removed the background property when it tried to guard header
repeat offsets.</p></div>
<div class="paragraph"><p>Given that this affected the LibreOffice 4.4 and 5.0 series, both branches got
a backport of the commit, and so the next release from those lines will have
the fix.</p></div>
</div>
</div>

  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/virtualdevice-leak.html">8884 VirtualDevices</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Tue 18 August 2015</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 2 minutes</p>
  </div>
  <div class="article_text">
    <div id="preamble">
<div class="sectionbody">
<div style="text-align: center; font-size: 0.6em;">
<img src="https://lh3.googleusercontent.com/-RAsPMFc8JVk/VdH9h_W4r_I/AAAAAAAAF6U/PDpQIbBtPKg/s475-Ic42/"/>
<p>(via <a href="http://www.teq.com/smart-pointers">teq</a>)</p>
</div>
<div class="paragraph"><p>If you are into C++ programming, you probably know that smart pointers are
not just literally strange things like the above ones. ;-) LibreOffice 5.0 got
<a href="https://gerrit.libreoffice.org/gitweb?p=core.git;a=blob;f=vcl/README.lifecycle;h=6b5cbd6e8df4bcc77b28b0e296e50a96ca8899a0;hb=HEAD">VclPtr</a>,
which is smart pointer specialized to VCL&#8217;s needs.</p></div>
<div class="paragraph"><p>Such refactorings are good things, except that there is no huge rework without
regressions. In <a href="https://bugs.documentfoundation.org/show_bug.cgi?id=93284">this
case</a> the WMF filter had 3 places where we were leaking VirtualDevices due to
a misconversion to the new VclPtr API. The problem was that the document had
135 images, WMF files to be exact. Now given that the leaks were during
parsing of WMF records (a WMF file consists of multiple WMF records), at the
end we leaked 8884 VirtualDevices. At first the problem was seen as
Windows-specific, as at least X on Linux has no problem with creating that
many VirtualDevices, but Windows' default resource limits are hit in this
case.</p></div>
<div class="paragraph"><p>A note about testing this bugfix effectively, so it never happens again. The
problem was that I wanted to create a minimal reproducer, but I also needed a
document with lots of WMF images, each complex enough to trigger the resource
limit. At the end I manually created a DOCX file that had the same image
copy&amp;pasted multiple times: that way we really imported them multiple times
(normally we notice that they&#8217;re the same, and only save the image to the file
once, and put multiple references to it), and because DOCX is also a ZIP
container, the test file can be still only 99KB instead of the original 17MB
RTF.</p></div>
<div class="paragraph"><p>Thanks to the
<a href="https://wiki.documentfoundation.org/QA/Bibisect/Windows#Versions">4.4 &#8594; 5.0
Windows bibisect repo</a>, it was immediately obvious that this is a VclPtr
problem, and then it was possible to identify the root cause, and finally see
that the bug title mentioning RTF was just container of the WMF images in this
case, the problem had nothing to with with RTF and the leak wasn&#8217;t
Windows-specific, either.</p></div>
</div>
</div>

  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/mail-merge-embedding.html">Mail merge embedding</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Tue 28 July 2015</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 1 minutes</p>
  </div>
  <div class="article_text">
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>If you ever used the
<a href="https://help.libreoffice.org/Writer/Mail_Merge_Wizard">mail merge wizard</a> with
a Calc data source, then you know how it worked in the past: you&#8217;ve got 3
files: the .odt mail template, the .ods data source and a .odb data source
definition that defines how to access the .ods.</p></div>
<div class="paragraph"><p>The target of this <a href="http://www.muenchen.de/">LHM-funded project</a> was to get rid
of the .odb file and just embed it into the .odt mail template. Why?</p></div>
<div class="paragraph"><p>Here is the problem description from a user&#8217;s point of view: "When a mail
merge document is being saved a separate database file is being automatically
created. It links the Writer file to the spreadsheet (ODS, XLS, XLSX etc.) as
data source. This additional 2kB ODB file confuses users, they might delete it
without knowing to break the connection to the data source." An additional
problem is that because the non-embedded data source definition is part of the
user profile, you can&#8217;t just move the three files to an other machine, as .odb
registration will be missing there.</p></div>
<div class="paragraph"><p>If you are interested how this looks like, here is a demo (click on the image
to see the video):</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<a class="image" href="https://youtu.be/5iQFZBOz8rM">
<img src="https://lh3.googleusercontent.com/-XDcWgOWKr2k/Vbc4blHURTI/AAAAAAAAF4E/VXFBglt-YmU/s800-Ic42/" alt="https://lh3.googleusercontent.com/-XDcWgOWKr2k/Vbc4blHURTI/AAAAAAAAF4E/VXFBglt-YmU/s800-Ic42/" />
</a>
</div>
</div>
<div class="paragraph"><p>That&#8217;s it for now&#8201;&#8212;&#8201;as usual the commits are in master, so you can try this
right now with a 5.1 <a href="http://dev-builds.libreoffice.org/daily/master/">daily
build</a>. :-)</p></div>
</div>
</div>

  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/ctags-sal-override.html">ctags vs override/SAL_OVERRIDE</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Mon 29 June 2015</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 1 minutes</p>
  </div>
  <div class="article_text">
    <div id="preamble">
<div class="sectionbody">
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://lh3.googleusercontent.com/-9Hd40EVT8aw/VZBhBTZQdTI/AAAAAAAAFyM/AfymfTqKDFw/s0/" alt="https://lh3.googleusercontent.com/-9Hd40EVT8aw/VZBhBTZQdTI/AAAAAAAAFyM/AfymfTqKDFw/s0/" />
</div>
</div>
<div class="paragraph"><p>If you use <a href="http://ctags.sourceforge.net/">ctags</a> to help your LibreOffice
development, there are already good descriptions for that&#8201;&#8212;&#8201;e.g. for vim
there is one <a href="https://wiki.documentfoundation.org/Development/Vim#ctags">on the
TDF wiki</a>.</p></div>
<div class="paragraph"><p>What was problematic is that since C++11, <code>override</code> is a valid keyword
after a member function declaration, and we have our <code>SAL_OVERRIDE</code> macro that
I
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=3891d323cdc3c03154f5682baaeaa4b2ef015a63">added</a>
to be able to use it before all our supported compilers recognize it.
Unsupported parsers include ctags, so if a member function have SAL_OVERRIDE,
ctags only indexed the definition, not the declaration.</p></div>
<div class="paragraph"><p>I created patches to fix these problems in ctags, the
<a href="https://sourceforge.net/p/ctags/bugs/367/">override one</a> is probably
interesting for all C++ projects, the
<a href="https://github.com/vmiklos/ctags-svn/commit/ef53a231db5b428585324f266072b884e17bae52">SAL_OVERRIDE
one</a> is LibreOffice-specific.</p></div>
<div class="paragraph"><p>The hope is that the later will go away in the long run, so it won&#8217;t really be
a problem that ctags do not recognize that macro out of the box. :-)</p></div>
</div>
</div>

  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/resourcemodel.html">Cleanup of resourcemodel in LibreOffice</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Mon 08 June 2015</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 1 minutes</p>
  </div>
  <div class="article_text">
    <div id="preamble">
<div class="sectionbody">
<div style="text-align: center; font-size: 0.6em;">
<img src="https://lh3.googleusercontent.com/-YxMHx754A4A/VXQbB0-TMBI/AAAAAAAAFos/Nx6SlKp1JF4/s400/"/>
<p>(via <a href="https://www.flickr.com/photos/jbparrott/9381120992/">jbparrott</a>)</p>
</div>
<div class="paragraph"><p>The <code>libreoffice-5-0</code> branch is created, and in each release cycle there is at
least one topic that was a long overdue cleanup. In this post, I&#8217;m describing
how and why the <code>writerfilter/inc/resourcemodel/</code> and
<code>writerfilter/source/resourcemodel/</code> directories disappeared&#8201;&#8212;&#8201;though
probably nobody will miss them. :-)</p></div>
<div class="paragraph"><p>The resourcemodel building block of writerfilter (that handles Writer&#8217;s DOCX
and RTF import in LibreOffice) was basically a bucket of old and unused
<a href="https://www.youtube.com/watch?v=MvgN5gCuLac">stuff</a>.  After the removal of the
unused <a href="https://vmiklos.hu/blog/doctok.html">.DOC tokenizer</a>, it turned out that
most of that code was just referring to itself or template code that was used
with a single type only (hello
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=45234fd21ad76b7732be4e5783cc7dd5dcf2daa2">TableManager</a>).
resourcemodel was about 6000 lines of code at the time LibreOffice was
started, and after some manual cleanup and moving the still needed small part
to dmapper (the shared part of the RTF / DOCX import), tools like
<a href="http://cgit.freedesktop.org/libreoffice/core/tree/compilerplugins/clang/unreffun.cxx">loplugin:unreffun</a>
and <a href="https://github.com/caolanm/callcatcher">callcatcher</a> helped to detect what
became truly unused&#8201;&#8212;&#8201;at the end resulting in the complete removal of these
directories.</p></div>
<div class="paragraph"><p>That means that after folding the
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=fcec34ffcc93f98be005b06c223e25c9c4e77cde">last
remaining header into dmapper</a>, the relevant
<a href="http://cgit.freedesktop.org/libreoffice/core/tree/writerfilter/README">documentation</a>
can hopefully now describe source contents easier, having just 4 directories:
the RTF and the DOCX tokenizer, the shared part and the UNO service
implementations. One less cryptic leftover nobody really knows what it is! ;-)</p></div>
</div>
</div>

  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/cambridge.html">LibreOffice Cambridge Hackfest</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Tue 26 May 2015</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 1 minutes</p>
  </div>
  <div class="article_text">
    <div id="preamble">
<div class="sectionbody">
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://lh3.googleusercontent.com/-dGY38VD7z0M/VWNqvkXDLwI/AAAAAAAAFlE/8yurKsu0NcA/s400/" alt="https://lh3.googleusercontent.com/-dGY38VD7z0M/VWNqvkXDLwI/AAAAAAAAFlE/8yurKsu0NcA/s400/" />
</div>
</div>
<div class="paragraph"><p>The first ever UK LibreOffice Hackfest took place in the city of Cambridge on
May 21st to 23rd (Thursday &#8594; Saturday), kindly hosted by
<a href="https://libreoffice-from-collabora.com/">Collabora</a>.</p></div>
<div class="paragraph"><p>My starter idea was to fix
<a href="https://bugs.documentfoundation.org/show_bug.cgi?id=90315">tdf#90315</a>, i.e. to
support both nested tables and multiple columns with the proper spacing in
between them in the RTF import. For comparison, here is how this looked in
LibreOffice 3.4:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://lh3.googleusercontent.com/-KX9Z8y1ojYc/VWNzgg1gQeI/AAAAAAAAFlk/TRwfvnklEOI/s400/" alt="https://lh3.googleusercontent.com/-KX9Z8y1ojYc/VWNzgg1gQeI/AAAAAAAAFlk/TRwfvnklEOI/s400/" />
</div>
</div>
<div class="paragraph"><p>The table borders looked OK due to correct column spacing, but the nested
table is missing. Then here is the LibreOffice 4.4 state:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://lh3.googleusercontent.com/-wz4OZdsYf5I/VWNzgu5OhUI/AAAAAAAAFlg/CG37pRlGggY/s400/" alt="https://lh3.googleusercontent.com/-wz4OZdsYf5I/VWNzgu5OhUI/AAAAAAAAFlg/CG37pRlGggY/s400/" />
</div>
</div>
<div class="paragraph"><p>Nested table is OK, but the table borders are strange due to incorrect column
spacing. Finally here is how it looks like now, when the import result is
correct:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://lh3.googleusercontent.com/-Zul_8xTSOkA/VWNzguGZf-I/AAAAAAAAFlY/L88WkfCpL1E/s400/" alt="https://lh3.googleusercontent.com/-Zul_8xTSOkA/VWNzguGZf-I/AAAAAAAAFlY/L88WkfCpL1E/s400/" />
</div>
</div>
<div class="paragraph"><p>Other than this, here is a list of other topics I hacked on:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://gerrit.libreoffice.org/gitweb?p=dev-tools.git;a=commit;h=9107601036fc9af9e67b37f0fc26296dddfd6eb1">clang
  libtooling-based compiler tools</a> (so far an example analizer and a rewriter)
</p>
</li>
<li>
<p>
some
  <a href="https://gerrit.libreoffice.org/gitweb?p=core.git;a=tree;f=libreofficekit;hb=HEAD">gtktiledviewer</a>
  tweaks like handling of the "Search key not found" or the "Page count changed"
  callback event
</p>
</li>
<li>
<p>
<a href="https://gerrit.libreoffice.org/gitweb?p=core.git;a=commitdiff;h=821b72886f1e407a492f881a2efb27ead2c22b5c">o3tl::make_unique</a>,
  till we can&#8217;t use C++ 14 std::make_unique
</p>
</li>
</ul></div>
<div class="paragraph"><p>After fixing two more less interesting regressions, now it seems we&#8217;re down to
0 for the
<a href="https://bugs.documentfoundation.org/buglist.cgi?keywords=regression&amp;keywords_type=allwords&amp;product=LibreOffice&amp;query_format=advanced&amp;resolution=---&amp;short_desc=RTF&amp;short_desc_type=allwordssubstr">regressions
having RTF in their summary</a>, which is promising. :-)</p></div>
<div class="paragraph"><p>I few
<a href="https://www.flickr.com/photos/vmiklos/albums/72157673531303691">pictures</a>
I took while punting and a
<a href="/panoramas/cambridge.html">panorama</a> is available, too.</p></div>
</div>
</div>

  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/plugfest2015.html">Protocols Plugfest Europe 2015</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Mon 18 May 2015</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 1 minutes</p>
  </div>
  <div class="article_text">
    <div id="preamble">
<div class="sectionbody">
<div style="text-align: center; font-size: 0.6em;">
<img src="https://lh3.googleusercontent.com/-Z9Pml365x6s/VVdBsMKPYVI/AAAAAAAAFfk/9PXnepbXuak/s400/"/>
<p>(via <a href="https://twitter.com/plugfestcon/status/598062244711309312">plugfestcon</a>)</p>
</div>
<div class="paragraph"><p>Last week I went to Zaragoza to give a talk on
<a href="https://speakerdeck.com/vmiklos/libreoffice-how-we-handle-interoperability">how
LibreOffice handles interoperability</a> at Protocols Plugfest Europe 2015 on
<a href="http://www.protocolsplugfest.com/europe/program/">Tuesday</a>. Although I was told
this conference is a successor of the previous Zentyal Summit (and I were not
there) the conference seemed well-attended&#8201;&#8212;&#8201;proof above. :-)</p></div>
<div class="paragraph"><p>Jacobo also
<a href="http://blogs.igalia.com/jaragunde/2015/05/11/speaking-at-protocols-plugfest-2015/">gave
a LibreOffice-related talk</a> on Wednesday.</p></div>
<div class="paragraph"><p>On the same day, there were some explicit spare time, so I took the
opportunity to walk in the historical parts of the city, see
<a href="https://www.flickr.com/photos/vmiklos/albums/72157673233248251">my
photos</a> and a <a href="/panoramas/zaragoza.html">panorama</a> if that kind
of pictures are of your interest. FWIW, <a href="http://www.hotelsauce.com/en/">Hotel
Sauce</a> has free wifi in the rooms, that&#8217;s kind of impressing for a two-star
category. ;-)</p></div>
<div class="paragraph"><p>As usual, thanks <a href="https://libreoffice-from-collabora.com/">Collabora</a> for sponsoring this travel!</p></div>
</div>
</div>

  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/mathtype-import.html">MathType import in the RTF and DOCX filter</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Sun 03 May 2015</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 2 minutes</p>
  </div>
  <div class="article_text">
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>TL;DR: Import of old-style (pre-2010 for RTF, pre-2007 for DOCX) math
equations embedded into text documents should be now imported as editable
embedded math objects.</p></div>
<div class="paragraph"><p>Longer version: if you want to embed math equations into RTF or DOCX files,
you have two choices. The older approach is to embed a MathType OLE object
into the file, the newer one is a native OOXML markup, which has an RTF markup
equivalent as well. Handling of the later has been implemented by
<a href="http://llunak.blogspot.com/">Luboš Luňák</a> for DOCX a long time ago, and I
contributed the RTF equivalent almost
<a href="https://vmiklos.hu/blog/lo-rtf-math-native.html">3 years ago</a>.</p></div>
<div class="paragraph"><p>What remains is the handling of the older version, the embedded OLE object.
Previously only the replacement graphic was imported, so regardless of the
Tools &#8594; Options &#8594; Load / Save &#8594; Microsoft Office &#8594; MathType to Math
checkbox, the result was never editable.</p></div>
<div class="paragraph"><p>Here is how it looks like now:</p></div>
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://lh3.googleusercontent.com/-V3SqO3Rz88s/VUZvFcBNMPI/AAAAAAAAFb4/QARDYqQVQGY/s0/" alt="https://lh3.googleusercontent.com/-V3SqO3Rz88s/VUZvFcBNMPI/AAAAAAAAFb4/QARDYqQVQGY/s0/" />
</div>
</div>
<div class="paragraph"><p>Given that the RTF and the DOCX importers share lots of code in the
<code>writerfilter/</code> module, I implemented the same for the DOCX import at the same
time, too. The interesting challenge was that writerfilter wants an
<a href="http://api.libreoffice.org/docs/idl/ref/interfacecom_1_1sun_1_1star_1_1document_1_1XFilter.html">XFilter</a>
implementation for the embedded object if it is to be handled internally by
LibreOffice, but the MathType filter (originally created to handle math
objects inside binary DOC files) didn&#8217;t have one. Once I implemented such a
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=add60d233f70ff56472448bd50b3771f38974c52">filter
wrapper</a>, the
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=2a3e8b470edf2fe76188f9ccf6b0f32dfc817ea4">rest</a>
wasn&#8217;t too hard.</p></div>
<div class="paragraph"><p>Here are
<a href="http://cgit.freedesktop.org/libreoffice/core/tree/sw/qa/extras/rtfimport/data/mathtype.rtf">test</a>
<a href="http://cgit.freedesktop.org/libreoffice/core/tree/sw/qa/extras/ooxmlimport/data/mathtype.docx">documents</a>
if you want to try it yourself. You&#8217;ll need a 5.0
<a href="http://dev-builds.libreoffice.org/daily/master/">daily build</a> for that, though.
;-)</p></div>
<div class="paragraph"><p>If I&#8217;m at describing features new in LibreOffice Writer 5.0 file filters, here are a few more:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=830abf307aab9f9611db60b5c734fbafd3b3d8a3">Automatic hyphenation at a document
  level</a> and <a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=a3ec386c2283a196f8d9f1edd0ff97c38ddb281a">exceptions to it</a> is now
  imported in RTF. I also adjusted the
  <a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=a2fea109e6454b10e8e85148b93bdca89066fe8d">exporter</a>, so now Word sort of
  understands our hyphenation rules, replacing the OOo-specific custom
  hyphenation RTF extension that Word just ignored.
</p>
</li>
<li>
<p>
<a href="http://cgit.freedesktop.org/libreoffice/core/commit/?id=7546a904265cc0d0a0e3795cdb411cbb945a39fe">picture wrap distance properties</a>
  are now handled in the RTF importer&#8201;&#8212;&#8201;previously that was only handled for
  shapes.
</p>
</li>
</ul></div>
<div class="paragraph"><p>And a number of bugfixes for the RTF filter:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://bugs.documentfoundation.org/show_bug.cgi?id=86182">tdf#86182</a> better RTL paragraph handling
</p>
</li>
<li>
<p>
<a href="https://bugs.documentfoundation.org/show_bug.cgi?id=80708">tdf#80708</a> related to the improved old-style Writer table export handling work
</p>
</li>
<li>
<p>
<a href="https://bugs.documentfoundation.org/show_bug.cgi?id=90421">tdf#90421</a> hyperlink export tweak
</p>
</li>
</ul></div>
<div class="paragraph"><p>Do these sound interesting? Look at what others did for LibreOffice 5.0 on
<a href="https://wiki.documentfoundation.org/ReleaseNotes/5.0">the TDF wiki</a>, even if
it&#8217;s far from complete, as the 5.0 branch is not yet created. :-)</p></div>
</div>
</div>

  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="https://vmiklos.hu/blog/openit-2015.html">Open IT 2015</a></h1>
  </div>
  <div class="article_meta">
    <p>Posted on: Tue 21 April 2015</p>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 1 minutes</p>
  </div>
  <div class="article_text">
    <div id="preamble">
<div class="sectionbody">
<div class="imageblock" style="text-align:center;">
<div class="content">
<img src="https://lh3.googleusercontent.com/-bcwPYUJF04A/VTY_cdBo8bI/AAAAAAAAFac/B5ICyiGoKaY/s0/" alt="https://lh3.googleusercontent.com/-bcwPYUJF04A/VTY_cdBo8bI/AAAAAAAAFac/B5ICyiGoKaY/s0/" />
</div>
</div>
<div class="paragraph"><p>On Saturday I gave a talk at the <a href="http://openit.eventbrite.com/">Open IT 2015</a>
conference about the new features of LibreOffice 4.3 and 4.4.  My uploaded
slides are available
<a href="https://speakerdeck.com/vmiklos/4-dot-4-es-kiadasban">here</a>.</p></div>
<div class="paragraph"><p>Thanks <a href="https://www.uni-obuda.hu/en">Óbuda University</a> for hosting us, it was a
great event! Other than talking to the usual suspects like
<a href="http://zolnaitamas.blogspot.com/">Tamás Zolnai</a> or
<a href="https://plus.google.com/117194932353487735021/posts">Gábor Kelemen</a>, I enjoyed
two OpenStreetMap talks: it was extermely cool to hear that finally the
<a href="http://turistautak.hu/">turistautak.hu</a> community
<a href="http://wiki.openstreetmap.org/wiki/WikiProject_Hungary/Import%C3%A1l%C3%A1s/turistautak.hu">changed
their license</a> in February so that all their free maps can be imported to
OpenStreetMap&#8201;&#8212;&#8201;finally one pointless fight ends.</p></div>
</div>
</div>

  </div>
</article>

<footer>
<div id="paginator">
<a href="https://vmiklos.hu/blog/tag/en17.html" class="button_accent">&larr; Older Posts</a>

<a href="https://vmiklos.hu/blog/tag/en15.html" class="button_accent">Newer Posts &rarr;</a>
</div>
</footer>

    <div id="ending_message">
      <p>&copy; Miklos Vajna. Built using <a href="http://getpelican.com" target="_blank">Pelican</a>. Theme by Giulio Fidente on <a href="https://github.com/gfidente/pelican-svbhack" target="_blank">github</a>. </p>
    </div>
  </main>
</body>
</html>